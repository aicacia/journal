import{S as Pt,i as xt,s as jt,C as ge,O as kt,e as ae,P as Rt,m as st,h as X,n as K,b as pt,G as et,D as ye,E as ve,F as _e,g as lt,d as ht,q as At,r as St,u as we,J as Re,Q as Bt,k as ut,l as ct,H as Et,o as Ie,a as Mt,y as gt,c as Ot,z as yt,A as vt,v as re,f as ne,B as _t,I as be,ah as ue,V as Me,K as wt,L as Vt,M as Jt,N as Ct,W as It,R as Oe,a4 as Ce,ai as Ne,aj as Ue,ak as je,_ as De,al as Fe,am as Le,an as Be}from"./index.cf145e90.js";import{w as Ee,d as $e,b as Qt}from"./paths.a82b3aa9.js";import{_ as qe}from"./preload-helper.41c905a7.js";function ce(P){let t,a;return{c(){t=kt("title"),a=At(P[0])},l(i){t=Rt(i,"title",{});var f=st(t);a=St(f,P[0]),f.forEach(X)},m(i,f){pt(i,t,f),et(t,a)},p(i,f){f&1&&we(a,i[0])},d(i){i&&X(t)}}}function Ve(P){let t,a,i,f=P[0]&&ce(P);const u=P[3].default,v=ge(u,P,P[2],null);return{c(){t=kt("svg"),f&&f.c(),a=ae(),v&&v.c(),this.h()},l(M){t=Rt(M,"svg",{xmlns:!0,viewBox:!0,class:!0});var m=st(t);f&&f.l(m),a=ae(),v&&v.l(m),m.forEach(X),this.h()},h(){K(t,"xmlns","http://www.w3.org/2000/svg"),K(t,"viewBox",P[1]),K(t,"class","svelte-c8tyih")},m(M,m){pt(M,t,m),f&&f.m(t,null),et(t,a),v&&v.m(t,null),i=!0},p(M,[m]){M[0]?f?f.p(M,m):(f=ce(M),f.c(),f.m(t,a)):f&&(f.d(1),f=null),v&&v.p&&(!i||m&4)&&ye(v,u,M,M[2],i?_e(u,M[2],m,null):ve(M[2]),null),(!i||m&2)&&K(t,"viewBox",M[1])},i(M){i||(lt(v,M),i=!0)},o(M){ht(v,M),i=!1},d(M){M&&X(t),f&&f.d(),v&&v.d(M)}}}function Je(P,t,a){let{$$slots:i={},$$scope:f}=t,{title:u=null}=t,{viewBox:v}=t;return P.$$set=M=>{"title"in M&&a(0,u=M.title),"viewBox"in M&&a(1,v=M.viewBox),"$$scope"in M&&a(2,f=M.$$scope)},[u,v,f,i]}class Gt extends Pt{constructor(t){super(),xt(this,t,Je,Ve,jt,{title:0,viewBox:1})}}function Pe(P,t){return P[0]=(t&4278190080)>>24,P[1]=(t&16711680)>>16,P[2]=(t&65280)>>8,P[3]=t&255,P}const le=new Uint8Array(1),Ge=new Uint8Array(4),he=new Float32Array(1);class ze{writeByte(t){return le[0]=t,this.write(le)}writeInteger(t){return this.write(Pe(Ge,t))}writeFloat(t){return he[0]=t,this.write(new Uint8Array(he.buffer))}}function He(P){return P>>>1&1073741824|P&3221225471}class Ye extends ze{constructor(){super(...arguments),this.hash=0}finish(){return this.hash}write(t){let a=this.hash;for(let i=0,f=t.length;i<f;i++)a=31*a+t[i];return this.hash=He(a),this}}function We(){return new Ye}const te=new Set;function Ke(P,t=We){return Xe(P,t()).finish()}function Xe(P,t){return zt(P,t),te.clear(),t}function zt(P,t){return P!=null&&(typeof P=="string"?Lt(P,t):typeof P=="number"?$t(P,t):typeof P=="boolean"?Qe(P,t):typeof P=="symbol"?Ze(P,t):typeof P[Symbol.iterator]=="function"?tr(P,t):typeof P=="function"?er(P,t):typeof P.length=="number"?rr(P,t):oe(P,t)),t}function Lt(P,t){for(const a of P)t.writeInteger(a.charCodeAt(0))}function $t(P,t){P%1===0?t.writeInteger(P):t.writeFloat(P)}function Qe(P,t){t.writeInteger(P===!0?1:0)}function Ze(P,t){Lt(P.toString(),t)}function tr(P,t){let a=0;for(const i of P)zt(i,t),a++;$t(a,t)}function er(P,t){P.prototype!==null&&typeof P.prototype=="object"&&oe(P.prototype,t),Lt(P.name,t),$t(P.length,t),Lt(P.toString(),t)}function rr(P,t){const a=Object.getPrototypeOf(P);a!==null&&typeof a=="object"&&typeof a.constructor=="function"&&oe(a.constructor,t);for(let i=0,f=P.length;i<f;i++)zt(P[i],t);$t(P.length,t)}function oe(P,t){if(!te.has(P)){te.add(P);let a=0;for(const[i,f]of Object.entries(P))Lt(i,t),zt(f,t),a++;$t(a,t)}}const Nt=Math.pow(2,31)-1|0,se={},Ut={};class Ht{constructor(t,a){if(t!==se)throw new TypeError("Options can only be created with the some or none functions");this._value=a}static some(t){return dt(t)}static none(){return ft()}static from(t){return t!=null?dt(t):ft()}static fromJSON(t){return Ht.from(t)}isNone(){return this._value===Ut}isSome(){return!this.isNone()}expect(t){if(this.isSome())return this._value;throw new Error(typeof t=="function"?t():t)}unwrap(){return this.expect("Tried to unwrap value of none Option")}unwrapOr(t){return this.isSome()?this._value:t}unwrapOrElse(t){return this.isSome()?this._value:t()}map(t){return this.isSome()?dt(t(this._value)):ft()}mapOr(t,a){return this.isSome()?dt(t(this._value)):dt(a)}mapOrElse(t,a){return this.isSome()?dt(t(this._value)):dt(a())}flatMap(t){return this.isSome()?t(this._value):ft()}flatMapOr(t,a){return this.isSome()?t(this._value):a}flatMapOrElse(t,a){return this.isSome()?t(this._value):a()}and(t){return this.isSome()?t:ft()}andThen(t){return this.isSome()?t(this._value):ft()}or(t){return this.isNone()?t:this}orElse(t){return this.isNone()?t():this}xor(t){const a=this.isSome(),i=t.isSome();return a&&!i?this:!a&&i?t:ft()}filter(t){return this.isSome()&&t(this._value)?this:ft()}getOrInsert(t){return this.isNone()&&(this._value=t),this}getOrInsertWith(t){return this.isNone()&&(this._value=t()),this}clear(){return this._value=Ut,this}take(){if(this.isSome()){const t=this._value;return this._value=Ut,dt(t)}else return ft()}from(t){return t!=null?this._value=t:this.clear(),this}replace(t){return this._value=t,this}ifSome(t,a){return this.isSome()?t(this._value):a&&a(),this}ifNone(t,a){return this.isNone()?t():a&&a(this._value),this}toJSON(){return this.unwrapOr(null)}toJS(){return this.unwrapOr(null)}[Symbol.iterator](){return new nr(this._value)}}class nr{constructor(t){this.value=t}next(){if(this.value===Ut)return{done:!0,value:void 0};{const t=this.value;return this.value=Ut,{done:!1,value:t}}}}const dt=P=>new Ht(se,P),ft=()=>new Ht(se,Ut);class rt{constructor(t){this._index=0,this._iter=t}[Symbol.iterator](){return this}iter(){return this}next(){return this._iter.next()}nextWithIndex(){const t=this._iter.next();return t.done?t:{value:[t.value,this._index++]}}enumerate(){throw new Error("iter/Enumerate was not imported!")}peekable(){throw new Error("iter/Peekable was not imported!")}forEach(t){throw new Error("iter/ForEach was not imported!")}map(t){throw new Error("iter/Map was not imported!")}merge(t){throw new Error("iter/Merge was not imported!")}concat(t){return this.merge(t)}filter(t){throw new Error("iter/Filter was not imported!")}step(t){throw new Error("iter/Step was not imported!")}skip(t){throw new Error("iter/Skip was not imported!")}take(t){throw new Error("iter/Take was not imported!")}toMap(t,a){throw new Error("iter/ToMap was not imported!")}count(){return this.reduce(0,t=>t+1)}consume(){let t=this.next();for(;!t.done;)t=this.next();return this}toArray(){return this.reduce([],(t,a)=>(t.push(a),t))}join(t){return this.toArray().join(t)}indexOf(t){let a=this.next(),i=0;for(;!a.done;){if(a.value===t)return i;i++,a=this.next()}return-1}findIndex(t){let a=this.nextWithIndex();for(;!a.done;){const[i,f]=a.value;if(t(i,f))return f;a=this.nextWithIndex()}return-1}find(t){let a=this.nextWithIndex();for(;!a.done;){const[i,f]=a.value;if(t(i,f))return dt(i);a=this.nextWithIndex()}return ft()}findAll(t){return this.filter(t)}nth(t=0){let a=this.next();for(t<0&&(t=0);!a.done;){if(t--<=0)return dt(a.value);a=this.next()}return ft()}first(){return this.nth(0)}last(){let t=this.next();for(;!t.done;){const a=this.next();if(a.done)return dt(t.value);t=a}return ft()}any(t){return this.findIndex(t)!==-1}some(t){return this.any(t)}none(t){return this.findIndex(t)===-1}all(t){let a=this.nextWithIndex();for(;!a.done;){const[i,f]=a.value;if(!t(i,f))return!1;a=this.nextWithIndex()}return!0}flatten(t){throw new Error("iter/Flatten was not imported!")}unflatten(t){throw new Error("iter/Unflatten was not imported!")}reduce(t,a){let i=this.next();for(;!i.done;){const f=i.value;t=a(t,f,this._index-1),i=this.next()}return t}reverse(){return Ft(this.toArray().reverse())}}function Ft(P){return P!=null?typeof P[Symbol.iterator]=="function"?new rt(P[Symbol.iterator]()):typeof P.next=="function"?P instanceof rt?P:new rt(P):Ft(typeof P=="object"?Object.entries(P):[P]):Ft([])}class or extends rt{constructor(t){super(t)}next(){const t=super.nextWithIndex();return t.done?t:{value:sr(t.value)}}}rt.prototype.enumerate=function(){return new or(this)};function sr(P){const t=P[0],a=P;return a[0]=P[1],a[1]=t,a}class ir extends rt{constructor(t,a){super(t),this._fn=a}next(){let t=super.nextWithIndex();for(;!t.done;){const[a,i]=t.value;if(this._fn(a,i))return{done:!1,value:a};t=super.nextWithIndex()}return{done:!0,value:void 0}}}rt.prototype.filter=function(t){return new ir(this,t)};class ar extends rt{constructor(t,a){super(t),this._fn=([i,f])=>(a(i,f),i)}next(){const t=super.nextWithIndex();return t.done?t:{done:!1,value:this._fn(t.value)}}}rt.prototype.forEach=function(t){return new ar(this,t)};let ur=class extends rt{constructor(t,a){super(t),this._fn=([i,f])=>a(i,f)}next(){const t=super.nextWithIndex();return t.done?t:{done:!1,value:this._fn(t.value)}}};rt.prototype.map=function(t){return new ur(this,t)};class cr extends rt{constructor(t,a){super(t),this._other=a}next(){const t=super.next();return t.done?this._other.next():t}}rt.prototype.merge=function(t){return new cr(this,t)};class lr extends rt{constructor(){super(...arguments),this.peeked=[]}unpeekAll(){return this.peeked.length=0,this}unpeek(){return this.peeked.length>0?dt(this.peeked.shift()):ft()}peek(t=0){if(t<this.peeked.length)return dt(this.peeked[t]);{let a=this.peeked.length-t-1,i=super.next();for(;!i.done&&(this.peeked.push(i.value),!(--a<=0));)i=super.next();return i.done?ft():dt(i.value)}}next(){const t=this.unpeek();if(t.isSome())return{done:!1,value:t.unwrap()};const a=super.next();return a.done?a:{done:!1,value:a.value}}}rt.prototype.peekable=function(){return new lr(this)};class hr extends rt{constructor(t,a){super(t),this._skipped=0,this._skip=(a<=0?0:a)|0}next(){let t=super.next();for(;!t.done;)if(this._skipped<=this._skip)this._skipped+=1,t=super.next();else return t;return{done:!0,value:void 0}}}rt.prototype.skip=function(P){return new hr(this,P)};class fr extends rt{constructor(t,a){super(t),this._stepped=0,this._step=a<=0?1:a|0}next(){let t=super.next();for(;!t.done;)if(this._stepped<this._step)this._stepped+=1,t=super.next();else return this._stepped=0,t;return{done:!0,value:void 0}}}rt.prototype.step=function(P){return new fr(this,P)};class dr extends rt{constructor(t,a){super(t),this._taken=0,this._count=(a<=0?0:a)|0}next(){return this._taken<this._count?(this._taken+=1,super.next()):{done:!0,value:void 0}}}rt.prototype.take=function(t){return new dr(this,t)};const pr=P=>P,mr=P=>P;class gr extends rt{constructor(t,a=pr,i=mr){super(t),this._map=([f,u])=>[a(f,u),i(f,u)]}toObject(){return this.reduce({},(t,a)=>(t[a[0]]=a[1],t))}next(){const t=super.nextWithIndex();return t.done?t:{done:!1,value:this._map(t.value)}}}rt.prototype.toMap=function(t,a){return new gr(this,t,a)};class yr extends rt{constructor(t,a){super(t),this._fn=a}next(){return this._fn(this._iter)}}rt.prototype.unflatten=function(t){return new yr(this,t)};class vr extends rt{constructor(t,a=1){super(t),this._current=void 0,this._depth=a}next(){if(this._current!==void 0){const t=this._current.next();if(t.done)this._current=void 0;else return t}return this._nextRecur()}_nextRecur(){const t=super.next();if(t.done)return t;if(this._depth>0){const a=Ft(t.value).flatten(this._depth-1),i=a.next();return i.done?this._nextRecur():(this._current=a,i)}else return t}}rt.prototype.flatten=function(t=1){return new vr(this,t)};class _r extends rt{constructor(t){super(t),this.rng=t}iter(){return new rt(this)}next(){return{done:!1,value:this.rng.nextFloat()}}}class wr extends rt{constructor(t,a=0,i=1){super(t),this.rng=t,this.min=a,this.max=i}iter(){return new rt(this)}nextFloat(){return this.rng.nextFloatInRange(this.min,this.max)}next(){return{done:!1,value:this.nextFloat()}}}class br extends rt{constructor(t,a=0,i=Nt){super(t),this.rng=t,this.min=a|0,this.max=i|0}iter(){return new rt(this)}nextInt(){return this.rng.nextIntInRange(this.min,this.max)}next(){return{done:!1,value:this.nextInt()}}}const Er=new Uint8Array(4);class xe{nextFloat(){return this.nextInt()/Nt}nextFloatInRange(t=0,a=1){return t+this.nextFloat()*(a-t)}nextIntInRange(t=0,a=Nt){return Math.round(this.nextFloatInRange(t,a))}shuffle(t){const a=t.length;for(let i=0;i<a;i++){const f=i+this.nextIntInRange(0,a-i-1),u=t[i];t[i]=t[f],t[f]=u}return t}fromArray(t){return t.length?dt(t[this.nextIntInRange(0,t.length-1)]):ft()}keyFromObject(t){return this.fromArray(Object.keys(t))}valueFromObject(t){return this.fromArray(Object.values(t))}fillBytes(t){const a=Er;for(let i=0,f=t.length;i<f;i++){const u=i%4;u===0&&Pe(a,this.nextInt()),t[i]=a[u]}return t}[Symbol.iterator](){return this}iter(){return new rt(this)}next(){return{done:!1,value:this.nextInt()}}float(){return new _r(this)}uniformFloat(t=0,a=1){return new wr(this,t,a)}uniformInt(t=0,a=Nt){return new br(this,t,a)}}class Te extends xe{constructor(t=423257940){super(),this.seed=t}setSeed(t=423257940){return this.seed=t,this}nextInt(){return this.seed=Math.imul(48271,this.seed)|0%Nt,this.seed&Nt}}const Pr=new Te;class Yt extends xe{constructor(t,a,i,f){super(),this.x=423257940,this.y=2829571177,this.z=2541948421,this.w=289122235,this.set(t,a,i,f)}static fromSeed(t){return new Yt().setSeed(t)}setSeed(t){const a=Pr.setSeed(t);return this.set(a.nextInt(),a.nextInt(),a.nextInt(),a.nextInt())}set(t=423257940,a=2829571177,i=2541948421,f=289122235){return this.x=t|0,this.y=a|0,this.z=i|0,this.w=f|0,this}nextInt(){const t=this.x,a=t^t<<11;this.x=this.y,this.y=this.z,this.z=this.w;const i=this.w;return this.w=i^i>>19^(a^a>>8),this.w}}new Te;new Yt;function xr(){return Math.random().toString(36).substring(2)}function bn(P){return P.toISOString().substring(0,7)}function En(P){return new Date(P.getFullYear(),P.getMonth()+1,0).getDate()}function Pn(P,t){return t.toLocaleDateString(P,{month:"short",weekday:"short",day:"numeric"})}function xn(P,t){return t.toLocaleDateString(P,{month:"short"})}function Tn(P,t){return t.toLocaleDateString(P,{weekday:"short"})}function An(P,t){return P.getFullYear()===t.getFullYear()&&P.getMonth()===t.getMonth()&&P.getDate()===t.getDate()}const qt=new Yt;function Sn(P){return qt.setSeed(Ke(P)),`rgb(${qt.nextFloatInRange(64,192)}, ${qt.nextFloatInRange(64,192)}, ${qt.nextFloatInRange(64,192)})`}function kn(){return new Promise((P,t)=>navigator.geolocation.getCurrentPosition(a=>P(a.coords),t))}async function Rn(P){const t=await fetch(`https://nominatim.openstreetmap.org/reverse.php?lat=${P.latitude}&lon=${P.longitude}&zoom=18&format=jsonv2`);if(!t.ok)throw new Error(await t.text());return(await t.json()).display_name}function In(P,t){return t.createdAt.getMilliseconds()-P.createdAt.getMilliseconds()}const Tr="lf5maxp3ghh4q1s",Ar="220951148444-5u4fja36i0dm85hcvipq6udm9msutf7n.apps.googleusercontent.com";var Sr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function kr(P){return P&&P.__esModule&&Object.prototype.hasOwnProperty.call(P,"default")?P.default:P}var ee={},Rr={get exports(){return ee},set exports(P){ee=P}};/*! remotestorage.js 2.0.0-beta.6, https://remotestorage.io, MIT licensed */(function(P,t){(function(a,i){P.exports=i()})(Sr,function(){return function(a){var i={};function f(u){if(i[u])return i[u].exports;var v=i[u]={i:u,l:!1,exports:{}};return a[u].call(v.exports,v,v.exports,f),v.l=!0,v.exports}return f.m=a,f.c=i,f.d=function(u,v,M){f.o(u,v)||Object.defineProperty(u,v,{enumerable:!0,get:M})},f.r=function(u){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})},f.t=function(u,v){if(1&v&&(u=f(u)),8&v||4&v&&typeof u=="object"&&u&&u.__esModule)return u;var M=Object.create(null);if(f.r(M),Object.defineProperty(M,"default",{enumerable:!0,value:u}),2&v&&typeof u!="string")for(var m in u)f.d(M,m,function(x){return u[x]}.bind(null,m));return M},f.n=function(u){var v=u&&u.__esModule?function(){return u.default}:function(){return u};return f.d(v,"a",v),v},f.o=function(u,v){return Object.prototype.hasOwnProperty.call(u,v)},f.p="",f(f.s=18)}([function(a,i,f){(function(u,v){var M=this&&this.__awaiter||function(m,x,_,c){return new(_||(_=Promise))(function(O,k){function R(l){try{p(c.next(l))}catch(w){k(w)}}function h(l){try{p(c.throw(l))}catch(w){k(w)}}function p(l){var w;l.done?O(l.value):(w=l.value,w instanceof _?w:new _(function(T){T(w)})).then(R,h)}p((c=c.apply(m,x||[])).next())})};Object.defineProperty(i,"__esModule",{value:!0}),i.applyMixins=i.generateCodeVerifier=i.toBase64=i.getTextFromArrayBuffer=i.shouldBeTreatedAsBinary=i.getJSONFromLocalStorage=i.localStorageAvailable=i.pathsFromRoot=i.deepClone=i.equal=i.bindAll=i.cleanPath=i.baseName=i.isDocument=i.isFolder=i.containingFolder=i.extend=i.getGlobalContext=i.globalContext=i.logError=void 0,i.logError=m=>{typeof m=="string"?console.error(m):console.error(m.message,m.stack)},i.globalContext=typeof window<"u"?window:typeof self=="object"?self:u,i.getGlobalContext=()=>typeof window<"u"?window:typeof self=="object"?self:u,i.extend=(...m)=>{const x=m[0];return Array.prototype.slice.call(m,1).forEach(function(_){for(const c in _)x[c]=_[c]}),x},i.containingFolder=m=>{if(m==="")return"/";if(!m)throw"Path not given!";return m.replace(/\/+/g,"/").replace(/[^\/]+\/?$/,"")},i.isFolder=m=>m.slice(-1)==="/",i.isDocument=m=>!(0,i.isFolder)(m),i.baseName=m=>{const x=m.split("/");return(0,i.isFolder)(m)?x[x.length-2]+"/":x[x.length-1]},i.cleanPath=m=>m.replace(/\/+/g,"/").split("/").map(encodeURIComponent).join("/").replace(/'/g,"%27"),i.bindAll=m=>{for(const x in this)typeof m[x]=="function"&&(m[x]=m[x].bind(m))},i.equal=(m,x,_=[])=>{let c;if(typeof m!=typeof x)return!1;if(typeof m=="number"||typeof m=="boolean"||typeof m=="string")return m===x;if(typeof m=="function")return m.toString()===x.toString();if(m instanceof ArrayBuffer&&x instanceof ArrayBuffer&&(m=new Uint8Array(m),x=new Uint8Array(x)),m instanceof Array){if(m.length!==x.length)return!1;for(let O=0,k=m.length;O<k;O++)if(!(0,i.equal)(m[O],x[O],_))return!1}else{for(c in m)if(m.hasOwnProperty(c)&&!(c in x))return!1;for(c in x){if(!x.hasOwnProperty(c))continue;if(!(c in m))return!1;let O;if(typeof x[c]=="object"){if(_.indexOf(x[c])>=0)continue;O=_.slice(),O.push(x[c])}if(!(0,i.equal)(m[c],x[c],O))return!1}}return!0},i.deepClone=m=>{if(m!==void 0){const x=JSON.parse(JSON.stringify(m));return function _(c,O){if(typeof c=="object"&&!Array.isArray(c)&&c!==null){for(const k in c)if(typeof c[k]=="object"&&c[k]!==null)if(c[k].toString()==="[object ArrayBuffer]"){O[k]=new ArrayBuffer(c[k].byteLength);const R=new Int8Array(c[k]);new Int8Array(O[k]).set(R)}else _(c[k],O[k])}}(m,x),x}},i.pathsFromRoot=m=>{const x=[m],_=m.replace(/\/$/,"").split("/");for(;_.length>1;)_.pop(),x.push(_.join("/")+"/");return x},i.localStorageAvailable=()=>{const m=(0,i.getGlobalContext)();if(!("localStorage"in m))return!1;try{return m.localStorage.setItem("rs-check","1"),m.localStorage.removeItem("rs-check"),!0}catch{return!1}},i.getJSONFromLocalStorage=m=>{const x=(0,i.getGlobalContext)();try{return JSON.parse(x.localStorage.getItem(m))}catch{}},i.shouldBeTreatedAsBinary=(m,x)=>!!(x&&x.match(/charset=binary/)||/[\x00-\x08\x0E-\x1F\uFFFD]/.test(m)),i.getTextFromArrayBuffer=(m,x)=>new Promise(_=>{if(typeof Blob>"u"){const c=v.from(m);_(c.toString(x))}else{let c;const O=i.globalContext;if(O.BlobBuilder=O.BlobBuilder||O.WebKitBlobBuilder,O.BlobBuilder!==void 0){const R=new O.BlobBuilder;R.append(m),c=R.getBlob()}else c=new Blob([m]);const k=new FileReader;typeof k.addEventListener=="function"?k.addEventListener("loadend",function(R){_(R.target.result)}):k.onloadend=function(R){_(R.target.result)},k.readAsText(c,x)}}),i.toBase64=m=>{const x=(0,i.getGlobalContext)();return"btoa"in x?x.btoa(m):v.from(m).toString("base64")},i.generateCodeVerifier=function(m=128){return M(this,void 0,void 0,function*(){const x=new Uint8Array(m);crypto.getRandomValues(x);const _="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",c=Array.from(x).map(l=>_[l%_.length]),O=c.join(""),k=Uint8Array.from(c.map(l=>l.charCodeAt(0))),R=yield crypto.subtle.digest("SHA-256",k),h=(p=R,btoa(String.fromCharCode.apply(null,new Uint8Array(p))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""));var p;return crypto.getRandomValues(x),{codeVerifier:O,codeChallenge:h,state:Array.from(x).map(l=>_[l%_.length]).join("")}})},i.applyMixins=function(m,x){x.forEach(_=>{Object.getOwnPropertyNames(_.prototype).forEach(c=>{Object.defineProperty(m.prototype,c,Object.getOwnPropertyDescriptor(_.prototype,c))})})}}).call(this,f(6),f(20).Buffer)},function(a,i,f){const u=(this&&this.__importDefault||function(v){return v&&v.__esModule?v:{default:v}})(f(3));a.exports=function(...v){u.default.logging&&console.log(...v)}},function(a,i,f){const u=(this&&this.__importDefault||function(v){return v&&v.__esModule?v:{default:v}})(f(1));a.exports=class{addEvents(v){v.forEach(M=>this._addEvent(M))}addEventListener(v,M){if(typeof v!="string")throw new Error("Argument eventName should be a string");if(typeof M!="function")throw new Error("Argument handler should be a function");(0,u.default)("[EventHandling] Adding event listener",v),this._validateEvent(v),this._handlers[v].push(M)}on(v,M){return this.addEventListener(v,M)}removeEventListener(v,M){this._validateEvent(v);const m=this._handlers[v].length;for(let x=0;x<m;x++)if(this._handlers[v][x]===M)return void this._handlers[v].splice(x,1)}_emit(v,...M){this._validateEvent(v),this._handlers[v].slice().forEach(m=>{m.apply(this,M)})}_validateEvent(v){if(!(v in this._handlers))throw new Error("Unknown event: "+v)}_delegateEvent(v,M){M.on(v,m=>{this._emit(v,m)})}_addEvent(v){this._handlers===void 0&&(this._handlers={}),this._handlers[v]=[]}}},function(a,i,f){const u={cache:!0,changeEvents:{local:!0,window:!1,remote:!0,conflict:!0},cordovaRedirectUri:void 0,logging:!1,modules:[],backgroundSyncInterval:6e4,disableFeatures:[],discoveryTimeout:1e4,isBackground:!1,requestTimeout:3e4,syncInterval:1e4};a.exports=u},function(a,i,f){var u=this&&this.__awaiter||function(R,h,p,l){return new(p||(p=Promise))(function(w,T){function N(g){try{e(l.next(g))}catch(y){T(y)}}function S(g){try{e(l.throw(g))}catch(y){T(y)}}function e(g){var y;g.done?w(g.value):(y=g.value,y instanceof p?y:new p(function(L){L(y)})).then(N,S)}e((l=l.apply(R,h||[])).next())})},v=this&&this.__importDefault||function(R){return R&&R.__esModule?R:{default:R}};const M=v(f(1)),m=f(0),x=v(f(5)),_=f(7);let c;function O(R){const h=R||k.getLocation().href,p={};for(const[T,N]of new URL(h).searchParams)p[T]=N;const l=h.indexOf("#");if(l===-1)return p;const w=h.substring(l+1);return w.includes("=")?w.split("&").reduce(function(T,N){const S=N.split("=");if(S[0]==="state"&&S[1].match(/rsDiscovery/)){let e=decodeURIComponent(S[1]);const g=e.substr(e.indexOf("rsDiscovery=")).split("&")[0].split("=")[1];T.rsDiscovery=JSON.parse(atob(g)),e=e.replace(new RegExp("&?rsDiscovery="+g),""),e.length>0&&(T.state=e)}else T[decodeURIComponent(S[0])]=decodeURIComponent(S[1]);return T},p):p}class k{static authorize(h,p){if((0,M.default)("[Authorize] authURL = ",p.authURL,"scope = ",p.scope,"redirectUri = ",p.redirectUri,"clientId = ",p.clientId,"response_type =",p.response_type),!p.scope)throw new Error("Cannot authorize due to undefined or empty scope; did you forget to access.claim()?");if(!(0,m.localStorageAvailable)()&&h.backend==="remotestorage"){p.redirectUri+=p.redirectUri.indexOf("#")>0?"&":"#";const w={userAddress:h.remote.userAddress,href:h.remote.href,storageApi:h.remote.storageApi,properties:h.remote.properties};p.redirectUri+="rsDiscovery="+(0,m.toBase64)(JSON.stringify(w))}const l=function(w){const T=new URL(w.redirectUri);w.state||(w.state=T.hash?T.hash.substring(1):""),w.response_type||(w.response_type="token");const N=new URL(w.authURL);N.searchParams.set("redirect_uri",w.redirectUri.replace(/#.*$/,"")),N.searchParams.set("scope",w.scope),N.searchParams.set("client_id",w.clientId);for(const S of["state","response_type","code_challenge","code_challenge_method","token_access_type"]){const e=w[S];e&&N.searchParams.set(S,e)}return N.href}(p);m.globalContext.cordova?k.openWindow(l,p.redirectUri,"location=yes,clearsessioncache=yes,clearcache=yes").then(w=>{h.remote.configure({token:w.access_token})}):k.setLocation(l)}static refreshAccessToken(h,p,l){var w,T,N;return u(this,void 0,void 0,function*(){yield p.configure({token:null,tokenType:null});const S=new URLSearchParams({grant_type:"refresh_token",client_id:p.clientId,refresh_token:l}),e=yield(0,_.requestWithTimeout)("POST",p.TOKEN_URL,{headers:{"Content-Type":"application/x-www-form-urlencoded"},body:S.toString(),responseType:"json"});if((e==null?void 0:e.status)!==200)throw yield p.configure({refreshToken:null}),new x.default("refresh token rejected:"+JSON.stringify(e.response));{(0,M.default)(`[Authorize] access token good for ${(w=e==null?void 0:e.response)===null||w===void 0?void 0:w.expires_in} seconds`);const g={token:(T=e==null?void 0:e.response)===null||T===void 0?void 0:T.access_token,tokenType:(N=e==null?void 0:e.response)===null||N===void 0?void 0:N.token_type};if(!g.token)throw new Error('no access_token in "successful" refresh: '+e.response);yield p.configure(g)}})}static setLocation(h){if(typeof h=="string")document.location.href=h;else{if(typeof h!="object")throw"Invalid location "+h;document.location=h}}static _rs_supported(){return typeof document<"u"}static _rs_cleanup(h){h.removeEventListener("features-loaded",c)}}k.IMPLIED_FAKE_TOKEN=!1,k.getLocation=function(){return document.location},k.openWindow=function(R,h,p){return new Promise((l,w)=>{const T=open(R,"_blank",p);function N(){w("Authorization was canceled")}T&&!T.closed?(T.addEventListener("loadstart",function(S){if(S.url.indexOf(h)!==0)return;T.removeEventListener("exit",N),T.close();const e=O(S.url);e?l(e):w("Authorization error")}),T.addEventListener("exit",N)):w("Authorization popup was blocked")})},k._rs_init=function(R){const h=O();let p;h&&(p=k.getLocation(),p.hash=""),c=function(){let l=!1;if(h){if(h.error)throw h.error==="access_denied"?new x.default("Authorization failed: access denied",{code:"access_denied"}):new x.default("Authorization failed: "+h.error);h.rsDiscovery&&R.remote.configure(h.rsDiscovery),h.access_token&&(R.remote.configure({token:h.access_token}),l=!0),h.remotestorage&&(R.connect(h.remotestorage),l=!0),h.state&&(p=k.getLocation(),k.setLocation(p.href.split("#")[0]+"#"+h.state)),h.code&&(function(w){var T,N,S,e;u(this,void 0,void 0,function*(){const g=sessionStorage.getItem("remotestorage:codeVerifier");if(!g)return void(0,M.default)("[Authorize] Ignoring OAuth code parameter, because no PKCE code verifier found in sessionStorage");p=k.getLocation();let y=p.origin;p.pathname!=="/"&&(y+=p.pathname);const L=new URLSearchParams({code:w,grant_type:"authorization_code",client_id:R.remote.clientId,redirect_uri:y,code_verifier:g}),j=yield(0,_.requestWithTimeout)("POST",R.remote.TOKEN_URL,{headers:{"Content-Type":"application/x-www-form-urlencoded"},body:L.toString(),responseType:"json"});switch(j.status){case 200:(0,M.default)(`[Authorize] access token good for ${(T=j==null?void 0:j.response)===null||T===void 0?void 0:T.expires_in} seconds`);const B={token:(N=j==null?void 0:j.response)===null||N===void 0?void 0:N.access_token,refreshToken:(S=j==null?void 0:j.response)===null||S===void 0?void 0:S.refresh_token,tokenType:(e=j==null?void 0:j.response)===null||e===void 0?void 0:e.token_type};B.token?R.remote.configure(B):R._emit("error",new Error('no access_token in "successful" response: '+j.response)),sessionStorage.removeItem("remotestorage:codeVerifier");break;default:R._emit("error",new Error(`${j.statusText}: ${j.response}`))}})}(h.code),l=!0),l||R.remote.stopWaitingForToken()}else R.remote.stopWaitingForToken()},R.on("features-loaded",c)},a.exports=k},function(a,i,f){class u extends Error{constructor(M,m={}){super(),this.name="Unauthorized",this.message=M===void 0?"App authorization expired or revoked.":M,m.code!==void 0&&(this.code=m.code),this.stack=new Error().stack}}a.exports=u},function(a,i){var f;f=function(){return this}();try{f=f||new Function("return this")()}catch{typeof window=="object"&&(f=window)}a.exports=f},function(a,i,f){(function(u){var v=this&&this.__awaiter||function(_,c,O,k){return new(O||(O=Promise))(function(R,h){function p(T){try{w(k.next(T))}catch(N){h(N)}}function l(T){try{w(k.throw(T))}catch(N){h(N)}}function w(T){var N;T.done?R(T.value):(N=T.value,N instanceof O?N:new O(function(S){S(N)})).then(p,l)}w((k=k.apply(_,c||[])).next())})},M=this&&this.__importDefault||function(_){return _&&_.__esModule?_:{default:_}};Object.defineProperty(i,"__esModule",{value:!0}),i.requestWithTimeout=i.isArrayBufferView=i.retryAfterMs=void 0;const m=M(f(1)),x=M(f(3));if(i.retryAfterMs=function(_){const c=1e3*parseInt(_.getResponseHeader("Retry-After"));return c>=1e3?c:Math.max(1500,Math.min(6e4,Math.round(x.default.syncInterval/(2.9+.2*Math.random()))))},typeof(u||window).ArrayBufferView=="function")i.isArrayBufferView=function(_){return _&&_ instanceof(u||window).ArrayBufferView};else{const _=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];i.isArrayBufferView=function(c){for(let O=0;O<8;O++)if(c instanceof _[O])return!0;return!1}}i.requestWithTimeout=function(_,c,O){return v(this,void 0,void 0,function*(){return typeof fetch=="function"?function(k,R,h){return v(this,void 0,void 0,function*(){const p=typeof AbortController=="function"?new AbortController:null;let l;const w=new Promise((e,g)=>{l=setTimeout(()=>{p&&p.abort(),g("timeout")},x.default.requestTimeout)});let T;const N={},S=fetch(R,{method:k,headers:h.headers,body:h.body,signal:p?p.signal:void 0}).then(e=>{switch((0,m.default)("[requests fetch]",e),e.headers.forEach((g,y)=>{N[y.toUpperCase()]=g}),T={readyState:4,status:e.status,statusText:e.statusText,response:void 0,getResponseHeader:g=>N[g.toUpperCase()]||null,responseType:h.responseType,responseURL:R},h.responseType){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"json":return e.json();case void 0:case"":case"text":return e.text();default:throw new Error("responseType 'document' is not currently supported using fetch")}}).then(e=>(T.response=e,h.responseType&&h.responseType!=="text"||(T.responseText=e),T)).finally(()=>{clearTimeout(l)});return Promise.race([S,w])})}(_,c,O):typeof XMLHttpRequest=="function"?function(k,R,h){return v(this,void 0,void 0,function*(){return new Promise((p,l)=>{(0,m.default)("[requests XHR]",k,R);let w=!1;const T=setTimeout(()=>{w=!0,l("timeout")},x.default.requestTimeout),N=new XMLHttpRequest;if(N.open(k,R,!0),h.responseType&&(N.responseType=h.responseType),h.headers)for(const e in h.headers)N.setRequestHeader(e,h.headers[e]);N.onload=()=>{w||(clearTimeout(T),p(N))},N.onerror=e=>{w||(clearTimeout(T),l(e))};let S=h.body;typeof S=="object"&&!(0,i.isArrayBufferView)(S)&&S instanceof ArrayBuffer&&(S=new Uint8Array(S)),N.send(S)})})}(_,c,O):Promise.reject("[Requests] You need to add a polyfill for fetch or XMLHttpRequest")})}}).call(this,f(6))},function(a,i,f){var u=this&&this.__awaiter||function(R,h,p,l){return new(p||(p=Promise))(function(w,T){function N(g){try{e(l.next(g))}catch(y){T(y)}}function S(g){try{e(l.throw(g))}catch(y){T(y)}}function e(g){var y;g.done?w(g.value):(y=g.value,y instanceof p?y:new p(function(L){L(y)})).then(N,S)}e((l=l.apply(R,h||[])).next())})},v=this&&this.__importDefault||function(R){return R&&R.__esModule?R:{default:R}};const M=v(f(24)),m=v(f(25)),x=v(f(26)),_=v(f(2)),c=v(f(3)),O=f(0);class k{constructor(h,p){if(this.schemas={configurable:!0,get(){return k.Types.inScope(this.moduleName)}},p[p.length-1]!=="/")throw"Not a folder: "+p;p==="/"&&(this.makePath=l=>(l[0]==="/"?"":"/")+l),this.storage=h,this.base=p,this.moduleName=function(l){const w=l.split("/");return l.length>2?w[1]:"root"}(this.base),this.addEvents(["change"]),this.on=this.on.bind(this),h.onChange(this.base,this._fireChange.bind(this))}scope(h){return new k(this.storage,this.makePath(h))}getListing(h,p){return u(this,void 0,void 0,function*(){if(typeof h!="string")h="";else if(h.length>0&&!(0,O.isFolder)(h))return Promise.reject("Not a folder: "+h);return this.storage.get(this.makePath(h),p).then(l=>l.statusCode===404?{}:l.body)})}getAll(h,p){return u(this,void 0,void 0,function*(){if(typeof h!="string")h="";else if(h.length>0&&!(0,O.isFolder)(h))return Promise.reject("Not a folder: "+h);return this.storage.get(this.makePath(h),p).then(l=>{if(l.statusCode===404)return{};if(typeof l.body=="object"){const w=Object.keys(l.body);if(w.length===0)return{};const T=w.map(N=>this.storage.get(this.makePath(h+N),p).then(S=>{if(typeof S.body=="string")try{S.body=JSON.parse(S.body)}catch{}typeof S.body=="object"&&(l.body[N]=S.body)}));return Promise.all(T).then(()=>l.body)}})})}getFile(h,p){return u(this,void 0,void 0,function*(){return typeof h!="string"?Promise.reject("Argument 'path' of baseClient.getFile must be a string"):this.storage.get(this.makePath(h),p).then(l=>({data:l.body,contentType:l.contentType,revision:l.revision}))})}storeFile(h,p,l){return u(this,void 0,void 0,function*(){return typeof h!="string"?Promise.reject("Argument 'mimeType' of baseClient.storeFile must be a string"):typeof p!="string"?Promise.reject("Argument 'path' of baseClient.storeFile must be a string"):typeof l!="string"&&typeof l!="object"?Promise.reject("Argument 'body' of baseClient.storeFile must be a string, ArrayBuffer, or ArrayBufferView"):(this.storage.access.checkPathPermission(this.makePath(p),"rw")||console.warn("WARNING: Editing a document to which only read access ('r') was claimed"),this.storage.put(this.makePath(p),l,h).then(w=>w.statusCode===200||w.statusCode===201?w.revision:Promise.reject("Request (PUT "+this.makePath(p)+") failed with status: "+w.statusCode)))})}getObject(h,p){return u(this,void 0,void 0,function*(){return typeof h!="string"?Promise.reject("Argument 'path' of baseClient.getObject must be a string"):this.storage.get(this.makePath(h),p).then(l=>{if(typeof l.body=="object")return l.body;if(typeof l.body=="string")try{return JSON.parse(l.body)}catch{throw new Error("Not valid JSON: "+this.makePath(h))}else if(l.body!==void 0&&l.statusCode===200)return Promise.reject("Not an object: "+this.makePath(h))})})}storeObject(h,p,l){return u(this,void 0,void 0,function*(){if(typeof h!="string")return Promise.reject("Argument 'typeAlias' of baseClient.storeObject must be a string");if(typeof p!="string")return Promise.reject("Argument 'path' of baseClient.storeObject must be a string");if(typeof l!="object")return Promise.reject("Argument 'object' of baseClient.storeObject must be an object");this._attachType(l,h);try{const w=this.validate(l);if(!w.valid)return Promise.reject(w)}catch(w){return Promise.reject(w)}return this.storage.put(this.makePath(p),JSON.stringify(l),"application/json; charset=UTF-8").then(w=>w.statusCode===200||w.statusCode===201?w.revision:Promise.reject("Request (PUT "+this.makePath(p)+") failed with status: "+w.statusCode))})}remove(h){return typeof h!="string"?Promise.reject("Argument 'path' of baseClient.remove must be a string"):(this.storage.access.checkPathPermission(this.makePath(h),"rw")||console.warn("WARNING: Removing a document to which only read access ('r') was claimed"),this.storage.delete(this.makePath(h)))}getItemURL(h){if(typeof h!="string")throw"Argument 'path' of baseClient.getItemURL must be a string";return this.storage.connected?(h=(0,O.cleanPath)(this.makePath(h)),this.storage.remote.href+h):void 0}cache(h,p="ALL"){if(typeof h!="string")throw"Argument 'path' of baseClient.cache must be a string";if(typeof p!="string")throw"Argument 'strategy' of baseClient.cache must be a string or undefined";if(p!=="FLUSH"&&p!=="SEEN"&&p!=="ALL")throw`Argument 'strategy' of baseclient.cache must be one of ["FLUSH", "SEEN", "ALL"]`;return this.storage.caching.set(this.makePath(h),p),this}flush(h){return this.storage.local.flush(h)}declareType(h,p,l){let w;if(l&&typeof p=="string")w=p;else if(l||typeof p=="string"){if(!l&&typeof p=="string")throw new Error("declareType() requires a JSON Schema object to be passed, in order to validate object types/formats")}else l=p,w=this._defaultTypeURI(h);k.Types.declare(this.moduleName,h,w,l)}validate(h){const p=k.Types.getSchema(h["@context"]);if(p)return M.default.validateResult(h,p);throw new x.default(h["@context"])}_defaultTypeURI(h){return"http://remotestorage.io/spec/modules/"+encodeURIComponent(this.moduleName)+"/"+encodeURIComponent(h)}_attachType(h,p){h["@context"]=k.Types.resolveAlias(this.moduleName+"/"+p)||this._defaultTypeURI(p)}makePath(h){return this.base+(h||"")}_fireChange(h){c.default.changeEvents[h.origin]&&(["new","old","lastCommon"].forEach(function(p){if((!h[p+"ContentType"]||/^application\/(.*)json(.*)/.exec(h[p+"ContentType"]))&&typeof h[p+"Value"]=="string")try{h[p+"Value"]=JSON.parse(h[p+"Value"])}catch{}}),this._emit("change",h))}static _rs_init(){}}k.Types=m.default,(0,O.applyMixins)(k,[_.default]),a.exports=k},function(a,i,f){var u=this&&this.__importDefault||function(x){return x&&x.__esModule?x:{default:x}};Object.defineProperty(i,"__esModule",{value:!0}),i.RemoteBase=void 0;const v=u(f(2)),M=f(0);class m extends v.default{constructor(_){super(),this.rs=_,this.connected=!1}stopWaitingForToken(){this.connected||this._emit("not-connected")}addQuotes(_){return typeof _!="string"?_:_==="*"?"*":'"'+_+'"'}stripQuotes(_){return typeof _!="string"?_:_.replace(/^["']|["']$/g,"")}isForbiddenRequestMethod(_,c){return(_==="PUT"||_==="DELETE")&&(0,M.isFolder)(c)}}i.RemoteBase=m},function(a,i,f){class u extends Error{constructor(M){super(),this.name="SyncError",this.message="Sync failed: ",typeof M=="string"?this.message+=M:(this.message+=M.message,this.stack=M.stack,this.originalError=M)}}a.exports=u},function(a,i,f){var u=this&&this.__awaiter||function(p,l,w,T){return new(w||(w=Promise))(function(N,S){function e(L){try{y(T.next(L))}catch(j){S(j)}}function g(L){try{y(T.throw(L))}catch(j){S(j)}}function y(L){var j;L.done?N(L.value):(j=L.value,j instanceof w?j:new w(function(B){B(j)})).then(e,g)}y((T=T.apply(p,l||[])).next())})},v=this&&this.__importDefault||function(p){return p&&p.__esModule?p:{default:p}};const M=v(f(2)),m=v(f(3)),x=v(f(1)),_=f(0);function c(p){if(typeof p=="object"&&typeof p.path=="string")if((0,_.isFolder)(p.path)){if(p.local&&p.local.itemsMap)return p.local;if(p.common&&p.common.itemsMap)return p.common}else{if(p.local){if(p.local.body&&p.local.contentType)return p.local;if(p.local.body===!1)return}if(p.common&&p.common.body&&p.common.contentType)return p.common;if(p.body&&p.contentType)return{body:p.body,contentType:p.contentType}}}function O(p,l){for(const w in p){if(p[w]&&p[w].remote)return!0;const T=c(p[w]);if(T&&T.timestamp&&new Date().getTime()-T.timestamp<=l)return!1;if(!T)return!0}return!0}function k(p){const l={path:p,common:{}};return(0,_.isFolder)(p)&&(l.common.itemsMap={}),l}function R(p,l){return p.common||(p.common={itemsMap:{}}),p.common.itemsMap||(p.common.itemsMap={}),p.local||(p.local=(0,_.deepClone)(p.common)),p.local.itemsMap||(p.local.itemsMap=p.common.itemsMap),p.local.itemsMap[l]=!0,p}class h{constructor(){this._updateNodesRunning=!1,this._updateNodesQueued=[]}get(l,w,T){return u(this,void 0,void 0,function*(){return typeof w=="number"?this.getNodes((0,_.pathsFromRoot)(l)).then(N=>{const S=c(N[l]);return O(N,w)?T(l):S?{statusCode:200,body:S.body||S.itemsMap,contentType:S.contentType}:{statusCode:404}}):this.getNodes([l]).then(N=>{const S=c(N[l]);if(S){if((0,_.isFolder)(l))for(const e in S.itemsMap)S.itemsMap.hasOwnProperty(e)&&S.itemsMap[e]===!1&&delete S.itemsMap[e];return{statusCode:200,body:S.body||S.itemsMap,contentType:S.contentType}}return{statusCode:404}})})}put(l,w,T){return u(this,void 0,void 0,function*(){const N=(0,_.pathsFromRoot)(l);return this._updateNodes(N,function(S,e){try{for(let g=0,y=S.length;g<y;g++){const L=S[g];let j,B=e[L];B||(e[L]=B=k(L)),g===0?(j=c(B),B.local={body:w,contentType:T,previousBody:j?j.body:void 0,previousContentType:j?j.contentType:void 0}):B=R(B,S[g-1].substring(L.length))}return e}catch(g){throw(0,x.default)("[Cachinglayer] Error during PUT",e,g),g}})})}delete(l){const w=(0,_.pathsFromRoot)(l);return this._updateNodes(w,function(T,N){for(let S=0,e=T.length;S<e;S++){const g=T[S],y=N[g];let L;if(y)if(S===0)L=c(y),y.local={body:!1,previousBody:L?L.body:void 0,previousContentType:L?L.contentType:void 0};else{y.local||(y.local=(0,_.deepClone)(y.common));const j=T[S-1].substring(g.length);if(delete y.local.itemsMap[j],Object.getOwnPropertyNames(y.local.itemsMap).length>0)break}else console.error("Cannot delete non-existing node "+g)}return N})}flush(l){return this._getAllDescendentPaths(l).then(w=>this.getNodes(w)).then(w=>{for(const T in w){const N=w[T];N&&N.common&&N.local&&this._emitChange({path:N.path,origin:"local",oldValue:N.local.body===!1?void 0:N.local.body,newValue:N.common.body===!1?void 0:N.common.body}),w[T]=void 0}return this.setNodes(w)})}_emitChange(l){m.default.changeEvents[l.origin]&&this._emit("change",l)}fireInitial(){m.default.changeEvents.local&&this.forAllNodes(l=>{if((0,_.isDocument)(l.path)){const w=c(l);w&&this._emitChange({path:l.path,origin:"local",oldValue:void 0,oldContentType:void 0,newValue:w.body,newContentType:w.contentType})}}).then(()=>{this._emit("local-events-done")})}onDiff(l){this.diffHandler=l}migrate(l){return typeof l!="object"||l.common||(l.common={},typeof l.path=="string"?l.path.substr(-1)==="/"&&typeof l.body=="object"&&(l.common.itemsMap=l.body):(l.local||(l.local={}),l.local.body=l.body,l.local.contentType=l.contentType)),l}_updateNodes(l,w){return new Promise((T,N)=>{this._doUpdateNodes(l,w,{resolve:T,reject:N})})}_doUpdateNodes(l,w,T){this._updateNodesRunning?this._updateNodesQueued.push({paths:l,cb:w,promise:T}):(this._updateNodesRunning=!0,this.getNodes(l).then(N=>{const S=(0,_.deepClone)(N),e=[];N=w(l,N);for(const g in N){const y=N[g];(0,_.equal)(y,S[g])?delete N[g]:(0,_.isDocument)(g)&&((0,_.equal)(y.local.body,y.local.previousBody)&&y.local.contentType===y.local.previousContentType||e.push({path:g,origin:"window",oldValue:y.local.previousBody,newValue:y.local.body===!1?void 0:y.local.body,oldContentType:y.local.previousContentType,newContentType:y.local.contentType}),delete y.local.previousBody,delete y.local.previousContentType)}this.setNodes(N).then(()=>{this._emitChangeEvents(e),T.resolve({statusCode:200})})}).then(()=>Promise.resolve(),N=>{T.reject(N)}).then(()=>{this._updateNodesRunning=!1;const N=this._updateNodesQueued.shift();N&&this._doUpdateNodes(N.paths,N.cb,N.promise)}))}_emitChangeEvents(l){for(let w=0,T=l.length;w<T;w++)this._emitChange(l[w]),this.diffHandler&&this.diffHandler(l[w].path)}_getAllDescendentPaths(l){return(0,_.isFolder)(l)?this.getNodes([l]).then(w=>{const T=[l],N=c(w[l]),S=Object.keys(N.itemsMap).map(e=>this._getAllDescendentPaths(l+e).then(g=>{for(let y=0,L=g.length;y<L;y++)T.push(g[y])}));return Promise.all(S).then(()=>T)}):Promise.resolve([l])}_getInternals(){return{getLatest:c,makeNode:k,isOutdated:O}}}(0,_.applyMixins)(h,[M.default]),a.exports=h},function(a,i,f){a.exports=class{constructor(){this.reset()}static _rs_init(){}get scopes(){return Object.keys(this.scopeModeMap).map(u=>({name:u,mode:this.scopeModeMap[u]}))}get scopeParameter(){return this.scopes.map(u=>`${this._scopeNameForParameter(u)}:${u.mode}`).join(" ")}claim(u,v){if(typeof u!="string"||u.indexOf("/")!==-1||u.length===0)throw new Error("Scope should be a non-empty string without forward slashes");if(!v.match(/^rw?$/))throw new Error("Mode should be either 'r' or 'rw'");this._adjustRootPaths(u),this.scopeModeMap[u]=v}get(u){return this.scopeModeMap[u]}remove(u){const v={};for(const M in this.scopeModeMap)v[M]=this.scopeModeMap[M];this.reset(),delete v[u];for(const M in v)this.claim(M,v[M])}checkPermission(u,v){const M=this.get(u);return M&&(v==="r"||M==="rw")}checkPathPermission(u,v){if(this.checkPermission("*",v))return!0;const M=this._getModuleName(u);return!!this.checkPermission(M,v)}reset(){this.rootPaths=[],this.scopeModeMap={}}_getModuleName(u){if(u[0]!=="/")throw new Error("Path should start with a slash");const v=u.replace(/^\/public/,"").match(/^\/([^/]*)\//);return v?v[1]:"*"}_adjustRootPaths(u){"*"in this.scopeModeMap||u==="*"?this.rootPaths=["/"]:u in this.scopeModeMap||(this.rootPaths.push("/"+u+"/"),this.rootPaths.push("/public/"+u+"/"))}_scopeNameForParameter(u){if(u.name==="*"&&this.storageType){if(this.storageType==="2012.04")return"";if(this.storageType.match(/remotestorage-0[01]/))return"root"}return u.name}setStorageType(u){this.storageType=u}}},function(a,i,f){var u=this&&this.__importDefault||function(m){return m&&m.__esModule?m:{default:m}};const v=f(0),M=u(f(1));a.exports=class{constructor(){this.pendingActivations=[],this.reset()}set(m,x){if(typeof m!="string")throw new Error("path should be a string");if(!(0,v.isFolder)(m))throw new Error("path should be a folder");if(!x.match(/^(FLUSH|SEEN|ALL)$/))throw new Error("strategy should be 'FLUSH', 'SEEN', or 'ALL'");this._rootPaths[m]=x,x==="ALL"&&(this.activateHandler?this.activateHandler(m):this.pendingActivations.push(m))}enable(m){this.set(m,"ALL")}disable(m){this.set(m,"FLUSH")}onActivate(m){(0,M.default)("[Caching] Setting activate handler",m,this.pendingActivations),this.activateHandler=m;for(let x=0;x<this.pendingActivations.length;x++)m(this.pendingActivations[x]);this.pendingActivations=[]}checkPath(m){return this._rootPaths[m]!==void 0?this._rootPaths[m]:m==="/"?"SEEN":this.checkPath((0,v.containingFolder)(m))}reset(){this._rootPaths={}}static _rs_init(){}}},function(a,i,f){var u=this&&this.__importDefault||function(N){return N&&N.__esModule?N:{default:N}};const v=u(f(8)),M=u(f(2)),m=f(0),x=f(7),_=f(9),c="https://www.googleapis.com",O="remotestorage:googledrive";let k;function R(N){return N.substr(-1)==="/"&&(N=N.substr(0,N.length-1)),decodeURIComponent(N)}function h(N){return N.replace(/[^\/]+\/?$/,"")}function p(N){const S=N.split("/");return N.substr(-1)==="/"?S[S.length-2]+"/":S[S.length-1]}function l(N){return(0,m.cleanPath)("/remotestorage/"+N)}class w{constructor(S){this._items={},this.maxAge=S,this._items={}}get(S){const e=this._items[S],g=new Date().getTime();return e&&e.t>=g-this.maxAge?e.v:void 0}set(S,e){this._items[S]={v:e,t:new Date().getTime()}}}class T extends _.RemoteBase{constructor(S,e){if(super(S),this.online=!0,this.storageApi="draft-dejong-remotestorage-19",this.addEvents(["connected","not-connected"]),this.clientId=e,this._fileIdCache=new w(300),k=(0,m.localStorageAvailable)(),k){const g=(0,m.getJSONFromLocalStorage)(O);g&&this.configure(g)}}configure(S){S.userAddress!==void 0&&(this.userAddress=S.userAddress),S.token!==void 0&&(this.token=S.token);const e=function(){k&&localStorage.setItem(O,JSON.stringify({userAddress:this.userAddress,token:this.token}))},g=function(){this.connected=!1,delete this.token,k&&localStorage.removeItem(O)};this.token?(this.connected=!0,this.userAddress?(this._emit("connected"),e.apply(this)):this.info().then(y=>{this.userAddress=y.user.emailAddress,this._emit("connected"),e.apply(this)}).catch(()=>{g.apply(this),this.rs._emit("error",new Error("Could not fetch user info."))})):g.apply(this)}connect(){this.rs.setBackend("googledrive"),this.rs.authorize({authURL:"https://accounts.google.com/o/oauth2/auth",scope:"https://www.googleapis.com/auth/drive",clientId:this.clientId})}get(S,e={}){return(0,m.isFolder)(S)?this._getFolder(l(S)):this._getFile(l(S),e)}put(S,e,g,y={}){const L=l(S);function j(B){if(B.status>=200&&B.status<300){const z=JSON.parse(B.responseText),J=this.stripQuotes(z.etag);return Promise.resolve({statusCode:200,contentType:z.mimeType,revision:J})}return B.status===412?Promise.resolve({statusCode:412,revision:"conflict"}):Promise.reject("PUT failed with status "+B.status+" ("+B.responseText+")")}return this._getFileId(L).then(B=>B?y&&y.ifNoneMatch==="*"?j({status:412}):this._updateFile(B,L,e,g,y).then(j):this._createFile(L,e,g).then(j))}delete(S,e={}){const g=l(S);return this._getFileId(g).then(y=>y?this._getMeta(y).then(L=>{let j;return typeof L=="object"&&typeof L.etag=="string"&&(j=this.stripQuotes(L.etag)),e&&e.ifMatch&&e.ifMatch!==j?{statusCode:412,revision:j}:this._request("DELETE",c+"/drive/v2/files/"+y,{}).then(B=>B.status===200||B.status===204?{statusCode:200}:Promise.reject("Delete failed: "+B.status+" ("+B.responseText+")"))}):Promise.resolve({statusCode:200}))}info(){return this._request("GET","https://www.googleapis.com/drive/v2/about?fields=user",{}).then(function(S){try{const e=JSON.parse(S.responseText);return Promise.resolve(e)}catch(e){return Promise.reject(e)}})}_updateFile(S,e,g,y,L){const j={mimeType:y},B={"Content-Type":"application/json; charset=UTF-8"};return L&&L.ifMatch&&(B["If-Match"]=this.addQuotes(L.ifMatch)),this._request("PUT",c+"/upload/drive/v2/files/"+S+"?uploadType=resumable",{body:JSON.stringify(j),headers:B}).then(z=>z.status===412?z:this._request("PUT",z.getResponseHeader("Location"),{body:y.match(/^application\/json/)?JSON.stringify(g):g}))}_createFile(S,e,g){return this._getParentId(S).then(y=>{const L={title:R(p(S)),mimeType:g,parents:[{kind:"drive#fileLink",id:y}]};return this._request("POST",c+"/upload/drive/v2/files?uploadType=resumable",{body:JSON.stringify(L),headers:{"Content-Type":"application/json; charset=UTF-8"}}).then(j=>this._request("POST",j.getResponseHeader("Location"),{body:g.match(/^application\/json/)?JSON.stringify(e):e}))})}_getFile(S,e){return this._getFileId(S).then(g=>this._getMeta(g).then(y=>{let L;if(typeof y=="object"&&typeof y.etag=="string"&&(L=this.stripQuotes(y.etag)),e&&e.ifNoneMatch&&L===e.ifNoneMatch)return Promise.resolve({statusCode:304});if(!y.downloadUrl){if(!y.exportLinks||!y.exportLinks["text/html"])return Promise.resolve({statusCode:200,body:"",contentType:y.mimeType,revision:L});y.mimeType+=";export=text/html",y.downloadUrl=y.exportLinks["text/html"]}return this._request("GET",y.downloadUrl,{responseType:"arraybuffer"}).then(j=>(0,m.getTextFromArrayBuffer)(j.response,"UTF-8").then(function(B){let z=B;if(y.mimeType.match(/^application\/json/))try{z=JSON.parse(z)}catch{}else(0,m.shouldBeTreatedAsBinary)(B,y.mimeType)&&(z=j.response);return{statusCode:200,body:z,contentType:y.mimeType,revision:L}}))}))}_getFolder(S){return this._getFileId(S).then(e=>{let g,y,L;if(!e)return Promise.resolve({statusCode:404});const j="'"+e+"' in parents";return this._request("GET",c+"/drive/v2/files?q="+encodeURIComponent(j)+"&fields="+encodeURIComponent("items(downloadUrl,etag,fileSize,id,mimeType,title,labels)")+"&maxResults=1000&trashed=false",{}).then(B=>{var z;if(B.status!==200)return Promise.reject("request failed or something: "+B.status);try{g=JSON.parse(B.responseText)}catch{return Promise.reject("non-JSON response from GoogleDrive")}L={};for(const J of g.items)!((z=J.labels)===null||z===void 0)&&z.trashed||(y=this.stripQuotes(J.etag),J.mimeType==="application/vnd.google-apps.folder"?(this._fileIdCache.set(S+(0,m.cleanPath)(J.title)+"/",J.id),L[J.title+"/"]={ETag:y}):(this._fileIdCache.set(S+(0,m.cleanPath)(J.title),J.id),L[J.title]={ETag:y,"Content-Type":J.mimeType,"Content-Length":J.fileSize}));return Promise.resolve({statusCode:200,body:L,contentType:"application/json; charset=UTF-8",revision:void 0})})})}_getParentId(S){const e=h(S);return this._getFileId(e).then(g=>g?Promise.resolve(g):this._createFolder(e))}_createFolder(S){return this._getParentId(S).then(e=>this._request("POST",c+"/drive/v2/files",{body:JSON.stringify({title:R(p(S)),mimeType:"application/vnd.google-apps.folder",parents:[{id:e}]}),headers:{"Content-Type":"application/json; charset=UTF-8"}}).then(g=>{const y=JSON.parse(g.responseText);return Promise.resolve(y.id)}))}_getFileId(S){let e;return S==="/"?Promise.resolve("root"):(e=this._fileIdCache.get(S))?Promise.resolve(e):this._getFolder(h(S)).then(()=>(e=this._fileIdCache.get(S),e?Promise.resolve(e):S.substr(-1)==="/"?this._createFolder(S).then(()=>this._getFileId(S)):Promise.resolve()))}_getMeta(S){return this._request("GET",c+"/drive/v2/files/"+S,{}).then(function(e){return e.status===200?Promise.resolve(JSON.parse(e.responseText)):Promise.reject("request (getting metadata for "+S+") failed with status: "+e.status)})}_request(S,e,g){return this.isForbiddenRequestMethod(S,e)?Promise.reject(`Don't use ${S} on directories!`):(g.headers||(g.headers={}),g.headers.Authorization="Bearer "+this.token,this.rs._emit("wire-busy",{method:S,isFolder:(0,m.isFolder)(e)}),(0,x.requestWithTimeout)(S,e,g).then(y=>y&&y.status===401?void this.connect():(this.online||(this.online=!0,this.rs._emit("network-online")),this.rs._emit("wire-done",{method:S,isFolder:(0,m.isFolder)(e),success:!0}),Promise.resolve(y)),y=>(this.online&&(this.online=!1,this.rs._emit("network-offline")),this.rs._emit("wire-done",{method:S,isFolder:(0,m.isFolder)(e),success:!1}),Promise.reject(y))))}static _rs_init(S){const e=S.apiKeys.googledrive;var g;e&&(S.googledrive=new T(S,e.clientId),S.backend==="googledrive"&&(S._origRemote=S.remote,S.remote=S.googledrive,(g=S)._origBaseClientGetItemURL||(g._origBaseClientGetItemURL=v.default.prototype.getItemURL,v.default.prototype.getItemURL=function(){throw new Error("getItemURL is not implemented for Google Drive yet")})))}static _rs_supported(){return!0}static _rs_cleanup(S){var e;S.setBackend(void 0),S._origRemote&&(S.remote=S._origRemote,delete S._origRemote),(e=S)._origBaseClientGetItemURL&&(v.default.prototype.getItemURL=e._origBaseClientGetItemURL,delete e._origBaseClientGetItemURL)}}(0,m.applyMixins)(T,[M.default]),a.exports=T},function(a,i,f){var u=this&&this.__awaiter||function(J,C,A,E){return new(A||(A=Promise))(function(n,o){function b(V){try{U(E.next(V))}catch(q){o(q)}}function I(V){try{U(E.throw(V))}catch(q){o(q)}}function U(V){var q;V.done?n(V.value):(q=V.value,q instanceof A?q:new A(function(G){G(q)})).then(b,I)}U((E=E.apply(J,C||[])).next())})},v=this&&this.__importDefault||function(J){return J&&J.__esModule?J:{default:J}};const M=v(f(2)),m=v(f(8)),x=v(f(27)),_=v(f(10)),c=v(f(5)),O=f(0),k=f(7),R=f(9),h=v(f(4));let p;const l="remotestorage:dropbox",w="https://api.dropboxapi.com/2/files/list_folder",T="https://api.dropboxapi.com/2/files/list_folder/continue";function N(J){return("/remotestorage/"+J).replace(/\/+$/,"").replace(/\/+/g,"/")}const S=/[\u007f-\uffff]/g;function e(J){return JSON.stringify(J).replace(S,function(C){return"\\u"+("000"+C.charCodeAt(0).toString(16)).slice(-4)})}function g(J,C){return new RegExp("^"+C.join("\\/")+"(\\/|$)").test(J.error_summary)}function y(J){return J instanceof ArrayBuffer||(0,k.isArrayBufferView)(J)}class L extends R.RemoteBase{constructor(C){if(super(C),this.online=!0,this.storageApi="draft-dejong-remotestorage-19",this._initialFetchDone=!1,this.addEvents(["connected","not-connected"]),this.clientId=C.apiKeys.dropbox.appKey,this.TOKEN_URL="https://api.dropboxapi.com/oauth2/token",this._revCache=new x.default("rev"),this._fetchDeltaCursor=null,this._fetchDeltaPromise=null,this._itemRefs={},p=(0,O.localStorageAvailable)(),p){const A=(0,O.getJSONFromLocalStorage)(l);A&&this.configure(A),this._itemRefs=(0,O.getJSONFromLocalStorage)(l+":shares")||{}}this.connected&&setTimeout(this._emit.bind(this),0,"connected")}connect(){return u(this,void 0,void 0,function*(){try{if(this.rs.setBackend("dropbox"),this.token)z(this.rs);else{const{codeVerifier:C,codeChallenge:A,state:E}=yield(0,O.generateCodeVerifier)();sessionStorage.setItem("remotestorage:codeVerifier",C),sessionStorage.setItem("remotestorage:state",E),this.rs.authorize({authURL:"https://www.dropbox.com/oauth2/authorize",scope:"account_info.read files.content.read files.content.write files.metadata.read files.metadata.write",clientId:this.clientId,response_type:"code",state:E,code_challenge:A,code_challenge_method:"S256",token_access_type:"offline"})}}catch(C){throw this.rs._emit("error",C),this.rs.setBackend(void 0),C}})}configure(C){return u(this,void 0,void 0,function*(){C.userAddress!==void 0&&(this.userAddress=C.userAddress),C.token!==void 0&&(this.token=C.token),C.refreshToken!==void 0&&(this.refreshToken=C.refreshToken),C.tokenType!==void 0&&(this.tokenType=C.tokenType);const A=()=>{p&&localStorage.setItem(l,JSON.stringify({userAddress:this.userAddress,token:this.token,refreshToken:this.refreshToken,tokenType:this.tokenType}))},E=()=>{this.connected=!1,p&&localStorage.removeItem(l),this.rs.setBackend(void 0)};if(this.refreshToken||this.token)if(this.connected=!0,this.userAddress)this._emit("connected"),A();else try{const n=yield this.info();this.userAddress=n.email,this._emit("connected"),A()}catch{this.connected=!1,this.rs._emit("error",new Error("Could not fetch user info.")),A.apply(this)}else E()})}_getFolder(C){const A=this._revCache,E=o=>{let b;if(o.status!==200&&o.status!==409)return Promise.reject("Unexpected response status: "+o.status);try{b=JSON.parse(o.responseText)}catch(U){return Promise.reject(U)}if(o.status===409)return g(b,["path","not_found"])?Promise.resolve({}):Promise.reject(new Error("API returned an error: "+b.error_summary));const I=b.entries.reduce((U,V)=>{try{const q=V[".tag"]==="folder",G=V.path_display.split("/").slice(-1)[0]+(q?"/":"");if(q)U[G]={ETag:A.get(C+G)};else{const Y=new Date(V.server_modified);U[G]={ETag:V.rev,"Content-Length":V.size,"Last-Modified":Y.toUTCString()},this._revCache.set(C+G,V.rev)}}catch(q){console.error(`[Dropbox] folder ${C} has entry ${JSON.stringify(V)}:`,q)}return U},{});return b.has_more?n(b.cursor).then(function(U){return Object.assign(I,U)}):Promise.resolve(I)},n=o=>{const b={body:{cursor:o}};return this._request("POST",T,b).then(E)};return this._request("POST",w,{body:{path:N(C)}}).then(E).then(function(o){return Promise.resolve({statusCode:200,body:o,contentType:"application/json; charset=UTF-8",revision:A.get(C)})})}get(C,A={}){if(!this.connected)return Promise.reject("not connected (path: "+C+")");const E=this._revCache.get(C);if(E===null)return Promise.resolve({statusCode:404});if(A&&A.ifNoneMatch){if(!this._initialFetchDone)return this.fetchDelta().then(()=>this.get(C,A));if(E&&E===A.ifNoneMatch)return Promise.resolve({statusCode:304})}if(C.slice(-1)==="/")return this._getFolder(C);const n={headers:{"Dropbox-API-Arg":e({path:N(C)})},responseType:"arraybuffer"};return A&&A.ifNoneMatch&&(n.headers["If-None-Match"]=A.ifNoneMatch),this._request("GET","https://content.dropboxapi.com/2/files/download",n).then(o=>{const b=o.status;let I,U,V,q;return b!==200&&b!==409?Promise.resolve({statusCode:b}):(I=o.getResponseHeader("Dropbox-API-Result"),(0,O.getTextFromArrayBuffer)(o.response,"UTF-8").then(G=>{U=G,b===409&&(I=U);try{I=JSON.parse(I)}catch(Y){return Promise.reject(Y)}if(b===409)return g(I,["path","not_found"])?{statusCode:404}:Promise.reject(new Error('API error while downloading file ("'+C+'"): '+I.error_summary));if(V=o.getResponseHeader("Content-Type"),q=I.rev,this._revCache.set(C,q),this._shareIfNeeded(C),(0,O.shouldBeTreatedAsBinary)(G,V))U=o.response;else try{U=JSON.parse(U),V="application/json; charset=UTF-8"}catch{}return{statusCode:b,body:U,contentType:V,revision:q}}))})}put(C,A,E,n={}){return u(this,void 0,void 0,function*(){if(!this.connected)throw new Error("not connected (path: "+C+")");const o=this._revCache.get(C);if(n&&n.ifMatch&&o&&o!==n.ifMatch)return{statusCode:412,revision:o};if(n&&n.ifNoneMatch==="*"&&o&&o!=="rev")return{statusCode:412,revision:o};if(!E.match(/charset=/)&&y(A)&&(E+="; charset=binary"),A.length>157286400)throw new Error("Cannot upload file larger than 150MB");const b=n&&(n.ifMatch||n.ifNoneMatch==="*"),I={body:A,contentType:E,path:C};if(b){const V=yield this._getMetadata(C);if(n&&n.ifNoneMatch==="*"&&V)return{statusCode:412,revision:V.rev};if(n&&n.ifMatch&&V&&V.rev!==n.ifMatch)return{statusCode:412,revision:V.rev}}const U=yield this._uploadSimple(I);return this._shareIfNeeded(C),U})}delete(C,A={}){return u(this,void 0,void 0,function*(){if(!this.connected)throw new Error("not connected (path: "+C+")");const E=this._revCache.get(C);if(A!=null&&A.ifMatch&&E&&A.ifMatch!==E)return{statusCode:412,revision:E};if(A!=null&&A.ifMatch){const n=yield this._getMetadata(C);if(A!=null&&A.ifMatch&&n&&n.rev!==A.ifMatch)return{statusCode:412,revision:n.rev}}return this._deleteSimple(C)})}_shareIfNeeded(C){if(C.match(/^\/public\/.*[^/]$/)&&this._itemRefs[C]===void 0)return this.share(C)}share(C){const A={body:{path:N(C)}};return this._request("POST","https://api.dropboxapi.com/2/sharing/create_shared_link_with_settings",A).then(E=>{if(E.status!==200&&E.status!==409)return Promise.reject(new Error("Invalid response status:"+E.status));let n;try{n=JSON.parse(E.responseText)}catch{return Promise.reject(new Error("Invalid response body: "+E.responseText))}return E.status===409?g(n,["shared_link_already_exists"])?this._getSharedLink(C):Promise.reject(new Error("API error: "+n.error_summary)):Promise.resolve(n.url)}).then(E=>(this._itemRefs[C]=E,p&&localStorage.setItem(l+":shares",JSON.stringify(this._itemRefs)),Promise.resolve(E)),E=>(E.message='Sharing Dropbox file or folder ("'+C+'") failed: '+E.message,Promise.reject(E)))}info(){return this._request("POST","https://api.dropboxapi.com/2/users/get_current_account",{}).then(function(C){let A;try{const E=JSON.parse(C.responseText);A=E==null?void 0:E.email}catch{return Promise.reject(new Error("Could not query current account info: Invalid API response: "+C.responseText))}return Promise.resolve({email:A})})}_request(C,A,E,n=1){return u(this,void 0,void 0,function*(){if(this.isForbiddenRequestMethod(C,A))throw`Don't use ${C} on directories!`;if(!this.token)throw new c.default("No access token");E.headers||(E.headers={}),E.headers.Authorization="Bearer "+this.token,typeof E.body!="object"||y(E.body)||(E.body=JSON.stringify(E.body),E.headers["Content-Type"]="application/json; charset=UTF-8"),this.rs._emit("wire-busy",{method:C,isFolder:(0,O.isFolder)(A)});try{const o=yield(0,k.requestWithTimeout)(C,A,E);return this.online||(this.online=!0,this.rs._emit("network-online")),this.rs._emit("wire-done",{method:C,isFolder:(0,O.isFolder)(A),success:!0}),(o==null?void 0:o.status)===401&&this.refreshToken?n>=3?(console.error(`Abandoned after ${n} attempts: ${C} ${A}`),o):(this.rs._emit("wire-busy",{method:C,isFolder:(0,O.isFolder)(A)}),yield h.default.refreshAccessToken(this.rs,this,this.refreshToken),this.rs._emit("wire-done",{method:C,isFolder:(0,O.isFolder)(A),success:!0}),this._request(C,A,E,n+1)):[503,429].includes(o==null?void 0:o.status)?(this.online&&(this.online=!1,this.rs._emit("network-offline")),n>=3?(console.warn(`Abandoned after ${n} attempts: ${C} ${A}`),o):(yield new Promise(b=>setTimeout(b,(0,k.retryAfterMs)(o))),this._request(C,A,E,n+1))):o}catch(o){throw this.online&&(this.online=!1,this.rs._emit("network-offline")),this.rs._emit("wire-done",{method:C,isFolder:(0,O.isFolder)(A),success:!1}),o}})}fetchDelta(...C){if(this._fetchDeltaPromise)return this._fetchDeltaPromise;const A=E=>u(this,void 0,void 0,function*(){let n,o;typeof E=="string"?(n=T,o={cursor:E}):(n=w,o={path:"/remotestorage",recursive:!0,include_deleted:!0});try{const b=yield this._request("POST",n,{body:o});if(b.status===401)throw new c.default;if(b.status!==200&&b.status!==409)throw new Error("Invalid response status: "+b.status);let I;try{I=JSON.parse(b.responseText)}catch{throw new Error("Invalid response body: "+b.responseText)}if(b.status===409){if(!g(I,["path","not_found"]))throw new Error("API returned an error: "+I.error_summary);I={cursor:null,entries:[],has_more:!1}}if(E||this._revCache.deactivatePropagation(),I.entries.forEach(U=>{const V=U.path_display.slice(14);U[".tag"]==="deleted"?(this._revCache.delete(V),this._revCache.delete(V+"/")):U[".tag"]==="file"&&this._revCache.set(V,U.rev)}),this._fetchDeltaCursor=I.cursor,I.has_more)return A(I.cursor);this._revCache.activatePropagation(),this._initialFetchDone=!0}catch(b){if(b==="timeout")return;throw b}});return this._fetchDeltaPromise=A(this._fetchDeltaCursor).catch(E=>(typeof E=="object"&&"message"in E?E.message="Dropbox: fetchDelta: "+E.message:E="Dropbox: fetchDelta: "+E,this.rs._emit("error",E),this._fetchDeltaPromise=null,Promise.reject(E))).then(()=>(this._fetchDeltaPromise=null,Promise.resolve(C))),this._fetchDeltaPromise}_getMetadata(C){const A={path:N(C)};return this._request("POST","https://api.dropboxapi.com/2/files/get_metadata",{body:A}).then(E=>{if(E.status!==200&&E.status!==409)return Promise.reject(new Error("Invalid response status:"+E.status));let n;try{n=JSON.parse(E.responseText)}catch{return Promise.reject(new Error("Invalid response body: "+E.responseText))}return E.status===409?g(n,["path","not_found"])?Promise.resolve():Promise.reject(new Error("API error: "+n.error_summary)):Promise.resolve(n)}).then(void 0,E=>(E.message='Could not load metadata for file or folder ("'+C+'"): '+E.message,Promise.reject(E)))}_uploadSimple(C){const A={path:N(C.path),mode:{".tag":"overwrite",update:void 0},mute:!0};return C.ifMatch&&(A.mode={".tag":"update",update:C.ifMatch}),this._request("POST","https://content.dropboxapi.com/2/files/upload",{body:C.body,headers:{"Content-Type":"application/octet-stream","Dropbox-API-Arg":e(A)}}).then(E=>{if(E.status!==200&&E.status!==409)return Promise.resolve({statusCode:E.status});let n;try{n=JSON.parse(E.responseText)}catch{return Promise.reject(new Error("Invalid API result: "+E.responseText))}return E.status===409?g(n,["path","conflict"])?this._getMetadata(C.path).then(function(o){return Promise.resolve({statusCode:412,revision:o.rev})}):(this.rs._emit("error",new Error(n.error_summary)),Promise.resolve({statusCode:E.status})):(this._revCache.set(C.path,n.rev),Promise.resolve({statusCode:E.status,revision:n.rev}))})}_deleteSimple(C){const A={path:N(C)};return this._request("POST","https://api.dropboxapi.com/2/files/delete",{body:A}).then(E=>{if(E.status!==200&&E.status!==409)return Promise.resolve({statusCode:E.status});let n;try{n=JSON.parse(E.responseText)}catch{return Promise.reject(new Error("Invalid response body: "+E.responseText))}if(E.status===409){if(g(n,["path_lookup","not_found"]))return Promise.resolve({statusCode:404});this.rs._emit("error",new Error(n.error_summary))}return Promise.resolve({statusCode:E.status})}).then(E=>(E.statusCode!==200&&E.statusCode!==404||(this._revCache.delete(C),delete this._itemRefs[C]),Promise.resolve(E)),E=>(E.message='Could not delete Dropbox file or folder ("'+C+'"): '+E.message,Promise.reject(E)))}_getSharedLink(C){return u(this,void 0,void 0,function*(){const A={body:{path:N(C),direct_only:!0}};return this._request("POST","https://api.dropbox.com/2/sharing/list_shared_links",A).then(E=>{if(E.status!==200&&E.status!==409)return Promise.reject(new Error("Invalid response status: "+E.status));let n;try{n=JSON.parse(E.responseText)}catch{return Promise.reject(new Error("Invalid response body: "+E.responseText))}return E.status===409?Promise.reject(new Error("API error: "+(n==null?void 0:n.error_summary)||!1)):n.links.length?Promise.resolve(n.links[0].url):Promise.reject(new Error("No links returned"))},E=>(E.message='Could not get link to a shared file or folder ("'+C+'"): '+E.message,Promise.reject(E)))})}static _rs_init(C){p=(0,O.localStorageAvailable)(),C.apiKeys.dropbox&&(C.dropbox=new L(C)),C.backend==="dropbox"&&z(C)}static _rs_supported(){return!0}static _rs_cleanup(C){(function(A){(function(E){E._origRemote&&(E.remote=E._origRemote,delete E._origRemote)})(A),function(E){E._dropboxOrigSync&&(E.sync.sync=E._dropboxOrigSync,delete E._dropboxOrigSync)}(A),function(E){E._origBaseClientGetItemURL&&(m.default.prototype.getItemURL=E._origBaseClientGetItemURL,delete E._origBaseClientGetItemURL)}(A),B(A)})(C),p&&localStorage.removeItem(l),C.setBackend(void 0)}}function j(J,...C){J._dropboxOrigSync||(J._dropboxOrigSync=J.sync.sync.bind(J.sync),J.sync.sync=function(){return this.dropbox.fetchDelta(J,...C).then(J._dropboxOrigSync,function(A){J._emit("error",new _.default(A)),J._emit("sync-done")})}.bind(J))}function B(J){J._dropboxOrigSyncCycle&&(J.syncCycle=J._dropboxOrigSyncCycle,delete J._dropboxOrigSyncCycle)}function z(J){(function(C){C._origRemote||(C._origRemote=C.remote,C.remote=C.dropbox)})(J),J.sync?j(J):function(C,...A){C._dropboxOrigSyncCycle||(C._dropboxOrigSyncCycle=C.syncCycle,C.syncCycle=()=>{if(!C.sync)throw new Error("expected sync to be initialized by now");j(C),C._dropboxOrigSyncCycle(C,...A),B(C)})}(J),function(C){C._origBaseClientGetItemURL||(C._origBaseClientGetItemURL=m.default.prototype.getItemURL,m.default.prototype.getItemURL=function(){throw new Error("getItemURL is not implemented for Dropbox yet")})}(J)}(0,O.applyMixins)(L,[M.default]),a.exports=L},function(a,i,f){var u=this&&this.__importDefault||function(k){return k&&k.__esModule?k:{default:k}};const v=u(f(28)),M=u(f(1)),m=f(0);let x,_,c={};const O=function(k){return new Promise((R,h)=>k in c?R(c[k]):new v.default({tls_only:!1,uri_fallback:!0,request_timeout:5e3}).lookup(k,function(p,l){if(p)return h(p);if(typeof l.idx.links.remotestorage!="object"||typeof l.idx.links.remotestorage.length!="number"||l.idx.links.remotestorage.length<=0)return(0,M.default)("[Discover] WebFinger record for "+k+" does not have remotestorage defined in the links section ",JSON.stringify(l.json)),h("WebFinger record for "+k+" does not have remotestorage defined in the links section.");const w=l.idx.links.remotestorage[0],T=w.properties["http://tools.ietf.org/html/rfc6749#section-4.2"]||w.properties["auth-endpoint"],N=w.properties["http://remotestorage.io/spec/version"]||w.type;return c[k]={href:w.href,storageApi:N,authURL:T,properties:w.properties},_&&(localStorage["remotestorage:discover"]=JSON.stringify({cache:c})),R(c[k])}))};(O.DiscoveryError=function(k){this.name="DiscoveryError",this.message=k,this.stack=new Error().stack}).prototype=Object.create(Error.prototype),O.DiscoveryError.prototype.constructor=O.DiscoveryError,O._rs_init=function(){if(_=(0,m.localStorageAvailable)(),_)try{c=JSON.parse(localStorage["remotestorage:discover"]).cache}catch{}},O._rs_supported=function(){return x=Object.prototype.hasOwnProperty.call(m.globalContext,"XMLHttpRequest"),x},O._rs_cleanup=function(){_&&delete localStorage["remotestorage:discover"]},a.exports=O},function(a,i,f){const u=(this&&this.__importDefault||function(m){return m&&m.__esModule?m:{default:m}})(f(2)),v=f(0);class M{constructor(){this.addEvents(["background","foreground"]),this.mode=typeof window<"u"?"browser":"node",this.mode==="browser"&&(this.setBrowserPrefixedNames(),document.addEventListener(this.visibilityChangeEvent,this.setVisibility.bind(this),!1),this.setVisibility())}setBrowserPrefixedNames(){this.mode==="browser"&&(document.hidden!==void 0?(this.hiddenProperty="hidden",this.visibilityChangeEvent="visibilitychange"):document.mozHidden!==void 0?(this.hiddenProperty="mozHidden",this.visibilityChangeEvent="mozvisibilitychange"):document.msHidden!==void 0?(this.hiddenProperty="msHidden",this.visibilityChangeEvent="msvisibilitychange"):document.webkitHidden!==void 0&&(this.hiddenProperty="webkitHidden",this.visibilityChangeEvent="webkitvisibilitychange"))}setVisibility(){document[this.hiddenProperty]?this.goBackground():this.goForeground()}isBrowser(){return this.mode==="browser"}isNode(){return this.mode==="node"}goBackground(){this._emit("background")}goForeground(){this._emit("foreground")}static _rs_init(){}static _rs_cleanup(){}}(0,v.applyMixins)(M,[u.default]),a.exports=M},function(a,i,f){a.exports=f(19)},function(a,i,f){var u=this&&this.__createBinding||(Object.create?function(C,A,E,n){n===void 0&&(n=E);var o=Object.getOwnPropertyDescriptor(A,E);o&&!("get"in o?!A.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return A[E]}}),Object.defineProperty(C,n,o)}:function(C,A,E,n){n===void 0&&(n=E),C[n]=A[E]}),v=this&&this.__setModuleDefault||(Object.create?function(C,A){Object.defineProperty(C,"default",{enumerable:!0,value:A})}:function(C,A){C.default=A}),M=this&&this.__importStar||function(C){if(C&&C.__esModule)return C;var A={};if(C!=null)for(var E in C)E!=="default"&&Object.prototype.hasOwnProperty.call(C,E)&&u(A,C,E);return v(A,C),A},m=this&&this.__importDefault||function(C){return C&&C.__esModule?C:{default:C}};const x=m(f(3)),_=m(f(1)),c=f(0),O=m(f(12)),k=m(f(4)),R=m(f(8)),h=m(f(13)),p=m(f(2)),l=m(f(14)),w=m(f(15)),T=m(f(16)),N=m(f(10)),S=m(f(5)),e=m(f(30)),g=M(f(0)),y=(0,c.getGlobalContext)();let L;function j(C){return C.statusCode!==403&&C.statusCode!==401||this._emit("error",new S.default),Promise.resolve(C)}function B(C){return typeof C=="number"&&C>=2e3&&C<=36e5}class z{constructor(A){this._pending=[],this._cleanups=[],this._pathHandlers={change:{}},this.apiKeys={},this._init=e.default.loadFeatures,this.features=e.default.features,this.loadFeature=e.default.loadFeature,this.featureSupported=e.default.featureSupported,this.featureDone=e.default.featureDone,this.featuresDone=e.default.featuresDone,this.featuresLoaded=e.default.featuresLoaded,this.featureInitialized=e.default.featureInitialized,this.featureFailed=e.default.featureFailed,this.hasFeature=e.default.hasFeature,this._setCachingModule=e.default._setCachingModule,this._collectCleanupFunctions=e.default._collectCleanupFunctions,this._fireReady=e.default._fireReady,this.initFeature=e.default.initFeature,typeof A=="object"&&(0,c.extend)(x.default,A),this.addEvents(["ready","authing","connecting","connected","disconnected","not-connected","conflict","error","features-loaded","sync-interval-change","sync-req-done","sync-done","wire-busy","wire-done","network-offline","network-online"]),this._setGPD({get:this._pendingGPD("get"),put:this._pendingGPD("put"),delete:this._pendingGPD("delete")}),L=(0,c.localStorageAvailable)(),L&&(this.apiKeys=(0,c.getJSONFromLocalStorage)("remotestorage:api-keys")||{},this.setBackend(localStorage.getItem("remotestorage:backend")||"remotestorage"));const E=this.on;this.on=function(n,o){if(this._allLoaded)switch(n){case"features-loaded":setTimeout(o,0);break;case"ready":this.remote&&setTimeout(o,0);break;case"connected":this.remote&&this.remote.connected&&setTimeout(o,0);break;case"not-connected":this.remote&&!this.remote.connected&&setTimeout(o,0)}return E.call(this,n,o)},this._init(),this.fireInitial=function(){this.local&&setTimeout(this.local.fireInitial.bind(this.local),0)}.bind(this),this.on("ready",this.fireInitial.bind(this)),this.loadModules()}get connected(){return this.remote.connected}loadModules(){x.default.modules.forEach(this.addModule.bind(this))}authorize(A){if(this.access.setStorageType(this.remote.storageApi),A.scope===void 0&&(A.scope=this.access.scopeParameter),y.cordova)A.redirectUri=x.default.cordovaRedirectUri;else{const E=k.default.getLocation();let n=E.origin;E.pathname!=="/"&&(n+=E.pathname),A.redirectUri=n}A.clientId===void 0&&(A.clientId=A.redirectUri.match(/^(https?:\/\/[^/]+)/)[0]),k.default.authorize(this,A)}impliedauth(A,E){A=A||this.remote.storageApi,E=E||String(document.location),(0,_.default)("ImpliedAuth proceeding due to absent authURL; storageApi = "+A+" redirectUri = "+E),this.remote.configure({token:k.default.IMPLIED_FAKE_TOKEN}),document.location.href=E}connect(A,E){if(this.setBackend("remotestorage"),A.indexOf("@")<0&&!A.match(/^(https?:\/\/)?[^\s\/$\.?#]+\.[^\s]*$/))return void this._emit("error",new z.DiscoveryError("Not a valid user address or URL."));if(A.indexOf("@")<0&&!A.match(/^https?:\/\//)&&(A="https://"+A),y.cordova){if(typeof x.default.cordovaRedirectUri!="string")return void this._emit("error",new z.DiscoveryError("Please supply a custom HTTPS redirect URI for your Cordova app"));if(!y.cordova.InAppBrowser)return void this._emit("error",new z.DiscoveryError("Please include the InAppBrowser Cordova plugin to enable OAuth"))}this.remote.configure({userAddress:A}),this._emit("connecting");const n=setTimeout(()=>{this._emit("error",new z.DiscoveryError("No storage information found for this user address."))},x.default.discoveryTimeout);(0,T.default)(A).then(o=>{if(clearTimeout(n),this._emit("authing"),o.userAddress=A,this.remote.configure(o),!this.remote.connected)if(o.authURL)if(E===void 0)this.authorize({authURL:o.authURL});else{if(typeof E!="string")throw new Error("Supplied bearer token must be a string");(0,_.default)("Skipping authorization sequence and connecting with known token"),this.remote.configure({token:E})}else this.impliedauth()},()=>{clearTimeout(n),this._emit("error",new z.DiscoveryError("No storage information found for this user address."))})}reconnect(){this.remote.configure({token:null}),this.backend==="remotestorage"?this.connect(this.remote.userAddress):this.remote.connect()}disconnect(){this.remote&&this.remote.configure({userAddress:null,href:null,storageApi:null,token:null,properties:null}),this._setGPD({get:this._pendingGPD("get"),put:this._pendingGPD("put"),delete:this._pendingGPD("delete")});const A=this._cleanups.length;let E=0;const n=()=>{E++,E>=A&&(this._init(),this._emit("disconnected"))};A>0?this._cleanups.forEach(o=>{const b=o(this);typeof b=="object"&&typeof b.then=="function"?b.then(n):n()}):n()}setBackend(A){this.backend=A,L&&(A?localStorage.setItem("remotestorage:backend",A):localStorage.removeItem("remotestorage:backend"))}onChange(A,E){this._pathHandlers.change[A]||(this._pathHandlers.change[A]=[]),this._pathHandlers.change[A].push(E)}enableLog(){x.default.logging=!0}disableLog(){x.default.logging=!1}log(...A){_.default.apply(z,A)}setApiKeys(A){const E=[J.GOOGLE,J.DROPBOX];if(typeof A!="object"||!Object.keys(A).every(n=>E.includes(n)))return console.error("setApiKeys() was called with invalid arguments"),!1;Object.keys(A).forEach(n=>{const o=A[n];if(o){switch(n){case J.DROPBOX:this.apiKeys[J.DROPBOX]={appKey:o},this.dropbox!==void 0&&this.dropbox.clientId===o||w.default._rs_init(this);break;case J.GOOGLE:this.apiKeys[J.GOOGLE]={clientId:o},this.googledrive!==void 0&&this.googledrive.clientId===o||l.default._rs_init(this)}return!0}delete this.apiKeys[n]}),L&&localStorage.setItem("remotestorage:api-keys",JSON.stringify(this.apiKeys))}setCordovaRedirectUri(A){if(typeof A!="string"||!A.match(/http(s)?:\/\//))throw new Error("Cordova redirect URI must be a URI string");x.default.cordovaRedirectUri=A}_setGPD(A,E){function n(o){return function(...b){return o.apply(E,b).then(j.bind(this))}}this.get=n(A.get),this.put=n(A.put),this.delete=n(A.delete)}_pendingGPD(A){return(...E)=>{const n=Array.prototype.slice.call(E);return new Promise((o,b)=>{this._pending.push({method:A,args:n,promise:{resolve:o,reject:b}})})}}_processPending(){this._pending.forEach(A=>{try{this[A.method](...A.args).then(A.promise.resolve,A.promise.reject)}catch(E){A.promise.reject(E)}}),this._pending=[]}_bindChange(A){A.on("change",this._dispatchEvent.bind(this,"change"))}_dispatchEvent(A,E){Object.keys(this._pathHandlers[A]).forEach(n=>{const o=n.length;E.path.substr(0,o)===n&&this._pathHandlers[A][n].forEach(b=>{const I={};for(const U in E)I[U]=E[U];I.relativePath=E.path.replace(new RegExp("^"+n),"");try{b(I)}catch(U){console.error("'change' handler failed: ",U,U.stack),this._emit("error",U)}})})}scope(A){if(typeof A!="string")throw"Argument 'path' of baseClient.scope must be a string";return this.access.checkPathPermission(A,"r")||console.warn("WARNING: Please use remoteStorage.access.claim() to ask for access permissions first: https://remotestoragejs.readthedocs.io/en/latest/js-api/access.html#claim"),new R.default(this,A)}getSyncInterval(){return x.default.syncInterval}setSyncInterval(A){if(!B(A))throw A+" is not a valid sync interval";const E=x.default.syncInterval;x.default.syncInterval=A,this._emit("sync-interval-change",{oldValue:E,newValue:A})}getBackgroundSyncInterval(){return x.default.backgroundSyncInterval}setBackgroundSyncInterval(A){if(!B(A))throw A+" is not a valid sync interval";const E=x.default.backgroundSyncInterval;x.default.backgroundSyncInterval=A,this._emit("sync-interval-change",{oldValue:E,newValue:A})}getCurrentSyncInterval(){return x.default.isBackground?x.default.backgroundSyncInterval:x.default.syncInterval}getRequestTimeout(){return x.default.requestTimeout}setRequestTimeout(A){if(typeof A!="number")throw A+" is not a valid request timeout";x.default.requestTimeout=A}syncCycle(){this.sync&&!this.sync.stopped&&(this.on("sync-done",()=>{this.sync&&!this.sync.stopped&&(this._syncTimer&&(clearTimeout(this._syncTimer),this._syncTimer=void 0),this._syncTimer=setTimeout(this.sync.sync.bind(this.sync),this.getCurrentSyncInterval()))}),this.sync.sync())}startSync(){return x.default.cache?(this.sync.stopped=!1,this.syncStopped=!1,this.sync.sync()):(console.warn("Nothing to sync, because caching is disabled."),Promise.resolve())}stopSync(){clearTimeout(this._syncTimer),this._syncTimer=void 0,this.sync?this.sync.stopped=!0:this.syncStopped=!0}addModule(A){const E=A.name,n=A.builder;if(Object.defineProperty(this,E,{configurable:!0,get:function(){const o=this._loadModule(E,n);return Object.defineProperty(this,E,{value:o}),o}}),E.indexOf("-")!==-1){const o=E.replace(/\-[a-z]/g,function(b){return b[1].toUpperCase()});Object.defineProperty(this,o,{get:function(){return this[E]}})}}_loadModule(A,E){if(E)return E(new R.default(this,"/"+A+"/"),new R.default(this,"/public/"+A+"/")).exports;throw"Unknown module: "+A}}var J;z.Authorize=k.default,z.SyncError=N.default,z.Unauthorized=S.default,z.DiscoveryError=T.default.DiscoveryError,z.util=g,Object.defineProperty(z.prototype,"access",{get:function(){const C=new O.default;return Object.defineProperty(this,"access",{value:C}),C},configurable:!0}),Object.defineProperty(z.prototype,"caching",{configurable:!0,get:function(){const C=new h.default;return Object.defineProperty(this,"caching",{value:C}),C}}),(0,c.applyMixins)(z,[p.default]),function(C){C.GOOGLE="googledrive",C.DROPBOX="dropbox"}(J||(J={})),a.exports=z},function(a,i,f){(function(u){/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */var v=f(21),M=f(22),m=f(23);function x(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function _(r,s){if(x()<s)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(r=new Uint8Array(s)).__proto__=c.prototype:(r===null&&(r=new c(s)),r.length=s),r}function c(r,s,d){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(r,s,d);if(typeof r=="number"){if(typeof s=="string")throw new Error("If encoding is specified then the first argument must be a string");return R(this,r)}return O(this,r,s,d)}function O(r,s,d,F){if(typeof s=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&s instanceof ArrayBuffer?function(D,$,H,Z){if($.byteLength,H<0||$.byteLength<H)throw new RangeError("'offset' is out of bounds");if($.byteLength<H+(Z||0))throw new RangeError("'length' is out of bounds");return $=H===void 0&&Z===void 0?new Uint8Array($):Z===void 0?new Uint8Array($,H):new Uint8Array($,H,Z),c.TYPED_ARRAY_SUPPORT?(D=$).__proto__=c.prototype:D=h(D,$),D}(r,s,d,F):typeof s=="string"?function(D,$,H){if(typeof H=="string"&&H!==""||(H="utf8"),!c.isEncoding(H))throw new TypeError('"encoding" must be a valid string encoding');var Z=0|l($,H),it=(D=_(D,Z)).write($,H);return it!==Z&&(D=D.slice(0,it)),D}(r,s,d):function(D,$){if(c.isBuffer($)){var H=0|p($.length);return(D=_(D,H)).length===0||$.copy(D,0,0,H),D}if($){if(typeof ArrayBuffer<"u"&&$.buffer instanceof ArrayBuffer||"length"in $)return typeof $.length!="number"||(Z=$.length)!=Z?_(D,0):h(D,$);if($.type==="Buffer"&&m($.data))return h(D,$.data)}var Z;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(r,s)}function k(r){if(typeof r!="number")throw new TypeError('"size" argument must be a number');if(r<0)throw new RangeError('"size" argument must not be negative')}function R(r,s){if(k(s),r=_(r,s<0?0:0|p(s)),!c.TYPED_ARRAY_SUPPORT)for(var d=0;d<s;++d)r[d]=0;return r}function h(r,s){var d=s.length<0?0:0|p(s.length);r=_(r,d);for(var F=0;F<d;F+=1)r[F]=255&s[F];return r}function p(r){if(r>=x())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+x().toString(16)+" bytes");return 0|r}function l(r,s){if(c.isBuffer(r))return r.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(r)||r instanceof ArrayBuffer))return r.byteLength;typeof r!="string"&&(r=""+r);var d=r.length;if(d===0)return 0;for(var F=!1;;)switch(s){case"ascii":case"latin1":case"binary":return d;case"utf8":case"utf-8":case void 0:return at(r).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*d;case"hex":return d>>>1;case"base64":return ot(r).length;default:if(F)return at(r).length;s=(""+s).toLowerCase(),F=!0}}function w(r,s,d){var F=!1;if((s===void 0||s<0)&&(s=0),s>this.length||((d===void 0||d>this.length)&&(d=this.length),d<=0)||(d>>>=0)<=(s>>>=0))return"";for(r||(r="utf8");;)switch(r){case"hex":return E(this,s,d);case"utf8":case"utf-8":return J(this,s,d);case"ascii":return C(this,s,d);case"latin1":case"binary":return A(this,s,d);case"base64":return z(this,s,d);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return n(this,s,d);default:if(F)throw new TypeError("Unknown encoding: "+r);r=(r+"").toLowerCase(),F=!0}}function T(r,s,d){var F=r[s];r[s]=r[d],r[d]=F}function N(r,s,d,F,D){if(r.length===0)return-1;if(typeof d=="string"?(F=d,d=0):d>2147483647?d=2147483647:d<-2147483648&&(d=-2147483648),d=+d,isNaN(d)&&(d=D?0:r.length-1),d<0&&(d=r.length+d),d>=r.length){if(D)return-1;d=r.length-1}else if(d<0){if(!D)return-1;d=0}if(typeof s=="string"&&(s=c.from(s,F)),c.isBuffer(s))return s.length===0?-1:S(r,s,d,F,D);if(typeof s=="number")return s&=255,c.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?D?Uint8Array.prototype.indexOf.call(r,s,d):Uint8Array.prototype.lastIndexOf.call(r,s,d):S(r,[s],d,F,D);throw new TypeError("val must be string, number or Buffer")}function S(r,s,d,F,D){var $,H=1,Z=r.length,it=s.length;if(F!==void 0&&((F=String(F).toLowerCase())==="ucs2"||F==="ucs-2"||F==="utf16le"||F==="utf-16le")){if(r.length<2||s.length<2)return-1;H=2,Z/=2,it/=2,d/=2}function nt(Tt,Dt){return H===1?Tt[Dt]:Tt.readUInt16BE(Dt*H)}if(D){var W=-1;for($=d;$<Z;$++)if(nt(r,$)===nt(s,W===-1?0:$-W)){if(W===-1&&(W=$),$-W+1===it)return W*H}else W!==-1&&($-=$-W),W=-1}else for(d+it>Z&&(d=Z-it),$=d;$>=0;$--){for(var mt=!0,bt=0;bt<it;bt++)if(nt(r,$+bt)!==nt(s,bt)){mt=!1;break}if(mt)return $}return-1}function e(r,s,d,F){d=Number(d)||0;var D=r.length-d;F?(F=Number(F))>D&&(F=D):F=D;var $=s.length;if($%2!=0)throw new TypeError("Invalid hex string");F>$/2&&(F=$/2);for(var H=0;H<F;++H){var Z=parseInt(s.substr(2*H,2),16);if(isNaN(Z))return H;r[d+H]=Z}return H}function g(r,s,d,F){return Q(at(s,r.length-d),r,d,F)}function y(r,s,d,F){return Q(function(D){for(var $=[],H=0;H<D.length;++H)$.push(255&D.charCodeAt(H));return $}(s),r,d,F)}function L(r,s,d,F){return y(r,s,d,F)}function j(r,s,d,F){return Q(ot(s),r,d,F)}function B(r,s,d,F){return Q(function(D,$){for(var H,Z,it,nt=[],W=0;W<D.length&&!(($-=2)<0);++W)H=D.charCodeAt(W),Z=H>>8,it=H%256,nt.push(it),nt.push(Z);return nt}(s,r.length-d),r,d,F)}function z(r,s,d){return s===0&&d===r.length?v.fromByteArray(r):v.fromByteArray(r.slice(s,d))}function J(r,s,d){d=Math.min(r.length,d);for(var F=[],D=s;D<d;){var $,H,Z,it,nt=r[D],W=null,mt=nt>239?4:nt>223?3:nt>191?2:1;if(D+mt<=d)switch(mt){case 1:nt<128&&(W=nt);break;case 2:(192&($=r[D+1]))==128&&(it=(31&nt)<<6|63&$)>127&&(W=it);break;case 3:$=r[D+1],H=r[D+2],(192&$)==128&&(192&H)==128&&(it=(15&nt)<<12|(63&$)<<6|63&H)>2047&&(it<55296||it>57343)&&(W=it);break;case 4:$=r[D+1],H=r[D+2],Z=r[D+3],(192&$)==128&&(192&H)==128&&(192&Z)==128&&(it=(15&nt)<<18|(63&$)<<12|(63&H)<<6|63&Z)>65535&&it<1114112&&(W=it)}W===null?(W=65533,mt=1):W>65535&&(W-=65536,F.push(W>>>10&1023|55296),W=56320|1023&W),F.push(W),D+=mt}return function(bt){var Tt=bt.length;if(Tt<=4096)return String.fromCharCode.apply(String,bt);for(var Dt="",Xt=0;Xt<Tt;)Dt+=String.fromCharCode.apply(String,bt.slice(Xt,Xt+=4096));return Dt}(F)}i.Buffer=c,i.SlowBuffer=function(r){return+r!=r&&(r=0),c.alloc(+r)},i.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=u.TYPED_ARRAY_SUPPORT!==void 0?u.TYPED_ARRAY_SUPPORT:function(){try{var r=new Uint8Array(1);return r.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},r.foo()===42&&typeof r.subarray=="function"&&r.subarray(1,1).byteLength===0}catch{return!1}}(),i.kMaxLength=x(),c.poolSize=8192,c._augment=function(r){return r.__proto__=c.prototype,r},c.from=function(r,s,d){return O(null,r,s,d)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(r,s,d){return function(F,D,$,H){return k(D),D<=0?_(F,D):$!==void 0?typeof H=="string"?_(F,D).fill($,H):_(F,D).fill($):_(F,D)}(null,r,s,d)},c.allocUnsafe=function(r){return R(null,r)},c.allocUnsafeSlow=function(r){return R(null,r)},c.isBuffer=function(r){return!(r==null||!r._isBuffer)},c.compare=function(r,s){if(!c.isBuffer(r)||!c.isBuffer(s))throw new TypeError("Arguments must be Buffers");if(r===s)return 0;for(var d=r.length,F=s.length,D=0,$=Math.min(d,F);D<$;++D)if(r[D]!==s[D]){d=r[D],F=s[D];break}return d<F?-1:F<d?1:0},c.isEncoding=function(r){switch(String(r).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(r,s){if(!m(r))throw new TypeError('"list" argument must be an Array of Buffers');if(r.length===0)return c.alloc(0);var d;if(s===void 0)for(s=0,d=0;d<r.length;++d)s+=r[d].length;var F=c.allocUnsafe(s),D=0;for(d=0;d<r.length;++d){var $=r[d];if(!c.isBuffer($))throw new TypeError('"list" argument must be an Array of Buffers');$.copy(F,D),D+=$.length}return F},c.byteLength=l,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var r=this.length;if(r%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var s=0;s<r;s+=2)T(this,s,s+1);return this},c.prototype.swap32=function(){var r=this.length;if(r%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var s=0;s<r;s+=4)T(this,s,s+3),T(this,s+1,s+2);return this},c.prototype.swap64=function(){var r=this.length;if(r%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var s=0;s<r;s+=8)T(this,s,s+7),T(this,s+1,s+6),T(this,s+2,s+5),T(this,s+3,s+4);return this},c.prototype.toString=function(){var r=0|this.length;return r===0?"":arguments.length===0?J(this,0,r):w.apply(this,arguments)},c.prototype.equals=function(r){if(!c.isBuffer(r))throw new TypeError("Argument must be a Buffer");return this===r||c.compare(this,r)===0},c.prototype.inspect=function(){var r="",s=i.INSPECT_MAX_BYTES;return this.length>0&&(r=this.toString("hex",0,s).match(/.{2}/g).join(" "),this.length>s&&(r+=" ... ")),"<Buffer "+r+">"},c.prototype.compare=function(r,s,d,F,D){if(!c.isBuffer(r))throw new TypeError("Argument must be a Buffer");if(s===void 0&&(s=0),d===void 0&&(d=r?r.length:0),F===void 0&&(F=0),D===void 0&&(D=this.length),s<0||d>r.length||F<0||D>this.length)throw new RangeError("out of range index");if(F>=D&&s>=d)return 0;if(F>=D)return-1;if(s>=d)return 1;if(this===r)return 0;for(var $=(D>>>=0)-(F>>>=0),H=(d>>>=0)-(s>>>=0),Z=Math.min($,H),it=this.slice(F,D),nt=r.slice(s,d),W=0;W<Z;++W)if(it[W]!==nt[W]){$=it[W],H=nt[W];break}return $<H?-1:H<$?1:0},c.prototype.includes=function(r,s,d){return this.indexOf(r,s,d)!==-1},c.prototype.indexOf=function(r,s,d){return N(this,r,s,d,!0)},c.prototype.lastIndexOf=function(r,s,d){return N(this,r,s,d,!1)},c.prototype.write=function(r,s,d,F){if(s===void 0)F="utf8",d=this.length,s=0;else if(d===void 0&&typeof s=="string")F=s,d=this.length,s=0;else{if(!isFinite(s))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");s|=0,isFinite(d)?(d|=0,F===void 0&&(F="utf8")):(F=d,d=void 0)}var D=this.length-s;if((d===void 0||d>D)&&(d=D),r.length>0&&(d<0||s<0)||s>this.length)throw new RangeError("Attempt to write outside buffer bounds");F||(F="utf8");for(var $=!1;;)switch(F){case"hex":return e(this,r,s,d);case"utf8":case"utf-8":return g(this,r,s,d);case"ascii":return y(this,r,s,d);case"latin1":case"binary":return L(this,r,s,d);case"base64":return j(this,r,s,d);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return B(this,r,s,d);default:if($)throw new TypeError("Unknown encoding: "+F);F=(""+F).toLowerCase(),$=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function C(r,s,d){var F="";d=Math.min(r.length,d);for(var D=s;D<d;++D)F+=String.fromCharCode(127&r[D]);return F}function A(r,s,d){var F="";d=Math.min(r.length,d);for(var D=s;D<d;++D)F+=String.fromCharCode(r[D]);return F}function E(r,s,d){var F=r.length;(!s||s<0)&&(s=0),(!d||d<0||d>F)&&(d=F);for(var D="",$=s;$<d;++$)D+=tt(r[$]);return D}function n(r,s,d){for(var F=r.slice(s,d),D="",$=0;$<F.length;$+=2)D+=String.fromCharCode(F[$]+256*F[$+1]);return D}function o(r,s,d){if(r%1!=0||r<0)throw new RangeError("offset is not uint");if(r+s>d)throw new RangeError("Trying to access beyond buffer length")}function b(r,s,d,F,D,$){if(!c.isBuffer(r))throw new TypeError('"buffer" argument must be a Buffer instance');if(s>D||s<$)throw new RangeError('"value" argument is out of bounds');if(d+F>r.length)throw new RangeError("Index out of range")}function I(r,s,d,F){s<0&&(s=65535+s+1);for(var D=0,$=Math.min(r.length-d,2);D<$;++D)r[d+D]=(s&255<<8*(F?D:1-D))>>>8*(F?D:1-D)}function U(r,s,d,F){s<0&&(s=4294967295+s+1);for(var D=0,$=Math.min(r.length-d,4);D<$;++D)r[d+D]=s>>>8*(F?D:3-D)&255}function V(r,s,d,F,D,$){if(d+F>r.length)throw new RangeError("Index out of range");if(d<0)throw new RangeError("Index out of range")}function q(r,s,d,F,D){return D||V(r,0,d,4),M.write(r,s,d,F,23,4),d+4}function G(r,s,d,F,D){return D||V(r,0,d,8),M.write(r,s,d,F,52,8),d+8}c.prototype.slice=function(r,s){var d,F=this.length;if((r=~~r)<0?(r+=F)<0&&(r=0):r>F&&(r=F),(s=s===void 0?F:~~s)<0?(s+=F)<0&&(s=0):s>F&&(s=F),s<r&&(s=r),c.TYPED_ARRAY_SUPPORT)(d=this.subarray(r,s)).__proto__=c.prototype;else{var D=s-r;d=new c(D,void 0);for(var $=0;$<D;++$)d[$]=this[$+r]}return d},c.prototype.readUIntLE=function(r,s,d){r|=0,s|=0,d||o(r,s,this.length);for(var F=this[r],D=1,$=0;++$<s&&(D*=256);)F+=this[r+$]*D;return F},c.prototype.readUIntBE=function(r,s,d){r|=0,s|=0,d||o(r,s,this.length);for(var F=this[r+--s],D=1;s>0&&(D*=256);)F+=this[r+--s]*D;return F},c.prototype.readUInt8=function(r,s){return s||o(r,1,this.length),this[r]},c.prototype.readUInt16LE=function(r,s){return s||o(r,2,this.length),this[r]|this[r+1]<<8},c.prototype.readUInt16BE=function(r,s){return s||o(r,2,this.length),this[r]<<8|this[r+1]},c.prototype.readUInt32LE=function(r,s){return s||o(r,4,this.length),(this[r]|this[r+1]<<8|this[r+2]<<16)+16777216*this[r+3]},c.prototype.readUInt32BE=function(r,s){return s||o(r,4,this.length),16777216*this[r]+(this[r+1]<<16|this[r+2]<<8|this[r+3])},c.prototype.readIntLE=function(r,s,d){r|=0,s|=0,d||o(r,s,this.length);for(var F=this[r],D=1,$=0;++$<s&&(D*=256);)F+=this[r+$]*D;return F>=(D*=128)&&(F-=Math.pow(2,8*s)),F},c.prototype.readIntBE=function(r,s,d){r|=0,s|=0,d||o(r,s,this.length);for(var F=s,D=1,$=this[r+--F];F>0&&(D*=256);)$+=this[r+--F]*D;return $>=(D*=128)&&($-=Math.pow(2,8*s)),$},c.prototype.readInt8=function(r,s){return s||o(r,1,this.length),128&this[r]?-1*(255-this[r]+1):this[r]},c.prototype.readInt16LE=function(r,s){s||o(r,2,this.length);var d=this[r]|this[r+1]<<8;return 32768&d?4294901760|d:d},c.prototype.readInt16BE=function(r,s){s||o(r,2,this.length);var d=this[r+1]|this[r]<<8;return 32768&d?4294901760|d:d},c.prototype.readInt32LE=function(r,s){return s||o(r,4,this.length),this[r]|this[r+1]<<8|this[r+2]<<16|this[r+3]<<24},c.prototype.readInt32BE=function(r,s){return s||o(r,4,this.length),this[r]<<24|this[r+1]<<16|this[r+2]<<8|this[r+3]},c.prototype.readFloatLE=function(r,s){return s||o(r,4,this.length),M.read(this,r,!0,23,4)},c.prototype.readFloatBE=function(r,s){return s||o(r,4,this.length),M.read(this,r,!1,23,4)},c.prototype.readDoubleLE=function(r,s){return s||o(r,8,this.length),M.read(this,r,!0,52,8)},c.prototype.readDoubleBE=function(r,s){return s||o(r,8,this.length),M.read(this,r,!1,52,8)},c.prototype.writeUIntLE=function(r,s,d,F){r=+r,s|=0,d|=0,F||b(this,r,s,d,Math.pow(2,8*d)-1,0);var D=1,$=0;for(this[s]=255&r;++$<d&&(D*=256);)this[s+$]=r/D&255;return s+d},c.prototype.writeUIntBE=function(r,s,d,F){r=+r,s|=0,d|=0,F||b(this,r,s,d,Math.pow(2,8*d)-1,0);var D=d-1,$=1;for(this[s+D]=255&r;--D>=0&&($*=256);)this[s+D]=r/$&255;return s+d},c.prototype.writeUInt8=function(r,s,d){return r=+r,s|=0,d||b(this,r,s,1,255,0),c.TYPED_ARRAY_SUPPORT||(r=Math.floor(r)),this[s]=255&r,s+1},c.prototype.writeUInt16LE=function(r,s,d){return r=+r,s|=0,d||b(this,r,s,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[s]=255&r,this[s+1]=r>>>8):I(this,r,s,!0),s+2},c.prototype.writeUInt16BE=function(r,s,d){return r=+r,s|=0,d||b(this,r,s,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[s]=r>>>8,this[s+1]=255&r):I(this,r,s,!1),s+2},c.prototype.writeUInt32LE=function(r,s,d){return r=+r,s|=0,d||b(this,r,s,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[s+3]=r>>>24,this[s+2]=r>>>16,this[s+1]=r>>>8,this[s]=255&r):U(this,r,s,!0),s+4},c.prototype.writeUInt32BE=function(r,s,d){return r=+r,s|=0,d||b(this,r,s,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[s]=r>>>24,this[s+1]=r>>>16,this[s+2]=r>>>8,this[s+3]=255&r):U(this,r,s,!1),s+4},c.prototype.writeIntLE=function(r,s,d,F){if(r=+r,s|=0,!F){var D=Math.pow(2,8*d-1);b(this,r,s,d,D-1,-D)}var $=0,H=1,Z=0;for(this[s]=255&r;++$<d&&(H*=256);)r<0&&Z===0&&this[s+$-1]!==0&&(Z=1),this[s+$]=(r/H>>0)-Z&255;return s+d},c.prototype.writeIntBE=function(r,s,d,F){if(r=+r,s|=0,!F){var D=Math.pow(2,8*d-1);b(this,r,s,d,D-1,-D)}var $=d-1,H=1,Z=0;for(this[s+$]=255&r;--$>=0&&(H*=256);)r<0&&Z===0&&this[s+$+1]!==0&&(Z=1),this[s+$]=(r/H>>0)-Z&255;return s+d},c.prototype.writeInt8=function(r,s,d){return r=+r,s|=0,d||b(this,r,s,1,127,-128),c.TYPED_ARRAY_SUPPORT||(r=Math.floor(r)),r<0&&(r=255+r+1),this[s]=255&r,s+1},c.prototype.writeInt16LE=function(r,s,d){return r=+r,s|=0,d||b(this,r,s,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[s]=255&r,this[s+1]=r>>>8):I(this,r,s,!0),s+2},c.prototype.writeInt16BE=function(r,s,d){return r=+r,s|=0,d||b(this,r,s,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[s]=r>>>8,this[s+1]=255&r):I(this,r,s,!1),s+2},c.prototype.writeInt32LE=function(r,s,d){return r=+r,s|=0,d||b(this,r,s,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[s]=255&r,this[s+1]=r>>>8,this[s+2]=r>>>16,this[s+3]=r>>>24):U(this,r,s,!0),s+4},c.prototype.writeInt32BE=function(r,s,d){return r=+r,s|=0,d||b(this,r,s,4,2147483647,-2147483648),r<0&&(r=4294967295+r+1),c.TYPED_ARRAY_SUPPORT?(this[s]=r>>>24,this[s+1]=r>>>16,this[s+2]=r>>>8,this[s+3]=255&r):U(this,r,s,!1),s+4},c.prototype.writeFloatLE=function(r,s,d){return q(this,r,s,!0,d)},c.prototype.writeFloatBE=function(r,s,d){return q(this,r,s,!1,d)},c.prototype.writeDoubleLE=function(r,s,d){return G(this,r,s,!0,d)},c.prototype.writeDoubleBE=function(r,s,d){return G(this,r,s,!1,d)},c.prototype.copy=function(r,s,d,F){if(d||(d=0),F||F===0||(F=this.length),s>=r.length&&(s=r.length),s||(s=0),F>0&&F<d&&(F=d),F===d||r.length===0||this.length===0)return 0;if(s<0)throw new RangeError("targetStart out of bounds");if(d<0||d>=this.length)throw new RangeError("sourceStart out of bounds");if(F<0)throw new RangeError("sourceEnd out of bounds");F>this.length&&(F=this.length),r.length-s<F-d&&(F=r.length-s+d);var D,$=F-d;if(this===r&&d<s&&s<F)for(D=$-1;D>=0;--D)r[D+s]=this[D+d];else if($<1e3||!c.TYPED_ARRAY_SUPPORT)for(D=0;D<$;++D)r[D+s]=this[D+d];else Uint8Array.prototype.set.call(r,this.subarray(d,d+$),s);return $},c.prototype.fill=function(r,s,d,F){if(typeof r=="string"){if(typeof s=="string"?(F=s,s=0,d=this.length):typeof d=="string"&&(F=d,d=this.length),r.length===1){var D=r.charCodeAt(0);D<256&&(r=D)}if(F!==void 0&&typeof F!="string")throw new TypeError("encoding must be a string");if(typeof F=="string"&&!c.isEncoding(F))throw new TypeError("Unknown encoding: "+F)}else typeof r=="number"&&(r&=255);if(s<0||this.length<s||this.length<d)throw new RangeError("Out of range index");if(d<=s)return this;var $;if(s>>>=0,d=d===void 0?this.length:d>>>0,r||(r=0),typeof r=="number")for($=s;$<d;++$)this[$]=r;else{var H=c.isBuffer(r)?r:at(new c(r,F).toString()),Z=H.length;for($=0;$<d-s;++$)this[$+s]=H[$%Z]}return this};var Y=/[^+\/0-9A-Za-z-_]/g;function tt(r){return r<16?"0"+r.toString(16):r.toString(16)}function at(r,s){var d;s=s||1/0;for(var F=r.length,D=null,$=[],H=0;H<F;++H){if((d=r.charCodeAt(H))>55295&&d<57344){if(!D){if(d>56319){(s-=3)>-1&&$.push(239,191,189);continue}if(H+1===F){(s-=3)>-1&&$.push(239,191,189);continue}D=d;continue}if(d<56320){(s-=3)>-1&&$.push(239,191,189),D=d;continue}d=65536+(D-55296<<10|d-56320)}else D&&(s-=3)>-1&&$.push(239,191,189);if(D=null,d<128){if((s-=1)<0)break;$.push(d)}else if(d<2048){if((s-=2)<0)break;$.push(d>>6|192,63&d|128)}else if(d<65536){if((s-=3)<0)break;$.push(d>>12|224,d>>6&63|128,63&d|128)}else{if(!(d<1114112))throw new Error("Invalid code point");if((s-=4)<0)break;$.push(d>>18|240,d>>12&63|128,d>>6&63|128,63&d|128)}}return $}function ot(r){return v.toByteArray(function(s){if((s=function(d){return d.trim?d.trim():d.replace(/^\s+|\s+$/g,"")}(s).replace(Y,"")).length<2)return"";for(;s.length%4!=0;)s+="=";return s}(r))}function Q(r,s,d,F){for(var D=0;D<F&&!(D+d>=s.length||D>=r.length);++D)s[D+d]=r[D];return D}}).call(this,f(6))},function(a,i,f){i.byteLength=function(k){var R=c(k),h=R[0],p=R[1];return 3*(h+p)/4-p},i.toByteArray=function(k){var R,h,p=c(k),l=p[0],w=p[1],T=new M(function(e,g,y){return 3*(g+y)/4-y}(0,l,w)),N=0,S=w>0?l-4:l;for(h=0;h<S;h+=4)R=v[k.charCodeAt(h)]<<18|v[k.charCodeAt(h+1)]<<12|v[k.charCodeAt(h+2)]<<6|v[k.charCodeAt(h+3)],T[N++]=R>>16&255,T[N++]=R>>8&255,T[N++]=255&R;return w===2&&(R=v[k.charCodeAt(h)]<<2|v[k.charCodeAt(h+1)]>>4,T[N++]=255&R),w===1&&(R=v[k.charCodeAt(h)]<<10|v[k.charCodeAt(h+1)]<<4|v[k.charCodeAt(h+2)]>>2,T[N++]=R>>8&255,T[N++]=255&R),T},i.fromByteArray=function(k){for(var R,h=k.length,p=h%3,l=[],w=0,T=h-p;w<T;w+=16383)l.push(O(k,w,w+16383>T?T:w+16383));return p===1?(R=k[h-1],l.push(u[R>>2]+u[R<<4&63]+"==")):p===2&&(R=(k[h-2]<<8)+k[h-1],l.push(u[R>>10]+u[R>>4&63]+u[R<<2&63]+"=")),l.join("")};for(var u=[],v=[],M=typeof Uint8Array<"u"?Uint8Array:Array,m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",x=0,_=m.length;x<_;++x)u[x]=m[x],v[m.charCodeAt(x)]=x;function c(k){var R=k.length;if(R%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var h=k.indexOf("=");return h===-1&&(h=R),[h,h===R?0:4-h%4]}function O(k,R,h){for(var p,l,w=[],T=R;T<h;T+=3)p=(k[T]<<16&16711680)+(k[T+1]<<8&65280)+(255&k[T+2]),w.push(u[(l=p)>>18&63]+u[l>>12&63]+u[l>>6&63]+u[63&l]);return w.join("")}v["-".charCodeAt(0)]=62,v["_".charCodeAt(0)]=63},function(a,i){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */i.read=function(f,u,v,M,m){var x,_,c=8*m-M-1,O=(1<<c)-1,k=O>>1,R=-7,h=v?m-1:0,p=v?-1:1,l=f[u+h];for(h+=p,x=l&(1<<-R)-1,l>>=-R,R+=c;R>0;x=256*x+f[u+h],h+=p,R-=8);for(_=x&(1<<-R)-1,x>>=-R,R+=M;R>0;_=256*_+f[u+h],h+=p,R-=8);if(x===0)x=1-k;else{if(x===O)return _?NaN:1/0*(l?-1:1);_+=Math.pow(2,M),x-=k}return(l?-1:1)*_*Math.pow(2,x-M)},i.write=function(f,u,v,M,m,x){var _,c,O,k=8*x-m-1,R=(1<<k)-1,h=R>>1,p=m===23?Math.pow(2,-24)-Math.pow(2,-77):0,l=M?0:x-1,w=M?1:-1,T=u<0||u===0&&1/u<0?1:0;for(u=Math.abs(u),isNaN(u)||u===1/0?(c=isNaN(u)?1:0,_=R):(_=Math.floor(Math.log(u)/Math.LN2),u*(O=Math.pow(2,-_))<1&&(_--,O*=2),(u+=_+h>=1?p/O:p*Math.pow(2,1-h))*O>=2&&(_++,O/=2),_+h>=R?(c=0,_=R):_+h>=1?(c=(u*O-1)*Math.pow(2,m),_+=h):(c=u*Math.pow(2,h-1)*Math.pow(2,m),_=0));m>=8;f[v+l]=255&c,l+=w,c/=256,m-=8);for(_=_<<m|c,k+=m;k>0;f[v+l]=255&_,l+=w,_/=256,k-=8);f[v+l-w]|=128*T}},function(a,i){var f={}.toString;a.exports=Array.isArray||function(u){return f.call(u)=="[object Array]"}},function(a,i,f){var u,v,M;v=[],(M=typeof(u=function(){var m,x,_,c;Object.keys||(Object.keys=(m=Object.prototype.hasOwnProperty,x=!{toString:null}.propertyIsEnumerable("toString"),c=(_=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(n){if(typeof n!="object"&&typeof n!="function"||n===null)throw new TypeError("Object.keys called on non-object");var o=[];for(var b in n)m.call(n,b)&&o.push(b);if(x)for(var I=0;I<c;I++)m.call(n,_[I])&&o.push(_[I]);return o})),Object.create||(Object.create=function(){function n(){}return function(o){if(arguments.length!==1)throw new Error("Object.create implementation only accepts one parameter.");return n.prototype=o,new n}}()),Array.isArray||(Array.isArray=function(n){return Object.prototype.toString.call(n)==="[object Array]"}),Array.prototype.indexOf||(Array.prototype.indexOf=function(n){if(this===null)throw new TypeError;var o=Object(this),b=o.length>>>0;if(b===0)return-1;var I=0;if(arguments.length>1&&((I=Number(arguments[1]))!=I?I=0:I!==0&&I!==1/0&&I!==-1/0&&(I=(I>0||-1)*Math.floor(Math.abs(I)))),I>=b)return-1;for(var U=I>=0?I:Math.max(b-Math.abs(I),0);U<b;U++)if(U in o&&o[U]===n)return U;return-1}),Object.isFrozen||(Object.isFrozen=function(n){for(var o="tv4_test_frozen_key";n.hasOwnProperty(o);)o+=Math.random();try{return n[o]=!0,delete n[o],!1}catch{return!0}});var O={"+":!0,"#":!0,".":!0,"/":!0,";":!0,"?":!0,"&":!0},k={"*":!0};function R(n){return encodeURI(n).replace(/%25[0-9][0-9]/g,function(o){return"%"+o.substring(3)})}function h(n){var o="";O[n.charAt(0)]&&(o=n.charAt(0),n=n.substring(1));var b="",I="",U=!0,V=!1,q=!1;o==="+"?U=!1:o==="."?(I=".",b="."):o==="/"?(I="/",b="/"):o==="#"?(I="#",U=!1):o===";"?(I=";",b=";",V=!0,q=!0):o==="?"?(I="?",b="&",V=!0):o==="&"&&(I="&",b="&",V=!0);for(var G=[],Y=n.split(","),tt=[],at={},ot=0;ot<Y.length;ot++){var Q=Y[ot],r=null;if(Q.indexOf(":")!==-1){var s=Q.split(":");Q=s[0],r=parseInt(s[1],10)}for(var d={};k[Q.charAt(Q.length-1)];)d[Q.charAt(Q.length-1)]=!0,Q=Q.substring(0,Q.length-1);var F={truncate:r,name:Q,suffices:d};tt.push(F),at[Q]=F,G.push(Q)}var D=function($){for(var H="",Z=0,it=0;it<tt.length;it++){var nt=tt[it],W=$(nt.name);if(W==null||Array.isArray(W)&&W.length===0||typeof W=="object"&&Object.keys(W).length===0)Z++;else if(H+=it===Z?I:b||",",Array.isArray(W)){V&&(H+=nt.name+"=");for(var mt=0;mt<W.length;mt++)mt>0&&(H+=nt.suffices["*"]&&b||",",nt.suffices["*"]&&V&&(H+=nt.name+"=")),H+=U?encodeURIComponent(W[mt]).replace(/!/g,"%21"):R(W[mt])}else if(typeof W=="object"){V&&!nt.suffices["*"]&&(H+=nt.name+"=");var bt=!0;for(var Tt in W)bt||(H+=nt.suffices["*"]&&b||","),bt=!1,H+=U?encodeURIComponent(Tt).replace(/!/g,"%21"):R(Tt),H+=nt.suffices["*"]?"=":",",H+=U?encodeURIComponent(W[Tt]).replace(/!/g,"%21"):R(W[Tt])}else V&&(H+=nt.name,q&&W===""||(H+="=")),nt.truncate!=null&&(W=W.substring(0,nt.truncate)),H+=U?encodeURIComponent(W).replace(/!/g,"%21"):R(W)}return H};return D.varNames=G,{prefix:I,substitution:D}}function p(n){if(!(this instanceof p))return new p(n);for(var o=n.split("{"),b=[o.shift()],I=[],U=[],V=[];o.length>0;){var q=o.shift(),G=q.split("}")[0],Y=q.substring(G.length+1),tt=h(G);U.push(tt.substitution),I.push(tt.prefix),b.push(Y),V=V.concat(tt.substitution.varNames)}this.fill=function(at){for(var ot=b[0],Q=0;Q<U.length;Q++)ot+=(0,U[Q])(at),ot+=b[Q+1];return ot},this.varNames=V,this.template=n}p.prototype={toString:function(){return this.template},fillFromObject:function(n){return this.fill(function(o){return n[o]})}};var l=function(n,o,b,I,U){if(this.missing=[],this.missingMap={},this.formatValidators=n?Object.create(n.formatValidators):{},this.schemas=n?Object.create(n.schemas):{},this.collectMultiple=o,this.errors=[],this.handleError=o?this.collectError:this.returnError,I&&(this.checkRecursive=!0,this.scanned=[],this.scannedFrozen=[],this.scannedFrozenSchemas=[],this.scannedFrozenValidationErrors=[],this.validatedSchemasKey="tv4_validation_id",this.validationErrorsKey="tv4_validation_errors_id"),U&&(this.trackUnknownProperties=!0,this.knownPropertyPaths={},this.unknownPropertyPaths={}),this.errorReporter=b||L("en"),typeof this.errorReporter=="string")throw new Error("debug");if(this.definedKeywords={},n)for(var V in n.definedKeywords)this.definedKeywords[V]=n.definedKeywords[V].slice(0)};function w(n,o){if(n===o)return!0;if(n&&o&&typeof n=="object"&&typeof o=="object"){if(Array.isArray(n)!==Array.isArray(o))return!1;if(Array.isArray(n)){if(n.length!==o.length)return!1;for(var b=0;b<n.length;b++)if(!w(n[b],o[b]))return!1}else{var I;for(I in n)if(o[I]===void 0&&n[I]!==void 0)return!1;for(I in o)if(n[I]===void 0&&o[I]!==void 0)return!1;for(I in n)if(!w(n[I],o[I]))return!1}return!0}return!1}l.prototype.defineKeyword=function(n,o){this.definedKeywords[n]=this.definedKeywords[n]||[],this.definedKeywords[n].push(o)},l.prototype.createError=function(n,o,b,I,U,V,q){var G=new C(n,o,b,I,U);return G.message=this.errorReporter(G,V,q),G},l.prototype.returnError=function(n){return n},l.prototype.collectError=function(n){return n&&this.errors.push(n),null},l.prototype.prefixErrors=function(n,o,b){for(var I=n;I<this.errors.length;I++)this.errors[I]=this.errors[I].prefixWith(o,b);return this},l.prototype.banUnknownProperties=function(n,o){for(var b in this.unknownPropertyPaths){var I=this.createError(j.UNKNOWN_PROPERTY,{path:b},b,"",null,n,o),U=this.handleError(I);if(U)return U}return null},l.prototype.addFormat=function(n,o){if(typeof n=="object"){for(var b in n)this.addFormat(b,n[b]);return this}this.formatValidators[n]=o},l.prototype.resolveRefs=function(n,o){if(n.$ref!==void 0){if((o=o||{})[n.$ref])return this.createError(j.CIRCULAR_REFERENCE,{urls:Object.keys(o).join(", ")},"","",null,void 0,n);o[n.$ref]=!0,n=this.getSchema(n.$ref,o)}return n},l.prototype.getSchema=function(n,o){var b;if(this.schemas[n]!==void 0)return b=this.schemas[n],this.resolveRefs(b,o);var I=n,U="";if(n.indexOf("#")!==-1&&(U=n.substring(n.indexOf("#")+1),I=n.substring(0,n.indexOf("#"))),typeof this.schemas[I]=="object"){b=this.schemas[I];var V=decodeURIComponent(U);if(V==="")return this.resolveRefs(b,o);if(V.charAt(0)!=="/")return;for(var q=V.split("/").slice(1),G=0;G<q.length;G++){var Y=q[G].replace(/~1/g,"/").replace(/~0/g,"~");if(b[Y]===void 0){b=void 0;break}b=b[Y]}if(b!==void 0)return this.resolveRefs(b,o)}this.missing[I]===void 0&&(this.missing.push(I),this.missing[I]=I,this.missingMap[I]=I)},l.prototype.searchSchemas=function(n,o){if(Array.isArray(n))for(var b=0;b<n.length;b++)this.searchSchemas(n[b],o);else if(n&&typeof n=="object"){for(var I in typeof n.id=="string"&&function(V,q){if(q.substring(0,V.length)===V){var G=q.substring(V.length);if(q.length>0&&q.charAt(V.length-1)==="/"||G.charAt(0)==="#"||G.charAt(0)==="?")return!0}return!1}(o,n.id)&&this.schemas[n.id]===void 0&&(this.schemas[n.id]=n),n)if(I!=="enum"){if(typeof n[I]=="object")this.searchSchemas(n[I],o);else if(I==="$ref"){var U=g(n[I]);U&&this.schemas[U]===void 0&&this.missingMap[U]===void 0&&(this.missingMap[U]=U)}}}},l.prototype.addSchema=function(n,o){if(typeof n!="string"||o===void 0){if(typeof n!="object"||typeof n.id!="string")return;n=(o=n).id}n===g(n)+"#"&&(n=g(n)),this.schemas[n]=o,delete this.missingMap[n],y(o,n),this.searchSchemas(o,n)},l.prototype.getSchemaMap=function(){var n={};for(var o in this.schemas)n[o]=this.schemas[o];return n},l.prototype.getSchemaUris=function(n){var o=[];for(var b in this.schemas)n&&!n.test(b)||o.push(b);return o},l.prototype.getMissingUris=function(n){var o=[];for(var b in this.missingMap)n&&!n.test(b)||o.push(b);return o},l.prototype.dropSchemas=function(){this.schemas={},this.reset()},l.prototype.reset=function(){this.missing=[],this.missingMap={},this.errors=[]},l.prototype.validateAll=function(n,o,b,I,U){var V;if(!(o=this.resolveRefs(o)))return null;if(o instanceof C)return this.errors.push(o),o;var q,G=this.errors.length,Y=null,tt=null;if(this.checkRecursive&&n&&typeof n=="object"){if(V=!this.scanned.length,n[this.validatedSchemasKey]){var at=n[this.validatedSchemasKey].indexOf(o);if(at!==-1)return this.errors=this.errors.concat(n[this.validationErrorsKey][at]),null}if(Object.isFrozen(n)&&(q=this.scannedFrozen.indexOf(n))!==-1){var ot=this.scannedFrozenSchemas[q].indexOf(o);if(ot!==-1)return this.errors=this.errors.concat(this.scannedFrozenValidationErrors[q][ot]),null}if(this.scanned.push(n),Object.isFrozen(n))q===-1&&(q=this.scannedFrozen.length,this.scannedFrozen.push(n),this.scannedFrozenSchemas.push([])),Y=this.scannedFrozenSchemas[q].length,this.scannedFrozenSchemas[q][Y]=o,this.scannedFrozenValidationErrors[q][Y]=[];else{if(!n[this.validatedSchemasKey])try{Object.defineProperty(n,this.validatedSchemasKey,{value:[],configurable:!0}),Object.defineProperty(n,this.validationErrorsKey,{value:[],configurable:!0})}catch{n[this.validatedSchemasKey]=[],n[this.validationErrorsKey]=[]}tt=n[this.validatedSchemasKey].length,n[this.validatedSchemasKey][tt]=o,n[this.validationErrorsKey][tt]=[]}}var Q=this.errors.length,r=this.validateBasic(n,o,U)||this.validateNumeric(n,o,U)||this.validateString(n,o,U)||this.validateArray(n,o,U)||this.validateObject(n,o,U)||this.validateCombinations(n,o,U)||this.validateHypermedia(n,o,U)||this.validateFormat(n,o,U)||this.validateDefinedKeywords(n,o,U)||null;if(V){for(;this.scanned.length;)delete this.scanned.pop()[this.validatedSchemasKey];this.scannedFrozen=[],this.scannedFrozenSchemas=[]}if(r||Q!==this.errors.length)for(;b&&b.length||I&&I.length;){var s=b&&b.length?""+b.pop():null,d=I&&I.length?""+I.pop():null;r&&(r=r.prefixWith(s,d)),this.prefixErrors(Q,s,d)}return Y!==null?this.scannedFrozenValidationErrors[q][Y]=this.errors.slice(G):tt!==null&&(n[this.validationErrorsKey][tt]=this.errors.slice(G)),this.handleError(r)},l.prototype.validateFormat=function(n,o){if(typeof o.format!="string"||!this.formatValidators[o.format])return null;var b=this.formatValidators[o.format].call(null,n,o);return typeof b=="string"||typeof b=="number"?this.createError(j.FORMAT_CUSTOM,{message:b},"","/format",null,n,o):b&&typeof b=="object"?this.createError(j.FORMAT_CUSTOM,{message:b.message||"?"},b.dataPath||"",b.schemaPath||"/format",null,n,o):null},l.prototype.validateDefinedKeywords=function(n,o,b){for(var I in this.definedKeywords)if(o[I]!==void 0)for(var U=this.definedKeywords[I],V=0;V<U.length;V++){var q=(0,U[V])(n,o[I],o,b);if(typeof q=="string"||typeof q=="number")return this.createError(j.KEYWORD_CUSTOM,{key:I,message:q},"","",null,n,o).prefixWith(null,I);if(q&&typeof q=="object"){var G=q.code;if(typeof G=="string"){if(!j[G])throw new Error("Undefined error code (use defineError): "+G);G=j[G]}else typeof G!="number"&&(G=j.KEYWORD_CUSTOM);var Y=typeof q.message=="object"?q.message:{key:I,message:q.message||"?"},tt=q.schemaPath||"/"+I.replace(/~/g,"~0").replace(/\//g,"~1");return this.createError(G,Y,q.dataPath||null,tt,null,n,o)}}return null},l.prototype.validateBasic=function(n,o,b){var I;return(I=this.validateType(n,o,b))||(I=this.validateEnum(n,o,b))?I.prefixWith(null,"type"):null},l.prototype.validateType=function(n,o){if(o.type===void 0)return null;var b=typeof n;n===null?b="null":Array.isArray(n)&&(b="array");var I=o.type;Array.isArray(I)||(I=[I]);for(var U=0;U<I.length;U++){var V=I[U];if(V===b||V==="integer"&&b==="number"&&n%1==0)return null}return this.createError(j.INVALID_TYPE,{type:b,expected:I.join("/")},"","",null,n,o)},l.prototype.validateEnum=function(n,o){if(o.enum===void 0)return null;for(var b=0;b<o.enum.length;b++)if(w(n,o.enum[b]))return null;return this.createError(j.ENUM_MISMATCH,{value:typeof JSON<"u"?JSON.stringify(n):n},"","",null,n,o)},l.prototype.validateNumeric=function(n,o,b){return this.validateMultipleOf(n,o,b)||this.validateMinMax(n,o,b)||this.validateNaN(n,o,b)||null};var T=Math.pow(2,-51),N=1-T;function S(n){var o=String(n).replace(/^\s+|\s+$/g,"").match(/^([^:\/?#]+:)?(\/\/(?:[^:@]*(?::[^:@]*)?@)?(([^:\/?#]*)(?::(\d*))?))?([^?#]*)(\?[^#]*)?(#[\s\S]*)?/);return o?{href:o[0]||"",protocol:o[1]||"",authority:o[2]||"",host:o[3]||"",hostname:o[4]||"",port:o[5]||"",pathname:o[6]||"",search:o[7]||"",hash:o[8]||""}:null}function e(n,o){return o=S(o||""),n=S(n||""),o&&n?(o.protocol||n.protocol)+(o.protocol||o.authority?o.authority:n.authority)+(b=o.protocol||o.authority||o.pathname.charAt(0)==="/"?o.pathname:o.pathname?(n.authority&&!n.pathname?"/":"")+n.pathname.slice(0,n.pathname.lastIndexOf("/")+1)+o.pathname:n.pathname,I=[],b.replace(/^(\.\.?(\/|$))+/,"").replace(/\/(\.(\/|$))+/g,"/").replace(/\/\.\.$/,"/../").replace(/\/?[^\/]*/g,function(U){U==="/.."?I.pop():I.push(U)}),I.join("").replace(/^\//,b.charAt(0)==="/"?"/":""))+(o.protocol||o.authority||o.pathname?o.search:o.search||n.search)+o.hash:null;var b,I}function g(n){return n.split("#")[0]}function y(n,o){if(n&&typeof n=="object")if(o===void 0?o=n.id:typeof n.id=="string"&&(o=e(o,n.id),n.id=o),Array.isArray(n))for(var b=0;b<n.length;b++)y(n[b],o);else for(var I in typeof n.$ref=="string"&&(n.$ref=e(o,n.$ref)),n)I!=="enum"&&y(n[I],o)}function L(n){var o=A[n=n||"en"];return function(b){var I=o[b.code]||J[b.code];if(typeof I!="string")return"Unknown error code "+b.code+": "+JSON.stringify(b.messageParams);var U=b.params;return I.replace(/\{([^{}]*)\}/g,function(V,q){var G=U[q];return typeof G=="string"||typeof G=="number"?G:V})}}l.prototype.validateMultipleOf=function(n,o){var b=o.multipleOf||o.divisibleBy;if(b===void 0)return null;if(typeof n=="number"){var I=n/b%1;if(I>=T&&I<N)return this.createError(j.NUMBER_MULTIPLE_OF,{value:n,multipleOf:b},"","",null,n,o)}return null},l.prototype.validateMinMax=function(n,o){if(typeof n!="number")return null;if(o.minimum!==void 0){if(n<o.minimum)return this.createError(j.NUMBER_MINIMUM,{value:n,minimum:o.minimum},"","/minimum",null,n,o);if(o.exclusiveMinimum&&n===o.minimum)return this.createError(j.NUMBER_MINIMUM_EXCLUSIVE,{value:n,minimum:o.minimum},"","/exclusiveMinimum",null,n,o)}if(o.maximum!==void 0){if(n>o.maximum)return this.createError(j.NUMBER_MAXIMUM,{value:n,maximum:o.maximum},"","/maximum",null,n,o);if(o.exclusiveMaximum&&n===o.maximum)return this.createError(j.NUMBER_MAXIMUM_EXCLUSIVE,{value:n,maximum:o.maximum},"","/exclusiveMaximum",null,n,o)}return null},l.prototype.validateNaN=function(n,o){return typeof n!="number"?null:isNaN(n)===!0||n===1/0||n===-1/0?this.createError(j.NUMBER_NOT_A_NUMBER,{value:n},"","/type",null,n,o):null},l.prototype.validateString=function(n,o,b){return this.validateStringLength(n,o,b)||this.validateStringPattern(n,o,b)||null},l.prototype.validateStringLength=function(n,o){return typeof n!="string"?null:o.minLength!==void 0&&n.length<o.minLength?this.createError(j.STRING_LENGTH_SHORT,{length:n.length,minimum:o.minLength},"","/minLength",null,n,o):o.maxLength!==void 0&&n.length>o.maxLength?this.createError(j.STRING_LENGTH_LONG,{length:n.length,maximum:o.maxLength},"","/maxLength",null,n,o):null},l.prototype.validateStringPattern=function(n,o){if(typeof n!="string"||typeof o.pattern!="string"&&!(o.pattern instanceof RegExp))return null;var b;if(o.pattern instanceof RegExp)b=o.pattern;else{var I,U="",V=o.pattern.match(/^\/(.+)\/([img]*)$/);V?(I=V[1],U=V[2]):I=o.pattern,b=new RegExp(I,U)}return b.test(n)?null:this.createError(j.STRING_PATTERN,{pattern:o.pattern},"","/pattern",null,n,o)},l.prototype.validateArray=function(n,o,b){return Array.isArray(n)&&(this.validateArrayLength(n,o,b)||this.validateArrayUniqueItems(n,o,b)||this.validateArrayItems(n,o,b))||null},l.prototype.validateArrayLength=function(n,o){var b;return o.minItems!==void 0&&n.length<o.minItems&&(b=this.createError(j.ARRAY_LENGTH_SHORT,{length:n.length,minimum:o.minItems},"","/minItems",null,n,o),this.handleError(b))||o.maxItems!==void 0&&n.length>o.maxItems&&(b=this.createError(j.ARRAY_LENGTH_LONG,{length:n.length,maximum:o.maxItems},"","/maxItems",null,n,o),this.handleError(b))?b:null},l.prototype.validateArrayUniqueItems=function(n,o){if(o.uniqueItems){for(var b=0;b<n.length;b++)for(var I=b+1;I<n.length;I++)if(w(n[b],n[I])){var U=this.createError(j.ARRAY_UNIQUE,{match1:b,match2:I},"","/uniqueItems",null,n,o);if(this.handleError(U))return U}}return null},l.prototype.validateArrayItems=function(n,o,b){if(o.items===void 0)return null;var I,U;if(Array.isArray(o.items)){for(U=0;U<n.length;U++)if(U<o.items.length){if(I=this.validateAll(n[U],o.items[U],[U],["items",U],b+"/"+U))return I}else if(o.additionalItems!==void 0){if(typeof o.additionalItems=="boolean"){if(!o.additionalItems&&(I=this.createError(j.ARRAY_ADDITIONAL_ITEMS,{},"/"+U,"/additionalItems",null,n,o),this.handleError(I)))return I}else if(I=this.validateAll(n[U],o.additionalItems,[U],["additionalItems"],b+"/"+U))return I}}else for(U=0;U<n.length;U++)if(I=this.validateAll(n[U],o.items,[U],["items"],b+"/"+U))return I;return null},l.prototype.validateObject=function(n,o,b){return typeof n!="object"||n===null||Array.isArray(n)?null:this.validateObjectMinMaxProperties(n,o,b)||this.validateObjectRequiredProperties(n,o,b)||this.validateObjectProperties(n,o,b)||this.validateObjectDependencies(n,o,b)||null},l.prototype.validateObjectMinMaxProperties=function(n,o){var b,I=Object.keys(n);return o.minProperties!==void 0&&I.length<o.minProperties&&(b=this.createError(j.OBJECT_PROPERTIES_MINIMUM,{propertyCount:I.length,minimum:o.minProperties},"","/minProperties",null,n,o),this.handleError(b))||o.maxProperties!==void 0&&I.length>o.maxProperties&&(b=this.createError(j.OBJECT_PROPERTIES_MAXIMUM,{propertyCount:I.length,maximum:o.maxProperties},"","/maxProperties",null,n,o),this.handleError(b))?b:null},l.prototype.validateObjectRequiredProperties=function(n,o){if(o.required!==void 0)for(var b=0;b<o.required.length;b++){var I=o.required[b];if(n[I]===void 0){var U=this.createError(j.OBJECT_REQUIRED,{key:I},"","/required/"+b,null,n,o);if(this.handleError(U))return U}}return null},l.prototype.validateObjectProperties=function(n,o,b){var I;for(var U in n){var V=b+"/"+U.replace(/~/g,"~0").replace(/\//g,"~1"),q=!1;if(o.properties!==void 0&&o.properties[U]!==void 0&&(q=!0,I=this.validateAll(n[U],o.properties[U],[U],["properties",U],V)))return I;if(o.patternProperties!==void 0){for(var G in o.patternProperties)if(new RegExp(G).test(U)&&(q=!0,I=this.validateAll(n[U],o.patternProperties[G],[U],["patternProperties",G],V)))return I}if(q)this.trackUnknownProperties&&(this.knownPropertyPaths[V]=!0,delete this.unknownPropertyPaths[V]);else if(o.additionalProperties!==void 0){if(this.trackUnknownProperties&&(this.knownPropertyPaths[V]=!0,delete this.unknownPropertyPaths[V]),typeof o.additionalProperties=="boolean"){if(!o.additionalProperties&&(I=this.createError(j.OBJECT_ADDITIONAL_PROPERTIES,{key:U},"","/additionalProperties",null,n,o).prefixWith(U,null),this.handleError(I)))return I}else if(I=this.validateAll(n[U],o.additionalProperties,[U],["additionalProperties"],V))return I}else this.trackUnknownProperties&&!this.knownPropertyPaths[V]&&(this.unknownPropertyPaths[V]=!0)}return null},l.prototype.validateObjectDependencies=function(n,o,b){var I;if(o.dependencies!==void 0){for(var U in o.dependencies)if(n[U]!==void 0){var V=o.dependencies[U];if(typeof V=="string"){if(n[V]===void 0&&(I=this.createError(j.OBJECT_DEPENDENCY_KEY,{key:U,missing:V},"","",null,n,o).prefixWith(null,U).prefixWith(null,"dependencies"),this.handleError(I)))return I}else if(Array.isArray(V))for(var q=0;q<V.length;q++){var G=V[q];if(n[G]===void 0&&(I=this.createError(j.OBJECT_DEPENDENCY_KEY,{key:U,missing:G},"","/"+q,null,n,o).prefixWith(null,U).prefixWith(null,"dependencies"),this.handleError(I)))return I}else if(I=this.validateAll(n,V,[],["dependencies",U],b))return I}}return null},l.prototype.validateCombinations=function(n,o,b){return this.validateAllOf(n,o,b)||this.validateAnyOf(n,o,b)||this.validateOneOf(n,o,b)||this.validateNot(n,o,b)||null},l.prototype.validateAllOf=function(n,o,b){if(o.allOf===void 0)return null;for(var I,U=0;U<o.allOf.length;U++){var V=o.allOf[U];if(I=this.validateAll(n,V,[],["allOf",U],b))return I}return null},l.prototype.validateAnyOf=function(n,o,b){if(o.anyOf===void 0)return null;var I,U,V=[],q=this.errors.length;this.trackUnknownProperties&&(I=this.unknownPropertyPaths,U=this.knownPropertyPaths);for(var G=!0,Y=0;Y<o.anyOf.length;Y++){this.trackUnknownProperties&&(this.unknownPropertyPaths={},this.knownPropertyPaths={});var tt=o.anyOf[Y],at=this.errors.length,ot=this.validateAll(n,tt,[],["anyOf",Y],b);if(ot===null&&at===this.errors.length){if(this.errors=this.errors.slice(0,q),this.trackUnknownProperties){for(var Q in this.knownPropertyPaths)U[Q]=!0,delete I[Q];for(var r in this.unknownPropertyPaths)U[r]||(I[r]=!0);G=!1;continue}return null}ot&&V.push(ot.prefixWith(null,""+Y).prefixWith(null,"anyOf"))}return this.trackUnknownProperties&&(this.unknownPropertyPaths=I,this.knownPropertyPaths=U),G?(V=V.concat(this.errors.slice(q)),this.errors=this.errors.slice(0,q),this.createError(j.ANY_OF_MISSING,{},"","/anyOf",V,n,o)):void 0},l.prototype.validateOneOf=function(n,o,b){if(o.oneOf===void 0)return null;var I,U,V=null,q=[],G=this.errors.length;this.trackUnknownProperties&&(I=this.unknownPropertyPaths,U=this.knownPropertyPaths);for(var Y=0;Y<o.oneOf.length;Y++){this.trackUnknownProperties&&(this.unknownPropertyPaths={},this.knownPropertyPaths={});var tt=o.oneOf[Y],at=this.errors.length,ot=this.validateAll(n,tt,[],["oneOf",Y],b);if(ot===null&&at===this.errors.length){if(V!==null)return this.errors=this.errors.slice(0,G),this.createError(j.ONE_OF_MULTIPLE,{index1:V,index2:Y},"","/oneOf",null,n,o);if(V=Y,this.trackUnknownProperties){for(var Q in this.knownPropertyPaths)U[Q]=!0,delete I[Q];for(var r in this.unknownPropertyPaths)U[r]||(I[r]=!0)}}else ot&&q.push(ot)}return this.trackUnknownProperties&&(this.unknownPropertyPaths=I,this.knownPropertyPaths=U),V===null?(q=q.concat(this.errors.slice(G)),this.errors=this.errors.slice(0,G),this.createError(j.ONE_OF_MISSING,{},"","/oneOf",q,n,o)):(this.errors=this.errors.slice(0,G),null)},l.prototype.validateNot=function(n,o,b){if(o.not===void 0)return null;var I,U,V=this.errors.length;this.trackUnknownProperties&&(I=this.unknownPropertyPaths,U=this.knownPropertyPaths,this.unknownPropertyPaths={},this.knownPropertyPaths={});var q=this.validateAll(n,o.not,null,null,b),G=this.errors.slice(V);return this.errors=this.errors.slice(0,V),this.trackUnknownProperties&&(this.unknownPropertyPaths=I,this.knownPropertyPaths=U),q===null&&G.length===0?this.createError(j.NOT_PASSED,{},"","/not",null,n,o):null},l.prototype.validateHypermedia=function(n,o,b){if(!o.links)return null;for(var I,U=0;U<o.links.length;U++){var V=o.links[U];if(V.rel==="describedby"){for(var q=new p(V.href),G=!0,Y=0;Y<q.varNames.length;Y++)if(!(q.varNames[Y]in n)){G=!1;break}if(G){var tt={$ref:q.fillFromObject(n)};if(I=this.validateAll(n,tt,[],["links",U],b))return I}}}};var j={INVALID_TYPE:0,ENUM_MISMATCH:1,ANY_OF_MISSING:10,ONE_OF_MISSING:11,ONE_OF_MULTIPLE:12,NOT_PASSED:13,NUMBER_MULTIPLE_OF:100,NUMBER_MINIMUM:101,NUMBER_MINIMUM_EXCLUSIVE:102,NUMBER_MAXIMUM:103,NUMBER_MAXIMUM_EXCLUSIVE:104,NUMBER_NOT_A_NUMBER:105,STRING_LENGTH_SHORT:200,STRING_LENGTH_LONG:201,STRING_PATTERN:202,OBJECT_PROPERTIES_MINIMUM:300,OBJECT_PROPERTIES_MAXIMUM:301,OBJECT_REQUIRED:302,OBJECT_ADDITIONAL_PROPERTIES:303,OBJECT_DEPENDENCY_KEY:304,ARRAY_LENGTH_SHORT:400,ARRAY_LENGTH_LONG:401,ARRAY_UNIQUE:402,ARRAY_ADDITIONAL_ITEMS:403,FORMAT_CUSTOM:500,KEYWORD_CUSTOM:501,CIRCULAR_REFERENCE:600,UNKNOWN_PROPERTY:1e3},B={};for(var z in j)B[j[z]]=z;var J={INVALID_TYPE:"Invalid type: {type} (expected {expected})",ENUM_MISMATCH:"No enum match for: {value}",ANY_OF_MISSING:'Data does not match any schemas from "anyOf"',ONE_OF_MISSING:'Data does not match any schemas from "oneOf"',ONE_OF_MULTIPLE:'Data is valid against more than one schema from "oneOf": indices {index1} and {index2}',NOT_PASSED:'Data matches schema from "not"',NUMBER_MULTIPLE_OF:"Value {value} is not a multiple of {multipleOf}",NUMBER_MINIMUM:"Value {value} is less than minimum {minimum}",NUMBER_MINIMUM_EXCLUSIVE:"Value {value} is equal to exclusive minimum {minimum}",NUMBER_MAXIMUM:"Value {value} is greater than maximum {maximum}",NUMBER_MAXIMUM_EXCLUSIVE:"Value {value} is equal to exclusive maximum {maximum}",NUMBER_NOT_A_NUMBER:"Value {value} is not a valid number",STRING_LENGTH_SHORT:"String is too short ({length} chars), minimum {minimum}",STRING_LENGTH_LONG:"String is too long ({length} chars), maximum {maximum}",STRING_PATTERN:"String does not match pattern: {pattern}",OBJECT_PROPERTIES_MINIMUM:"Too few properties defined ({propertyCount}), minimum {minimum}",OBJECT_PROPERTIES_MAXIMUM:"Too many properties defined ({propertyCount}), maximum {maximum}",OBJECT_REQUIRED:"Missing required property: {key}",OBJECT_ADDITIONAL_PROPERTIES:"Additional properties not allowed",OBJECT_DEPENDENCY_KEY:"Dependency failed - key must exist: {missing} (due to key: {key})",ARRAY_LENGTH_SHORT:"Array is too short ({length}), minimum {minimum}",ARRAY_LENGTH_LONG:"Array is too long ({length}), maximum {maximum}",ARRAY_UNIQUE:"Array items are not unique (indices {match1} and {match2})",ARRAY_ADDITIONAL_ITEMS:"Additional items not allowed",FORMAT_CUSTOM:"Format validation failed ({message})",KEYWORD_CUSTOM:"Keyword failed: {key} ({message})",CIRCULAR_REFERENCE:"Circular $refs: {urls}",UNKNOWN_PROPERTY:"Unknown property (not in schema)"};function C(n,o,b,I,U){if(Error.call(this),n===void 0)throw new Error("No error code supplied: "+I);this.message="",this.params=o,this.code=n,this.dataPath=b||"",this.schemaPath=I||"",this.subErrors=U||null;var V=new Error(this.message);if(this.stack=V.stack||V.stacktrace,!this.stack)try{throw V}catch(q){this.stack=q.stack||q.stacktrace}}C.prototype=Object.create(Error.prototype),C.prototype.constructor=C,C.prototype.name="ValidationError",C.prototype.prefixWith=function(n,o){if(n!==null&&(n=n.replace(/~/g,"~0").replace(/\//g,"~1"),this.dataPath="/"+n+this.dataPath),o!==null&&(o=o.replace(/~/g,"~0").replace(/\//g,"~1"),this.schemaPath="/"+o+this.schemaPath),this.subErrors!==null)for(var b=0;b<this.subErrors.length;b++)this.subErrors[b].prefixWith(n,o);return this};var A={},E=function n(o){var b,I,U=new l,V={setErrorReporter:function(q){return typeof q=="string"?this.language(q):(I=q,!0)},addFormat:function(){U.addFormat.apply(U,arguments)},language:function(q){return q?(A[q]||(q=q.split("-")[0]),!!A[q]&&(b=q,q)):b},addLanguage:function(q,G){var Y;for(Y in j)G[Y]&&!G[j[Y]]&&(G[j[Y]]=G[Y]);var tt=q.split("-")[0];if(A[tt])for(Y in A[q]=Object.create(A[tt]),G)A[tt][Y]===void 0&&(A[tt][Y]=G[Y]),A[q][Y]=G[Y];else A[q]=G,A[tt]=G;return this},freshApi:function(q){var G=n();return q&&G.language(q),G},validate:function(q,G,Y,tt){var at=L(b),ot=new l(U,!1,I?function(r,s,d){return I(r,s,d)||at(r,s,d)}:at,Y,tt);typeof G=="string"&&(G={$ref:G}),ot.addSchema("",G);var Q=ot.validateAll(q,G,null,null,"");return!Q&&tt&&(Q=ot.banUnknownProperties(q,G)),this.error=Q,this.missing=ot.missing,this.valid=Q===null,this.valid},validateResult:function(){var q={toString:function(){return this.valid?"valid":this.error.message}};return this.validate.apply(q,arguments),q},validateMultiple:function(q,G,Y,tt){var at=L(b),ot=new l(U,!0,I?function(r,s,d){return I(r,s,d)||at(r,s,d)}:at,Y,tt);typeof G=="string"&&(G={$ref:G}),ot.addSchema("",G),ot.validateAll(q,G,null,null,""),tt&&ot.banUnknownProperties(q,G);var Q={toString:function(){return this.valid?"valid":this.error.message}};return Q.errors=ot.errors,Q.missing=ot.missing,Q.valid=Q.errors.length===0,Q},addSchema:function(){return U.addSchema.apply(U,arguments)},getSchema:function(){return U.getSchema.apply(U,arguments)},getSchemaMap:function(){return U.getSchemaMap.apply(U,arguments)},getSchemaUris:function(){return U.getSchemaUris.apply(U,arguments)},getMissingUris:function(){return U.getMissingUris.apply(U,arguments)},dropSchemas:function(){U.dropSchemas.apply(U,arguments)},defineKeyword:function(){U.defineKeyword.apply(U,arguments)},defineError:function(q,G,Y){if(typeof q!="string"||!/^[A-Z]+(_[A-Z]+)*$/.test(q))throw new Error("Code name must be a string in UPPER_CASE_WITH_UNDERSCORES");if(typeof G!="number"||G%1!=0||G<1e4)throw new Error("Code number must be an integer > 10000");if(j[q]!==void 0)throw new Error("Error already defined: "+q+" as "+j[q]);if(B[G]!==void 0)throw new Error("Error code already used: "+B[G]+" as "+G);for(var tt in j[q]=G,B[G]=q,J[q]=J[G]=Y,A){var at=A[tt];at[q]&&(at[G]=at[G]||at[q])}},reset:function(){U.reset(),this.error=null,this.missing=[],this.valid=!0},missing:[],error:null,valid:!0,normSchema:y,resolveUrl:e,getDocumentUri:g,errorCodes:j};return V.language(o||"en"),V}();return E.addLanguage("en-gb",J),E.tv4=E,E})=="function"?u.apply(i,v):u)===void 0||(a.exports=M)},function(a,i,f){Object.defineProperty(i,"__esModule",{value:!0}),i.BaseClientTypes=void 0;class u{constructor(){this.uris={},this.schemas={},this.aliases={}}declare(m,x,_,c){const O=m+"/"+x;if(c.extends){const k=c.extends.split("/"),R=k.length===1?m+"/"+k.shift():k.join("/"),h=this.uris[R];if(!h)throw"Type '"+O+"' tries to extend unknown schema '"+R+"'";c.extends=this.schemas[h]}this.uris[O]=_,this.aliases[_]=O,this.schemas[_]=c}resolveAlias(m){return this.uris[m]}getSchema(m){return this.schemas[m]}inScope(m){const x=m.length,_={};for(const c in this.uris)if(c.substr(0,x+1)===m+"/"){const O=this.uris[c];_[O]=this.schemas[O]}return _}}i.BaseClientTypes=u;const v=new u;i.default=v},function(a,i,f){class u extends Error{constructor(M){super();const m=new Error("Schema not found: "+M);return m.name="SchemaNotFound",m}}a.exports=u},function(a,i,f){a.exports=class{constructor(u){this._itemsRev={},this._storage={},this._canPropagate=!1,this.defaultValue=u,this.activatePropagation()}get(u){u=u.toLowerCase();let v=this._storage[u];return v===void 0&&(v=this.defaultValue,this._storage[u]=v),v}set(u,v){return u=u.toLowerCase(),this._storage[u]===v||(this._storage[u]=v,v||delete this._itemsRev[u],this._updateParentFolderItemRev(u,v),this._canPropagate&&this._propagate(u)),v}delete(u){return this.set(u,null)}deactivatePropagation(){return this._canPropagate=!1,!0}activatePropagation(){return this._canPropagate||(this._generateFolderRev("/"),this._canPropagate=!0),!0}_hashCode(u){let v=0;if(u.length===0)return v;for(let M=0;M<u.length;M++)v=(v<<5)-v+u.charCodeAt(M),v|=0;return v}_generateHash(u){const v=u.sort().join("|");return""+this._hashCode(v)}_updateParentFolderItemRev(u,v){if(u!=="/"){const M=this._getParentFolder(u);this._itemsRev[M]||(this._itemsRev[M]={});const m=this._itemsRev[M];v?m[u]=v:delete m[u],this._updateParentFolderItemRev(M,this.defaultValue)}}_getParentFolder(u){return u.substr(0,u.lastIndexOf("/",u.length-2)+1)}_propagate(u){if(u!=="/"){const v=this._getParentFolder(u),M=this._itemsRev[v],m=[];for(const _ in M)m.push(M[_]);const x=this._generateHash(m);this.set(v,x)}}_generateFolderRev(u){const v=this._itemsRev[u];let M=this.defaultValue;if(v){const m=[];for(const x in v){let _;_=x.substr(-1)==="/"?this._generateFolderRev(x):v[x],m.push(_)}m.length>0&&(M=this._generateHash(m))}return this.set(u,M),M}}},function(a,i,f){var u;/*!
 * webfinger.js
 *   http://github.com/silverbucket/webfinger.js
 *
 * Developed and Maintained by:
 *   Nick Jennings <nick@silverbucket.net>
 *
 * webfinger.js is released under the AGPL (see LICENSE).
 *
 * You don't have to do anything special to choose one license or the other and you don't
 * have to notify anyone which license you are using.
 * Please see the corresponding license file for details of these licenses.
 * You are free to use, modify and distribute this software, but all copyright
 * information must remain.
 *
 */typeof fetch!="function"&&typeof XMLHttpRequest!="function"&&(XMLHttpRequest=f(29)),function(v){var M={"http://webfist.org/spec/rel":"webfist","http://webfinger.net/rel/avatar":"avatar",remotestorage:"remotestorage","http://tools.ietf.org/id/draft-dejong-remotestorage":"remotestorage",remoteStorage:"remotestorage","http://www.packetizer.com/rel/share":"share","http://webfinger.net/rel/profile-page":"profile",me:"profile",vcard:"vcard",blog:"blog","http://packetizer.com/rel/blog":"blog","http://schemas.google.com/g/2010#updates-from":"updates","https://camlistore.org/rel/server":"camilstore"},m={avatar:[],remotestorage:[],blog:[],vcard:[],updates:[],share:[],profile:[],webfist:[],camlistore:[]},x=["webfinger","host-meta","host-meta.json"];function _(O){return O.toString=function(){return this.message},O}function c(O){typeof O!="object"&&(O={}),this.config={tls_only:O.tls_only===void 0||O.tls_only,webfist_fallback:O.webfist_fallback!==void 0&&O.webfist_fallback,uri_fallback:O.uri_fallback!==void 0&&O.uri_fallback,request_timeout:O.request_timeout!==void 0?O.request_timeout:1e4}}c.prototype.__fetchJRD=function(O,k,R){if(typeof fetch=="function")return this.__fetchJRD_fetch(O,k,R);if(typeof XMLHttpRequest=="function")return this.__fetchJRD_XHR(O,k,R);throw new Error("add a polyfill for fetch or XMLHttpRequest")},c.prototype.__fetchJRD_fetch=function(O,k,R){var h,p=this;typeof AbortController=="function"&&(h=new AbortController);var l=fetch(O,{headers:{Accept:"application/jrd+json, application/json"},signal:h?h.signal:void 0}).then(function(T){if(T.ok)return T.text();throw T.status===404?_({message:"resource not found",url:O,status:T.status}):_({message:"error during request",url:O,status:T.status})},function(T){throw _({message:"error during request",url:O,status:void 0,err:T})}).then(function(T){if(p.__isValidJSON(T))return T;throw _({message:"invalid json",url:O,status:void 0})}),w=new Promise(function(T,N){setTimeout(function(){N(_({message:"request timed out",url:O,status:void 0})),h&&h.abort()},p.config.request_timeout)});Promise.race([l,w]).then(function(T){R(T)}).catch(function(T){k(T)})},c.prototype.__fetchJRD_XHR=function(O,k,R){var h=this,p=!1,l=new XMLHttpRequest;function w(){if(!p){if(p=!0,l.status===200)return h.__isValidJSON(l.responseText)?R(l.responseText):k(_({message:"invalid json",url:O,status:l.status}));if(l.status===404)return k(_({message:"resource not found",url:O,status:l.status}));if(l.status>=301&&l.status<=302){var N=l.getResponseHeader("Location");return function(S){return typeof S=="string"&&S.split("://")[0]==="https"}(N)?T():k(_({message:"no redirect URL found",url:O,status:l.status}))}return k(_({message:"error during request",url:O,status:l.status}))}}function T(){l.onreadystatechange=function(){l.readyState===4&&w()},l.onload=function(){w()},l.ontimeout=function(){return k(_({message:"request timed out",url:O,status:l.status}))},l.open("GET",O,!0),l.timeout=h.config.request_timeout,l.setRequestHeader("Accept","application/jrd+json, application/json"),l.send()}return T()},c.prototype.__isValidJSON=function(O){try{JSON.parse(O)}catch{return!1}return!0},c.prototype.__isLocalhost=function(O){return/^localhost(\.localdomain)?(\:[0-9]+)?$/.test(O)},c.prototype.__processJRD=function(O,k,R,h){var p=JSON.parse(k);if(typeof p!="object"||typeof p.links!="object")return p.error!==void 0?R(_({message:p.error,request:O})):R(_({message:"unknown response from server",request:O}));var l=p.links;Array.isArray(l)||(l=[]);var w={object:p,json:k,idx:{}};w.idx.properties={name:void 0},w.idx.links=JSON.parse(JSON.stringify(m)),l.map(function(S,e){if(M.hasOwnProperty(S.rel)&&w.idx.links[M[S.rel]]){var g={};Object.keys(S).map(function(y,L){g[y]=S[y]}),w.idx.links[M[S.rel]].push(g)}});var T=JSON.parse(k).properties;for(var N in T)T.hasOwnProperty(N)&&N==="http://packetizer.com/ns/name"&&(w.idx.properties.name=T[N]);return h(w)},c.prototype.lookup=function(O,k){if(typeof O!="string")throw new Error("first parameter must be a user address");if(typeof k!="function")throw new Error("second parameter must be a callback");var R=this,h="";h=O.indexOf("://")>-1?O.replace(/ /g,"").split("/")[2]:O.replace(/ /g,"").split("@")[1];var p=0,l="https";function w(){var S="";return O.split("://")[1]||(S="acct:"),l+"://"+h+"/.well-known/"+x[p]+"?resource="+S+O}function T(S){if(R.config.uri_fallback&&h!=="webfist.org"&&p!==x.length-1)return p+=1,N();if(!R.config.tls_only&&l==="https")return p=0,l="http",N();if(!R.config.webfist_fallback||h==="webfist.org")return k(S);p=0,l="http",h="webfist.org";var e=w();R.__fetchJRD(e,k,function(g){R.__processJRD(e,g,k,function(y){typeof y.idx.links.webfist=="object"&&typeof y.idx.links.webfist[0].href=="string"&&R.__fetchJRD(y.idx.links.webfist[0].href,k,function(L){R.__processJRD(e,L,k,function(j){return k(null,k)})})})})}function N(){var S=w();R.__fetchJRD(S,T,function(e){R.__processJRD(S,e,k,function(g){k(null,g)})})}return R.__isLocalhost(h)&&(l="http"),setTimeout(N,0)},c.prototype.lookupLink=function(O,k,R){if(!m.hasOwnProperty(k))return R("unsupported rel "+k);this.lookup(O,function(h,p){var l=p.idx.links[k];return h?R(h):l.length===0?R('no links found with rel="'+k+'"'):R(null,l[0])})},(u=function(){return c}.apply(i,[]))===void 0||(a.exports=u)}()},function(a,i){a.exports=XMLHttpRequest},function(a,i,f){var u=this&&this.__importDefault||function(y){return y&&y.__esModule?y:{default:y}};const v=u(f(3)),M=u(f(17)),m=u(f(1)),x=f(0),_=u(f(31)),c=u(f(12)),O=u(f(4)),k=u(f(16)),R=u(f(8)),h=u(f(14)),p=u(f(15)),l=u(f(32)),w=u(f(33)),T=u(f(13)),N=u(f(34)),S=u(f(35)),e=u(f(36)),g={features:[],featuresDone:0,readyFired:!1,loadFeatures(){this.features=[],this.featuresDone=0,this.readyFired=!1,this.featureModules={WireClient:l.default,Dropbox:p.default,GoogleDrive:h.default,Access:c.default,Discover:k.default,Authorize:O.default,BaseClient:R.default,Env:M.default},v.default.cache&&(0,x.extend)(this.featureModules,{Caching:T.default,IndexedDB:N.default,LocalStorage:S.default,InMemoryStorage:e.default,Sync:w.default}),v.default.disableFeatures.forEach(y=>{this.featureModules[y]&&delete this.featureModules[y]}),this._allLoaded=!1;for(const y in this.featureModules)this.loadFeature(y)},hasFeature(y){for(let L=this.features.length-1;L>=0;L--)if(this.features[L].name===y)return this.features[L].supported;return!1},loadFeature(y){const L=this.featureModules[y],j=!L._rs_supported||L._rs_supported();(0,m.default)(`[RemoteStorage] [FEATURE ${y}] initializing ...`),typeof j=="object"?j.then(()=>{this.featureSupported(y,!0),this.initFeature(y)},()=>{this.featureSupported(y,!1)}):typeof j=="boolean"?(this.featureSupported(y,j),j&&this.initFeature(y)):this.featureSupported(y,!1)},initFeature(y){const L=this.featureModules[y];let j;try{j=L._rs_init(this)}catch(B){return void this.featureFailed(y,B)}typeof j=="object"&&typeof j.then=="function"?j.then(()=>{this.featureInitialized(y)},B=>{this.featureFailed(y,B)}):this.featureInitialized(y)},featureFailed(y,L){(0,m.default)(`[RemoteStorage] [FEATURE ${y}] initialization failed (${L})`),this.featureDone()},featureSupported(y,L){(0,m.default)(`[RemoteStorage] [FEATURE ${y}]${L?"":"not "} supported`),L||this.featureDone()},featureInitialized(y){(0,m.default)(`[RemoteStorage] [FEATURE ${y}] initialized`),this.features.push({name:y,init:this.featureModules[y]._rs_init,supported:!0,cleanup:this.featureModules[y]._rs_cleanup}),this.featureDone()},featureDone(){this.featuresDone++,this.featuresDone===Object.keys(this.featureModules).length&&setTimeout(this.featuresLoaded.bind(this),0)},_setCachingModule(){["IndexedDB","LocalStorage","InMemoryStorage"].some(y=>{if(this.features.some(L=>L.name===y))return this.features.local=this.featureModules[y],!0})},_fireReady(){try{this.readyFired||(this._emit("ready"),this.readyFired=!0)}catch(y){console.error("'ready' failed: ",y,y.stack),this._emit("error",y)}},featuresLoaded(){(0,m.default)("[RemoteStorage] All features loaded"),this._setCachingModule(),this.local=v.default.cache&&this.features.local&&new this.features.local,this.local&&this.remote?(this._setGPD(_.default,this),this._bindChange(this.local)):this.remote&&this._setGPD(this.remote,this.remote),this.remote&&(this.remote.on("connected",()=>{this._fireReady(),this._emit("connected")}),this.remote.on("not-connected",()=>{this._fireReady(),this._emit("not-connected")}),this.remote.connected&&(this._fireReady(),this._emit("connected")),this.hasFeature("Authorize")||this.remote.stopWaitingForToken()),this._collectCleanupFunctions();try{this._allLoaded=!0,this._emit("features-loaded")}catch(y){(0,x.logError)(y),this._emit("error",y)}this._processPending()},_collectCleanupFunctions(){this._cleanups=[];for(let y=0;y<this.features.length;y++){const L=this.features[y].cleanup;typeof L=="function"&&this._cleanups.push(L)}}};a.exports=g},function(a,i,f){var u=this&&this.__awaiter||function(x,_,c,O){return new(c||(c=Promise))(function(k,R){function h(w){try{l(O.next(w))}catch(T){R(T)}}function p(w){try{l(O.throw(w))}catch(T){R(T)}}function l(w){var T;w.done?k(w.value):(T=w.value,T instanceof c?T:new c(function(N){N(T)})).then(h,p)}l((O=O.apply(x,_||[])).next())})};const v=(this&&this.__importDefault||function(x){return x&&x.__esModule?x:{default:x}})(f(1));function M(x){return this.backend==="dropbox"&&!!x.match(/^\/public\/.*[^\/]$/)}const m={get:function(x,_){if(this.local){if(_===void 0)_=typeof(c=this).remote=="object"&&c.remote.connected&&c.remote.online?2*c.getSyncInterval():((0,v.default)("Not setting default maxAge, because remote is offline or not connected"),!1);else if(typeof _!="number"&&_!==!1)return Promise.reject("Argument 'maxAge' must be 'false' or a number");return this.local.get(x,_,this.sync.queueGetRequest.bind(this.sync))}return this.remote.get(x);var c},put:function(x,_,c){return M.bind(this)(x)?m._wrapBusyDone.call(this,this.remote.put(x,_,c)):this.local?this.local.put(x,_,c):m._wrapBusyDone.call(this,this.remote.put(x,_,c))},delete:function(x){return this.local?this.local.delete(x):m._wrapBusyDone.call(this,this.remote.delete(x))},_wrapBusyDone:function(x){return u(this,void 0,void 0,function*(){return this._emit("wire-busy"),x.then(_=>(this._emit("wire-done",{success:!0}),Promise.resolve(_)),_=>(this._emit("wire-done",{success:!1}),Promise.reject(_)))})}};a.exports=m},function(a,i,f){var u=this&&this.__awaiter||function(w,T,N,S){return new(N||(N=Promise))(function(e,g){function y(B){try{j(S.next(B))}catch(z){g(z)}}function L(B){try{j(S.throw(B))}catch(z){g(z)}}function j(B){var z;B.done?e(B.value):(z=B.value,z instanceof N?z:new N(function(J){J(z)})).then(y,L)}j((S=S.apply(w,T||[])).next())})},v=this&&this.__importDefault||function(w){return w&&w.__esModule?w:{default:w}};const M=v(f(4)),m=v(f(2)),x=v(f(5)),_=v(f(1)),c=f(0),O=f(7),k=f(9);let R;const h="remotestorage:wireclient",p={"draft-dejong-remotestorage-00":2,"draft-dejong-remotestorage-01":3,"draft-dejong-remotestorage-02":4,"https://www.w3.org/community/rww/wiki/read-write-web-00#simple":1};class l extends k.RemoteBase{constructor(T){if(super(T),this._revisionCache={},R=(0,c.localStorageAvailable)(),this.addEvents(["connected","not-connected"]),R){const N=function(){const S=(0,c.getJSONFromLocalStorage)(h)||{},{userAddress:e,href:g,storageApi:y,token:L,properties:j}=S;return{userAddress:e,href:g,storageApi:y,token:L,properties:j}}();N&&setTimeout(()=>{this.configure(N)},0)}this.connected&&setTimeout(this._emit.bind(this),0,"connected")}get storageType(){if(this.storageApi){const T=this.storageApi.match(/draft-dejong-(remotestorage-\d\d)/);return T?T[1]:"2012.04"}}_request(T,N,S,e,g,y,L){return u(this,void 0,void 0,function*(){if(this.isForbiddenRequestMethod(T,N))return Promise.reject(`Don't use ${T} on directories!`);let j;return S!==M.default.IMPLIED_FAKE_TOKEN&&(e.Authorization="Bearer "+S),this.rs._emit("wire-busy",{method:T,isFolder:(0,c.isFolder)(N)}),(0,O.requestWithTimeout)(T,N,{body:g,headers:e,responseType:"arraybuffer"}).then(B=>{if(this.online||(this.online=!0,this.rs._emit("network-online")),this.rs._emit("wire-done",{method:T,isFolder:(0,c.isFolder)(N),success:!0}),z=B.status,[401,403,404,412].indexOf(z)>=0)return(0,_.default)("[WireClient] Error response status",B.status),j=y?this.stripQuotes(B.getResponseHeader("ETag")):void 0,B.status===401&&this.rs._emit("error",new x.default),Promise.resolve({statusCode:B.status,revision:j});if(function(J){return[201,204,304].indexOf(J)>=0}(B.status)||B.status===200&&T!=="GET")return j=this.stripQuotes(B.getResponseHeader("ETag")),(0,_.default)("[WireClient] Successful request",j),Promise.resolve({statusCode:B.status,revision:j});{const J=B.getResponseHeader("Content-Type");j=y?this.stripQuotes(B.getResponseHeader("ETag")):B.status===200?L:void 0;const C=function(A){let E,n="utf-8";return A&&(E=A.match(/charset=(.+)$/),E&&(n=E[1])),n}(J);return(0,c.shouldBeTreatedAsBinary)(B.response,J)?((0,_.default)("[WireClient] Successful request with unknown or binary mime-type",j),Promise.resolve({statusCode:B.status,body:B.response,contentType:J,revision:j})):(0,c.getTextFromArrayBuffer)(B.response,C).then(A=>((0,_.default)("[WireClient] Successful request",j),Promise.resolve({statusCode:B.status,body:A,contentType:J,revision:j})))}var z},B=>(this.online&&(this.online=!1,this.rs._emit("network-offline")),this.rs._emit("wire-done",{method:T,isFolder:(0,c.isFolder)(N),success:!1}),Promise.reject(B)))})}configure(T){if(typeof T!="object")throw new Error("WireClient configure settings parameter should be an object");if(T.userAddress!==void 0&&(this.userAddress=T.userAddress),T.href!==void 0&&(this.href=T.href),T.storageApi!==void 0&&(this.storageApi=T.storageApi),T.token!==void 0&&(this.token=T.token),T.properties!==void 0&&(this.properties=T.properties),typeof this.storageApi=="string"){const N=p[this.storageApi]||5;this.supportsRevs=N>=2}this.href&&this.token?(this.connected=!0,this.online=!0,this._emit("connected")):this.connected=!1,R&&(localStorage[h]=JSON.stringify({userAddress:this.userAddress,href:this.href,storageApi:this.storageApi,token:this.token,properties:this.properties}))}get(T,N={}){if(!this.connected)return Promise.reject("not connected (path: "+T+")");const S={};return this.supportsRevs&&N.ifNoneMatch&&(S["If-None-Match"]=this.addQuotes(N.ifNoneMatch)),this._request("GET",this.href+(0,c.cleanPath)(T),this.token,S,void 0,this.supportsRevs,this._revisionCache[T]).then(e=>{if(!(0,c.isFolder)(T))return Promise.resolve(e);let g={};if(e.body!==void 0)try{e.body=JSON.parse(e.body)}catch{return Promise.reject("Folder description at "+this.href+(0,c.cleanPath)(T)+" is not JSON")}if(e.statusCode===200&&typeof e.body=="object"){if(Object.keys(e.body).length===0)e.statusCode=404;else if((y=e.body)["@context"]==="http://remotestorage.io/spec/folder-description"&&typeof y.items=="object"){for(const L in e.body.items)this._revisionCache[T+L]=e.body.items[L].ETag;g=e.body.items}else Object.keys(e.body).forEach(L=>{this._revisionCache[T+L]=e.body[L],g[L]={ETag:e.body[L]}});return e.body=g,Promise.resolve(e)}return Promise.resolve(e);var y})}put(T,N,S,e={}){if(!this.connected)return Promise.reject("not connected (path: "+T+")");!S.match(/charset=/)&&(N instanceof ArrayBuffer||(0,O.isArrayBufferView)(N))&&(S+="; charset=binary");const g={"Content-Type":S};return this.supportsRevs&&(e.ifMatch&&(g["If-Match"]=this.addQuotes(e.ifMatch)),e.ifNoneMatch&&(g["If-None-Match"]=this.addQuotes(e.ifNoneMatch))),this._request("PUT",this.href+(0,c.cleanPath)(T),this.token,g,N,this.supportsRevs)}delete(T,N={}){if(!this.connected)throw new Error("not connected (path: "+T+")");N||(N={});const S={};return this.supportsRevs&&N.ifMatch&&(S["If-Match"]=this.addQuotes(N.ifMatch)),this._request("DELETE",this.href+(0,c.cleanPath)(T),this.token,S,void 0,this.supportsRevs)}static _rs_init(T){T.remote=new l(T),T.remote.online=!0}static _rs_supported(){return typeof fetch=="function"||typeof XMLHttpRequest=="function"}static _rs_cleanup(){R&&delete localStorage[h]}}(0,c.applyMixins)(l,[m.default]),a.exports=l},function(a,i,f){var u=this&&this.__awaiter||function(S,e,g,y){return new(g||(g=Promise))(function(L,j){function B(C){try{J(y.next(C))}catch(A){j(A)}}function z(C){try{J(y.throw(C))}catch(A){j(A)}}function J(C){var A;C.done?L(C.value):(A=C.value,A instanceof g?A:new g(function(E){E(A)})).then(B,z)}J((y=y.apply(S,e||[])).next())})},v=this&&this.__importDefault||function(S){return S&&S.__esModule?S:{default:S}};const M=v(f(3)),m=v(f(17)),x=v(f(2)),_=v(f(1)),c=v(f(4)),O=v(f(10)),k=v(f(5)),R=f(0);let h,p;function l(S,e,g){return{action:S,path:e,promise:g}}function w(S,e){return S.common.revision!==e&&(!S.remote||S.remote.revision!==e)}function T(S){return S.common&&S.common.revision}class N{constructor(e){this._finishedTasks=[],this.rs=e,this._tasks={},this._running={},this._timeStarted={},this.numThreads=10,this.rs.local.onDiff(g=>{this.addTask(g),this.doTasks()}),this.rs.caching.onActivate(g=>{this.addTask(g),this.doTasks()}),this.addEvents(["done","req-done"])}now(){return new Date().getTime()}queueGetRequest(e){return new Promise((g,y)=>{this.rs.remote.connected?this.rs.remote.online?(this.addTask(e,function(){this.rs.local.get(e).then(L=>g(L))}.bind(this)),this.doTasks()):y("cannot fulfill maxAge requirement - remote is not online"):y("cannot fulfill maxAge requirement - remote is not connected")})}corruptServerItemsMap(e,g){if(typeof e!="object"||Array.isArray(e))return!0;for(const y in e){const L=e[y];if(typeof L!="object"||typeof L.ETag!="string")return!0;if((0,R.isFolder)(y)){if(y.substring(0,y.length-1).indexOf("/")!==-1)return!0}else if(y.indexOf("/")!==-1||g&&(typeof L["Content-Type"]!="string"||typeof L["Content-Length"]!="number"))return!0}return!1}corruptItemsMap(e){if(typeof e!="object"||Array.isArray(e))return!0;for(const g in e)if(typeof e[g]!="boolean")return!0;return!1}corruptRevision(e){return typeof e!="object"||Array.isArray(e)||e.revision&&typeof e.revision!="string"||e.body&&typeof e.body!="string"&&typeof e.body!="object"||e.contentType&&typeof e.contentType!="string"||e.contentLength&&typeof e.contentLength!="number"||e.timestamp&&typeof e.timestamp!="number"||e.itemsMap&&this.corruptItemsMap(e.itemsMap)}isCorrupt(e){return typeof e!="object"||Array.isArray(e)||typeof e.path!="string"||this.corruptRevision(e.common)||e.local&&this.corruptRevision(e.local)||e.remote&&this.corruptRevision(e.remote)||e.push&&this.corruptRevision(e.push)}hasTasks(){return Object.getOwnPropertyNames(this._tasks).length>0}collectDiffTasks(){return u(this,void 0,void 0,function*(){let e=0;return this.rs.local.forAllNodes(g=>{e>100||(this.isCorrupt(g)?((0,_.default)("[Sync] WARNING: corrupt node in local cache",g),typeof g=="object"&&g.path&&(this.addTask(g.path),e++)):(this.needsFetch(g)&&this.rs.access.checkPathPermission(g.path,"r")||(0,R.isDocument)(g.path)&&this.needsPush(g)&&this.rs.access.checkPathPermission(g.path,"rw"))&&(this.addTask(g.path),e++))}).then(()=>e).catch(g=>{throw g})})}inConflict(e){return e.local&&e.remote&&(e.remote.body!==void 0||e.remote.itemsMap)}needsRefresh(e){return!!e.common&&(!e.common.timestamp||this.now()-e.common.timestamp>M.default.syncInterval)}needsFetch(e){return!!this.inConflict(e)||!(!e.common||e.common.itemsMap!==void 0||e.common.body!==void 0)||!(!e.remote||e.remote.itemsMap!==void 0||e.remote.body!==void 0)}needsPush(e){return!this.inConflict(e)&&(!(!e.local||e.push)||void 0)}needsRemotePut(e){return e.local&&e.local.body}needsRemoteDelete(e){return e.local&&e.local.body===!1}getParentPath(e){const g=e.match(/^(.*\/)([^\/]+\/?)$/);if(g)return g[1];throw new Error('Not a valid path: "'+e+'"')}deleteChildPathsFromTasks(){for(const e in this._tasks){const g=(0,R.pathsFromRoot)(e);for(let y=1;y<g.length;y++)this._tasks[g[y]]&&(Array.isArray(this._tasks[e])&&this._tasks[e].length&&Array.prototype.push.apply(this._tasks[g[y]],this._tasks[e]),delete this._tasks[e])}}collectRefreshTasks(){return u(this,void 0,void 0,function*(){return this.rs.local.forAllNodes(e=>{let g;if(this.needsRefresh(e)){try{g=this.getParentPath(e.path)}catch{}g&&this.rs.access.checkPathPermission(g,"r")?this.addTask(g):this.rs.access.checkPathPermission(e.path,"r")&&this.addTask(e.path)}}).then(()=>this.deleteChildPathsFromTasks()).catch(e=>{throw e})})}flush(e){for(const g in e)this.rs.caching.checkPath(g)==="FLUSH"&&e[g]&&!e[g].local&&((0,_.default)("[Sync] Flushing",g),e[g]=void 0);return e}doTask(e){return this.rs.local.getNodes([e]).then(g=>{const y=g[e];return y===void 0||function(L){return L.remote&&L.remote.revision&&!L.remote.itemsMap&&!L.remote.body}(y)?l("get",e,this.rs.remote.get(e)):this.needsRemotePut(y)?(y.push=(0,R.deepClone)(y.local),y.push.timestamp=this.now(),this.rs.local.setNodes(this.flush(g)).then(()=>{let L;return L=T(y)?{ifMatch:y.common.revision}:{ifNoneMatch:"*"},l("put",e,this.rs.remote.put(e,y.push.body,y.push.contentType,L))})):this.needsRemoteDelete(y)?(y.push={body:!1,timestamp:this.now()},this.rs.local.setNodes(this.flush(g)).then(()=>T(y)?l("delete",e,this.rs.remote.delete(e,{ifMatch:y.common.revision})):l("get",e,this.rs.remote.get(e)))):T(y)?l("get",e,this.rs.remote.get(e,{ifNoneMatch:y.common.revision})):l("get",e,this.rs.remote.get(e))})}autoMergeFolder(e){if(e.remote.itemsMap&&(e.common=e.remote,delete e.remote,e.common.itemsMap)){for(const g in e.common.itemsMap)e.local.itemsMap[g]||(e.local.itemsMap[g]=!1);(0,R.equal)(e.local.itemsMap,e.common.itemsMap)&&delete e.local}return e}autoMergeDocument(e){return function(g){return(!g.remote||!g.remote.revision||g.remote.revision===g.common.revision)&&(g.common.body===void 0&&g.remote.body===!1||g.remote.body===g.common.body&&g.remote.contentType===g.common.contentType)}(e)?delete(e=function(g){return g.remote&&g.remote.body===!1&&g.local&&g.local.body===!1&&delete g.local,g}(e)).remote:e.remote.body!==void 0&&((0,_.default)("[Sync] Emitting keep/revert"),this.rs.local._emitChange({origin:"conflict",path:e.path,oldValue:e.local.body,newValue:e.remote.body,lastCommonValue:e.common.body,oldContentType:e.local.contentType,newContentType:e.remote.contentType,lastCommonContentType:e.common.contentType}),e.remote.body?e.common=e.remote:e.common={},delete e.remote,delete e.local),e}autoMerge(e){if(e.remote){if(e.local)return(0,R.isFolder)(e.path)?this.autoMergeFolder(e):this.autoMergeDocument(e);if((0,R.isFolder)(e.path))e.remote.itemsMap!==void 0&&(e.common=e.remote,delete e.remote);else if(e.remote.body!==void 0){const g={origin:"remote",path:e.path,oldValue:e.common.body===!1?void 0:e.common.body,newValue:e.remote.body===!1?void 0:e.remote.body,oldContentType:e.common.contentType,newContentType:e.remote.contentType};if((g.oldValue||g.newValue)&&this.rs.local._emitChange(g),!e.remote.body)return;e.common=e.remote,delete e.remote}return e}e.common.body&&this.rs.local._emitChange({origin:"remote",path:e.path,oldValue:e.common.body,newValue:void 0,oldContentType:e.common.contentType,newContentType:void 0})}updateCommonTimestamp(e,g){return u(this,void 0,void 0,function*(){return this.rs.local.getNodes([e]).then(y=>(y[e]&&y[e].common&&y[e].common.revision===g&&(y[e].common.timestamp=this.now()),this.rs.local.setNodes(this.flush(y))))})}markChildren(e,g,y,L){return u(this,void 0,void 0,function*(){const j=[],B={},z={};for(const J in g)j.push(e+J),B[e+J]=g[J];for(const J in L)j.push(e+J);return this.rs.local.getNodes(j).then(J=>{let C,A;for(const E in J)if(A=J[E],B[E])A&&A.common?w(A,B[E].ETag)&&(y[E]=(0,R.deepClone)(A),y[E].remote={revision:B[E].ETag,timestamp:this.now()},y[E]=this.autoMerge(y[E])):(C=this.rs.caching.checkPath(E),C==="ALL"&&(y[E]={path:E,common:{timestamp:this.now()},remote:{revision:B[E].ETag,timestamp:this.now()}})),y[E]&&B[E]["Content-Type"]&&(y[E].remote.contentType=B[E]["Content-Type"]),y[E]&&B[E]["Content-Length"]&&(y[E].remote.contentLength=B[E]["Content-Length"]);else if(L[E.substring(e.length)]&&A&&A.common){if(A.common.itemsMap)for(const n in A.common.itemsMap)z[E+n]=!0;if(A.local&&A.local.itemsMap)for(const n in A.local.itemsMap)z[E+n]=!0;if(A.remote||(0,R.isFolder)(E))y[E]=void 0;else if(y[E]=this.autoMerge(A),y[E]===void 0){const n=this.getParentPath(E),o=y[n],b=E.substring(e.length);o&&o.local&&(delete o.local.itemsMap[b],(0,R.equal)(o.local.itemsMap,o.common.itemsMap)&&delete o.local)}}return this.deleteRemoteTrees(Object.keys(z),y).then(E=>this.rs.local.setNodes(this.flush(E)))})})}deleteRemoteTrees(e,g){return u(this,void 0,void 0,function*(){return e.length===0?Promise.resolve(g):this.rs.local.getNodes(e).then(y=>u(this,void 0,void 0,function*(){const L={};function j(B,z){if(B&&B.itemsMap)for(const J in B.itemsMap)L[z+J]=!0}for(const B in y){const z=y[B];z&&((0,R.isFolder)(B)?(j(z.common,B),j(z.local,B)):z.common&&typeof z.common.body!==void 0&&(g[B]=(0,R.deepClone)(z),g[B].remote={body:!1,timestamp:this.now()},g[B]=this.autoMerge(g[B])))}return this.deleteRemoteTrees(Object.keys(L),g).then(B=>this.rs.local.setNodes(this.flush(B)))}))})}completeFetch(e,g,y,L){return u(this,void 0,void 0,function*(){let j,B;const z=(0,R.pathsFromRoot)(e);return(0,R.isFolder)(e)?j=[e]:(B=z[1],j=[e,B]),this.rs.local.getNodes(j).then(J=>{let C,A,E=J[e];const n={};function o(b){if(b&&b.itemsMap)for(C in b.itemsMap)g[C]||(n[C]=!0)}if(typeof E=="object"&&E.path===e&&typeof E.common=="object"||(E={path:e,common:{}},J[e]=E),E.remote={revision:L,timestamp:this.now()},(0,R.isFolder)(e))for(C in o(E.common),o(E.remote),E.remote.itemsMap={},g)E.remote.itemsMap[C]=!0;else E.remote.body=g,E.remote.contentType=y,A=J[B],A&&A.local&&A.local.itemsMap&&(C=e.substring(B.length),A.local.itemsMap[C]=!0,(0,R.equal)(A.local.itemsMap,A.common.itemsMap)&&delete A.local);return J[e]=this.autoMerge(E),{toBeSaved:J,missingChildren:n}})})}completePush(e,g,y,L){return u(this,void 0,void 0,function*(){return this.rs.local.getNodes([e]).then(j=>{const B=j[e];if(!B.push)throw this.stopped=!0,new Error("completePush called but no push version!");return y?((0,_.default)("[Sync] We have a conflict"),B.remote&&B.remote.revision===L||(B.remote={revision:L||"conflict",timestamp:this.now()},delete B.push),j[e]=this.autoMerge(B)):(B.common={revision:L,timestamp:this.now()},g==="put"?(B.common.body=B.push.body,B.common.contentType=B.push.contentType,(0,R.equal)(B.local.body,B.push.body)&&B.local.contentType===B.push.contentType&&delete B.local,delete B.push):g==="delete"&&(B.local.body===!1?j[e]=void 0:delete B.push)),this.rs.local.setNodes(this.flush(j))})})}dealWithFailure(e){return u(this,void 0,void 0,function*(){return this.rs.local.getNodes([e]).then(g=>{if(g[e])return delete g[e].push,this.rs.local.setNodes(this.flush(g))})})}interpretStatus(e){const g={statusCode:e,successful:void 0,conflict:void 0,unAuth:void 0,notFound:void 0,changed:void 0,networkProblems:void 0};if(typeof e=="string"&&(e==="offline"||e==="timeout"))return g.successful=!1,g.networkProblems=!0,g;if(typeof e=="number"){const y=Math.floor(e/100);return g.successful=y===2||e===304||e===412||e===404,g.conflict=e===412,g.unAuth=e===401&&this.rs.remote.token!==c.default.IMPLIED_FAKE_TOKEN||e===402||e===403,g.notFound=e===404,g.changed=e!==304,g}}handleGetResponse(e,g,y,L,j){return u(this,void 0,void 0,function*(){return g.notFound&&(y=!!(0,R.isFolder)(e)&&{}),g.changed?this.completeFetch(e,y,L,j).then(B=>(0,R.isFolder)(e)?this.corruptServerItemsMap(y)?((0,_.default)("[Sync] WARNING: Discarding corrupt folder description from server for "+e),!1):this.markChildren(e,y,B.toBeSaved,B.missingChildren).then(()=>!0):this.rs.local.setNodes(this.flush(B.toBeSaved)).then(()=>!0)):this.updateCommonTimestamp(e,j).then(()=>!0)})}handleResponse(e,g,y){const L=this.interpretStatus(y.statusCode);if(L.successful){if(g==="get")return this.handleGetResponse(e,L,y.body,y.contentType,y.revision);if(g==="put"||g==="delete")return this.completePush(e,g,L.conflict,y.revision).then(function(){return!0});throw new Error("cannot handle response for unknown action "+g)}{let j;return j=L.unAuth?new k.default:L.networkProblems?new O.default("Network request failed."):new Error("HTTP response code "+L.statusCode+" received."),this.dealWithFailure(e).then(()=>{throw this.rs._emit("error",j),j})}}finishTask(e,g=!0){if(e.action!==void 0){if(!(g&&((0,_.default)("[Sync] queue finished task:",e.path),this._finishedTasks.push(e),this._finishedTasks.length>1)))return(0,_.default)("[Sync] run task:",e.path),e.promise.then(y=>this.handleResponse(e.path,e.action,y),y=>((0,_.default)("[Sync] wireclient rejects its promise!",e.path,e.action,y),this.handleResponse(e.path,e.action,{statusCode:"offline"}))).then(y=>{if(this._finishedTasks.shift(),delete this._timeStarted[e.path],delete this._running[e.path],y&&this._tasks[e.path]){for(let L=0;L<this._tasks[e.path].length;L++)this._tasks[e.path][L]();delete this._tasks[e.path]}this.rs._emit("sync-req-done"),this._finishedTasks.length>0?this.finishTask(this._finishedTasks[0],!1):this.collectTasks(!1).then(()=>{!this.hasTasks()||this.stopped?((0,_.default)("[Sync] Sync is done! Reschedule?",Object.getOwnPropertyNames(this._tasks).length,this.stopped),this.done||(this.done=!0,this.rs._emit("sync-done"))):setTimeout(()=>{this.doTasks()},10)})},y=>{(0,_.default)("[Sync] Error",y),this._finishedTasks.shift(),delete this._timeStarted[e.path],delete this._running[e.path],this.rs._emit("sync-req-done"),this._finishedTasks.length>0?this.finishTask(this._finishedTasks[0],!1):this.done||(this.done=!0,this.rs._emit("sync-done"))});(0,_.default)("[Sync] delaying finished task:",e.path)}else delete this._running[e.path]}doTasks(){let e,g,y=0;e=this.rs.remote.connected?this.rs.remote.online?this.numThreads:1:0;const L=e-Object.getOwnPropertyNames(this._running).length;if(L<=0)return!0;for(g in this._tasks)if(!this._running[g]&&(this._timeStarted[g]=this.now(),this._running[g]=this.doTask(g),this._running[g].then(this.finishTask.bind(this)),y++,y>=L))return!0;return y>=L}collectTasks(e){return u(this,void 0,void 0,function*(){return this.hasTasks()||this.stopped?Promise.resolve():this.collectDiffTasks().then(g=>g||e===!1?Promise.resolve():this.collectRefreshTasks(),function(g){throw g})})}addTask(e,g){this._tasks[e]||(this._tasks[e]=[]),typeof g=="function"&&this._tasks[e].push(g)}sync(){return this.done=!1,this.doTasks()?Promise.resolve():this.collectTasks().then(()=>{try{this.doTasks()}catch(e){(0,_.default)("[Sync] doTasks error",e)}},function(e){throw(0,_.default)("[Sync] Sync error",e),new Error("Local cache unavailable")})}static _rs_init(e){h=function(){(0,_.default)("[Sync] syncCycleCb calling syncCycle");const g=new m.default;g.isBrowser()&&function(y,L){function j(B){const z=L.getCurrentSyncInterval();M.default.isBackground=!B;const J=L.getCurrentSyncInterval();L._emit("sync-interval-change",{oldValue:z,newValue:J})}y.on("background",()=>j(!1)),y.on("foreground",()=>j(!0))}(g,e),e.sync||(e.sync=new N(e),e.syncStopped&&((0,_.default)("[Sync] Instantiating sync stopped"),e.sync.stopped=!0,delete e.syncStopped)),(0,_.default)("[Sync] syncCycleCb calling syncCycle"),e.syncCycle()},p=function(){e.removeEventListener("connected",p),e.startSync()},e.on("ready",h),e.on("connected",p)}static _rs_cleanup(e){e.stopSync(),e.removeEventListener("ready",h),e.removeEventListener("connected",p),e.sync=void 0,delete e.sync}}(0,R.applyMixins)(N,[x.default]),a.exports=N},function(a,i,f){(function(u){var v=this&&this.__awaiter||function(R,h,p,l){return new(p||(p=Promise))(function(w,T){function N(g){try{e(l.next(g))}catch(y){T(y)}}function S(g){try{e(l.throw(g))}catch(y){T(y)}}function e(g){var y;g.done?w(g.value):(y=g.value,y instanceof p?y:new p(function(L){L(y)})).then(N,S)}e((l=l.apply(R,h||[])).next())})},M=this&&this.__importDefault||function(R){return R&&R.__esModule?R:{default:R}};const m=M(f(2)),x=M(f(11)),_=M(f(1)),c=f(0);let O;class k extends x.default{constructor(h){super(),this.addEvents(["change","local-events-done"]),this.db=h||O,this.db?(this.getsRunning=0,this.putsRunning=0,this.changesQueued={},this.changesRunning={},this.commitSlownessWarning=null):(0,_.default)("[IndexedDB] Failed to open DB")}getNodes(h){return v(this,void 0,void 0,function*(){const p=[],l={};for(let w=0,T=h.length;w<T;w++)this.changesQueued[h[w]]!==void 0?l[h[w]]=(0,c.deepClone)(this.changesQueued[h[w]]||void 0):this.changesRunning[h[w]]!==void 0?l[h[w]]=(0,c.deepClone)(this.changesRunning[h[w]]||void 0):p.push(h[w]);return p.length>0?this.getNodesFromDb(p).then(function(w){for(const T in l)w[T]=l[T];return w}):Promise.resolve(l)})}setNodes(h){return v(this,void 0,void 0,function*(){for(const p in h)this.changesQueued[p]=h[p]||!1;return this.maybeFlush(),Promise.resolve()})}maybeFlush(){this.putsRunning===0?this.flushChangesQueued():this.commitSlownessWarning||(this.commitSlownessWarning=u.setInterval(function(){console.warn("WARNING: waited more than 10 seconds for previous commit to finish")},1e4))}flushChangesQueued(){this.commitSlownessWarning&&(clearInterval(this.commitSlownessWarning),this.commitSlownessWarning=null),Object.keys(this.changesQueued).length>0&&(this.changesRunning=this.changesQueued,this.changesQueued={},this.setNodesInDb(this.changesRunning).then(this.flushChangesQueued.bind(this)))}getNodesFromDb(h){return new Promise((p,l)=>{const w=this.db.transaction(["nodes"],"readonly"),T=w.objectStore("nodes"),N={};this.getsRunning++,h.map(S=>{T.get(S).onsuccess=e=>{N[S]=e.target.result}}),w.oncomplete=()=>{p(N),this.getsRunning--},w.onerror=w.onabort=()=>{l("get transaction error/abort"),this.getsRunning--}})}setNodesInDb(h){return v(this,void 0,void 0,function*(){return new Promise((p,l)=>{const w=this.db.transaction(["nodes"],"readwrite"),T=w.objectStore("nodes"),N=new Date().getTime();this.putsRunning++,(0,_.default)("[IndexedDB] Starting put",h,this.putsRunning);for(const S in h){const e=h[S];if(typeof e=="object")try{T.put(e)}catch(g){throw(0,_.default)("[IndexedDB] Error while putting",e,g),g}else try{T.delete(S)}catch(g){throw(0,_.default)("[IndexedDB] Error while removing",T,e,g),g}}w.oncomplete=()=>{this.putsRunning--,(0,_.default)("[IndexedDB] Finished put",h,this.putsRunning,new Date().getTime()-N+"ms"),p()},w.onerror=()=>{this.putsRunning--,l("transaction error")},w.onabort=()=>{l("transaction abort"),this.putsRunning--}})})}reset(h){const p=this.db.name;this.db.close(),k.clean(this.db.name,()=>{k.open(p,(l,w)=>{l?(0,_.default)("[IndexedDB] Error while resetting local storage",l):this.db=w,typeof h=="function"&&h(self)})})}forAllNodes(h){return v(this,void 0,void 0,function*(){return new Promise(p=>{this.db.transaction(["nodes"],"readonly").objectStore("nodes").openCursor().onsuccess=l=>{const w=l.target.result;w?(h(this.migrate(w.value)),w.continue()):p()}})})}closeDB(){this.putsRunning===0?this.db.close():setTimeout(this.closeDB.bind(this),100)}static open(h,p){const l=setTimeout(function(){p("timeout trying to open db")},1e4);try{const w=indexedDB.open(h,2);w.onerror=function(){(0,_.default)("[IndexedDB] Opening DB failed",w),clearTimeout(l),p(w.error)},w.onupgradeneeded=function(T){const N=w.result;(0,_.default)("[IndexedDB] Upgrade: from ",T.oldVersion," to ",T.newVersion),T.oldVersion!==1&&((0,_.default)("[IndexedDB] Creating object store: nodes"),N.createObjectStore("nodes",{keyPath:"path"})),(0,_.default)("[IndexedDB] Creating object store: changes"),N.createObjectStore("changes",{keyPath:"path"})},w.onsuccess=function(){clearTimeout(l);const T=w.result;if(!T.objectStoreNames.contains("nodes")||!T.objectStoreNames.contains("changes"))return(0,_.default)("[IndexedDB] Missing object store. Resetting the database."),void k.clean(h,function(){k.open(h,p)});p(null,w.result)}}catch(w){(0,_.default)("[IndexedDB] Failed to open database: "+w),(0,_.default)("[IndexedDB] Resetting database and trying again."),clearTimeout(l),k.clean(h,function(){k.open(h,p)})}}static clean(h,p){const l=indexedDB.deleteDatabase(h);l.onsuccess=function(){(0,_.default)("[IndexedDB] Done removing DB"),p()},l.onerror=l.onabort=function(w){console.error('Failed to remove database "'+h+'"',w)}}static _rs_init(h){return new Promise((p,l)=>{k.open("remotestorage",function(w,T){w?l(w):(O=T,T.onerror=()=>{h._emit("error",w)},p())})})}static _rs_supported(){return new Promise((h,p)=>{const l=(0,c.getGlobalContext)();let w=!1;if(typeof navigator<"u"&&navigator.userAgent.match(/Android (2|3|4\.[0-3])/)&&(navigator.userAgent.match(/Chrome|Firefox/)||(w=!0)),"indexedDB"in l&&!w)try{const T=indexedDB.open("rs-check");T.onerror=function(){p()},T.onsuccess=function(){T.result.close(),indexedDB.deleteDatabase("rs-check"),h()}}catch{p()}else p()})}static _rs_cleanup(h){return new Promise(p=>{h.local&&h.local.closeDB(),k.clean("remotestorage",p)})}diffHandler(){}}(0,c.applyMixins)(k,[m.default]),a.exports=k}).call(this,f(6))},function(a,i,f){var u=this&&this.__importDefault||function(k){return k&&k.__esModule?k:{default:k}};const v=u(f(11)),M=u(f(2)),m=u(f(1)),x=f(0),_="remotestorage:cache:nodes:";function c(k){return k.substr(0,_.length)===_||k.substr(0,28)==="remotestorage:cache:changes:"}class O extends v.default{constructor(){super(),this.addEvents(["change","local-events-done"])}diffHandler(...R){}getNodes(R){const h={};for(let p=0,l=R.length;p<l;p++)try{h[R[p]]=JSON.parse(localStorage[_+R[p]])}catch{h[R[p]]=void 0}return Promise.resolve(h)}setNodes(R){for(const h in R)localStorage[_+h]=JSON.stringify(R[h]);return Promise.resolve()}forAllNodes(R){let h;for(let p=0,l=localStorage.length;p<l;p++)if(localStorage.key(p).substr(0,_.length)===_){try{h=this.migrate(JSON.parse(localStorage[localStorage.key(p)]))}catch{h=void 0}h&&R(h)}return Promise.resolve()}static _rs_init(){}static _rs_supported(){return(0,x.localStorageAvailable)()}static _rs_cleanup(){const R=[];for(let h=0,p=localStorage.length;h<p;h++){const l=localStorage.key(h);c(l)&&R.push(l)}R.forEach(h=>{(0,m.default)("[LocalStorage] Removing",h),delete localStorage[h]})}}(0,x.applyMixins)(O,[M.default]),a.exports=O},function(a,i,f){var u=this&&this.__importDefault||function(_){return _&&_.__esModule?_:{default:_}};const v=u(f(2)),M=u(f(11)),m=f(0);class x extends M.default{constructor(){super(),this._storage={},this.addEvents(["change","local-events-done"])}getNodes(c){const O={};for(let k=0,R=c.length;k<R;k++)O[c[k]]=(0,m.deepClone)(this._storage[c[k]]);return Promise.resolve(O)}setNodes(c){for(const O in c)c[O]===void 0?delete this._storage[O]:this._storage[O]=c[O];return Promise.resolve()}forAllNodes(c){for(const O in this._storage)c(this.migrate(this._storage[O]));return Promise.resolve()}diffHandler(){}static _rs_init(){}static _rs_supported(){return!0}static _rs_cleanup(){}}(0,m.applyMixins)(x,[v.default]),a.exports=x}])})})(Rr);const Ir=kr(ee),Wt=new Ir;Wt.setApiKeys({dropbox:Tr,googledrive:Ar});const ie=Ee([]),Mr=ie;function Mn(P,t="error",a=5e3){const i=xr();return ie.update(f=>[...f,{id:i,message:P,type:t}]),setTimeout(()=>Ae(i),a),i}function Ae(P){ie.update(t=>{const a=t.findIndex(i=>i.id===P);return a===-1||(t=t.slice(),t.splice(a,1)),t})}const Kt=Ee(!1),Or=$e(Kt,P=>P);Wt.addEventListener("sync-req-done",()=>{Kt.set(!0)});Wt.addEventListener("sync-done",()=>{Kt.set(!1)});window.addEventListener("beforeunload",P=>{if(Re(Kt)){const t="It looks like you have been editing something. If you leave before saving, your changes will be lost.";return(P||window.event).returnValue=t,t}});function Cr(P){let t;return{c(){t=ut("div"),this.h()},l(a){t=ct(a,"DIV",{id:!0}),st(t).forEach(X),this.h()},h(){K(t,"id",Se)},m(a,i){pt(a,t,i)},p:Et,i:Et,o:Et,d(a){a&&X(t)}}}const Se="remote-storage-widget";let Zt;function Nr(P,t,a){let{element:i=void 0}=t,{widget:f=void 0}=t;return Ie(()=>{qe(()=>import("./widget.b2efbc62.js").then(u=>u.w),[],import.meta.url).then(({default:u})=>{var M;Zt&&((M=Zt.rsWidget)==null||M.remove());const v=new u(Wt);v.attach(Se),Zt=v,function m(){v.rsWidget?(a(1,f=v),a(0,i=v.rsWidget)):setTimeout(m,300)}()})}),P.$$set=u=>{"element"in u&&a(0,i=u.element),"widget"in u&&a(1,f=u.widget)},[i,f]}class Ur extends Pt{constructor(t){super(),xt(this,t,Nr,Cr,Bt,{element:0,widget:1})}}function jr(P){let t,a,i,f;return{c(){t=ut("div"),a=kt("svg"),i=kt("circle"),f=kt("path"),this.h()},l(u){t=ct(u,"DIV",{class:!0});var v=st(t);a=Rt(v,"svg",{class:!0,xmlns:!0,fill:!0,viewBox:!0});var M=st(a);i=Rt(M,"circle",{class:!0,cx:!0,cy:!0,r:!0,stroke:!0,"stroke-width":!0}),st(i).forEach(X),f=Rt(M,"path",{class:!0,fill:!0,d:!0}),st(f).forEach(X),M.forEach(X),v.forEach(X),this.h()},h(){K(i,"class","opacity-25"),K(i,"cx","12"),K(i,"cy","12"),K(i,"r","10"),K(i,"stroke","currentColor"),K(i,"stroke-width","4"),K(f,"class","opacity-75"),K(f,"fill","currentColor"),K(f,"d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"),K(a,"class","animate-spin text-black"),K(a,"xmlns","http://www.w3.org/2000/svg"),K(a,"fill","none"),K(a,"viewBox","0 0 24 24"),K(t,"class","w-8 h-8")},m(u,v){pt(u,t,v),et(t,a),et(a,i),et(a,f)},p:Et,i:Et,o:Et,d(u){u&&X(t)}}}class Dr extends Pt{constructor(t){super(),xt(this,t,null,jr,jt,{})}}function fe(P){let t,a;return t=new Dr({}),{c(){gt(t.$$.fragment)},l(i){yt(t.$$.fragment,i)},m(i,f){vt(t,i,f),a=!0},i(i){a||(lt(t.$$.fragment,i),a=!0)},o(i){ht(t.$$.fragment,i),a=!1},d(i){_t(t,i)}}}function Fr(P){let t,a,i,f,u=new Date().getFullYear()+"",v,M,m,x,_,c,O,k,R,h,p,l,w,T,N,S,e,g,y,L;e=new Ur({});let j=P[0]&&fe();return{c(){t=ut("div"),a=ut("div"),i=ut("div"),f=At(" "),v=At(u),M=Mt(),m=ut("a"),x=At("aicacia.github.io/journal"),_=Mt(),c=ut("div"),O=ut("a"),k=At("Source Code"),R=At(`
			|
			`),h=ut("a"),p=At("Privacy Policy"),l=At(`
			|
			`),w=ut("a"),T=At("Terms of Service"),N=Mt(),S=ut("div"),gt(e.$$.fragment),g=Mt(),y=ut("div"),j&&j.c(),this.h()},l(B){t=ct(B,"DIV",{class:!0});var z=st(t);a=ct(z,"DIV",{class:!0});var J=st(a);i=ct(J,"DIV",{class:!0});var C=st(i);f=St(C," "),v=St(C,u),M=Ot(C),m=ct(C,"A",{href:!0});var A=st(m);x=St(A,"aicacia.github.io/journal"),A.forEach(X),C.forEach(X),_=Ot(J),c=ct(J,"DIV",{class:!0});var E=st(c);O=ct(E,"A",{target:!0,href:!0});var n=st(O);k=St(n,"Source Code"),n.forEach(X),R=St(E,`
			|
			`),h=ct(E,"A",{target:!0,href:!0});var o=st(h);p=St(o,"Privacy Policy"),o.forEach(X),l=St(E,`
			|
			`),w=ct(E,"A",{target:!0,href:!0});var b=st(w);T=St(b,"Terms of Service"),b.forEach(X),E.forEach(X),J.forEach(X),N=Ot(z),S=ct(z,"DIV",{class:!0});var I=st(S);yt(e.$$.fragment,I),I.forEach(X),g=Ot(z),y=ct(z,"DIV",{class:!0});var U=st(y);j&&j.l(U),U.forEach(X),z.forEach(X),this.h()},h(){K(m,"href",Qt),K(i,"class","text-center text-xs mt-8"),K(O,"target","_blank"),K(O,"href","https://github.com/aicacia/journal"),K(h,"target","_blank"),K(h,"href",`${Qt}/privacy-policy`),K(w,"target","_blank"),K(w,"href",`${Qt}/terms-of-service`),K(c,"class","text-center text-xs my-2"),K(a,"class","absolute bottom-0 w-full"),K(S,"class","absolute left-0 bottom-0"),K(y,"class","absolute right-4 bottom-4"),K(t,"class","absolute bottom-0 w-full flex z-[1000]")},m(B,z){pt(B,t,z),et(t,a),et(a,i),et(i,f),et(i,v),et(i,M),et(i,m),et(m,x),et(a,_),et(a,c),et(c,O),et(O,k),et(c,R),et(c,h),et(h,p),et(c,l),et(c,w),et(w,T),et(t,N),et(t,S),vt(e,S,null),et(t,g),et(t,y),j&&j.m(y,null),L=!0},p(B,[z]){B[0]?j?z&1&&lt(j,1):(j=fe(),j.c(),lt(j,1),j.m(y,null)):j&&(re(),ht(j,1,1,()=>{j=null}),ne())},i(B){L||(lt(e.$$.fragment,B),lt(j),L=!0)},o(B){ht(e.$$.fragment,B),ht(j),L=!1},d(B){B&&X(t),_t(e),j&&j.d()}}}function Lr(P,t,a){let i;return be(P,Or,f=>a(0,i=f)),[i]}class Br extends Pt{constructor(t){super(),xt(this,t,Lr,Fr,Bt,{})}}function ke(P){const t=P-1;return t*t*t+1}function de(P,{delay:t=0,duration:a=400,easing:i=ke,x:f=0,y:u=0,opacity:v=0}={}){const M=getComputedStyle(P),m=+M.opacity,x=M.transform==="none"?"":M.transform,_=m*(1-v),[c,O]=ue(f),[k,R]=ue(u);return{delay:t,duration:a,easing:i,css:(h,p)=>`
			transform: ${x} translate(${(1-h)*c}${O}, ${(1-h)*k}${R});
			opacity: ${m-_*p}`}}function $r(P,{from:t,to:a},i={}){const f=getComputedStyle(P),u=f.transform==="none"?"":f.transform,[v,M]=f.transformOrigin.split(" ").map(parseFloat),m=t.left+t.width*v/a.width-(a.left+v),x=t.top+t.height*M/a.height-(a.top+M),{delay:_=0,duration:c=k=>Math.sqrt(k)*120,easing:O=ke}=i;return{delay:_,duration:Me(c)?c(Math.sqrt(m*m+x*x)):c,easing:O,css:(k,R)=>{const h=R*m,p=R*x,l=k+R*t.width/a.width,w=k+R*t.height/a.height;return`transform: ${u} translate(${h}px, ${p}px) scale(${l}, ${w});`}}}function qr(P){let t;return{c(){t=kt("path"),this.h()},l(a){t=Rt(a,"path",{d:!0}),st(t).forEach(X),this.h()},h(){K(t,"d","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z")},m(a,i){pt(a,t,i)},p:Et,d(a){a&&X(t)}}}function Vr(P){let t,a;const i=[{viewBox:"0 0 24 24"},P[0]];let f={$$slots:{default:[qr]},$$scope:{ctx:P}};for(let u=0;u<i.length;u+=1)f=wt(f,i[u]);return t=new Gt({props:f}),{c(){gt(t.$$.fragment)},l(u){yt(t.$$.fragment,u)},m(u,v){vt(t,u,v),a=!0},p(u,[v]){const M=v&1?Vt(i,[i[0],Jt(u[0])]):{};v&2&&(M.$$scope={dirty:v,ctx:u}),t.$set(M)},i(u){a||(lt(t.$$.fragment,u),a=!0)},o(u){ht(t.$$.fragment,u),a=!1},d(u){_t(t,u)}}}function Jr(P,t,a){return P.$$set=i=>{a(0,t=wt(wt({},t),Ct(i)))},t=Ct(t),[t]}class Gr extends Pt{constructor(t){super(),xt(this,t,Jr,Vr,jt,{})}}function zr(P){let t;return{c(){t=kt("path"),this.h()},l(a){t=Rt(a,"path",{d:!0}),st(t).forEach(X),this.h()},h(){K(t,"d","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z")},m(a,i){pt(a,t,i)},p:Et,d(a){a&&X(t)}}}function Hr(P){let t,a;const i=[{viewBox:"0 0 24 24"},P[0]];let f={$$slots:{default:[zr]},$$scope:{ctx:P}};for(let u=0;u<i.length;u+=1)f=wt(f,i[u]);return t=new Gt({props:f}),{c(){gt(t.$$.fragment)},l(u){yt(t.$$.fragment,u)},m(u,v){vt(t,u,v),a=!0},p(u,[v]){const M=v&1?Vt(i,[i[0],Jt(u[0])]):{};v&2&&(M.$$scope={dirty:v,ctx:u}),t.$set(M)},i(u){a||(lt(t.$$.fragment,u),a=!0)},o(u){ht(t.$$.fragment,u),a=!1},d(u){_t(t,u)}}}function Yr(P,t,a){return P.$$set=i=>{a(0,t=wt(wt({},t),Ct(i)))},t=Ct(t),[t]}class Wr extends Pt{constructor(t){super(),xt(this,t,Yr,Hr,jt,{})}}function Kr(P){let t;return{c(){t=kt("path"),this.h()},l(a){t=Rt(a,"path",{d:!0}),st(t).forEach(X),this.h()},h(){K(t,"d","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z")},m(a,i){pt(a,t,i)},p:Et,d(a){a&&X(t)}}}function Xr(P){let t,a;const i=[{viewBox:"0 0 24 24"},P[0]];let f={$$slots:{default:[Kr]},$$scope:{ctx:P}};for(let u=0;u<i.length;u+=1)f=wt(f,i[u]);return t=new Gt({props:f}),{c(){gt(t.$$.fragment)},l(u){yt(t.$$.fragment,u)},m(u,v){vt(t,u,v),a=!0},p(u,[v]){const M=v&1?Vt(i,[i[0],Jt(u[0])]):{};v&2&&(M.$$scope={dirty:v,ctx:u}),t.$set(M)},i(u){a||(lt(t.$$.fragment,u),a=!0)},o(u){ht(t.$$.fragment,u),a=!1},d(u){_t(t,u)}}}function Qr(P,t,a){return P.$$set=i=>{a(0,t=wt(wt({},t),Ct(i)))},t=Ct(t),[t]}class Zr extends Pt{constructor(t){super(),xt(this,t,Qr,Xr,jt,{})}}function tn(P){let t;return{c(){t=kt("path"),this.h()},l(a){t=Rt(a,"path",{d:!0}),st(t).forEach(X),this.h()},h(){K(t,"d","M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z")},m(a,i){pt(a,t,i)},p:Et,d(a){a&&X(t)}}}function en(P){let t,a;const i=[{viewBox:"0 0 24 24"},P[0]];let f={$$slots:{default:[tn]},$$scope:{ctx:P}};for(let u=0;u<i.length;u+=1)f=wt(f,i[u]);return t=new Gt({props:f}),{c(){gt(t.$$.fragment)},l(u){yt(t.$$.fragment,u)},m(u,v){vt(t,u,v),a=!0},p(u,[v]){const M=v&1?Vt(i,[i[0],Jt(u[0])]):{};v&2&&(M.$$scope={dirty:v,ctx:u}),t.$set(M)},i(u){a||(lt(t.$$.fragment,u),a=!0)},o(u){ht(t.$$.fragment,u),a=!1},d(u){_t(t,u)}}}function rn(P,t,a){return P.$$set=i=>{a(0,t=wt(wt({},t),Ct(i)))},t=Ct(t),[t]}class nn extends Pt{constructor(t){super(),xt(this,t,rn,en,jt,{})}}function on(P){let t,a;return t=new nn({}),{c(){gt(t.$$.fragment)},l(i){yt(t.$$.fragment,i)},m(i,f){vt(t,i,f),a=!0},i(i){a||(lt(t.$$.fragment,i),a=!0)},o(i){ht(t.$$.fragment,i),a=!1},d(i){_t(t,i)}}}function sn(P){let t,a;return t=new Zr({}),{c(){gt(t.$$.fragment)},l(i){yt(t.$$.fragment,i)},m(i,f){vt(t,i,f),a=!0},i(i){a||(lt(t.$$.fragment,i),a=!0)},o(i){ht(t.$$.fragment,i),a=!1},d(i){_t(t,i)}}}function an(P){let t,a;return t=new Wr({}),{c(){gt(t.$$.fragment)},l(i){yt(t.$$.fragment,i)},m(i,f){vt(t,i,f),a=!0},i(i){a||(lt(t.$$.fragment,i),a=!0)},o(i){ht(t.$$.fragment,i),a=!1},d(i){_t(t,i)}}}function un(P){let t,a;return t=new Gr({}),{c(){gt(t.$$.fragment)},l(i){yt(t.$$.fragment,i)},m(i,f){vt(t,i,f),a=!0},i(i){a||(lt(t.$$.fragment,i),a=!0)},o(i){ht(t.$$.fragment,i),a=!1},d(i){_t(t,i)}}}function cn(P){let t,a,i,f,u,v,M=P[0].message+"",m,x,_,c;const O=[un,an,sn,on],k=[];function R(h,p){return h[0].type==="error"?0:h[0].type==="success"?1:h[0].type==="info"?2:h[0].type==="warning"?3:-1}return~(i=R(P))&&(f=k[i]=O[i](P)),{c(){t=ut("div"),a=ut("div"),f&&f.c(),u=Mt(),v=ut("div"),m=At(M),this.h()},l(h){t=ct(h,"DIV",{class:!0});var p=st(t);a=ct(p,"DIV",{class:!0});var l=st(a);f&&f.l(l),l.forEach(X),u=Ot(p),v=ct(p,"DIV",{class:!0});var w=st(v);m=St(w,M),w.forEach(X),p.forEach(X),this.h()},h(){K(a,"class","as-w-6 as-h-6 as-mr-2 as-text-white"),K(v,"class","as-text-white as-max-w-xs "),K(t,"class","as-flex as-items-center as-py-2 as-px-3 as-m-1 as-cursor-pointer as-shadow"),It(t,"as-bg-green-500",P[0].type==="success"),It(t,"as-bg-red-500",P[0].type==="error"),It(t,"as-bg-blue-500",P[0].type==="info"),It(t,"as-bg-yellow-500",P[0].type==="warning")},m(h,p){pt(h,t,p),et(t,a),~i&&k[i].m(a,null),et(t,u),et(t,v),et(v,m),x=!0,_||(c=Oe(t,"click",P[1]),_=!0)},p(h,[p]){let l=i;i=R(h),i!==l&&(f&&(re(),ht(k[l],1,1,()=>{k[l]=null}),ne()),~i?(f=k[i],f||(f=k[i]=O[i](h),f.c()),lt(f,1),f.m(a,null)):f=null),(!x||p&1)&&M!==(M=h[0].message+"")&&we(m,M),(!x||p&1)&&It(t,"as-bg-green-500",h[0].type==="success"),(!x||p&1)&&It(t,"as-bg-red-500",h[0].type==="error"),(!x||p&1)&&It(t,"as-bg-blue-500",h[0].type==="info"),(!x||p&1)&&It(t,"as-bg-yellow-500",h[0].type==="warning")},i(h){x||(lt(f),x=!0)},o(h){ht(f),x=!1},d(h){h&&X(t),~i&&k[i].d(),_=!1,c()}}}function ln(P,t,a){let{notification:i}=t;function f(){Ae(i.id)}return P.$$set=u=>{"notification"in u&&a(0,i=u.notification)},[i,f]}class hn extends Pt{constructor(t){super(),xt(this,t,ln,cn,Bt,{notification:0})}}function pe(P,t,a){const i=P.slice();return i[1]=t[a],i}function me(P,t){let a,i,f,u,v,M,m=Et,x;return i=new hn({props:{notification:t[1]}}),{key:P,first:null,c(){a=ut("div"),gt(i.$$.fragment),f=Mt(),this.h()},l(_){a=ct(_,"DIV",{class:!0});var c=st(a);yt(i.$$.fragment,c),f=Ot(c),c.forEach(X),this.h()},h(){K(a,"class","as-w-full"),this.first=a},m(_,c){pt(_,a,c),vt(i,a,null),et(a,f),x=!0},p(_,c){t=_;const O={};c&1&&(O.notification=t[1]),i.$set(O)},r(){M=a.getBoundingClientRect()},f(){Ne(a),m(),Ue(a,M)},a(){m(),m=je(a,M,$r,{})},i(_){x||(lt(i.$$.fragment,_),De(()=>{x&&(v&&v.end(1),u=Fe(a,de,{y:-64,duration:300}),u.start())}),x=!0)},o(_){ht(i.$$.fragment,_),u&&u.invalidate(),v=Le(a,de,{y:-64,duration:300}),x=!1},d(_){_&&X(a),_t(i),_&&v&&v.end()}}}function fn(P){let t,a,i=[],f=new Map,u,v=P[0];const M=m=>m[1].id;for(let m=0;m<v.length;m+=1){let x=pe(P,v,m),_=M(x);f.set(_,i[m]=me(_,x))}return{c(){t=ut("div"),a=ut("div");for(let m=0;m<i.length;m+=1)i[m].c();this.h()},l(m){t=ct(m,"DIV",{class:!0});var x=st(t);a=ct(x,"DIV",{class:!0});var _=st(a);for(let c=0;c<i.length;c+=1)i[c].l(_);_.forEach(X),x.forEach(X),this.h()},h(){K(a,"class","as-container as-mx-auto"),K(t,"class","as-fixed as-top-0 as-left-0 z-20 as-w-full")},m(m,x){pt(m,t,x),et(t,a);for(let _=0;_<i.length;_+=1)i[_]&&i[_].m(a,null);u=!0},p(m,[x]){if(x&1){v=m[0],re();for(let _=0;_<i.length;_+=1)i[_].r();i=Ce(i,x,M,1,m,v,f,a,Be,me,null,pe);for(let _=0;_<i.length;_+=1)i[_].a();ne()}},i(m){if(!u){for(let x=0;x<v.length;x+=1)lt(i[x]);u=!0}},o(m){for(let x=0;x<i.length;x+=1)ht(i[x]);u=!1},d(m){m&&X(t);for(let x=0;x<i.length;x+=1)i[x].d()}}}function dn(P,t,a){let i;return be(P,Mr,f=>a(0,i=f)),[i]}class pn extends Pt{constructor(t){super(),xt(this,t,dn,fn,Bt,{})}}function mn(P){let t,a,i,f,u,v,M,m;const x=P[1].default,_=ge(x,P,P[0],null);return u=new Br({}),M=new pn({}),{c(){t=ut("div"),a=ut("div"),i=ut("div"),_&&_.c(),f=Mt(),gt(u.$$.fragment),v=Mt(),gt(M.$$.fragment),this.h()},l(c){t=ct(c,"DIV",{class:!0});var O=st(t);a=ct(O,"DIV",{class:!0});var k=st(a);i=ct(k,"DIV",{class:!0});var R=st(i);_&&_.l(R),R.forEach(X),k.forEach(X),O.forEach(X),f=Ot(c),yt(u.$$.fragment,c),v=Ot(c),yt(M.$$.fragment,c),this.h()},h(){K(i,"class","flex flex-col w-full h-full overflow-hidden"),K(a,"class","flex flex-col w-full h-full"),K(t,"class","relative flex w-full h-full")},m(c,O){pt(c,t,O),et(t,a),et(a,i),_&&_.m(i,null),pt(c,f,O),vt(u,c,O),pt(c,v,O),vt(M,c,O),m=!0},p(c,[O]){_&&_.p&&(!m||O&1)&&ye(_,x,c,c[0],m?_e(x,c[0],O,null):ve(c[0]),null)},i(c){m||(lt(_,c),lt(u.$$.fragment,c),lt(M.$$.fragment,c),m=!0)},o(c){ht(_,c),ht(u.$$.fragment,c),ht(M.$$.fragment,c),m=!1},d(c){c&&X(t),_&&_.d(c),c&&X(f),_t(u,c),c&&X(v),_t(M,c)}}}function gn(P,t,a){let{$$slots:i={},$$scope:f}=t;return P.$$set=u=>{"$$scope"in u&&a(0,f=u.$$scope)},[f,i]}class On extends Pt{constructor(t){super(),xt(this,t,gn,mn,Bt,{})}}export{Gt as I,On as L,Pn as a,bn as b,xr as c,Sr as d,kn as e,Rn as f,xn as g,Mn as h,rt as i,Tn as j,An as k,Or as l,Sn as m,En as n,kr as o,Wt as r,In as s};
