import{d as Ot,w as Mt}from"./paths.9b48cad6.js";import{a1 as Ct}from"./index.aef511b5.js";const Nt="lf5maxp3ghh4q1s",Ut="220951148444-5u4fja36i0dm85hcvipq6udm9msutf7n.apps.googleusercontent.com";var jt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ft(D){return D&&D.__esModule&&Object.prototype.hasOwnProperty.call(D,"default")?D.default:D}var bt={},Dt={get exports(){return bt},set exports(D){bt=D}};/*! remotestorage.js 2.0.0-beta.6, https://remotestorage.io, MIT licensed */(function(D,i){(function(P,I){D.exports=I()})(jt,function(){return function(P){var I={};function T(p){if(I[p])return I[p].exports;var x=I[p]={i:p,l:!1,exports:{}};return P[p].call(x.exports,x,x.exports,T),x.l=!0,x.exports}return T.m=P,T.c=I,T.d=function(p,x,q){T.o(p,x)||Object.defineProperty(p,x,{enumerable:!0,get:q})},T.r=function(p){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(p,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(p,"__esModule",{value:!0})},T.t=function(p,x){if(1&x&&(p=T(p)),8&x||4&x&&typeof p=="object"&&p&&p.__esModule)return p;var q=Object.create(null);if(T.r(q),Object.defineProperty(q,"default",{enumerable:!0,value:p}),2&x&&typeof p!="string")for(var v in p)T.d(q,v,function(k){return p[k]}.bind(null,v));return q},T.n=function(p){var x=p&&p.__esModule?function(){return p.default}:function(){return p};return T.d(x,"a",x),x},T.o=function(p,x){return Object.prototype.hasOwnProperty.call(p,x)},T.p="",T(T.s=18)}([function(P,I,T){(function(p,x){var q=this&&this.__awaiter||function(v,k,w,u){return new(w||(w=Promise))(function(N,S){function A(s){try{l(u.next(s))}catch(g){S(g)}}function c(s){try{l(u.throw(s))}catch(g){S(g)}}function l(s){var g;s.done?N(s.value):(g=s.value,g instanceof w?g:new w(function(y){y(g)})).then(A,c)}l((u=u.apply(v,k||[])).next())})};Object.defineProperty(I,"__esModule",{value:!0}),I.applyMixins=I.generateCodeVerifier=I.toBase64=I.getTextFromArrayBuffer=I.shouldBeTreatedAsBinary=I.getJSONFromLocalStorage=I.localStorageAvailable=I.pathsFromRoot=I.deepClone=I.equal=I.bindAll=I.cleanPath=I.baseName=I.isDocument=I.isFolder=I.containingFolder=I.extend=I.getGlobalContext=I.globalContext=I.logError=void 0,I.logError=v=>{typeof v=="string"?console.error(v):console.error(v.message,v.stack)},I.globalContext=typeof window<"u"?window:typeof self=="object"?self:p,I.getGlobalContext=()=>typeof window<"u"?window:typeof self=="object"?self:p,I.extend=(...v)=>{const k=v[0];return Array.prototype.slice.call(v,1).forEach(function(w){for(const u in w)k[u]=w[u]}),k},I.containingFolder=v=>{if(v==="")return"/";if(!v)throw"Path not given!";return v.replace(/\/+/g,"/").replace(/[^\/]+\/?$/,"")},I.isFolder=v=>v.slice(-1)==="/",I.isDocument=v=>!(0,I.isFolder)(v),I.baseName=v=>{const k=v.split("/");return(0,I.isFolder)(v)?k[k.length-2]+"/":k[k.length-1]},I.cleanPath=v=>v.replace(/\/+/g,"/").split("/").map(encodeURIComponent).join("/").replace(/'/g,"%27"),I.bindAll=v=>{for(const k in this)typeof v[k]=="function"&&(v[k]=v[k].bind(v))},I.equal=(v,k,w=[])=>{let u;if(typeof v!=typeof k)return!1;if(typeof v=="number"||typeof v=="boolean"||typeof v=="string")return v===k;if(typeof v=="function")return v.toString()===k.toString();if(v instanceof ArrayBuffer&&k instanceof ArrayBuffer&&(v=new Uint8Array(v),k=new Uint8Array(k)),v instanceof Array){if(v.length!==k.length)return!1;for(let N=0,S=v.length;N<S;N++)if(!(0,I.equal)(v[N],k[N],w))return!1}else{for(u in v)if(v.hasOwnProperty(u)&&!(u in k))return!1;for(u in k){if(!k.hasOwnProperty(u))continue;if(!(u in v))return!1;let N;if(typeof k[u]=="object"){if(w.indexOf(k[u])>=0)continue;N=w.slice(),N.push(k[u])}if(!(0,I.equal)(v[u],k[u],N))return!1}}return!0},I.deepClone=v=>{if(v!==void 0){const k=JSON.parse(JSON.stringify(v));return function w(u,N){if(typeof u=="object"&&!Array.isArray(u)&&u!==null){for(const S in u)if(typeof u[S]=="object"&&u[S]!==null)if(u[S].toString()==="[object ArrayBuffer]"){N[S]=new ArrayBuffer(u[S].byteLength);const A=new Int8Array(u[S]);new Int8Array(N[S]).set(A)}else w(u[S],N[S])}}(v,k),k}},I.pathsFromRoot=v=>{const k=[v],w=v.replace(/\/$/,"").split("/");for(;w.length>1;)w.pop(),k.push(w.join("/")+"/");return k},I.localStorageAvailable=()=>{const v=(0,I.getGlobalContext)();if(!("localStorage"in v))return!1;try{return v.localStorage.setItem("rs-check","1"),v.localStorage.removeItem("rs-check"),!0}catch{return!1}},I.getJSONFromLocalStorage=v=>{const k=(0,I.getGlobalContext)();try{return JSON.parse(k.localStorage.getItem(v))}catch{}},I.shouldBeTreatedAsBinary=(v,k)=>!!(k&&k.match(/charset=binary/)||/[\x00-\x08\x0E-\x1F\uFFFD]/.test(v)),I.getTextFromArrayBuffer=(v,k)=>new Promise(w=>{if(typeof Blob>"u"){const u=x.from(v);w(u.toString(k))}else{let u;const N=I.globalContext;if(N.BlobBuilder=N.BlobBuilder||N.WebKitBlobBuilder,N.BlobBuilder!==void 0){const A=new N.BlobBuilder;A.append(v),u=A.getBlob()}else u=new Blob([v]);const S=new FileReader;typeof S.addEventListener=="function"?S.addEventListener("loadend",function(A){w(A.target.result)}):S.onloadend=function(A){w(A.target.result)},S.readAsText(u,k)}}),I.toBase64=v=>{const k=(0,I.getGlobalContext)();return"btoa"in k?k.btoa(v):x.from(v).toString("base64")},I.generateCodeVerifier=function(v=128){return q(this,void 0,void 0,function*(){const k=new Uint8Array(v);crypto.getRandomValues(k);const w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",u=Array.from(k).map(s=>w[s%w.length]),N=u.join(""),S=Uint8Array.from(u.map(s=>s.charCodeAt(0))),A=yield crypto.subtle.digest("SHA-256",S),c=(l=A,btoa(String.fromCharCode.apply(null,new Uint8Array(l))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""));var l;return crypto.getRandomValues(k),{codeVerifier:N,codeChallenge:c,state:Array.from(k).map(s=>w[s%w.length]).join("")}})},I.applyMixins=function(v,k){k.forEach(w=>{Object.getOwnPropertyNames(w.prototype).forEach(u=>{Object.defineProperty(v.prototype,u,Object.getOwnPropertyDescriptor(w.prototype,u))})})}}).call(this,T(6),T(20).Buffer)},function(P,I,T){const p=(this&&this.__importDefault||function(x){return x&&x.__esModule?x:{default:x}})(T(3));P.exports=function(...x){p.default.logging&&console.log(...x)}},function(P,I,T){const p=(this&&this.__importDefault||function(x){return x&&x.__esModule?x:{default:x}})(T(1));P.exports=class{addEvents(x){x.forEach(q=>this._addEvent(q))}addEventListener(x,q){if(typeof x!="string")throw new Error("Argument eventName should be a string");if(typeof q!="function")throw new Error("Argument handler should be a function");(0,p.default)("[EventHandling] Adding event listener",x),this._validateEvent(x),this._handlers[x].push(q)}on(x,q){return this.addEventListener(x,q)}removeEventListener(x,q){this._validateEvent(x);const v=this._handlers[x].length;for(let k=0;k<v;k++)if(this._handlers[x][k]===q)return void this._handlers[x].splice(k,1)}_emit(x,...q){this._validateEvent(x),this._handlers[x].slice().forEach(v=>{v.apply(this,q)})}_validateEvent(x){if(!(x in this._handlers))throw new Error("Unknown event: "+x)}_delegateEvent(x,q){q.on(x,v=>{this._emit(x,v)})}_addEvent(x){this._handlers===void 0&&(this._handlers={}),this._handlers[x]=[]}}},function(P,I,T){const p={cache:!0,changeEvents:{local:!0,window:!1,remote:!0,conflict:!0},cordovaRedirectUri:void 0,logging:!1,modules:[],backgroundSyncInterval:6e4,disableFeatures:[],discoveryTimeout:1e4,isBackground:!1,requestTimeout:3e4,syncInterval:1e4};P.exports=p},function(P,I,T){var p=this&&this.__awaiter||function(A,c,l,s){return new(l||(l=Promise))(function(g,y){function O(h){try{t(s.next(h))}catch(d){y(d)}}function b(h){try{t(s.throw(h))}catch(d){y(d)}}function t(h){var d;h.done?g(h.value):(d=h.value,d instanceof l?d:new l(function(j){j(d)})).then(O,b)}t((s=s.apply(A,c||[])).next())})},x=this&&this.__importDefault||function(A){return A&&A.__esModule?A:{default:A}};const q=x(T(1)),v=T(0),k=x(T(5)),w=T(7);let u;function N(A){const c=A||S.getLocation().href,l={};for(const[y,O]of new URL(c).searchParams)l[y]=O;const s=c.indexOf("#");if(s===-1)return l;const g=c.substring(s+1);return g.includes("=")?g.split("&").reduce(function(y,O){const b=O.split("=");if(b[0]==="state"&&b[1].match(/rsDiscovery/)){let t=decodeURIComponent(b[1]);const h=t.substr(t.indexOf("rsDiscovery=")).split("&")[0].split("=")[1];y.rsDiscovery=JSON.parse(atob(h)),t=t.replace(new RegExp("&?rsDiscovery="+h),""),t.length>0&&(y.state=t)}else y[decodeURIComponent(b[0])]=decodeURIComponent(b[1]);return y},l):l}class S{static authorize(c,l){if((0,q.default)("[Authorize] authURL = ",l.authURL,"scope = ",l.scope,"redirectUri = ",l.redirectUri,"clientId = ",l.clientId,"response_type =",l.response_type),!l.scope)throw new Error("Cannot authorize due to undefined or empty scope; did you forget to access.claim()?");if(!(0,v.localStorageAvailable)()&&c.backend==="remotestorage"){l.redirectUri+=l.redirectUri.indexOf("#")>0?"&":"#";const g={userAddress:c.remote.userAddress,href:c.remote.href,storageApi:c.remote.storageApi,properties:c.remote.properties};l.redirectUri+="rsDiscovery="+(0,v.toBase64)(JSON.stringify(g))}const s=function(g){const y=new URL(g.redirectUri);g.state||(g.state=y.hash?y.hash.substring(1):""),g.response_type||(g.response_type="token");const O=new URL(g.authURL);O.searchParams.set("redirect_uri",g.redirectUri.replace(/#.*$/,"")),O.searchParams.set("scope",g.scope),O.searchParams.set("client_id",g.clientId);for(const b of["state","response_type","code_challenge","code_challenge_method","token_access_type"]){const t=g[b];t&&O.searchParams.set(b,t)}return O.href}(l);v.globalContext.cordova?S.openWindow(s,l.redirectUri,"location=yes,clearsessioncache=yes,clearcache=yes").then(g=>{c.remote.configure({token:g.access_token})}):S.setLocation(s)}static refreshAccessToken(c,l,s){var g,y,O;return p(this,void 0,void 0,function*(){yield l.configure({token:null,tokenType:null});const b=new URLSearchParams({grant_type:"refresh_token",client_id:l.clientId,refresh_token:s}),t=yield(0,w.requestWithTimeout)("POST",l.TOKEN_URL,{headers:{"Content-Type":"application/x-www-form-urlencoded"},body:b.toString(),responseType:"json"});if((t==null?void 0:t.status)!==200)throw yield l.configure({refreshToken:null}),new k.default("refresh token rejected:"+JSON.stringify(t.response));{(0,q.default)(`[Authorize] access token good for ${(g=t==null?void 0:t.response)===null||g===void 0?void 0:g.expires_in} seconds`);const h={token:(y=t==null?void 0:t.response)===null||y===void 0?void 0:y.access_token,tokenType:(O=t==null?void 0:t.response)===null||O===void 0?void 0:O.token_type};if(!h.token)throw new Error('no access_token in "successful" refresh: '+t.response);yield l.configure(h)}})}static setLocation(c){if(typeof c=="string")document.location.href=c;else{if(typeof c!="object")throw"Invalid location "+c;document.location=c}}static _rs_supported(){return typeof document<"u"}static _rs_cleanup(c){c.removeEventListener("features-loaded",u)}}S.IMPLIED_FAKE_TOKEN=!1,S.getLocation=function(){return document.location},S.openWindow=function(A,c,l){return new Promise((s,g)=>{const y=open(A,"_blank",l);function O(){g("Authorization was canceled")}y&&!y.closed?(y.addEventListener("loadstart",function(b){if(b.url.indexOf(c)!==0)return;y.removeEventListener("exit",O),y.close();const t=N(b.url);t?s(t):g("Authorization error")}),y.addEventListener("exit",O)):g("Authorization popup was blocked")})},S._rs_init=function(A){const c=N();let l;c&&(l=S.getLocation(),l.hash=""),u=function(){let s=!1;if(c){if(c.error)throw c.error==="access_denied"?new k.default("Authorization failed: access denied",{code:"access_denied"}):new k.default("Authorization failed: "+c.error);c.rsDiscovery&&A.remote.configure(c.rsDiscovery),c.access_token&&(A.remote.configure({token:c.access_token}),s=!0),c.remotestorage&&(A.connect(c.remotestorage),s=!0),c.state&&(l=S.getLocation(),S.setLocation(l.href.split("#")[0]+"#"+c.state)),c.code&&(function(g){var y,O,b,t;p(this,void 0,void 0,function*(){const h=sessionStorage.getItem("remotestorage:codeVerifier");if(!h)return void(0,q.default)("[Authorize] Ignoring OAuth code parameter, because no PKCE code verifier found in sessionStorage");l=S.getLocation();let d=l.origin;l.pathname!=="/"&&(d+=l.pathname);const j=new URLSearchParams({code:g,grant_type:"authorization_code",client_id:A.remote.clientId,redirect_uri:d,code_verifier:h}),F=yield(0,w.requestWithTimeout)("POST",A.remote.TOKEN_URL,{headers:{"Content-Type":"application/x-www-form-urlencoded"},body:j.toString(),responseType:"json"});switch(F.status){case 200:(0,q.default)(`[Authorize] access token good for ${(y=F==null?void 0:F.response)===null||y===void 0?void 0:y.expires_in} seconds`);const B={token:(O=F==null?void 0:F.response)===null||O===void 0?void 0:O.access_token,refreshToken:(b=F==null?void 0:F.response)===null||b===void 0?void 0:b.refresh_token,tokenType:(t=F==null?void 0:F.response)===null||t===void 0?void 0:t.token_type};B.token?A.remote.configure(B):A._emit("error",new Error('no access_token in "successful" response: '+F.response)),sessionStorage.removeItem("remotestorage:codeVerifier");break;default:A._emit("error",new Error(`${F.statusText}: ${F.response}`))}})}(c.code),s=!0),s||A.remote.stopWaitingForToken()}else A.remote.stopWaitingForToken()},A.on("features-loaded",u)},P.exports=S},function(P,I,T){class p extends Error{constructor(q,v={}){super(),this.name="Unauthorized",this.message=q===void 0?"App authorization expired or revoked.":q,v.code!==void 0&&(this.code=v.code),this.stack=new Error().stack}}P.exports=p},function(P,I){var T;T=function(){return this}();try{T=T||new Function("return this")()}catch{typeof window=="object"&&(T=window)}P.exports=T},function(P,I,T){(function(p){var x=this&&this.__awaiter||function(w,u,N,S){return new(N||(N=Promise))(function(A,c){function l(y){try{g(S.next(y))}catch(O){c(O)}}function s(y){try{g(S.throw(y))}catch(O){c(O)}}function g(y){var O;y.done?A(y.value):(O=y.value,O instanceof N?O:new N(function(b){b(O)})).then(l,s)}g((S=S.apply(w,u||[])).next())})},q=this&&this.__importDefault||function(w){return w&&w.__esModule?w:{default:w}};Object.defineProperty(I,"__esModule",{value:!0}),I.requestWithTimeout=I.isArrayBufferView=I.retryAfterMs=void 0;const v=q(T(1)),k=q(T(3));if(I.retryAfterMs=function(w){const u=1e3*parseInt(w.getResponseHeader("Retry-After"));return u>=1e3?u:Math.max(1500,Math.min(6e4,Math.round(k.default.syncInterval/(2.9+.2*Math.random()))))},typeof(p||window).ArrayBufferView=="function")I.isArrayBufferView=function(w){return w&&w instanceof(p||window).ArrayBufferView};else{const w=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];I.isArrayBufferView=function(u){for(let N=0;N<8;N++)if(u instanceof w[N])return!0;return!1}}I.requestWithTimeout=function(w,u,N){return x(this,void 0,void 0,function*(){return typeof fetch=="function"?function(S,A,c){return x(this,void 0,void 0,function*(){const l=typeof AbortController=="function"?new AbortController:null;let s;const g=new Promise((t,h)=>{s=setTimeout(()=>{l&&l.abort(),h("timeout")},k.default.requestTimeout)});let y;const O={},b=fetch(A,{method:S,headers:c.headers,body:c.body,signal:l?l.signal:void 0}).then(t=>{switch((0,v.default)("[requests fetch]",t),t.headers.forEach((h,d)=>{O[d.toUpperCase()]=h}),y={readyState:4,status:t.status,statusText:t.statusText,response:void 0,getResponseHeader:h=>O[h.toUpperCase()]||null,responseType:c.responseType,responseURL:A},c.responseType){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json();case void 0:case"":case"text":return t.text();default:throw new Error("responseType 'document' is not currently supported using fetch")}}).then(t=>(y.response=t,c.responseType&&c.responseType!=="text"||(y.responseText=t),y)).finally(()=>{clearTimeout(s)});return Promise.race([b,g])})}(w,u,N):typeof XMLHttpRequest=="function"?function(S,A,c){return x(this,void 0,void 0,function*(){return new Promise((l,s)=>{(0,v.default)("[requests XHR]",S,A);let g=!1;const y=setTimeout(()=>{g=!0,s("timeout")},k.default.requestTimeout),O=new XMLHttpRequest;if(O.open(S,A,!0),c.responseType&&(O.responseType=c.responseType),c.headers)for(const t in c.headers)O.setRequestHeader(t,c.headers[t]);O.onload=()=>{g||(clearTimeout(y),l(O))},O.onerror=t=>{g||(clearTimeout(y),s(t))};let b=c.body;typeof b=="object"&&!(0,I.isArrayBufferView)(b)&&b instanceof ArrayBuffer&&(b=new Uint8Array(b)),O.send(b)})})}(w,u,N):Promise.reject("[Requests] You need to add a polyfill for fetch or XMLHttpRequest")})}}).call(this,T(6))},function(P,I,T){var p=this&&this.__awaiter||function(A,c,l,s){return new(l||(l=Promise))(function(g,y){function O(h){try{t(s.next(h))}catch(d){y(d)}}function b(h){try{t(s.throw(h))}catch(d){y(d)}}function t(h){var d;h.done?g(h.value):(d=h.value,d instanceof l?d:new l(function(j){j(d)})).then(O,b)}t((s=s.apply(A,c||[])).next())})},x=this&&this.__importDefault||function(A){return A&&A.__esModule?A:{default:A}};const q=x(T(24)),v=x(T(25)),k=x(T(26)),w=x(T(2)),u=x(T(3)),N=T(0);class S{constructor(c,l){if(this.schemas={configurable:!0,get(){return S.Types.inScope(this.moduleName)}},l[l.length-1]!=="/")throw"Not a folder: "+l;l==="/"&&(this.makePath=s=>(s[0]==="/"?"":"/")+s),this.storage=c,this.base=l,this.moduleName=function(s){const g=s.split("/");return s.length>2?g[1]:"root"}(this.base),this.addEvents(["change"]),this.on=this.on.bind(this),c.onChange(this.base,this._fireChange.bind(this))}scope(c){return new S(this.storage,this.makePath(c))}getListing(c,l){return p(this,void 0,void 0,function*(){if(typeof c!="string")c="";else if(c.length>0&&!(0,N.isFolder)(c))return Promise.reject("Not a folder: "+c);return this.storage.get(this.makePath(c),l).then(s=>s.statusCode===404?{}:s.body)})}getAll(c,l){return p(this,void 0,void 0,function*(){if(typeof c!="string")c="";else if(c.length>0&&!(0,N.isFolder)(c))return Promise.reject("Not a folder: "+c);return this.storage.get(this.makePath(c),l).then(s=>{if(s.statusCode===404)return{};if(typeof s.body=="object"){const g=Object.keys(s.body);if(g.length===0)return{};const y=g.map(O=>this.storage.get(this.makePath(c+O),l).then(b=>{if(typeof b.body=="string")try{b.body=JSON.parse(b.body)}catch{}typeof b.body=="object"&&(s.body[O]=b.body)}));return Promise.all(y).then(()=>s.body)}})})}getFile(c,l){return p(this,void 0,void 0,function*(){return typeof c!="string"?Promise.reject("Argument 'path' of baseClient.getFile must be a string"):this.storage.get(this.makePath(c),l).then(s=>({data:s.body,contentType:s.contentType,revision:s.revision}))})}storeFile(c,l,s){return p(this,void 0,void 0,function*(){return typeof c!="string"?Promise.reject("Argument 'mimeType' of baseClient.storeFile must be a string"):typeof l!="string"?Promise.reject("Argument 'path' of baseClient.storeFile must be a string"):typeof s!="string"&&typeof s!="object"?Promise.reject("Argument 'body' of baseClient.storeFile must be a string, ArrayBuffer, or ArrayBufferView"):(this.storage.access.checkPathPermission(this.makePath(l),"rw")||console.warn("WARNING: Editing a document to which only read access ('r') was claimed"),this.storage.put(this.makePath(l),s,c).then(g=>g.statusCode===200||g.statusCode===201?g.revision:Promise.reject("Request (PUT "+this.makePath(l)+") failed with status: "+g.statusCode)))})}getObject(c,l){return p(this,void 0,void 0,function*(){return typeof c!="string"?Promise.reject("Argument 'path' of baseClient.getObject must be a string"):this.storage.get(this.makePath(c),l).then(s=>{if(typeof s.body=="object")return s.body;if(typeof s.body=="string")try{return JSON.parse(s.body)}catch{throw new Error("Not valid JSON: "+this.makePath(c))}else if(s.body!==void 0&&s.statusCode===200)return Promise.reject("Not an object: "+this.makePath(c))})})}storeObject(c,l,s){return p(this,void 0,void 0,function*(){if(typeof c!="string")return Promise.reject("Argument 'typeAlias' of baseClient.storeObject must be a string");if(typeof l!="string")return Promise.reject("Argument 'path' of baseClient.storeObject must be a string");if(typeof s!="object")return Promise.reject("Argument 'object' of baseClient.storeObject must be an object");this._attachType(s,c);try{const g=this.validate(s);if(!g.valid)return Promise.reject(g)}catch(g){return Promise.reject(g)}return this.storage.put(this.makePath(l),JSON.stringify(s),"application/json; charset=UTF-8").then(g=>g.statusCode===200||g.statusCode===201?g.revision:Promise.reject("Request (PUT "+this.makePath(l)+") failed with status: "+g.statusCode))})}remove(c){return typeof c!="string"?Promise.reject("Argument 'path' of baseClient.remove must be a string"):(this.storage.access.checkPathPermission(this.makePath(c),"rw")||console.warn("WARNING: Removing a document to which only read access ('r') was claimed"),this.storage.delete(this.makePath(c)))}getItemURL(c){if(typeof c!="string")throw"Argument 'path' of baseClient.getItemURL must be a string";return this.storage.connected?(c=(0,N.cleanPath)(this.makePath(c)),this.storage.remote.href+c):void 0}cache(c,l="ALL"){if(typeof c!="string")throw"Argument 'path' of baseClient.cache must be a string";if(typeof l!="string")throw"Argument 'strategy' of baseClient.cache must be a string or undefined";if(l!=="FLUSH"&&l!=="SEEN"&&l!=="ALL")throw`Argument 'strategy' of baseclient.cache must be one of ["FLUSH", "SEEN", "ALL"]`;return this.storage.caching.set(this.makePath(c),l),this}flush(c){return this.storage.local.flush(c)}declareType(c,l,s){let g;if(s&&typeof l=="string")g=l;else if(s||typeof l=="string"){if(!s&&typeof l=="string")throw new Error("declareType() requires a JSON Schema object to be passed, in order to validate object types/formats")}else s=l,g=this._defaultTypeURI(c);S.Types.declare(this.moduleName,c,g,s)}validate(c){const l=S.Types.getSchema(c["@context"]);if(l)return q.default.validateResult(c,l);throw new k.default(c["@context"])}_defaultTypeURI(c){return"http://remotestorage.io/spec/modules/"+encodeURIComponent(this.moduleName)+"/"+encodeURIComponent(c)}_attachType(c,l){c["@context"]=S.Types.resolveAlias(this.moduleName+"/"+l)||this._defaultTypeURI(l)}makePath(c){return this.base+(c||"")}_fireChange(c){u.default.changeEvents[c.origin]&&(["new","old","lastCommon"].forEach(function(l){if((!c[l+"ContentType"]||/^application\/(.*)json(.*)/.exec(c[l+"ContentType"]))&&typeof c[l+"Value"]=="string")try{c[l+"Value"]=JSON.parse(c[l+"Value"])}catch{}}),this._emit("change",c))}static _rs_init(){}}S.Types=v.default,(0,N.applyMixins)(S,[w.default]),P.exports=S},function(P,I,T){var p=this&&this.__importDefault||function(k){return k&&k.__esModule?k:{default:k}};Object.defineProperty(I,"__esModule",{value:!0}),I.RemoteBase=void 0;const x=p(T(2)),q=T(0);class v extends x.default{constructor(w){super(),this.rs=w,this.connected=!1}stopWaitingForToken(){this.connected||this._emit("not-connected")}addQuotes(w){return typeof w!="string"?w:w==="*"?"*":'"'+w+'"'}stripQuotes(w){return typeof w!="string"?w:w.replace(/^["']|["']$/g,"")}isForbiddenRequestMethod(w,u){return(w==="PUT"||w==="DELETE")&&(0,q.isFolder)(u)}}I.RemoteBase=v},function(P,I,T){class p extends Error{constructor(q){super(),this.name="SyncError",this.message="Sync failed: ",typeof q=="string"?this.message+=q:(this.message+=q.message,this.stack=q.stack,this.originalError=q)}}P.exports=p},function(P,I,T){var p=this&&this.__awaiter||function(l,s,g,y){return new(g||(g=Promise))(function(O,b){function t(j){try{d(y.next(j))}catch(F){b(F)}}function h(j){try{d(y.throw(j))}catch(F){b(F)}}function d(j){var F;j.done?O(j.value):(F=j.value,F instanceof g?F:new g(function(B){B(F)})).then(t,h)}d((y=y.apply(l,s||[])).next())})},x=this&&this.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};const q=x(T(2)),v=x(T(3)),k=x(T(1)),w=T(0);function u(l){if(typeof l=="object"&&typeof l.path=="string")if((0,w.isFolder)(l.path)){if(l.local&&l.local.itemsMap)return l.local;if(l.common&&l.common.itemsMap)return l.common}else{if(l.local){if(l.local.body&&l.local.contentType)return l.local;if(l.local.body===!1)return}if(l.common&&l.common.body&&l.common.contentType)return l.common;if(l.body&&l.contentType)return{body:l.body,contentType:l.contentType}}}function N(l,s){for(const g in l){if(l[g]&&l[g].remote)return!0;const y=u(l[g]);if(y&&y.timestamp&&new Date().getTime()-y.timestamp<=s)return!1;if(!y)return!0}return!0}function S(l){const s={path:l,common:{}};return(0,w.isFolder)(l)&&(s.common.itemsMap={}),s}function A(l,s){return l.common||(l.common={itemsMap:{}}),l.common.itemsMap||(l.common.itemsMap={}),l.local||(l.local=(0,w.deepClone)(l.common)),l.local.itemsMap||(l.local.itemsMap=l.common.itemsMap),l.local.itemsMap[s]=!0,l}class c{constructor(){this._updateNodesRunning=!1,this._updateNodesQueued=[]}get(s,g,y){return p(this,void 0,void 0,function*(){return typeof g=="number"?this.getNodes((0,w.pathsFromRoot)(s)).then(O=>{const b=u(O[s]);return N(O,g)?y(s):b?{statusCode:200,body:b.body||b.itemsMap,contentType:b.contentType}:{statusCode:404}}):this.getNodes([s]).then(O=>{const b=u(O[s]);if(b){if((0,w.isFolder)(s))for(const t in b.itemsMap)b.itemsMap.hasOwnProperty(t)&&b.itemsMap[t]===!1&&delete b.itemsMap[t];return{statusCode:200,body:b.body||b.itemsMap,contentType:b.contentType}}return{statusCode:404}})})}put(s,g,y){return p(this,void 0,void 0,function*(){const O=(0,w.pathsFromRoot)(s);return this._updateNodes(O,function(b,t){try{for(let h=0,d=b.length;h<d;h++){const j=b[h];let F,B=t[j];B||(t[j]=B=S(j)),h===0?(F=u(B),B.local={body:g,contentType:y,previousBody:F?F.body:void 0,previousContentType:F?F.contentType:void 0}):B=A(B,b[h-1].substring(j.length))}return t}catch(h){throw(0,k.default)("[Cachinglayer] Error during PUT",t,h),h}})})}delete(s){const g=(0,w.pathsFromRoot)(s);return this._updateNodes(g,function(y,O){for(let b=0,t=y.length;b<t;b++){const h=y[b],d=O[h];let j;if(d)if(b===0)j=u(d),d.local={body:!1,previousBody:j?j.body:void 0,previousContentType:j?j.contentType:void 0};else{d.local||(d.local=(0,w.deepClone)(d.common));const F=y[b-1].substring(h.length);if(delete d.local.itemsMap[F],Object.getOwnPropertyNames(d.local.itemsMap).length>0)break}else console.error("Cannot delete non-existing node "+h)}return O})}flush(s){return this._getAllDescendentPaths(s).then(g=>this.getNodes(g)).then(g=>{for(const y in g){const O=g[y];O&&O.common&&O.local&&this._emitChange({path:O.path,origin:"local",oldValue:O.local.body===!1?void 0:O.local.body,newValue:O.common.body===!1?void 0:O.common.body}),g[y]=void 0}return this.setNodes(g)})}_emitChange(s){v.default.changeEvents[s.origin]&&this._emit("change",s)}fireInitial(){v.default.changeEvents.local&&this.forAllNodes(s=>{if((0,w.isDocument)(s.path)){const g=u(s);g&&this._emitChange({path:s.path,origin:"local",oldValue:void 0,oldContentType:void 0,newValue:g.body,newContentType:g.contentType})}}).then(()=>{this._emit("local-events-done")})}onDiff(s){this.diffHandler=s}migrate(s){return typeof s!="object"||s.common||(s.common={},typeof s.path=="string"?s.path.substr(-1)==="/"&&typeof s.body=="object"&&(s.common.itemsMap=s.body):(s.local||(s.local={}),s.local.body=s.body,s.local.contentType=s.contentType)),s}_updateNodes(s,g){return new Promise((y,O)=>{this._doUpdateNodes(s,g,{resolve:y,reject:O})})}_doUpdateNodes(s,g,y){this._updateNodesRunning?this._updateNodesQueued.push({paths:s,cb:g,promise:y}):(this._updateNodesRunning=!0,this.getNodes(s).then(O=>{const b=(0,w.deepClone)(O),t=[];O=g(s,O);for(const h in O){const d=O[h];(0,w.equal)(d,b[h])?delete O[h]:(0,w.isDocument)(h)&&((0,w.equal)(d.local.body,d.local.previousBody)&&d.local.contentType===d.local.previousContentType||t.push({path:h,origin:"window",oldValue:d.local.previousBody,newValue:d.local.body===!1?void 0:d.local.body,oldContentType:d.local.previousContentType,newContentType:d.local.contentType}),delete d.local.previousBody,delete d.local.previousContentType)}this.setNodes(O).then(()=>{this._emitChangeEvents(t),y.resolve({statusCode:200})})}).then(()=>Promise.resolve(),O=>{y.reject(O)}).then(()=>{this._updateNodesRunning=!1;const O=this._updateNodesQueued.shift();O&&this._doUpdateNodes(O.paths,O.cb,O.promise)}))}_emitChangeEvents(s){for(let g=0,y=s.length;g<y;g++)this._emitChange(s[g]),this.diffHandler&&this.diffHandler(s[g].path)}_getAllDescendentPaths(s){return(0,w.isFolder)(s)?this.getNodes([s]).then(g=>{const y=[s],O=u(g[s]),b=Object.keys(O.itemsMap).map(t=>this._getAllDescendentPaths(s+t).then(h=>{for(let d=0,j=h.length;d<j;d++)y.push(h[d])}));return Promise.all(b).then(()=>y)}):Promise.resolve([s])}_getInternals(){return{getLatest:u,makeNode:S,isOutdated:N}}}(0,w.applyMixins)(c,[q.default]),P.exports=c},function(P,I,T){P.exports=class{constructor(){this.reset()}static _rs_init(){}get scopes(){return Object.keys(this.scopeModeMap).map(p=>({name:p,mode:this.scopeModeMap[p]}))}get scopeParameter(){return this.scopes.map(p=>`${this._scopeNameForParameter(p)}:${p.mode}`).join(" ")}claim(p,x){if(typeof p!="string"||p.indexOf("/")!==-1||p.length===0)throw new Error("Scope should be a non-empty string without forward slashes");if(!x.match(/^rw?$/))throw new Error("Mode should be either 'r' or 'rw'");this._adjustRootPaths(p),this.scopeModeMap[p]=x}get(p){return this.scopeModeMap[p]}remove(p){const x={};for(const q in this.scopeModeMap)x[q]=this.scopeModeMap[q];this.reset(),delete x[p];for(const q in x)this.claim(q,x[q])}checkPermission(p,x){const q=this.get(p);return q&&(x==="r"||q==="rw")}checkPathPermission(p,x){if(this.checkPermission("*",x))return!0;const q=this._getModuleName(p);return!!this.checkPermission(q,x)}reset(){this.rootPaths=[],this.scopeModeMap={}}_getModuleName(p){if(p[0]!=="/")throw new Error("Path should start with a slash");const x=p.replace(/^\/public/,"").match(/^\/([^/]*)\//);return x?x[1]:"*"}_adjustRootPaths(p){"*"in this.scopeModeMap||p==="*"?this.rootPaths=["/"]:p in this.scopeModeMap||(this.rootPaths.push("/"+p+"/"),this.rootPaths.push("/public/"+p+"/"))}_scopeNameForParameter(p){if(p.name==="*"&&this.storageType){if(this.storageType==="2012.04")return"";if(this.storageType.match(/remotestorage-0[01]/))return"root"}return p.name}setStorageType(p){this.storageType=p}}},function(P,I,T){var p=this&&this.__importDefault||function(v){return v&&v.__esModule?v:{default:v}};const x=T(0),q=p(T(1));P.exports=class{constructor(){this.pendingActivations=[],this.reset()}set(v,k){if(typeof v!="string")throw new Error("path should be a string");if(!(0,x.isFolder)(v))throw new Error("path should be a folder");if(!k.match(/^(FLUSH|SEEN|ALL)$/))throw new Error("strategy should be 'FLUSH', 'SEEN', or 'ALL'");this._rootPaths[v]=k,k==="ALL"&&(this.activateHandler?this.activateHandler(v):this.pendingActivations.push(v))}enable(v){this.set(v,"ALL")}disable(v){this.set(v,"FLUSH")}onActivate(v){(0,q.default)("[Caching] Setting activate handler",v,this.pendingActivations),this.activateHandler=v;for(let k=0;k<this.pendingActivations.length;k++)v(this.pendingActivations[k]);this.pendingActivations=[]}checkPath(v){return this._rootPaths[v]!==void 0?this._rootPaths[v]:v==="/"?"SEEN":this.checkPath((0,x.containingFolder)(v))}reset(){this._rootPaths={}}static _rs_init(){}}},function(P,I,T){var p=this&&this.__importDefault||function(O){return O&&O.__esModule?O:{default:O}};const x=p(T(8)),q=p(T(2)),v=T(0),k=T(7),w=T(9),u="https://www.googleapis.com",N="remotestorage:googledrive";let S;function A(O){return O.substr(-1)==="/"&&(O=O.substr(0,O.length-1)),decodeURIComponent(O)}function c(O){return O.replace(/[^\/]+\/?$/,"")}function l(O){const b=O.split("/");return O.substr(-1)==="/"?b[b.length-2]+"/":b[b.length-1]}function s(O){return(0,v.cleanPath)("/remotestorage/"+O)}class g{constructor(b){this._items={},this.maxAge=b,this._items={}}get(b){const t=this._items[b],h=new Date().getTime();return t&&t.t>=h-this.maxAge?t.v:void 0}set(b,t){this._items[b]={v:t,t:new Date().getTime()}}}class y extends w.RemoteBase{constructor(b,t){if(super(b),this.online=!0,this.storageApi="draft-dejong-remotestorage-19",this.addEvents(["connected","not-connected"]),this.clientId=t,this._fileIdCache=new g(300),S=(0,v.localStorageAvailable)(),S){const h=(0,v.getJSONFromLocalStorage)(N);h&&this.configure(h)}}configure(b){b.userAddress!==void 0&&(this.userAddress=b.userAddress),b.token!==void 0&&(this.token=b.token);const t=function(){S&&localStorage.setItem(N,JSON.stringify({userAddress:this.userAddress,token:this.token}))},h=function(){this.connected=!1,delete this.token,S&&localStorage.removeItem(N)};this.token?(this.connected=!0,this.userAddress?(this._emit("connected"),t.apply(this)):this.info().then(d=>{this.userAddress=d.user.emailAddress,this._emit("connected"),t.apply(this)}).catch(()=>{h.apply(this),this.rs._emit("error",new Error("Could not fetch user info."))})):h.apply(this)}connect(){this.rs.setBackend("googledrive"),this.rs.authorize({authURL:"https://accounts.google.com/o/oauth2/auth",scope:"https://www.googleapis.com/auth/drive",clientId:this.clientId})}get(b,t={}){return(0,v.isFolder)(b)?this._getFolder(s(b)):this._getFile(s(b),t)}put(b,t,h,d={}){const j=s(b);function F(B){if(B.status>=200&&B.status<300){const z=JSON.parse(B.responseText),Y=this.stripQuotes(z.etag);return Promise.resolve({statusCode:200,contentType:z.mimeType,revision:Y})}return B.status===412?Promise.resolve({statusCode:412,revision:"conflict"}):Promise.reject("PUT failed with status "+B.status+" ("+B.responseText+")")}return this._getFileId(j).then(B=>B?d&&d.ifNoneMatch==="*"?F({status:412}):this._updateFile(B,j,t,h,d).then(F):this._createFile(j,t,h).then(F))}delete(b,t={}){const h=s(b);return this._getFileId(h).then(d=>d?this._getMeta(d).then(j=>{let F;return typeof j=="object"&&typeof j.etag=="string"&&(F=this.stripQuotes(j.etag)),t&&t.ifMatch&&t.ifMatch!==F?{statusCode:412,revision:F}:this._request("DELETE",u+"/drive/v2/files/"+d,{}).then(B=>B.status===200||B.status===204?{statusCode:200}:Promise.reject("Delete failed: "+B.status+" ("+B.responseText+")"))}):Promise.resolve({statusCode:200}))}info(){return this._request("GET","https://www.googleapis.com/drive/v2/about?fields=user",{}).then(function(b){try{const t=JSON.parse(b.responseText);return Promise.resolve(t)}catch(t){return Promise.reject(t)}})}_updateFile(b,t,h,d,j){const F={mimeType:d},B={"Content-Type":"application/json; charset=UTF-8"};return j&&j.ifMatch&&(B["If-Match"]=this.addQuotes(j.ifMatch)),this._request("PUT",u+"/upload/drive/v2/files/"+b+"?uploadType=resumable",{body:JSON.stringify(F),headers:B}).then(z=>z.status===412?z:this._request("PUT",z.getResponseHeader("Location"),{body:d.match(/^application\/json/)?JSON.stringify(h):h}))}_createFile(b,t,h){return this._getParentId(b).then(d=>{const j={title:A(l(b)),mimeType:h,parents:[{kind:"drive#fileLink",id:d}]};return this._request("POST",u+"/upload/drive/v2/files?uploadType=resumable",{body:JSON.stringify(j),headers:{"Content-Type":"application/json; charset=UTF-8"}}).then(F=>this._request("POST",F.getResponseHeader("Location"),{body:h.match(/^application\/json/)?JSON.stringify(t):t}))})}_getFile(b,t){return this._getFileId(b).then(h=>this._getMeta(h).then(d=>{let j;if(typeof d=="object"&&typeof d.etag=="string"&&(j=this.stripQuotes(d.etag)),t&&t.ifNoneMatch&&j===t.ifNoneMatch)return Promise.resolve({statusCode:304});if(!d.downloadUrl){if(!d.exportLinks||!d.exportLinks["text/html"])return Promise.resolve({statusCode:200,body:"",contentType:d.mimeType,revision:j});d.mimeType+=";export=text/html",d.downloadUrl=d.exportLinks["text/html"]}return this._request("GET",d.downloadUrl,{responseType:"arraybuffer"}).then(F=>(0,v.getTextFromArrayBuffer)(F.response,"UTF-8").then(function(B){let z=B;if(d.mimeType.match(/^application\/json/))try{z=JSON.parse(z)}catch{}else(0,v.shouldBeTreatedAsBinary)(B,d.mimeType)&&(z=F.response);return{statusCode:200,body:z,contentType:d.mimeType,revision:j}}))}))}_getFolder(b){return this._getFileId(b).then(t=>{let h,d,j;if(!t)return Promise.resolve({statusCode:404});const F="'"+t+"' in parents";return this._request("GET",u+"/drive/v2/files?q="+encodeURIComponent(F)+"&fields="+encodeURIComponent("items(downloadUrl,etag,fileSize,id,mimeType,title,labels)")+"&maxResults=1000&trashed=false",{}).then(B=>{var z;if(B.status!==200)return Promise.reject("request failed or something: "+B.status);try{h=JSON.parse(B.responseText)}catch{return Promise.reject("non-JSON response from GoogleDrive")}j={};for(const Y of h.items)!((z=Y.labels)===null||z===void 0)&&z.trashed||(d=this.stripQuotes(Y.etag),Y.mimeType==="application/vnd.google-apps.folder"?(this._fileIdCache.set(b+(0,v.cleanPath)(Y.title)+"/",Y.id),j[Y.title+"/"]={ETag:d}):(this._fileIdCache.set(b+(0,v.cleanPath)(Y.title),Y.id),j[Y.title]={ETag:d,"Content-Type":Y.mimeType,"Content-Length":Y.fileSize}));return Promise.resolve({statusCode:200,body:j,contentType:"application/json; charset=UTF-8",revision:void 0})})})}_getParentId(b){const t=c(b);return this._getFileId(t).then(h=>h?Promise.resolve(h):this._createFolder(t))}_createFolder(b){return this._getParentId(b).then(t=>this._request("POST",u+"/drive/v2/files",{body:JSON.stringify({title:A(l(b)),mimeType:"application/vnd.google-apps.folder",parents:[{id:t}]}),headers:{"Content-Type":"application/json; charset=UTF-8"}}).then(h=>{const d=JSON.parse(h.responseText);return Promise.resolve(d.id)}))}_getFileId(b){let t;return b==="/"?Promise.resolve("root"):(t=this._fileIdCache.get(b))?Promise.resolve(t):this._getFolder(c(b)).then(()=>(t=this._fileIdCache.get(b),t?Promise.resolve(t):b.substr(-1)==="/"?this._createFolder(b).then(()=>this._getFileId(b)):Promise.resolve()))}_getMeta(b){return this._request("GET",u+"/drive/v2/files/"+b,{}).then(function(t){return t.status===200?Promise.resolve(JSON.parse(t.responseText)):Promise.reject("request (getting metadata for "+b+") failed with status: "+t.status)})}_request(b,t,h){return this.isForbiddenRequestMethod(b,t)?Promise.reject(`Don't use ${b} on directories!`):(h.headers||(h.headers={}),h.headers.Authorization="Bearer "+this.token,this.rs._emit("wire-busy",{method:b,isFolder:(0,v.isFolder)(t)}),(0,k.requestWithTimeout)(b,t,h).then(d=>d&&d.status===401?void this.connect():(this.online||(this.online=!0,this.rs._emit("network-online")),this.rs._emit("wire-done",{method:b,isFolder:(0,v.isFolder)(t),success:!0}),Promise.resolve(d)),d=>(this.online&&(this.online=!1,this.rs._emit("network-offline")),this.rs._emit("wire-done",{method:b,isFolder:(0,v.isFolder)(t),success:!1}),Promise.reject(d))))}static _rs_init(b){const t=b.apiKeys.googledrive;var h;t&&(b.googledrive=new y(b,t.clientId),b.backend==="googledrive"&&(b._origRemote=b.remote,b.remote=b.googledrive,(h=b)._origBaseClientGetItemURL||(h._origBaseClientGetItemURL=x.default.prototype.getItemURL,x.default.prototype.getItemURL=function(){throw new Error("getItemURL is not implemented for Google Drive yet")})))}static _rs_supported(){return!0}static _rs_cleanup(b){var t;b.setBackend(void 0),b._origRemote&&(b.remote=b._origRemote,delete b._origRemote),(t=b)._origBaseClientGetItemURL&&(x.default.prototype.getItemURL=t._origBaseClientGetItemURL,delete t._origBaseClientGetItemURL)}}(0,v.applyMixins)(y,[q.default]),P.exports=y},function(P,I,T){var p=this&&this.__awaiter||function(Y,R,_,m){return new(_||(_=Promise))(function(r,n){function f(G){try{M(m.next(G))}catch(J){n(J)}}function E(G){try{M(m.throw(G))}catch(J){n(J)}}function M(G){var J;G.done?r(G.value):(J=G.value,J instanceof _?J:new _(function(H){H(J)})).then(f,E)}M((m=m.apply(Y,R||[])).next())})},x=this&&this.__importDefault||function(Y){return Y&&Y.__esModule?Y:{default:Y}};const q=x(T(2)),v=x(T(8)),k=x(T(27)),w=x(T(10)),u=x(T(5)),N=T(0),S=T(7),A=T(9),c=x(T(4));let l;const s="remotestorage:dropbox",g="https://api.dropboxapi.com/2/files/list_folder",y="https://api.dropboxapi.com/2/files/list_folder/continue";function O(Y){return("/remotestorage/"+Y).replace(/\/+$/,"").replace(/\/+/g,"/")}const b=/[\u007f-\uffff]/g;function t(Y){return JSON.stringify(Y).replace(b,function(R){return"\\u"+("000"+R.charCodeAt(0).toString(16)).slice(-4)})}function h(Y,R){return new RegExp("^"+R.join("\\/")+"(\\/|$)").test(Y.error_summary)}function d(Y){return Y instanceof ArrayBuffer||(0,S.isArrayBufferView)(Y)}class j extends A.RemoteBase{constructor(R){if(super(R),this.online=!0,this.storageApi="draft-dejong-remotestorage-19",this._initialFetchDone=!1,this.addEvents(["connected","not-connected"]),this.clientId=R.apiKeys.dropbox.appKey,this.TOKEN_URL="https://api.dropboxapi.com/oauth2/token",this._revCache=new k.default("rev"),this._fetchDeltaCursor=null,this._fetchDeltaPromise=null,this._itemRefs={},l=(0,N.localStorageAvailable)(),l){const _=(0,N.getJSONFromLocalStorage)(s);_&&this.configure(_),this._itemRefs=(0,N.getJSONFromLocalStorage)(s+":shares")||{}}this.connected&&setTimeout(this._emit.bind(this),0,"connected")}connect(){return p(this,void 0,void 0,function*(){try{if(this.rs.setBackend("dropbox"),this.token)z(this.rs);else{const{codeVerifier:R,codeChallenge:_,state:m}=yield(0,N.generateCodeVerifier)();sessionStorage.setItem("remotestorage:codeVerifier",R),sessionStorage.setItem("remotestorage:state",m),this.rs.authorize({authURL:"https://www.dropbox.com/oauth2/authorize",scope:"account_info.read files.content.read files.content.write files.metadata.read files.metadata.write",clientId:this.clientId,response_type:"code",state:m,code_challenge:_,code_challenge_method:"S256",token_access_type:"offline"})}}catch(R){throw this.rs._emit("error",R),this.rs.setBackend(void 0),R}})}configure(R){return p(this,void 0,void 0,function*(){R.userAddress!==void 0&&(this.userAddress=R.userAddress),R.token!==void 0&&(this.token=R.token),R.refreshToken!==void 0&&(this.refreshToken=R.refreshToken),R.tokenType!==void 0&&(this.tokenType=R.tokenType);const _=()=>{l&&localStorage.setItem(s,JSON.stringify({userAddress:this.userAddress,token:this.token,refreshToken:this.refreshToken,tokenType:this.tokenType}))},m=()=>{this.connected=!1,l&&localStorage.removeItem(s),this.rs.setBackend(void 0)};if(this.refreshToken||this.token)if(this.connected=!0,this.userAddress)this._emit("connected"),_();else try{const r=yield this.info();this.userAddress=r.email,this._emit("connected"),_()}catch{this.connected=!1,this.rs._emit("error",new Error("Could not fetch user info.")),_.apply(this)}else m()})}_getFolder(R){const _=this._revCache,m=n=>{let f;if(n.status!==200&&n.status!==409)return Promise.reject("Unexpected response status: "+n.status);try{f=JSON.parse(n.responseText)}catch(M){return Promise.reject(M)}if(n.status===409)return h(f,["path","not_found"])?Promise.resolve({}):Promise.reject(new Error("API returned an error: "+f.error_summary));const E=f.entries.reduce((M,G)=>{try{const J=G[".tag"]==="folder",H=G.path_display.split("/").slice(-1)[0]+(J?"/":"");if(J)M[H]={ETag:_.get(R+H)};else{const W=new Date(G.server_modified);M[H]={ETag:G.rev,"Content-Length":G.size,"Last-Modified":W.toUTCString()},this._revCache.set(R+H,G.rev)}}catch(J){console.error(`[Dropbox] folder “${R}” has entry ${JSON.stringify(G)}:`,J)}return M},{});return f.has_more?r(f.cursor).then(function(M){return Object.assign(E,M)}):Promise.resolve(E)},r=n=>{const f={body:{cursor:n}};return this._request("POST",y,f).then(m)};return this._request("POST",g,{body:{path:O(R)}}).then(m).then(function(n){return Promise.resolve({statusCode:200,body:n,contentType:"application/json; charset=UTF-8",revision:_.get(R)})})}get(R,_={}){if(!this.connected)return Promise.reject("not connected (path: "+R+")");const m=this._revCache.get(R);if(m===null)return Promise.resolve({statusCode:404});if(_&&_.ifNoneMatch){if(!this._initialFetchDone)return this.fetchDelta().then(()=>this.get(R,_));if(m&&m===_.ifNoneMatch)return Promise.resolve({statusCode:304})}if(R.slice(-1)==="/")return this._getFolder(R);const r={headers:{"Dropbox-API-Arg":t({path:O(R)})},responseType:"arraybuffer"};return _&&_.ifNoneMatch&&(r.headers["If-None-Match"]=_.ifNoneMatch),this._request("GET","https://content.dropboxapi.com/2/files/download",r).then(n=>{const f=n.status;let E,M,G,J;return f!==200&&f!==409?Promise.resolve({statusCode:f}):(E=n.getResponseHeader("Dropbox-API-Result"),(0,N.getTextFromArrayBuffer)(n.response,"UTF-8").then(H=>{M=H,f===409&&(E=M);try{E=JSON.parse(E)}catch(W){return Promise.reject(W)}if(f===409)return h(E,["path","not_found"])?{statusCode:404}:Promise.reject(new Error('API error while downloading file ("'+R+'"): '+E.error_summary));if(G=n.getResponseHeader("Content-Type"),J=E.rev,this._revCache.set(R,J),this._shareIfNeeded(R),(0,N.shouldBeTreatedAsBinary)(H,G))M=n.response;else try{M=JSON.parse(M),G="application/json; charset=UTF-8"}catch{}return{statusCode:f,body:M,contentType:G,revision:J}}))})}put(R,_,m,r={}){return p(this,void 0,void 0,function*(){if(!this.connected)throw new Error("not connected (path: "+R+")");const n=this._revCache.get(R);if(r&&r.ifMatch&&n&&n!==r.ifMatch)return{statusCode:412,revision:n};if(r&&r.ifNoneMatch==="*"&&n&&n!=="rev")return{statusCode:412,revision:n};if(!m.match(/charset=/)&&d(_)&&(m+="; charset=binary"),_.length>157286400)throw new Error("Cannot upload file larger than 150MB");const f=r&&(r.ifMatch||r.ifNoneMatch==="*"),E={body:_,contentType:m,path:R};if(f){const G=yield this._getMetadata(R);if(r&&r.ifNoneMatch==="*"&&G)return{statusCode:412,revision:G.rev};if(r&&r.ifMatch&&G&&G.rev!==r.ifMatch)return{statusCode:412,revision:G.rev}}const M=yield this._uploadSimple(E);return this._shareIfNeeded(R),M})}delete(R,_={}){return p(this,void 0,void 0,function*(){if(!this.connected)throw new Error("not connected (path: "+R+")");const m=this._revCache.get(R);if(_!=null&&_.ifMatch&&m&&_.ifMatch!==m)return{statusCode:412,revision:m};if(_!=null&&_.ifMatch){const r=yield this._getMetadata(R);if(_!=null&&_.ifMatch&&r&&r.rev!==_.ifMatch)return{statusCode:412,revision:r.rev}}return this._deleteSimple(R)})}_shareIfNeeded(R){if(R.match(/^\/public\/.*[^/]$/)&&this._itemRefs[R]===void 0)return this.share(R)}share(R){const _={body:{path:O(R)}};return this._request("POST","https://api.dropboxapi.com/2/sharing/create_shared_link_with_settings",_).then(m=>{if(m.status!==200&&m.status!==409)return Promise.reject(new Error("Invalid response status:"+m.status));let r;try{r=JSON.parse(m.responseText)}catch{return Promise.reject(new Error("Invalid response body: "+m.responseText))}return m.status===409?h(r,["shared_link_already_exists"])?this._getSharedLink(R):Promise.reject(new Error("API error: "+r.error_summary)):Promise.resolve(r.url)}).then(m=>(this._itemRefs[R]=m,l&&localStorage.setItem(s+":shares",JSON.stringify(this._itemRefs)),Promise.resolve(m)),m=>(m.message='Sharing Dropbox file or folder ("'+R+'") failed: '+m.message,Promise.reject(m)))}info(){return this._request("POST","https://api.dropboxapi.com/2/users/get_current_account",{}).then(function(R){let _;try{const m=JSON.parse(R.responseText);_=m==null?void 0:m.email}catch{return Promise.reject(new Error("Could not query current account info: Invalid API response: "+R.responseText))}return Promise.resolve({email:_})})}_request(R,_,m,r=1){return p(this,void 0,void 0,function*(){if(this.isForbiddenRequestMethod(R,_))throw`Don't use ${R} on directories!`;if(!this.token)throw new u.default("No access token");m.headers||(m.headers={}),m.headers.Authorization="Bearer "+this.token,typeof m.body!="object"||d(m.body)||(m.body=JSON.stringify(m.body),m.headers["Content-Type"]="application/json; charset=UTF-8"),this.rs._emit("wire-busy",{method:R,isFolder:(0,N.isFolder)(_)});try{const n=yield(0,S.requestWithTimeout)(R,_,m);return this.online||(this.online=!0,this.rs._emit("network-online")),this.rs._emit("wire-done",{method:R,isFolder:(0,N.isFolder)(_),success:!0}),(n==null?void 0:n.status)===401&&this.refreshToken?r>=3?(console.error(`Abandoned after ${r} attempts: ${R} ${_}`),n):(this.rs._emit("wire-busy",{method:R,isFolder:(0,N.isFolder)(_)}),yield c.default.refreshAccessToken(this.rs,this,this.refreshToken),this.rs._emit("wire-done",{method:R,isFolder:(0,N.isFolder)(_),success:!0}),this._request(R,_,m,r+1)):[503,429].includes(n==null?void 0:n.status)?(this.online&&(this.online=!1,this.rs._emit("network-offline")),r>=3?(console.warn(`Abandoned after ${r} attempts: ${R} ${_}`),n):(yield new Promise(f=>setTimeout(f,(0,S.retryAfterMs)(n))),this._request(R,_,m,r+1))):n}catch(n){throw this.online&&(this.online=!1,this.rs._emit("network-offline")),this.rs._emit("wire-done",{method:R,isFolder:(0,N.isFolder)(_),success:!1}),n}})}fetchDelta(...R){if(this._fetchDeltaPromise)return this._fetchDeltaPromise;const _=m=>p(this,void 0,void 0,function*(){let r,n;typeof m=="string"?(r=y,n={cursor:m}):(r=g,n={path:"/remotestorage",recursive:!0,include_deleted:!0});try{const f=yield this._request("POST",r,{body:n});if(f.status===401)throw new u.default;if(f.status!==200&&f.status!==409)throw new Error("Invalid response status: "+f.status);let E;try{E=JSON.parse(f.responseText)}catch{throw new Error("Invalid response body: "+f.responseText)}if(f.status===409){if(!h(E,["path","not_found"]))throw new Error("API returned an error: "+E.error_summary);E={cursor:null,entries:[],has_more:!1}}if(m||this._revCache.deactivatePropagation(),E.entries.forEach(M=>{const G=M.path_display.slice(14);M[".tag"]==="deleted"?(this._revCache.delete(G),this._revCache.delete(G+"/")):M[".tag"]==="file"&&this._revCache.set(G,M.rev)}),this._fetchDeltaCursor=E.cursor,E.has_more)return _(E.cursor);this._revCache.activatePropagation(),this._initialFetchDone=!0}catch(f){if(f==="timeout")return;throw f}});return this._fetchDeltaPromise=_(this._fetchDeltaCursor).catch(m=>(typeof m=="object"&&"message"in m?m.message="Dropbox: fetchDelta: "+m.message:m="Dropbox: fetchDelta: "+m,this.rs._emit("error",m),this._fetchDeltaPromise=null,Promise.reject(m))).then(()=>(this._fetchDeltaPromise=null,Promise.resolve(R))),this._fetchDeltaPromise}_getMetadata(R){const _={path:O(R)};return this._request("POST","https://api.dropboxapi.com/2/files/get_metadata",{body:_}).then(m=>{if(m.status!==200&&m.status!==409)return Promise.reject(new Error("Invalid response status:"+m.status));let r;try{r=JSON.parse(m.responseText)}catch{return Promise.reject(new Error("Invalid response body: "+m.responseText))}return m.status===409?h(r,["path","not_found"])?Promise.resolve():Promise.reject(new Error("API error: "+r.error_summary)):Promise.resolve(r)}).then(void 0,m=>(m.message='Could not load metadata for file or folder ("'+R+'"): '+m.message,Promise.reject(m)))}_uploadSimple(R){const _={path:O(R.path),mode:{".tag":"overwrite",update:void 0},mute:!0};return R.ifMatch&&(_.mode={".tag":"update",update:R.ifMatch}),this._request("POST","https://content.dropboxapi.com/2/files/upload",{body:R.body,headers:{"Content-Type":"application/octet-stream","Dropbox-API-Arg":t(_)}}).then(m=>{if(m.status!==200&&m.status!==409)return Promise.resolve({statusCode:m.status});let r;try{r=JSON.parse(m.responseText)}catch{return Promise.reject(new Error("Invalid API result: "+m.responseText))}return m.status===409?h(r,["path","conflict"])?this._getMetadata(R.path).then(function(n){return Promise.resolve({statusCode:412,revision:n.rev})}):(this.rs._emit("error",new Error(r.error_summary)),Promise.resolve({statusCode:m.status})):(this._revCache.set(R.path,r.rev),Promise.resolve({statusCode:m.status,revision:r.rev}))})}_deleteSimple(R){const _={path:O(R)};return this._request("POST","https://api.dropboxapi.com/2/files/delete",{body:_}).then(m=>{if(m.status!==200&&m.status!==409)return Promise.resolve({statusCode:m.status});let r;try{r=JSON.parse(m.responseText)}catch{return Promise.reject(new Error("Invalid response body: "+m.responseText))}if(m.status===409){if(h(r,["path_lookup","not_found"]))return Promise.resolve({statusCode:404});this.rs._emit("error",new Error(r.error_summary))}return Promise.resolve({statusCode:m.status})}).then(m=>(m.statusCode!==200&&m.statusCode!==404||(this._revCache.delete(R),delete this._itemRefs[R]),Promise.resolve(m)),m=>(m.message='Could not delete Dropbox file or folder ("'+R+'"): '+m.message,Promise.reject(m)))}_getSharedLink(R){return p(this,void 0,void 0,function*(){const _={body:{path:O(R),direct_only:!0}};return this._request("POST","https://api.dropbox.com/2/sharing/list_shared_links",_).then(m=>{if(m.status!==200&&m.status!==409)return Promise.reject(new Error("Invalid response status: "+m.status));let r;try{r=JSON.parse(m.responseText)}catch{return Promise.reject(new Error("Invalid response body: "+m.responseText))}return m.status===409?Promise.reject(new Error("API error: "+(r==null?void 0:r.error_summary)||!1)):r.links.length?Promise.resolve(r.links[0].url):Promise.reject(new Error("No links returned"))},m=>(m.message='Could not get link to a shared file or folder ("'+R+'"): '+m.message,Promise.reject(m)))})}static _rs_init(R){l=(0,N.localStorageAvailable)(),R.apiKeys.dropbox&&(R.dropbox=new j(R)),R.backend==="dropbox"&&z(R)}static _rs_supported(){return!0}static _rs_cleanup(R){(function(_){(function(m){m._origRemote&&(m.remote=m._origRemote,delete m._origRemote)})(_),function(m){m._dropboxOrigSync&&(m.sync.sync=m._dropboxOrigSync,delete m._dropboxOrigSync)}(_),function(m){m._origBaseClientGetItemURL&&(v.default.prototype.getItemURL=m._origBaseClientGetItemURL,delete m._origBaseClientGetItemURL)}(_),B(_)})(R),l&&localStorage.removeItem(s),R.setBackend(void 0)}}function F(Y,...R){Y._dropboxOrigSync||(Y._dropboxOrigSync=Y.sync.sync.bind(Y.sync),Y.sync.sync=function(){return this.dropbox.fetchDelta(Y,...R).then(Y._dropboxOrigSync,function(_){Y._emit("error",new w.default(_)),Y._emit("sync-done")})}.bind(Y))}function B(Y){Y._dropboxOrigSyncCycle&&(Y.syncCycle=Y._dropboxOrigSyncCycle,delete Y._dropboxOrigSyncCycle)}function z(Y){(function(R){R._origRemote||(R._origRemote=R.remote,R.remote=R.dropbox)})(Y),Y.sync?F(Y):function(R,..._){R._dropboxOrigSyncCycle||(R._dropboxOrigSyncCycle=R.syncCycle,R.syncCycle=()=>{if(!R.sync)throw new Error("expected sync to be initialized by now");F(R),R._dropboxOrigSyncCycle(R,..._),B(R)})}(Y),function(R){R._origBaseClientGetItemURL||(R._origBaseClientGetItemURL=v.default.prototype.getItemURL,v.default.prototype.getItemURL=function(){throw new Error("getItemURL is not implemented for Dropbox yet")})}(Y)}(0,N.applyMixins)(j,[q.default]),P.exports=j},function(P,I,T){var p=this&&this.__importDefault||function(S){return S&&S.__esModule?S:{default:S}};const x=p(T(28)),q=p(T(1)),v=T(0);let k,w,u={};const N=function(S){return new Promise((A,c)=>S in u?A(u[S]):new x.default({tls_only:!1,uri_fallback:!0,request_timeout:5e3}).lookup(S,function(l,s){if(l)return c(l);if(typeof s.idx.links.remotestorage!="object"||typeof s.idx.links.remotestorage.length!="number"||s.idx.links.remotestorage.length<=0)return(0,q.default)("[Discover] WebFinger record for "+S+" does not have remotestorage defined in the links section ",JSON.stringify(s.json)),c("WebFinger record for "+S+" does not have remotestorage defined in the links section.");const g=s.idx.links.remotestorage[0],y=g.properties["http://tools.ietf.org/html/rfc6749#section-4.2"]||g.properties["auth-endpoint"],O=g.properties["http://remotestorage.io/spec/version"]||g.type;return u[S]={href:g.href,storageApi:O,authURL:y,properties:g.properties},w&&(localStorage["remotestorage:discover"]=JSON.stringify({cache:u})),A(u[S])}))};(N.DiscoveryError=function(S){this.name="DiscoveryError",this.message=S,this.stack=new Error().stack}).prototype=Object.create(Error.prototype),N.DiscoveryError.prototype.constructor=N.DiscoveryError,N._rs_init=function(){if(w=(0,v.localStorageAvailable)(),w)try{u=JSON.parse(localStorage["remotestorage:discover"]).cache}catch{}},N._rs_supported=function(){return k=Object.prototype.hasOwnProperty.call(v.globalContext,"XMLHttpRequest"),k},N._rs_cleanup=function(){w&&delete localStorage["remotestorage:discover"]},P.exports=N},function(P,I,T){const p=(this&&this.__importDefault||function(v){return v&&v.__esModule?v:{default:v}})(T(2)),x=T(0);class q{constructor(){this.addEvents(["background","foreground"]),this.mode=typeof window<"u"?"browser":"node",this.mode==="browser"&&(this.setBrowserPrefixedNames(),document.addEventListener(this.visibilityChangeEvent,this.setVisibility.bind(this),!1),this.setVisibility())}setBrowserPrefixedNames(){this.mode==="browser"&&(document.hidden!==void 0?(this.hiddenProperty="hidden",this.visibilityChangeEvent="visibilitychange"):document.mozHidden!==void 0?(this.hiddenProperty="mozHidden",this.visibilityChangeEvent="mozvisibilitychange"):document.msHidden!==void 0?(this.hiddenProperty="msHidden",this.visibilityChangeEvent="msvisibilitychange"):document.webkitHidden!==void 0&&(this.hiddenProperty="webkitHidden",this.visibilityChangeEvent="webkitvisibilitychange"))}setVisibility(){document[this.hiddenProperty]?this.goBackground():this.goForeground()}isBrowser(){return this.mode==="browser"}isNode(){return this.mode==="node"}goBackground(){this._emit("background")}goForeground(){this._emit("foreground")}static _rs_init(){}static _rs_cleanup(){}}(0,x.applyMixins)(q,[p.default]),P.exports=q},function(P,I,T){P.exports=T(19)},function(P,I,T){var p=this&&this.__createBinding||(Object.create?function(R,_,m,r){r===void 0&&(r=m);var n=Object.getOwnPropertyDescriptor(_,m);n&&!("get"in n?!_.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return _[m]}}),Object.defineProperty(R,r,n)}:function(R,_,m,r){r===void 0&&(r=m),R[r]=_[m]}),x=this&&this.__setModuleDefault||(Object.create?function(R,_){Object.defineProperty(R,"default",{enumerable:!0,value:_})}:function(R,_){R.default=_}),q=this&&this.__importStar||function(R){if(R&&R.__esModule)return R;var _={};if(R!=null)for(var m in R)m!=="default"&&Object.prototype.hasOwnProperty.call(R,m)&&p(_,R,m);return x(_,R),_},v=this&&this.__importDefault||function(R){return R&&R.__esModule?R:{default:R}};const k=v(T(3)),w=v(T(1)),u=T(0),N=v(T(12)),S=v(T(4)),A=v(T(8)),c=v(T(13)),l=v(T(2)),s=v(T(14)),g=v(T(15)),y=v(T(16)),O=v(T(10)),b=v(T(5)),t=v(T(30)),h=q(T(0)),d=(0,u.getGlobalContext)();let j;function F(R){return R.statusCode!==403&&R.statusCode!==401||this._emit("error",new b.default),Promise.resolve(R)}function B(R){return typeof R=="number"&&R>=2e3&&R<=36e5}class z{constructor(_){this._pending=[],this._cleanups=[],this._pathHandlers={change:{}},this.apiKeys={},this._init=t.default.loadFeatures,this.features=t.default.features,this.loadFeature=t.default.loadFeature,this.featureSupported=t.default.featureSupported,this.featureDone=t.default.featureDone,this.featuresDone=t.default.featuresDone,this.featuresLoaded=t.default.featuresLoaded,this.featureInitialized=t.default.featureInitialized,this.featureFailed=t.default.featureFailed,this.hasFeature=t.default.hasFeature,this._setCachingModule=t.default._setCachingModule,this._collectCleanupFunctions=t.default._collectCleanupFunctions,this._fireReady=t.default._fireReady,this.initFeature=t.default.initFeature,typeof _=="object"&&(0,u.extend)(k.default,_),this.addEvents(["ready","authing","connecting","connected","disconnected","not-connected","conflict","error","features-loaded","sync-interval-change","sync-req-done","sync-done","wire-busy","wire-done","network-offline","network-online"]),this._setGPD({get:this._pendingGPD("get"),put:this._pendingGPD("put"),delete:this._pendingGPD("delete")}),j=(0,u.localStorageAvailable)(),j&&(this.apiKeys=(0,u.getJSONFromLocalStorage)("remotestorage:api-keys")||{},this.setBackend(localStorage.getItem("remotestorage:backend")||"remotestorage"));const m=this.on;this.on=function(r,n){if(this._allLoaded)switch(r){case"features-loaded":setTimeout(n,0);break;case"ready":this.remote&&setTimeout(n,0);break;case"connected":this.remote&&this.remote.connected&&setTimeout(n,0);break;case"not-connected":this.remote&&!this.remote.connected&&setTimeout(n,0)}return m.call(this,r,n)},this._init(),this.fireInitial=function(){this.local&&setTimeout(this.local.fireInitial.bind(this.local),0)}.bind(this),this.on("ready",this.fireInitial.bind(this)),this.loadModules()}get connected(){return this.remote.connected}loadModules(){k.default.modules.forEach(this.addModule.bind(this))}authorize(_){if(this.access.setStorageType(this.remote.storageApi),_.scope===void 0&&(_.scope=this.access.scopeParameter),d.cordova)_.redirectUri=k.default.cordovaRedirectUri;else{const m=S.default.getLocation();let r=m.origin;m.pathname!=="/"&&(r+=m.pathname),_.redirectUri=r}_.clientId===void 0&&(_.clientId=_.redirectUri.match(/^(https?:\/\/[^/]+)/)[0]),S.default.authorize(this,_)}impliedauth(_,m){_=_||this.remote.storageApi,m=m||String(document.location),(0,w.default)("ImpliedAuth proceeding due to absent authURL; storageApi = "+_+" redirectUri = "+m),this.remote.configure({token:S.default.IMPLIED_FAKE_TOKEN}),document.location.href=m}connect(_,m){if(this.setBackend("remotestorage"),_.indexOf("@")<0&&!_.match(/^(https?:\/\/)?[^\s\/$\.?#]+\.[^\s]*$/))return void this._emit("error",new z.DiscoveryError("Not a valid user address or URL."));if(_.indexOf("@")<0&&!_.match(/^https?:\/\//)&&(_="https://"+_),d.cordova){if(typeof k.default.cordovaRedirectUri!="string")return void this._emit("error",new z.DiscoveryError("Please supply a custom HTTPS redirect URI for your Cordova app"));if(!d.cordova.InAppBrowser)return void this._emit("error",new z.DiscoveryError("Please include the InAppBrowser Cordova plugin to enable OAuth"))}this.remote.configure({userAddress:_}),this._emit("connecting");const r=setTimeout(()=>{this._emit("error",new z.DiscoveryError("No storage information found for this user address."))},k.default.discoveryTimeout);(0,y.default)(_).then(n=>{if(clearTimeout(r),this._emit("authing"),n.userAddress=_,this.remote.configure(n),!this.remote.connected)if(n.authURL)if(m===void 0)this.authorize({authURL:n.authURL});else{if(typeof m!="string")throw new Error("Supplied bearer token must be a string");(0,w.default)("Skipping authorization sequence and connecting with known token"),this.remote.configure({token:m})}else this.impliedauth()},()=>{clearTimeout(r),this._emit("error",new z.DiscoveryError("No storage information found for this user address."))})}reconnect(){this.remote.configure({token:null}),this.backend==="remotestorage"?this.connect(this.remote.userAddress):this.remote.connect()}disconnect(){this.remote&&this.remote.configure({userAddress:null,href:null,storageApi:null,token:null,properties:null}),this._setGPD({get:this._pendingGPD("get"),put:this._pendingGPD("put"),delete:this._pendingGPD("delete")});const _=this._cleanups.length;let m=0;const r=()=>{m++,m>=_&&(this._init(),this._emit("disconnected"))};_>0?this._cleanups.forEach(n=>{const f=n(this);typeof f=="object"&&typeof f.then=="function"?f.then(r):r()}):r()}setBackend(_){this.backend=_,j&&(_?localStorage.setItem("remotestorage:backend",_):localStorage.removeItem("remotestorage:backend"))}onChange(_,m){this._pathHandlers.change[_]||(this._pathHandlers.change[_]=[]),this._pathHandlers.change[_].push(m)}enableLog(){k.default.logging=!0}disableLog(){k.default.logging=!1}log(..._){w.default.apply(z,_)}setApiKeys(_){const m=[Y.GOOGLE,Y.DROPBOX];if(typeof _!="object"||!Object.keys(_).every(r=>m.includes(r)))return console.error("setApiKeys() was called with invalid arguments"),!1;Object.keys(_).forEach(r=>{const n=_[r];if(n){switch(r){case Y.DROPBOX:this.apiKeys[Y.DROPBOX]={appKey:n},this.dropbox!==void 0&&this.dropbox.clientId===n||g.default._rs_init(this);break;case Y.GOOGLE:this.apiKeys[Y.GOOGLE]={clientId:n},this.googledrive!==void 0&&this.googledrive.clientId===n||s.default._rs_init(this)}return!0}delete this.apiKeys[r]}),j&&localStorage.setItem("remotestorage:api-keys",JSON.stringify(this.apiKeys))}setCordovaRedirectUri(_){if(typeof _!="string"||!_.match(/http(s)?:\/\//))throw new Error("Cordova redirect URI must be a URI string");k.default.cordovaRedirectUri=_}_setGPD(_,m){function r(n){return function(...f){return n.apply(m,f).then(F.bind(this))}}this.get=r(_.get),this.put=r(_.put),this.delete=r(_.delete)}_pendingGPD(_){return(...m)=>{const r=Array.prototype.slice.call(m);return new Promise((n,f)=>{this._pending.push({method:_,args:r,promise:{resolve:n,reject:f}})})}}_processPending(){this._pending.forEach(_=>{try{this[_.method](..._.args).then(_.promise.resolve,_.promise.reject)}catch(m){_.promise.reject(m)}}),this._pending=[]}_bindChange(_){_.on("change",this._dispatchEvent.bind(this,"change"))}_dispatchEvent(_,m){Object.keys(this._pathHandlers[_]).forEach(r=>{const n=r.length;m.path.substr(0,n)===r&&this._pathHandlers[_][r].forEach(f=>{const E={};for(const M in m)E[M]=m[M];E.relativePath=m.path.replace(new RegExp("^"+r),"");try{f(E)}catch(M){console.error("'change' handler failed: ",M,M.stack),this._emit("error",M)}})})}scope(_){if(typeof _!="string")throw"Argument 'path' of baseClient.scope must be a string";return this.access.checkPathPermission(_,"r")||console.warn("WARNING: Please use remoteStorage.access.claim() to ask for access permissions first: https://remotestoragejs.readthedocs.io/en/latest/js-api/access.html#claim"),new A.default(this,_)}getSyncInterval(){return k.default.syncInterval}setSyncInterval(_){if(!B(_))throw _+" is not a valid sync interval";const m=k.default.syncInterval;k.default.syncInterval=_,this._emit("sync-interval-change",{oldValue:m,newValue:_})}getBackgroundSyncInterval(){return k.default.backgroundSyncInterval}setBackgroundSyncInterval(_){if(!B(_))throw _+" is not a valid sync interval";const m=k.default.backgroundSyncInterval;k.default.backgroundSyncInterval=_,this._emit("sync-interval-change",{oldValue:m,newValue:_})}getCurrentSyncInterval(){return k.default.isBackground?k.default.backgroundSyncInterval:k.default.syncInterval}getRequestTimeout(){return k.default.requestTimeout}setRequestTimeout(_){if(typeof _!="number")throw _+" is not a valid request timeout";k.default.requestTimeout=_}syncCycle(){this.sync&&!this.sync.stopped&&(this.on("sync-done",()=>{this.sync&&!this.sync.stopped&&(this._syncTimer&&(clearTimeout(this._syncTimer),this._syncTimer=void 0),this._syncTimer=setTimeout(this.sync.sync.bind(this.sync),this.getCurrentSyncInterval()))}),this.sync.sync())}startSync(){return k.default.cache?(this.sync.stopped=!1,this.syncStopped=!1,this.sync.sync()):(console.warn("Nothing to sync, because caching is disabled."),Promise.resolve())}stopSync(){clearTimeout(this._syncTimer),this._syncTimer=void 0,this.sync?this.sync.stopped=!0:this.syncStopped=!0}addModule(_){const m=_.name,r=_.builder;if(Object.defineProperty(this,m,{configurable:!0,get:function(){const n=this._loadModule(m,r);return Object.defineProperty(this,m,{value:n}),n}}),m.indexOf("-")!==-1){const n=m.replace(/\-[a-z]/g,function(f){return f[1].toUpperCase()});Object.defineProperty(this,n,{get:function(){return this[m]}})}}_loadModule(_,m){if(m)return m(new A.default(this,"/"+_+"/"),new A.default(this,"/public/"+_+"/")).exports;throw"Unknown module: "+_}}var Y;z.Authorize=S.default,z.SyncError=O.default,z.Unauthorized=b.default,z.DiscoveryError=y.default.DiscoveryError,z.util=h,Object.defineProperty(z.prototype,"access",{get:function(){const R=new N.default;return Object.defineProperty(this,"access",{value:R}),R},configurable:!0}),Object.defineProperty(z.prototype,"caching",{configurable:!0,get:function(){const R=new c.default;return Object.defineProperty(this,"caching",{value:R}),R}}),(0,u.applyMixins)(z,[l.default]),function(R){R.GOOGLE="googledrive",R.DROPBOX="dropbox"}(Y||(Y={})),P.exports=z},function(P,I,T){(function(p){/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */var x=T(21),q=T(22),v=T(23);function k(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function w(e,o){if(k()<o)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(o)).__proto__=u.prototype:(e===null&&(e=new u(o)),e.length=o),e}function u(e,o,a){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(e,o,a);if(typeof e=="number"){if(typeof o=="string")throw new Error("If encoding is specified then the first argument must be a string");return A(this,e)}return N(this,e,o,a)}function N(e,o,a,U){if(typeof o=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&o instanceof ArrayBuffer?function(C,L,V,X){if(L.byteLength,V<0||L.byteLength<V)throw new RangeError("'offset' is out of bounds");if(L.byteLength<V+(X||0))throw new RangeError("'length' is out of bounds");return L=V===void 0&&X===void 0?new Uint8Array(L):X===void 0?new Uint8Array(L,V):new Uint8Array(L,V,X),u.TYPED_ARRAY_SUPPORT?(C=L).__proto__=u.prototype:C=c(C,L),C}(e,o,a,U):typeof o=="string"?function(C,L,V){if(typeof V=="string"&&V!==""||(V="utf8"),!u.isEncoding(V))throw new TypeError('"encoding" must be a valid string encoding');var X=0|s(L,V),rt=(C=w(C,X)).write(L,V);return rt!==X&&(C=C.slice(0,rt)),C}(e,o,a):function(C,L){if(u.isBuffer(L)){var V=0|l(L.length);return(C=w(C,V)).length===0||L.copy(C,0,0,V),C}if(L){if(typeof ArrayBuffer<"u"&&L.buffer instanceof ArrayBuffer||"length"in L)return typeof L.length!="number"||(X=L.length)!=X?w(C,0):c(C,L);if(L.type==="Buffer"&&v(L.data))return c(C,L.data)}var X;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,o)}function S(e){if(typeof e!="number")throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function A(e,o){if(S(o),e=w(e,o<0?0:0|l(o)),!u.TYPED_ARRAY_SUPPORT)for(var a=0;a<o;++a)e[a]=0;return e}function c(e,o){var a=o.length<0?0:0|l(o.length);e=w(e,a);for(var U=0;U<a;U+=1)e[U]=255&o[U];return e}function l(e){if(e>=k())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+k().toString(16)+" bytes");return 0|e}function s(e,o){if(u.isBuffer(e))return e.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;typeof e!="string"&&(e=""+e);var a=e.length;if(a===0)return 0;for(var U=!1;;)switch(o){case"ascii":case"latin1":case"binary":return a;case"utf8":case"utf-8":case void 0:return nt(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*a;case"hex":return a>>>1;case"base64":return et(e).length;default:if(U)return nt(e).length;o=(""+o).toLowerCase(),U=!0}}function g(e,o,a){var U=!1;if((o===void 0||o<0)&&(o=0),o>this.length||((a===void 0||a>this.length)&&(a=this.length),a<=0)||(a>>>=0)<=(o>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return m(this,o,a);case"utf8":case"utf-8":return Y(this,o,a);case"ascii":return R(this,o,a);case"latin1":case"binary":return _(this,o,a);case"base64":return z(this,o,a);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return r(this,o,a);default:if(U)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),U=!0}}function y(e,o,a){var U=e[o];e[o]=e[a],e[a]=U}function O(e,o,a,U,C){if(e.length===0)return-1;if(typeof a=="string"?(U=a,a=0):a>2147483647?a=2147483647:a<-2147483648&&(a=-2147483648),a=+a,isNaN(a)&&(a=C?0:e.length-1),a<0&&(a=e.length+a),a>=e.length){if(C)return-1;a=e.length-1}else if(a<0){if(!C)return-1;a=0}if(typeof o=="string"&&(o=u.from(o,U)),u.isBuffer(o))return o.length===0?-1:b(e,o,a,U,C);if(typeof o=="number")return o&=255,u.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?C?Uint8Array.prototype.indexOf.call(e,o,a):Uint8Array.prototype.lastIndexOf.call(e,o,a):b(e,[o],a,U,C);throw new TypeError("val must be string, number or Buffer")}function b(e,o,a,U,C){var L,V=1,X=e.length,rt=o.length;if(U!==void 0&&((U=String(U).toLowerCase())==="ucs2"||U==="ucs-2"||U==="utf16le"||U==="utf-16le")){if(e.length<2||o.length<2)return-1;V=2,X/=2,rt/=2,a/=2}function tt(ut,lt){return V===1?ut[lt]:ut.readUInt16BE(lt*V)}if(C){var K=-1;for(L=a;L<X;L++)if(tt(e,L)===tt(o,K===-1?0:L-K)){if(K===-1&&(K=L),L-K+1===rt)return K*V}else K!==-1&&(L-=L-K),K=-1}else for(a+rt>X&&(a=X-rt),L=a;L>=0;L--){for(var it=!0,at=0;at<rt;at++)if(tt(e,L+at)!==tt(o,at)){it=!1;break}if(it)return L}return-1}function t(e,o,a,U){a=Number(a)||0;var C=e.length-a;U?(U=Number(U))>C&&(U=C):U=C;var L=o.length;if(L%2!=0)throw new TypeError("Invalid hex string");U>L/2&&(U=L/2);for(var V=0;V<U;++V){var X=parseInt(o.substr(2*V,2),16);if(isNaN(X))return V;e[a+V]=X}return V}function h(e,o,a,U){return $(nt(o,e.length-a),e,a,U)}function d(e,o,a,U){return $(function(C){for(var L=[],V=0;V<C.length;++V)L.push(255&C.charCodeAt(V));return L}(o),e,a,U)}function j(e,o,a,U){return d(e,o,a,U)}function F(e,o,a,U){return $(et(o),e,a,U)}function B(e,o,a,U){return $(function(C,L){for(var V,X,rt,tt=[],K=0;K<C.length&&!((L-=2)<0);++K)V=C.charCodeAt(K),X=V>>8,rt=V%256,tt.push(rt),tt.push(X);return tt}(o,e.length-a),e,a,U)}function z(e,o,a){return o===0&&a===e.length?x.fromByteArray(e):x.fromByteArray(e.slice(o,a))}function Y(e,o,a){a=Math.min(e.length,a);for(var U=[],C=o;C<a;){var L,V,X,rt,tt=e[C],K=null,it=tt>239?4:tt>223?3:tt>191?2:1;if(C+it<=a)switch(it){case 1:tt<128&&(K=tt);break;case 2:(192&(L=e[C+1]))==128&&(rt=(31&tt)<<6|63&L)>127&&(K=rt);break;case 3:L=e[C+1],V=e[C+2],(192&L)==128&&(192&V)==128&&(rt=(15&tt)<<12|(63&L)<<6|63&V)>2047&&(rt<55296||rt>57343)&&(K=rt);break;case 4:L=e[C+1],V=e[C+2],X=e[C+3],(192&L)==128&&(192&V)==128&&(192&X)==128&&(rt=(15&tt)<<18|(63&L)<<12|(63&V)<<6|63&X)>65535&&rt<1114112&&(K=rt)}K===null?(K=65533,it=1):K>65535&&(K-=65536,U.push(K>>>10&1023|55296),K=56320|1023&K),U.push(K),C+=it}return function(at){var ut=at.length;if(ut<=4096)return String.fromCharCode.apply(String,at);for(var lt="",wt=0;wt<ut;)lt+=String.fromCharCode.apply(String,at.slice(wt,wt+=4096));return lt}(U)}I.Buffer=u,I.SlowBuffer=function(e){return+e!=e&&(e=0),u.alloc(+e)},I.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=p.TYPED_ARRAY_SUPPORT!==void 0?p.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},e.foo()===42&&typeof e.subarray=="function"&&e.subarray(1,1).byteLength===0}catch{return!1}}(),I.kMaxLength=k(),u.poolSize=8192,u._augment=function(e){return e.__proto__=u.prototype,e},u.from=function(e,o,a){return N(null,e,o,a)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(e,o,a){return function(U,C,L,V){return S(C),C<=0?w(U,C):L!==void 0?typeof V=="string"?w(U,C).fill(L,V):w(U,C).fill(L):w(U,C)}(null,e,o,a)},u.allocUnsafe=function(e){return A(null,e)},u.allocUnsafeSlow=function(e){return A(null,e)},u.isBuffer=function(e){return!(e==null||!e._isBuffer)},u.compare=function(e,o){if(!u.isBuffer(e)||!u.isBuffer(o))throw new TypeError("Arguments must be Buffers");if(e===o)return 0;for(var a=e.length,U=o.length,C=0,L=Math.min(a,U);C<L;++C)if(e[C]!==o[C]){a=e[C],U=o[C];break}return a<U?-1:U<a?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,o){if(!v(e))throw new TypeError('"list" argument must be an Array of Buffers');if(e.length===0)return u.alloc(0);var a;if(o===void 0)for(o=0,a=0;a<e.length;++a)o+=e[a].length;var U=u.allocUnsafe(o),C=0;for(a=0;a<e.length;++a){var L=e[a];if(!u.isBuffer(L))throw new TypeError('"list" argument must be an Array of Buffers');L.copy(U,C),C+=L.length}return U},u.byteLength=s,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var o=0;o<e;o+=2)y(this,o,o+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var o=0;o<e;o+=4)y(this,o,o+3),y(this,o+1,o+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var o=0;o<e;o+=8)y(this,o,o+7),y(this,o+1,o+6),y(this,o+2,o+5),y(this,o+3,o+4);return this},u.prototype.toString=function(){var e=0|this.length;return e===0?"":arguments.length===0?Y(this,0,e):g.apply(this,arguments)},u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||u.compare(this,e)===0},u.prototype.inspect=function(){var e="",o=I.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,o).match(/.{2}/g).join(" "),this.length>o&&(e+=" ... ")),"<Buffer "+e+">"},u.prototype.compare=function(e,o,a,U,C){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(o===void 0&&(o=0),a===void 0&&(a=e?e.length:0),U===void 0&&(U=0),C===void 0&&(C=this.length),o<0||a>e.length||U<0||C>this.length)throw new RangeError("out of range index");if(U>=C&&o>=a)return 0;if(U>=C)return-1;if(o>=a)return 1;if(this===e)return 0;for(var L=(C>>>=0)-(U>>>=0),V=(a>>>=0)-(o>>>=0),X=Math.min(L,V),rt=this.slice(U,C),tt=e.slice(o,a),K=0;K<X;++K)if(rt[K]!==tt[K]){L=rt[K],V=tt[K];break}return L<V?-1:V<L?1:0},u.prototype.includes=function(e,o,a){return this.indexOf(e,o,a)!==-1},u.prototype.indexOf=function(e,o,a){return O(this,e,o,a,!0)},u.prototype.lastIndexOf=function(e,o,a){return O(this,e,o,a,!1)},u.prototype.write=function(e,o,a,U){if(o===void 0)U="utf8",a=this.length,o=0;else if(a===void 0&&typeof o=="string")U=o,a=this.length,o=0;else{if(!isFinite(o))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");o|=0,isFinite(a)?(a|=0,U===void 0&&(U="utf8")):(U=a,a=void 0)}var C=this.length-o;if((a===void 0||a>C)&&(a=C),e.length>0&&(a<0||o<0)||o>this.length)throw new RangeError("Attempt to write outside buffer bounds");U||(U="utf8");for(var L=!1;;)switch(U){case"hex":return t(this,e,o,a);case"utf8":case"utf-8":return h(this,e,o,a);case"ascii":return d(this,e,o,a);case"latin1":case"binary":return j(this,e,o,a);case"base64":return F(this,e,o,a);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return B(this,e,o,a);default:if(L)throw new TypeError("Unknown encoding: "+U);U=(""+U).toLowerCase(),L=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function R(e,o,a){var U="";a=Math.min(e.length,a);for(var C=o;C<a;++C)U+=String.fromCharCode(127&e[C]);return U}function _(e,o,a){var U="";a=Math.min(e.length,a);for(var C=o;C<a;++C)U+=String.fromCharCode(e[C]);return U}function m(e,o,a){var U=e.length;(!o||o<0)&&(o=0),(!a||a<0||a>U)&&(a=U);for(var C="",L=o;L<a;++L)C+=Q(e[L]);return C}function r(e,o,a){for(var U=e.slice(o,a),C="",L=0;L<U.length;L+=2)C+=String.fromCharCode(U[L]+256*U[L+1]);return C}function n(e,o,a){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+o>a)throw new RangeError("Trying to access beyond buffer length")}function f(e,o,a,U,C,L){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(o>C||o<L)throw new RangeError('"value" argument is out of bounds');if(a+U>e.length)throw new RangeError("Index out of range")}function E(e,o,a,U){o<0&&(o=65535+o+1);for(var C=0,L=Math.min(e.length-a,2);C<L;++C)e[a+C]=(o&255<<8*(U?C:1-C))>>>8*(U?C:1-C)}function M(e,o,a,U){o<0&&(o=4294967295+o+1);for(var C=0,L=Math.min(e.length-a,4);C<L;++C)e[a+C]=o>>>8*(U?C:3-C)&255}function G(e,o,a,U,C,L){if(a+U>e.length)throw new RangeError("Index out of range");if(a<0)throw new RangeError("Index out of range")}function J(e,o,a,U,C){return C||G(e,0,a,4),q.write(e,o,a,U,23,4),a+4}function H(e,o,a,U,C){return C||G(e,0,a,8),q.write(e,o,a,U,52,8),a+8}u.prototype.slice=function(e,o){var a,U=this.length;if((e=~~e)<0?(e+=U)<0&&(e=0):e>U&&(e=U),(o=o===void 0?U:~~o)<0?(o+=U)<0&&(o=0):o>U&&(o=U),o<e&&(o=e),u.TYPED_ARRAY_SUPPORT)(a=this.subarray(e,o)).__proto__=u.prototype;else{var C=o-e;a=new u(C,void 0);for(var L=0;L<C;++L)a[L]=this[L+e]}return a},u.prototype.readUIntLE=function(e,o,a){e|=0,o|=0,a||n(e,o,this.length);for(var U=this[e],C=1,L=0;++L<o&&(C*=256);)U+=this[e+L]*C;return U},u.prototype.readUIntBE=function(e,o,a){e|=0,o|=0,a||n(e,o,this.length);for(var U=this[e+--o],C=1;o>0&&(C*=256);)U+=this[e+--o]*C;return U},u.prototype.readUInt8=function(e,o){return o||n(e,1,this.length),this[e]},u.prototype.readUInt16LE=function(e,o){return o||n(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUInt16BE=function(e,o){return o||n(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUInt32LE=function(e,o){return o||n(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUInt32BE=function(e,o){return o||n(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,o,a){e|=0,o|=0,a||n(e,o,this.length);for(var U=this[e],C=1,L=0;++L<o&&(C*=256);)U+=this[e+L]*C;return U>=(C*=128)&&(U-=Math.pow(2,8*o)),U},u.prototype.readIntBE=function(e,o,a){e|=0,o|=0,a||n(e,o,this.length);for(var U=o,C=1,L=this[e+--U];U>0&&(C*=256);)L+=this[e+--U]*C;return L>=(C*=128)&&(L-=Math.pow(2,8*o)),L},u.prototype.readInt8=function(e,o){return o||n(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,o){o||n(e,2,this.length);var a=this[e]|this[e+1]<<8;return 32768&a?4294901760|a:a},u.prototype.readInt16BE=function(e,o){o||n(e,2,this.length);var a=this[e+1]|this[e]<<8;return 32768&a?4294901760|a:a},u.prototype.readInt32LE=function(e,o){return o||n(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,o){return o||n(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,o){return o||n(e,4,this.length),q.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,o){return o||n(e,4,this.length),q.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,o){return o||n(e,8,this.length),q.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,o){return o||n(e,8,this.length),q.read(this,e,!1,52,8)},u.prototype.writeUIntLE=function(e,o,a,U){e=+e,o|=0,a|=0,U||f(this,e,o,a,Math.pow(2,8*a)-1,0);var C=1,L=0;for(this[o]=255&e;++L<a&&(C*=256);)this[o+L]=e/C&255;return o+a},u.prototype.writeUIntBE=function(e,o,a,U){e=+e,o|=0,a|=0,U||f(this,e,o,a,Math.pow(2,8*a)-1,0);var C=a-1,L=1;for(this[o+C]=255&e;--C>=0&&(L*=256);)this[o+C]=e/L&255;return o+a},u.prototype.writeUInt8=function(e,o,a){return e=+e,o|=0,a||f(this,e,o,1,255,0),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[o]=255&e,o+1},u.prototype.writeUInt16LE=function(e,o,a){return e=+e,o|=0,a||f(this,e,o,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[o]=255&e,this[o+1]=e>>>8):E(this,e,o,!0),o+2},u.prototype.writeUInt16BE=function(e,o,a){return e=+e,o|=0,a||f(this,e,o,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[o]=e>>>8,this[o+1]=255&e):E(this,e,o,!1),o+2},u.prototype.writeUInt32LE=function(e,o,a){return e=+e,o|=0,a||f(this,e,o,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[o+3]=e>>>24,this[o+2]=e>>>16,this[o+1]=e>>>8,this[o]=255&e):M(this,e,o,!0),o+4},u.prototype.writeUInt32BE=function(e,o,a){return e=+e,o|=0,a||f(this,e,o,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[o]=e>>>24,this[o+1]=e>>>16,this[o+2]=e>>>8,this[o+3]=255&e):M(this,e,o,!1),o+4},u.prototype.writeIntLE=function(e,o,a,U){if(e=+e,o|=0,!U){var C=Math.pow(2,8*a-1);f(this,e,o,a,C-1,-C)}var L=0,V=1,X=0;for(this[o]=255&e;++L<a&&(V*=256);)e<0&&X===0&&this[o+L-1]!==0&&(X=1),this[o+L]=(e/V>>0)-X&255;return o+a},u.prototype.writeIntBE=function(e,o,a,U){if(e=+e,o|=0,!U){var C=Math.pow(2,8*a-1);f(this,e,o,a,C-1,-C)}var L=a-1,V=1,X=0;for(this[o+L]=255&e;--L>=0&&(V*=256);)e<0&&X===0&&this[o+L+1]!==0&&(X=1),this[o+L]=(e/V>>0)-X&255;return o+a},u.prototype.writeInt8=function(e,o,a){return e=+e,o|=0,a||f(this,e,o,1,127,-128),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[o]=255&e,o+1},u.prototype.writeInt16LE=function(e,o,a){return e=+e,o|=0,a||f(this,e,o,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[o]=255&e,this[o+1]=e>>>8):E(this,e,o,!0),o+2},u.prototype.writeInt16BE=function(e,o,a){return e=+e,o|=0,a||f(this,e,o,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[o]=e>>>8,this[o+1]=255&e):E(this,e,o,!1),o+2},u.prototype.writeInt32LE=function(e,o,a){return e=+e,o|=0,a||f(this,e,o,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[o]=255&e,this[o+1]=e>>>8,this[o+2]=e>>>16,this[o+3]=e>>>24):M(this,e,o,!0),o+4},u.prototype.writeInt32BE=function(e,o,a){return e=+e,o|=0,a||f(this,e,o,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),u.TYPED_ARRAY_SUPPORT?(this[o]=e>>>24,this[o+1]=e>>>16,this[o+2]=e>>>8,this[o+3]=255&e):M(this,e,o,!1),o+4},u.prototype.writeFloatLE=function(e,o,a){return J(this,e,o,!0,a)},u.prototype.writeFloatBE=function(e,o,a){return J(this,e,o,!1,a)},u.prototype.writeDoubleLE=function(e,o,a){return H(this,e,o,!0,a)},u.prototype.writeDoubleBE=function(e,o,a){return H(this,e,o,!1,a)},u.prototype.copy=function(e,o,a,U){if(a||(a=0),U||U===0||(U=this.length),o>=e.length&&(o=e.length),o||(o=0),U>0&&U<a&&(U=a),U===a||e.length===0||this.length===0)return 0;if(o<0)throw new RangeError("targetStart out of bounds");if(a<0||a>=this.length)throw new RangeError("sourceStart out of bounds");if(U<0)throw new RangeError("sourceEnd out of bounds");U>this.length&&(U=this.length),e.length-o<U-a&&(U=e.length-o+a);var C,L=U-a;if(this===e&&a<o&&o<U)for(C=L-1;C>=0;--C)e[C+o]=this[C+a];else if(L<1e3||!u.TYPED_ARRAY_SUPPORT)for(C=0;C<L;++C)e[C+o]=this[C+a];else Uint8Array.prototype.set.call(e,this.subarray(a,a+L),o);return L},u.prototype.fill=function(e,o,a,U){if(typeof e=="string"){if(typeof o=="string"?(U=o,o=0,a=this.length):typeof a=="string"&&(U=a,a=this.length),e.length===1){var C=e.charCodeAt(0);C<256&&(e=C)}if(U!==void 0&&typeof U!="string")throw new TypeError("encoding must be a string");if(typeof U=="string"&&!u.isEncoding(U))throw new TypeError("Unknown encoding: "+U)}else typeof e=="number"&&(e&=255);if(o<0||this.length<o||this.length<a)throw new RangeError("Out of range index");if(a<=o)return this;var L;if(o>>>=0,a=a===void 0?this.length:a>>>0,e||(e=0),typeof e=="number")for(L=o;L<a;++L)this[L]=e;else{var V=u.isBuffer(e)?e:nt(new u(e,U).toString()),X=V.length;for(L=0;L<a-o;++L)this[L+o]=V[L%X]}return this};var W=/[^+\/0-9A-Za-z-_]/g;function Q(e){return e<16?"0"+e.toString(16):e.toString(16)}function nt(e,o){var a;o=o||1/0;for(var U=e.length,C=null,L=[],V=0;V<U;++V){if((a=e.charCodeAt(V))>55295&&a<57344){if(!C){if(a>56319){(o-=3)>-1&&L.push(239,191,189);continue}if(V+1===U){(o-=3)>-1&&L.push(239,191,189);continue}C=a;continue}if(a<56320){(o-=3)>-1&&L.push(239,191,189),C=a;continue}a=65536+(C-55296<<10|a-56320)}else C&&(o-=3)>-1&&L.push(239,191,189);if(C=null,a<128){if((o-=1)<0)break;L.push(a)}else if(a<2048){if((o-=2)<0)break;L.push(a>>6|192,63&a|128)}else if(a<65536){if((o-=3)<0)break;L.push(a>>12|224,a>>6&63|128,63&a|128)}else{if(!(a<1114112))throw new Error("Invalid code point");if((o-=4)<0)break;L.push(a>>18|240,a>>12&63|128,a>>6&63|128,63&a|128)}}return L}function et(e){return x.toByteArray(function(o){if((o=function(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}(o).replace(W,"")).length<2)return"";for(;o.length%4!=0;)o+="=";return o}(e))}function $(e,o,a,U){for(var C=0;C<U&&!(C+a>=o.length||C>=e.length);++C)o[C+a]=e[C];return C}}).call(this,T(6))},function(P,I,T){I.byteLength=function(S){var A=u(S),c=A[0],l=A[1];return 3*(c+l)/4-l},I.toByteArray=function(S){var A,c,l=u(S),s=l[0],g=l[1],y=new q(function(t,h,d){return 3*(h+d)/4-d}(0,s,g)),O=0,b=g>0?s-4:s;for(c=0;c<b;c+=4)A=x[S.charCodeAt(c)]<<18|x[S.charCodeAt(c+1)]<<12|x[S.charCodeAt(c+2)]<<6|x[S.charCodeAt(c+3)],y[O++]=A>>16&255,y[O++]=A>>8&255,y[O++]=255&A;return g===2&&(A=x[S.charCodeAt(c)]<<2|x[S.charCodeAt(c+1)]>>4,y[O++]=255&A),g===1&&(A=x[S.charCodeAt(c)]<<10|x[S.charCodeAt(c+1)]<<4|x[S.charCodeAt(c+2)]>>2,y[O++]=A>>8&255,y[O++]=255&A),y},I.fromByteArray=function(S){for(var A,c=S.length,l=c%3,s=[],g=0,y=c-l;g<y;g+=16383)s.push(N(S,g,g+16383>y?y:g+16383));return l===1?(A=S[c-1],s.push(p[A>>2]+p[A<<4&63]+"==")):l===2&&(A=(S[c-2]<<8)+S[c-1],s.push(p[A>>10]+p[A>>4&63]+p[A<<2&63]+"=")),s.join("")};for(var p=[],x=[],q=typeof Uint8Array<"u"?Uint8Array:Array,v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",k=0,w=v.length;k<w;++k)p[k]=v[k],x[v.charCodeAt(k)]=k;function u(S){var A=S.length;if(A%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var c=S.indexOf("=");return c===-1&&(c=A),[c,c===A?0:4-c%4]}function N(S,A,c){for(var l,s,g=[],y=A;y<c;y+=3)l=(S[y]<<16&16711680)+(S[y+1]<<8&65280)+(255&S[y+2]),g.push(p[(s=l)>>18&63]+p[s>>12&63]+p[s>>6&63]+p[63&s]);return g.join("")}x["-".charCodeAt(0)]=62,x["_".charCodeAt(0)]=63},function(P,I){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */I.read=function(T,p,x,q,v){var k,w,u=8*v-q-1,N=(1<<u)-1,S=N>>1,A=-7,c=x?v-1:0,l=x?-1:1,s=T[p+c];for(c+=l,k=s&(1<<-A)-1,s>>=-A,A+=u;A>0;k=256*k+T[p+c],c+=l,A-=8);for(w=k&(1<<-A)-1,k>>=-A,A+=q;A>0;w=256*w+T[p+c],c+=l,A-=8);if(k===0)k=1-S;else{if(k===N)return w?NaN:1/0*(s?-1:1);w+=Math.pow(2,q),k-=S}return(s?-1:1)*w*Math.pow(2,k-q)},I.write=function(T,p,x,q,v,k){var w,u,N,S=8*k-v-1,A=(1<<S)-1,c=A>>1,l=v===23?Math.pow(2,-24)-Math.pow(2,-77):0,s=q?0:k-1,g=q?1:-1,y=p<0||p===0&&1/p<0?1:0;for(p=Math.abs(p),isNaN(p)||p===1/0?(u=isNaN(p)?1:0,w=A):(w=Math.floor(Math.log(p)/Math.LN2),p*(N=Math.pow(2,-w))<1&&(w--,N*=2),(p+=w+c>=1?l/N:l*Math.pow(2,1-c))*N>=2&&(w++,N/=2),w+c>=A?(u=0,w=A):w+c>=1?(u=(p*N-1)*Math.pow(2,v),w+=c):(u=p*Math.pow(2,c-1)*Math.pow(2,v),w=0));v>=8;T[x+s]=255&u,s+=g,u/=256,v-=8);for(w=w<<v|u,S+=v;S>0;T[x+s]=255&w,s+=g,w/=256,S-=8);T[x+s-g]|=128*y}},function(P,I){var T={}.toString;P.exports=Array.isArray||function(p){return T.call(p)=="[object Array]"}},function(P,I,T){var p,x,q;x=[],(q=typeof(p=function(){var v,k,w,u;Object.keys||(Object.keys=(v=Object.prototype.hasOwnProperty,k=!{toString:null}.propertyIsEnumerable("toString"),u=(w=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(r){if(typeof r!="object"&&typeof r!="function"||r===null)throw new TypeError("Object.keys called on non-object");var n=[];for(var f in r)v.call(r,f)&&n.push(f);if(k)for(var E=0;E<u;E++)v.call(r,w[E])&&n.push(w[E]);return n})),Object.create||(Object.create=function(){function r(){}return function(n){if(arguments.length!==1)throw new Error("Object.create implementation only accepts one parameter.");return r.prototype=n,new r}}()),Array.isArray||(Array.isArray=function(r){return Object.prototype.toString.call(r)==="[object Array]"}),Array.prototype.indexOf||(Array.prototype.indexOf=function(r){if(this===null)throw new TypeError;var n=Object(this),f=n.length>>>0;if(f===0)return-1;var E=0;if(arguments.length>1&&((E=Number(arguments[1]))!=E?E=0:E!==0&&E!==1/0&&E!==-1/0&&(E=(E>0||-1)*Math.floor(Math.abs(E)))),E>=f)return-1;for(var M=E>=0?E:Math.max(f-Math.abs(E),0);M<f;M++)if(M in n&&n[M]===r)return M;return-1}),Object.isFrozen||(Object.isFrozen=function(r){for(var n="tv4_test_frozen_key";r.hasOwnProperty(n);)n+=Math.random();try{return r[n]=!0,delete r[n],!1}catch{return!0}});var N={"+":!0,"#":!0,".":!0,"/":!0,";":!0,"?":!0,"&":!0},S={"*":!0};function A(r){return encodeURI(r).replace(/%25[0-9][0-9]/g,function(n){return"%"+n.substring(3)})}function c(r){var n="";N[r.charAt(0)]&&(n=r.charAt(0),r=r.substring(1));var f="",E="",M=!0,G=!1,J=!1;n==="+"?M=!1:n==="."?(E=".",f="."):n==="/"?(E="/",f="/"):n==="#"?(E="#",M=!1):n===";"?(E=";",f=";",G=!0,J=!0):n==="?"?(E="?",f="&",G=!0):n==="&"&&(E="&",f="&",G=!0);for(var H=[],W=r.split(","),Q=[],nt={},et=0;et<W.length;et++){var $=W[et],e=null;if($.indexOf(":")!==-1){var o=$.split(":");$=o[0],e=parseInt(o[1],10)}for(var a={};S[$.charAt($.length-1)];)a[$.charAt($.length-1)]=!0,$=$.substring(0,$.length-1);var U={truncate:e,name:$,suffices:a};Q.push(U),nt[$]=U,H.push($)}var C=function(L){for(var V="",X=0,rt=0;rt<Q.length;rt++){var tt=Q[rt],K=L(tt.name);if(K==null||Array.isArray(K)&&K.length===0||typeof K=="object"&&Object.keys(K).length===0)X++;else if(V+=rt===X?E:f||",",Array.isArray(K)){G&&(V+=tt.name+"=");for(var it=0;it<K.length;it++)it>0&&(V+=tt.suffices["*"]&&f||",",tt.suffices["*"]&&G&&(V+=tt.name+"=")),V+=M?encodeURIComponent(K[it]).replace(/!/g,"%21"):A(K[it])}else if(typeof K=="object"){G&&!tt.suffices["*"]&&(V+=tt.name+"=");var at=!0;for(var ut in K)at||(V+=tt.suffices["*"]&&f||","),at=!1,V+=M?encodeURIComponent(ut).replace(/!/g,"%21"):A(ut),V+=tt.suffices["*"]?"=":",",V+=M?encodeURIComponent(K[ut]).replace(/!/g,"%21"):A(K[ut])}else G&&(V+=tt.name,J&&K===""||(V+="=")),tt.truncate!=null&&(K=K.substring(0,tt.truncate)),V+=M?encodeURIComponent(K).replace(/!/g,"%21"):A(K)}return V};return C.varNames=H,{prefix:E,substitution:C}}function l(r){if(!(this instanceof l))return new l(r);for(var n=r.split("{"),f=[n.shift()],E=[],M=[],G=[];n.length>0;){var J=n.shift(),H=J.split("}")[0],W=J.substring(H.length+1),Q=c(H);M.push(Q.substitution),E.push(Q.prefix),f.push(W),G=G.concat(Q.substitution.varNames)}this.fill=function(nt){for(var et=f[0],$=0;$<M.length;$++)et+=(0,M[$])(nt),et+=f[$+1];return et},this.varNames=G,this.template=r}l.prototype={toString:function(){return this.template},fillFromObject:function(r){return this.fill(function(n){return r[n]})}};var s=function(r,n,f,E,M){if(this.missing=[],this.missingMap={},this.formatValidators=r?Object.create(r.formatValidators):{},this.schemas=r?Object.create(r.schemas):{},this.collectMultiple=n,this.errors=[],this.handleError=n?this.collectError:this.returnError,E&&(this.checkRecursive=!0,this.scanned=[],this.scannedFrozen=[],this.scannedFrozenSchemas=[],this.scannedFrozenValidationErrors=[],this.validatedSchemasKey="tv4_validation_id",this.validationErrorsKey="tv4_validation_errors_id"),M&&(this.trackUnknownProperties=!0,this.knownPropertyPaths={},this.unknownPropertyPaths={}),this.errorReporter=f||j("en"),typeof this.errorReporter=="string")throw new Error("debug");if(this.definedKeywords={},r)for(var G in r.definedKeywords)this.definedKeywords[G]=r.definedKeywords[G].slice(0)};function g(r,n){if(r===n)return!0;if(r&&n&&typeof r=="object"&&typeof n=="object"){if(Array.isArray(r)!==Array.isArray(n))return!1;if(Array.isArray(r)){if(r.length!==n.length)return!1;for(var f=0;f<r.length;f++)if(!g(r[f],n[f]))return!1}else{var E;for(E in r)if(n[E]===void 0&&r[E]!==void 0)return!1;for(E in n)if(r[E]===void 0&&n[E]!==void 0)return!1;for(E in r)if(!g(r[E],n[E]))return!1}return!0}return!1}s.prototype.defineKeyword=function(r,n){this.definedKeywords[r]=this.definedKeywords[r]||[],this.definedKeywords[r].push(n)},s.prototype.createError=function(r,n,f,E,M,G,J){var H=new R(r,n,f,E,M);return H.message=this.errorReporter(H,G,J),H},s.prototype.returnError=function(r){return r},s.prototype.collectError=function(r){return r&&this.errors.push(r),null},s.prototype.prefixErrors=function(r,n,f){for(var E=r;E<this.errors.length;E++)this.errors[E]=this.errors[E].prefixWith(n,f);return this},s.prototype.banUnknownProperties=function(r,n){for(var f in this.unknownPropertyPaths){var E=this.createError(F.UNKNOWN_PROPERTY,{path:f},f,"",null,r,n),M=this.handleError(E);if(M)return M}return null},s.prototype.addFormat=function(r,n){if(typeof r=="object"){for(var f in r)this.addFormat(f,r[f]);return this}this.formatValidators[r]=n},s.prototype.resolveRefs=function(r,n){if(r.$ref!==void 0){if((n=n||{})[r.$ref])return this.createError(F.CIRCULAR_REFERENCE,{urls:Object.keys(n).join(", ")},"","",null,void 0,r);n[r.$ref]=!0,r=this.getSchema(r.$ref,n)}return r},s.prototype.getSchema=function(r,n){var f;if(this.schemas[r]!==void 0)return f=this.schemas[r],this.resolveRefs(f,n);var E=r,M="";if(r.indexOf("#")!==-1&&(M=r.substring(r.indexOf("#")+1),E=r.substring(0,r.indexOf("#"))),typeof this.schemas[E]=="object"){f=this.schemas[E];var G=decodeURIComponent(M);if(G==="")return this.resolveRefs(f,n);if(G.charAt(0)!=="/")return;for(var J=G.split("/").slice(1),H=0;H<J.length;H++){var W=J[H].replace(/~1/g,"/").replace(/~0/g,"~");if(f[W]===void 0){f=void 0;break}f=f[W]}if(f!==void 0)return this.resolveRefs(f,n)}this.missing[E]===void 0&&(this.missing.push(E),this.missing[E]=E,this.missingMap[E]=E)},s.prototype.searchSchemas=function(r,n){if(Array.isArray(r))for(var f=0;f<r.length;f++)this.searchSchemas(r[f],n);else if(r&&typeof r=="object"){for(var E in typeof r.id=="string"&&function(G,J){if(J.substring(0,G.length)===G){var H=J.substring(G.length);if(J.length>0&&J.charAt(G.length-1)==="/"||H.charAt(0)==="#"||H.charAt(0)==="?")return!0}return!1}(n,r.id)&&this.schemas[r.id]===void 0&&(this.schemas[r.id]=r),r)if(E!=="enum"){if(typeof r[E]=="object")this.searchSchemas(r[E],n);else if(E==="$ref"){var M=h(r[E]);M&&this.schemas[M]===void 0&&this.missingMap[M]===void 0&&(this.missingMap[M]=M)}}}},s.prototype.addSchema=function(r,n){if(typeof r!="string"||n===void 0){if(typeof r!="object"||typeof r.id!="string")return;r=(n=r).id}r===h(r)+"#"&&(r=h(r)),this.schemas[r]=n,delete this.missingMap[r],d(n,r),this.searchSchemas(n,r)},s.prototype.getSchemaMap=function(){var r={};for(var n in this.schemas)r[n]=this.schemas[n];return r},s.prototype.getSchemaUris=function(r){var n=[];for(var f in this.schemas)r&&!r.test(f)||n.push(f);return n},s.prototype.getMissingUris=function(r){var n=[];for(var f in this.missingMap)r&&!r.test(f)||n.push(f);return n},s.prototype.dropSchemas=function(){this.schemas={},this.reset()},s.prototype.reset=function(){this.missing=[],this.missingMap={},this.errors=[]},s.prototype.validateAll=function(r,n,f,E,M){var G;if(!(n=this.resolveRefs(n)))return null;if(n instanceof R)return this.errors.push(n),n;var J,H=this.errors.length,W=null,Q=null;if(this.checkRecursive&&r&&typeof r=="object"){if(G=!this.scanned.length,r[this.validatedSchemasKey]){var nt=r[this.validatedSchemasKey].indexOf(n);if(nt!==-1)return this.errors=this.errors.concat(r[this.validationErrorsKey][nt]),null}if(Object.isFrozen(r)&&(J=this.scannedFrozen.indexOf(r))!==-1){var et=this.scannedFrozenSchemas[J].indexOf(n);if(et!==-1)return this.errors=this.errors.concat(this.scannedFrozenValidationErrors[J][et]),null}if(this.scanned.push(r),Object.isFrozen(r))J===-1&&(J=this.scannedFrozen.length,this.scannedFrozen.push(r),this.scannedFrozenSchemas.push([])),W=this.scannedFrozenSchemas[J].length,this.scannedFrozenSchemas[J][W]=n,this.scannedFrozenValidationErrors[J][W]=[];else{if(!r[this.validatedSchemasKey])try{Object.defineProperty(r,this.validatedSchemasKey,{value:[],configurable:!0}),Object.defineProperty(r,this.validationErrorsKey,{value:[],configurable:!0})}catch{r[this.validatedSchemasKey]=[],r[this.validationErrorsKey]=[]}Q=r[this.validatedSchemasKey].length,r[this.validatedSchemasKey][Q]=n,r[this.validationErrorsKey][Q]=[]}}var $=this.errors.length,e=this.validateBasic(r,n,M)||this.validateNumeric(r,n,M)||this.validateString(r,n,M)||this.validateArray(r,n,M)||this.validateObject(r,n,M)||this.validateCombinations(r,n,M)||this.validateHypermedia(r,n,M)||this.validateFormat(r,n,M)||this.validateDefinedKeywords(r,n,M)||null;if(G){for(;this.scanned.length;)delete this.scanned.pop()[this.validatedSchemasKey];this.scannedFrozen=[],this.scannedFrozenSchemas=[]}if(e||$!==this.errors.length)for(;f&&f.length||E&&E.length;){var o=f&&f.length?""+f.pop():null,a=E&&E.length?""+E.pop():null;e&&(e=e.prefixWith(o,a)),this.prefixErrors($,o,a)}return W!==null?this.scannedFrozenValidationErrors[J][W]=this.errors.slice(H):Q!==null&&(r[this.validationErrorsKey][Q]=this.errors.slice(H)),this.handleError(e)},s.prototype.validateFormat=function(r,n){if(typeof n.format!="string"||!this.formatValidators[n.format])return null;var f=this.formatValidators[n.format].call(null,r,n);return typeof f=="string"||typeof f=="number"?this.createError(F.FORMAT_CUSTOM,{message:f},"","/format",null,r,n):f&&typeof f=="object"?this.createError(F.FORMAT_CUSTOM,{message:f.message||"?"},f.dataPath||"",f.schemaPath||"/format",null,r,n):null},s.prototype.validateDefinedKeywords=function(r,n,f){for(var E in this.definedKeywords)if(n[E]!==void 0)for(var M=this.definedKeywords[E],G=0;G<M.length;G++){var J=(0,M[G])(r,n[E],n,f);if(typeof J=="string"||typeof J=="number")return this.createError(F.KEYWORD_CUSTOM,{key:E,message:J},"","",null,r,n).prefixWith(null,E);if(J&&typeof J=="object"){var H=J.code;if(typeof H=="string"){if(!F[H])throw new Error("Undefined error code (use defineError): "+H);H=F[H]}else typeof H!="number"&&(H=F.KEYWORD_CUSTOM);var W=typeof J.message=="object"?J.message:{key:E,message:J.message||"?"},Q=J.schemaPath||"/"+E.replace(/~/g,"~0").replace(/\//g,"~1");return this.createError(H,W,J.dataPath||null,Q,null,r,n)}}return null},s.prototype.validateBasic=function(r,n,f){var E;return(E=this.validateType(r,n,f))||(E=this.validateEnum(r,n,f))?E.prefixWith(null,"type"):null},s.prototype.validateType=function(r,n){if(n.type===void 0)return null;var f=typeof r;r===null?f="null":Array.isArray(r)&&(f="array");var E=n.type;Array.isArray(E)||(E=[E]);for(var M=0;M<E.length;M++){var G=E[M];if(G===f||G==="integer"&&f==="number"&&r%1==0)return null}return this.createError(F.INVALID_TYPE,{type:f,expected:E.join("/")},"","",null,r,n)},s.prototype.validateEnum=function(r,n){if(n.enum===void 0)return null;for(var f=0;f<n.enum.length;f++)if(g(r,n.enum[f]))return null;return this.createError(F.ENUM_MISMATCH,{value:typeof JSON<"u"?JSON.stringify(r):r},"","",null,r,n)},s.prototype.validateNumeric=function(r,n,f){return this.validateMultipleOf(r,n,f)||this.validateMinMax(r,n,f)||this.validateNaN(r,n,f)||null};var y=Math.pow(2,-51),O=1-y;function b(r){var n=String(r).replace(/^\s+|\s+$/g,"").match(/^([^:\/?#]+:)?(\/\/(?:[^:@]*(?::[^:@]*)?@)?(([^:\/?#]*)(?::(\d*))?))?([^?#]*)(\?[^#]*)?(#[\s\S]*)?/);return n?{href:n[0]||"",protocol:n[1]||"",authority:n[2]||"",host:n[3]||"",hostname:n[4]||"",port:n[5]||"",pathname:n[6]||"",search:n[7]||"",hash:n[8]||""}:null}function t(r,n){return n=b(n||""),r=b(r||""),n&&r?(n.protocol||r.protocol)+(n.protocol||n.authority?n.authority:r.authority)+(f=n.protocol||n.authority||n.pathname.charAt(0)==="/"?n.pathname:n.pathname?(r.authority&&!r.pathname?"/":"")+r.pathname.slice(0,r.pathname.lastIndexOf("/")+1)+n.pathname:r.pathname,E=[],f.replace(/^(\.\.?(\/|$))+/,"").replace(/\/(\.(\/|$))+/g,"/").replace(/\/\.\.$/,"/../").replace(/\/?[^\/]*/g,function(M){M==="/.."?E.pop():E.push(M)}),E.join("").replace(/^\//,f.charAt(0)==="/"?"/":""))+(n.protocol||n.authority||n.pathname?n.search:n.search||r.search)+n.hash:null;var f,E}function h(r){return r.split("#")[0]}function d(r,n){if(r&&typeof r=="object")if(n===void 0?n=r.id:typeof r.id=="string"&&(n=t(n,r.id),r.id=n),Array.isArray(r))for(var f=0;f<r.length;f++)d(r[f],n);else for(var E in typeof r.$ref=="string"&&(r.$ref=t(n,r.$ref)),r)E!=="enum"&&d(r[E],n)}function j(r){var n=_[r=r||"en"];return function(f){var E=n[f.code]||Y[f.code];if(typeof E!="string")return"Unknown error code "+f.code+": "+JSON.stringify(f.messageParams);var M=f.params;return E.replace(/\{([^{}]*)\}/g,function(G,J){var H=M[J];return typeof H=="string"||typeof H=="number"?H:G})}}s.prototype.validateMultipleOf=function(r,n){var f=n.multipleOf||n.divisibleBy;if(f===void 0)return null;if(typeof r=="number"){var E=r/f%1;if(E>=y&&E<O)return this.createError(F.NUMBER_MULTIPLE_OF,{value:r,multipleOf:f},"","",null,r,n)}return null},s.prototype.validateMinMax=function(r,n){if(typeof r!="number")return null;if(n.minimum!==void 0){if(r<n.minimum)return this.createError(F.NUMBER_MINIMUM,{value:r,minimum:n.minimum},"","/minimum",null,r,n);if(n.exclusiveMinimum&&r===n.minimum)return this.createError(F.NUMBER_MINIMUM_EXCLUSIVE,{value:r,minimum:n.minimum},"","/exclusiveMinimum",null,r,n)}if(n.maximum!==void 0){if(r>n.maximum)return this.createError(F.NUMBER_MAXIMUM,{value:r,maximum:n.maximum},"","/maximum",null,r,n);if(n.exclusiveMaximum&&r===n.maximum)return this.createError(F.NUMBER_MAXIMUM_EXCLUSIVE,{value:r,maximum:n.maximum},"","/exclusiveMaximum",null,r,n)}return null},s.prototype.validateNaN=function(r,n){return typeof r!="number"?null:isNaN(r)===!0||r===1/0||r===-1/0?this.createError(F.NUMBER_NOT_A_NUMBER,{value:r},"","/type",null,r,n):null},s.prototype.validateString=function(r,n,f){return this.validateStringLength(r,n,f)||this.validateStringPattern(r,n,f)||null},s.prototype.validateStringLength=function(r,n){return typeof r!="string"?null:n.minLength!==void 0&&r.length<n.minLength?this.createError(F.STRING_LENGTH_SHORT,{length:r.length,minimum:n.minLength},"","/minLength",null,r,n):n.maxLength!==void 0&&r.length>n.maxLength?this.createError(F.STRING_LENGTH_LONG,{length:r.length,maximum:n.maxLength},"","/maxLength",null,r,n):null},s.prototype.validateStringPattern=function(r,n){if(typeof r!="string"||typeof n.pattern!="string"&&!(n.pattern instanceof RegExp))return null;var f;if(n.pattern instanceof RegExp)f=n.pattern;else{var E,M="",G=n.pattern.match(/^\/(.+)\/([img]*)$/);G?(E=G[1],M=G[2]):E=n.pattern,f=new RegExp(E,M)}return f.test(r)?null:this.createError(F.STRING_PATTERN,{pattern:n.pattern},"","/pattern",null,r,n)},s.prototype.validateArray=function(r,n,f){return Array.isArray(r)&&(this.validateArrayLength(r,n,f)||this.validateArrayUniqueItems(r,n,f)||this.validateArrayItems(r,n,f))||null},s.prototype.validateArrayLength=function(r,n){var f;return n.minItems!==void 0&&r.length<n.minItems&&(f=this.createError(F.ARRAY_LENGTH_SHORT,{length:r.length,minimum:n.minItems},"","/minItems",null,r,n),this.handleError(f))||n.maxItems!==void 0&&r.length>n.maxItems&&(f=this.createError(F.ARRAY_LENGTH_LONG,{length:r.length,maximum:n.maxItems},"","/maxItems",null,r,n),this.handleError(f))?f:null},s.prototype.validateArrayUniqueItems=function(r,n){if(n.uniqueItems){for(var f=0;f<r.length;f++)for(var E=f+1;E<r.length;E++)if(g(r[f],r[E])){var M=this.createError(F.ARRAY_UNIQUE,{match1:f,match2:E},"","/uniqueItems",null,r,n);if(this.handleError(M))return M}}return null},s.prototype.validateArrayItems=function(r,n,f){if(n.items===void 0)return null;var E,M;if(Array.isArray(n.items)){for(M=0;M<r.length;M++)if(M<n.items.length){if(E=this.validateAll(r[M],n.items[M],[M],["items",M],f+"/"+M))return E}else if(n.additionalItems!==void 0){if(typeof n.additionalItems=="boolean"){if(!n.additionalItems&&(E=this.createError(F.ARRAY_ADDITIONAL_ITEMS,{},"/"+M,"/additionalItems",null,r,n),this.handleError(E)))return E}else if(E=this.validateAll(r[M],n.additionalItems,[M],["additionalItems"],f+"/"+M))return E}}else for(M=0;M<r.length;M++)if(E=this.validateAll(r[M],n.items,[M],["items"],f+"/"+M))return E;return null},s.prototype.validateObject=function(r,n,f){return typeof r!="object"||r===null||Array.isArray(r)?null:this.validateObjectMinMaxProperties(r,n,f)||this.validateObjectRequiredProperties(r,n,f)||this.validateObjectProperties(r,n,f)||this.validateObjectDependencies(r,n,f)||null},s.prototype.validateObjectMinMaxProperties=function(r,n){var f,E=Object.keys(r);return n.minProperties!==void 0&&E.length<n.minProperties&&(f=this.createError(F.OBJECT_PROPERTIES_MINIMUM,{propertyCount:E.length,minimum:n.minProperties},"","/minProperties",null,r,n),this.handleError(f))||n.maxProperties!==void 0&&E.length>n.maxProperties&&(f=this.createError(F.OBJECT_PROPERTIES_MAXIMUM,{propertyCount:E.length,maximum:n.maxProperties},"","/maxProperties",null,r,n),this.handleError(f))?f:null},s.prototype.validateObjectRequiredProperties=function(r,n){if(n.required!==void 0)for(var f=0;f<n.required.length;f++){var E=n.required[f];if(r[E]===void 0){var M=this.createError(F.OBJECT_REQUIRED,{key:E},"","/required/"+f,null,r,n);if(this.handleError(M))return M}}return null},s.prototype.validateObjectProperties=function(r,n,f){var E;for(var M in r){var G=f+"/"+M.replace(/~/g,"~0").replace(/\//g,"~1"),J=!1;if(n.properties!==void 0&&n.properties[M]!==void 0&&(J=!0,E=this.validateAll(r[M],n.properties[M],[M],["properties",M],G)))return E;if(n.patternProperties!==void 0){for(var H in n.patternProperties)if(new RegExp(H).test(M)&&(J=!0,E=this.validateAll(r[M],n.patternProperties[H],[M],["patternProperties",H],G)))return E}if(J)this.trackUnknownProperties&&(this.knownPropertyPaths[G]=!0,delete this.unknownPropertyPaths[G]);else if(n.additionalProperties!==void 0){if(this.trackUnknownProperties&&(this.knownPropertyPaths[G]=!0,delete this.unknownPropertyPaths[G]),typeof n.additionalProperties=="boolean"){if(!n.additionalProperties&&(E=this.createError(F.OBJECT_ADDITIONAL_PROPERTIES,{key:M},"","/additionalProperties",null,r,n).prefixWith(M,null),this.handleError(E)))return E}else if(E=this.validateAll(r[M],n.additionalProperties,[M],["additionalProperties"],G))return E}else this.trackUnknownProperties&&!this.knownPropertyPaths[G]&&(this.unknownPropertyPaths[G]=!0)}return null},s.prototype.validateObjectDependencies=function(r,n,f){var E;if(n.dependencies!==void 0){for(var M in n.dependencies)if(r[M]!==void 0){var G=n.dependencies[M];if(typeof G=="string"){if(r[G]===void 0&&(E=this.createError(F.OBJECT_DEPENDENCY_KEY,{key:M,missing:G},"","",null,r,n).prefixWith(null,M).prefixWith(null,"dependencies"),this.handleError(E)))return E}else if(Array.isArray(G))for(var J=0;J<G.length;J++){var H=G[J];if(r[H]===void 0&&(E=this.createError(F.OBJECT_DEPENDENCY_KEY,{key:M,missing:H},"","/"+J,null,r,n).prefixWith(null,M).prefixWith(null,"dependencies"),this.handleError(E)))return E}else if(E=this.validateAll(r,G,[],["dependencies",M],f))return E}}return null},s.prototype.validateCombinations=function(r,n,f){return this.validateAllOf(r,n,f)||this.validateAnyOf(r,n,f)||this.validateOneOf(r,n,f)||this.validateNot(r,n,f)||null},s.prototype.validateAllOf=function(r,n,f){if(n.allOf===void 0)return null;for(var E,M=0;M<n.allOf.length;M++){var G=n.allOf[M];if(E=this.validateAll(r,G,[],["allOf",M],f))return E}return null},s.prototype.validateAnyOf=function(r,n,f){if(n.anyOf===void 0)return null;var E,M,G=[],J=this.errors.length;this.trackUnknownProperties&&(E=this.unknownPropertyPaths,M=this.knownPropertyPaths);for(var H=!0,W=0;W<n.anyOf.length;W++){this.trackUnknownProperties&&(this.unknownPropertyPaths={},this.knownPropertyPaths={});var Q=n.anyOf[W],nt=this.errors.length,et=this.validateAll(r,Q,[],["anyOf",W],f);if(et===null&&nt===this.errors.length){if(this.errors=this.errors.slice(0,J),this.trackUnknownProperties){for(var $ in this.knownPropertyPaths)M[$]=!0,delete E[$];for(var e in this.unknownPropertyPaths)M[e]||(E[e]=!0);H=!1;continue}return null}et&&G.push(et.prefixWith(null,""+W).prefixWith(null,"anyOf"))}return this.trackUnknownProperties&&(this.unknownPropertyPaths=E,this.knownPropertyPaths=M),H?(G=G.concat(this.errors.slice(J)),this.errors=this.errors.slice(0,J),this.createError(F.ANY_OF_MISSING,{},"","/anyOf",G,r,n)):void 0},s.prototype.validateOneOf=function(r,n,f){if(n.oneOf===void 0)return null;var E,M,G=null,J=[],H=this.errors.length;this.trackUnknownProperties&&(E=this.unknownPropertyPaths,M=this.knownPropertyPaths);for(var W=0;W<n.oneOf.length;W++){this.trackUnknownProperties&&(this.unknownPropertyPaths={},this.knownPropertyPaths={});var Q=n.oneOf[W],nt=this.errors.length,et=this.validateAll(r,Q,[],["oneOf",W],f);if(et===null&&nt===this.errors.length){if(G!==null)return this.errors=this.errors.slice(0,H),this.createError(F.ONE_OF_MULTIPLE,{index1:G,index2:W},"","/oneOf",null,r,n);if(G=W,this.trackUnknownProperties){for(var $ in this.knownPropertyPaths)M[$]=!0,delete E[$];for(var e in this.unknownPropertyPaths)M[e]||(E[e]=!0)}}else et&&J.push(et)}return this.trackUnknownProperties&&(this.unknownPropertyPaths=E,this.knownPropertyPaths=M),G===null?(J=J.concat(this.errors.slice(H)),this.errors=this.errors.slice(0,H),this.createError(F.ONE_OF_MISSING,{},"","/oneOf",J,r,n)):(this.errors=this.errors.slice(0,H),null)},s.prototype.validateNot=function(r,n,f){if(n.not===void 0)return null;var E,M,G=this.errors.length;this.trackUnknownProperties&&(E=this.unknownPropertyPaths,M=this.knownPropertyPaths,this.unknownPropertyPaths={},this.knownPropertyPaths={});var J=this.validateAll(r,n.not,null,null,f),H=this.errors.slice(G);return this.errors=this.errors.slice(0,G),this.trackUnknownProperties&&(this.unknownPropertyPaths=E,this.knownPropertyPaths=M),J===null&&H.length===0?this.createError(F.NOT_PASSED,{},"","/not",null,r,n):null},s.prototype.validateHypermedia=function(r,n,f){if(!n.links)return null;for(var E,M=0;M<n.links.length;M++){var G=n.links[M];if(G.rel==="describedby"){for(var J=new l(G.href),H=!0,W=0;W<J.varNames.length;W++)if(!(J.varNames[W]in r)){H=!1;break}if(H){var Q={$ref:J.fillFromObject(r)};if(E=this.validateAll(r,Q,[],["links",M],f))return E}}}};var F={INVALID_TYPE:0,ENUM_MISMATCH:1,ANY_OF_MISSING:10,ONE_OF_MISSING:11,ONE_OF_MULTIPLE:12,NOT_PASSED:13,NUMBER_MULTIPLE_OF:100,NUMBER_MINIMUM:101,NUMBER_MINIMUM_EXCLUSIVE:102,NUMBER_MAXIMUM:103,NUMBER_MAXIMUM_EXCLUSIVE:104,NUMBER_NOT_A_NUMBER:105,STRING_LENGTH_SHORT:200,STRING_LENGTH_LONG:201,STRING_PATTERN:202,OBJECT_PROPERTIES_MINIMUM:300,OBJECT_PROPERTIES_MAXIMUM:301,OBJECT_REQUIRED:302,OBJECT_ADDITIONAL_PROPERTIES:303,OBJECT_DEPENDENCY_KEY:304,ARRAY_LENGTH_SHORT:400,ARRAY_LENGTH_LONG:401,ARRAY_UNIQUE:402,ARRAY_ADDITIONAL_ITEMS:403,FORMAT_CUSTOM:500,KEYWORD_CUSTOM:501,CIRCULAR_REFERENCE:600,UNKNOWN_PROPERTY:1e3},B={};for(var z in F)B[F[z]]=z;var Y={INVALID_TYPE:"Invalid type: {type} (expected {expected})",ENUM_MISMATCH:"No enum match for: {value}",ANY_OF_MISSING:'Data does not match any schemas from "anyOf"',ONE_OF_MISSING:'Data does not match any schemas from "oneOf"',ONE_OF_MULTIPLE:'Data is valid against more than one schema from "oneOf": indices {index1} and {index2}',NOT_PASSED:'Data matches schema from "not"',NUMBER_MULTIPLE_OF:"Value {value} is not a multiple of {multipleOf}",NUMBER_MINIMUM:"Value {value} is less than minimum {minimum}",NUMBER_MINIMUM_EXCLUSIVE:"Value {value} is equal to exclusive minimum {minimum}",NUMBER_MAXIMUM:"Value {value} is greater than maximum {maximum}",NUMBER_MAXIMUM_EXCLUSIVE:"Value {value} is equal to exclusive maximum {maximum}",NUMBER_NOT_A_NUMBER:"Value {value} is not a valid number",STRING_LENGTH_SHORT:"String is too short ({length} chars), minimum {minimum}",STRING_LENGTH_LONG:"String is too long ({length} chars), maximum {maximum}",STRING_PATTERN:"String does not match pattern: {pattern}",OBJECT_PROPERTIES_MINIMUM:"Too few properties defined ({propertyCount}), minimum {minimum}",OBJECT_PROPERTIES_MAXIMUM:"Too many properties defined ({propertyCount}), maximum {maximum}",OBJECT_REQUIRED:"Missing required property: {key}",OBJECT_ADDITIONAL_PROPERTIES:"Additional properties not allowed",OBJECT_DEPENDENCY_KEY:"Dependency failed - key must exist: {missing} (due to key: {key})",ARRAY_LENGTH_SHORT:"Array is too short ({length}), minimum {minimum}",ARRAY_LENGTH_LONG:"Array is too long ({length}), maximum {maximum}",ARRAY_UNIQUE:"Array items are not unique (indices {match1} and {match2})",ARRAY_ADDITIONAL_ITEMS:"Additional items not allowed",FORMAT_CUSTOM:"Format validation failed ({message})",KEYWORD_CUSTOM:"Keyword failed: {key} ({message})",CIRCULAR_REFERENCE:"Circular $refs: {urls}",UNKNOWN_PROPERTY:"Unknown property (not in schema)"};function R(r,n,f,E,M){if(Error.call(this),r===void 0)throw new Error("No error code supplied: "+E);this.message="",this.params=n,this.code=r,this.dataPath=f||"",this.schemaPath=E||"",this.subErrors=M||null;var G=new Error(this.message);if(this.stack=G.stack||G.stacktrace,!this.stack)try{throw G}catch(J){this.stack=J.stack||J.stacktrace}}R.prototype=Object.create(Error.prototype),R.prototype.constructor=R,R.prototype.name="ValidationError",R.prototype.prefixWith=function(r,n){if(r!==null&&(r=r.replace(/~/g,"~0").replace(/\//g,"~1"),this.dataPath="/"+r+this.dataPath),n!==null&&(n=n.replace(/~/g,"~0").replace(/\//g,"~1"),this.schemaPath="/"+n+this.schemaPath),this.subErrors!==null)for(var f=0;f<this.subErrors.length;f++)this.subErrors[f].prefixWith(r,n);return this};var _={},m=function r(n){var f,E,M=new s,G={setErrorReporter:function(J){return typeof J=="string"?this.language(J):(E=J,!0)},addFormat:function(){M.addFormat.apply(M,arguments)},language:function(J){return J?(_[J]||(J=J.split("-")[0]),!!_[J]&&(f=J,J)):f},addLanguage:function(J,H){var W;for(W in F)H[W]&&!H[F[W]]&&(H[F[W]]=H[W]);var Q=J.split("-")[0];if(_[Q])for(W in _[J]=Object.create(_[Q]),H)_[Q][W]===void 0&&(_[Q][W]=H[W]),_[J][W]=H[W];else _[J]=H,_[Q]=H;return this},freshApi:function(J){var H=r();return J&&H.language(J),H},validate:function(J,H,W,Q){var nt=j(f),et=new s(M,!1,E?function(e,o,a){return E(e,o,a)||nt(e,o,a)}:nt,W,Q);typeof H=="string"&&(H={$ref:H}),et.addSchema("",H);var $=et.validateAll(J,H,null,null,"");return!$&&Q&&($=et.banUnknownProperties(J,H)),this.error=$,this.missing=et.missing,this.valid=$===null,this.valid},validateResult:function(){var J={toString:function(){return this.valid?"valid":this.error.message}};return this.validate.apply(J,arguments),J},validateMultiple:function(J,H,W,Q){var nt=j(f),et=new s(M,!0,E?function(e,o,a){return E(e,o,a)||nt(e,o,a)}:nt,W,Q);typeof H=="string"&&(H={$ref:H}),et.addSchema("",H),et.validateAll(J,H,null,null,""),Q&&et.banUnknownProperties(J,H);var $={toString:function(){return this.valid?"valid":this.error.message}};return $.errors=et.errors,$.missing=et.missing,$.valid=$.errors.length===0,$},addSchema:function(){return M.addSchema.apply(M,arguments)},getSchema:function(){return M.getSchema.apply(M,arguments)},getSchemaMap:function(){return M.getSchemaMap.apply(M,arguments)},getSchemaUris:function(){return M.getSchemaUris.apply(M,arguments)},getMissingUris:function(){return M.getMissingUris.apply(M,arguments)},dropSchemas:function(){M.dropSchemas.apply(M,arguments)},defineKeyword:function(){M.defineKeyword.apply(M,arguments)},defineError:function(J,H,W){if(typeof J!="string"||!/^[A-Z]+(_[A-Z]+)*$/.test(J))throw new Error("Code name must be a string in UPPER_CASE_WITH_UNDERSCORES");if(typeof H!="number"||H%1!=0||H<1e4)throw new Error("Code number must be an integer > 10000");if(F[J]!==void 0)throw new Error("Error already defined: "+J+" as "+F[J]);if(B[H]!==void 0)throw new Error("Error code already used: "+B[H]+" as "+H);for(var Q in F[J]=H,B[H]=J,Y[J]=Y[H]=W,_){var nt=_[Q];nt[J]&&(nt[H]=nt[H]||nt[J])}},reset:function(){M.reset(),this.error=null,this.missing=[],this.valid=!0},missing:[],error:null,valid:!0,normSchema:d,resolveUrl:t,getDocumentUri:h,errorCodes:F};return G.language(n||"en"),G}();return m.addLanguage("en-gb",Y),m.tv4=m,m})=="function"?p.apply(I,x):p)===void 0||(P.exports=q)},function(P,I,T){Object.defineProperty(I,"__esModule",{value:!0}),I.BaseClientTypes=void 0;class p{constructor(){this.uris={},this.schemas={},this.aliases={}}declare(v,k,w,u){const N=v+"/"+k;if(u.extends){const S=u.extends.split("/"),A=S.length===1?v+"/"+S.shift():S.join("/"),c=this.uris[A];if(!c)throw"Type '"+N+"' tries to extend unknown schema '"+A+"'";u.extends=this.schemas[c]}this.uris[N]=w,this.aliases[w]=N,this.schemas[w]=u}resolveAlias(v){return this.uris[v]}getSchema(v){return this.schemas[v]}inScope(v){const k=v.length,w={};for(const u in this.uris)if(u.substr(0,k+1)===v+"/"){const N=this.uris[u];w[N]=this.schemas[N]}return w}}I.BaseClientTypes=p;const x=new p;I.default=x},function(P,I,T){class p extends Error{constructor(q){super();const v=new Error("Schema not found: "+q);return v.name="SchemaNotFound",v}}P.exports=p},function(P,I,T){P.exports=class{constructor(p){this._itemsRev={},this._storage={},this._canPropagate=!1,this.defaultValue=p,this.activatePropagation()}get(p){p=p.toLowerCase();let x=this._storage[p];return x===void 0&&(x=this.defaultValue,this._storage[p]=x),x}set(p,x){return p=p.toLowerCase(),this._storage[p]===x||(this._storage[p]=x,x||delete this._itemsRev[p],this._updateParentFolderItemRev(p,x),this._canPropagate&&this._propagate(p)),x}delete(p){return this.set(p,null)}deactivatePropagation(){return this._canPropagate=!1,!0}activatePropagation(){return this._canPropagate||(this._generateFolderRev("/"),this._canPropagate=!0),!0}_hashCode(p){let x=0;if(p.length===0)return x;for(let q=0;q<p.length;q++)x=(x<<5)-x+p.charCodeAt(q),x|=0;return x}_generateHash(p){const x=p.sort().join("|");return""+this._hashCode(x)}_updateParentFolderItemRev(p,x){if(p!=="/"){const q=this._getParentFolder(p);this._itemsRev[q]||(this._itemsRev[q]={});const v=this._itemsRev[q];x?v[p]=x:delete v[p],this._updateParentFolderItemRev(q,this.defaultValue)}}_getParentFolder(p){return p.substr(0,p.lastIndexOf("/",p.length-2)+1)}_propagate(p){if(p!=="/"){const x=this._getParentFolder(p),q=this._itemsRev[x],v=[];for(const w in q)v.push(q[w]);const k=this._generateHash(v);this.set(x,k)}}_generateFolderRev(p){const x=this._itemsRev[p];let q=this.defaultValue;if(x){const v=[];for(const k in x){let w;w=k.substr(-1)==="/"?this._generateFolderRev(k):x[k],v.push(w)}v.length>0&&(q=this._generateHash(v))}return this.set(p,q),q}}},function(P,I,T){var p;/*!
 * webfinger.js
 *   http://github.com/silverbucket/webfinger.js
 *
 * Developed and Maintained by:
 *   Nick Jennings <nick@silverbucket.net>
 *
 * webfinger.js is released under the AGPL (see LICENSE).
 *
 * You don't have to do anything special to choose one license or the other and you don't
 * have to notify anyone which license you are using.
 * Please see the corresponding license file for details of these licenses.
 * You are free to use, modify and distribute this software, but all copyright
 * information must remain.
 *
 */typeof fetch!="function"&&typeof XMLHttpRequest!="function"&&(XMLHttpRequest=T(29)),function(x){var q={"http://webfist.org/spec/rel":"webfist","http://webfinger.net/rel/avatar":"avatar",remotestorage:"remotestorage","http://tools.ietf.org/id/draft-dejong-remotestorage":"remotestorage",remoteStorage:"remotestorage","http://www.packetizer.com/rel/share":"share","http://webfinger.net/rel/profile-page":"profile",me:"profile",vcard:"vcard",blog:"blog","http://packetizer.com/rel/blog":"blog","http://schemas.google.com/g/2010#updates-from":"updates","https://camlistore.org/rel/server":"camilstore"},v={avatar:[],remotestorage:[],blog:[],vcard:[],updates:[],share:[],profile:[],webfist:[],camlistore:[]},k=["webfinger","host-meta","host-meta.json"];function w(N){return N.toString=function(){return this.message},N}function u(N){typeof N!="object"&&(N={}),this.config={tls_only:N.tls_only===void 0||N.tls_only,webfist_fallback:N.webfist_fallback!==void 0&&N.webfist_fallback,uri_fallback:N.uri_fallback!==void 0&&N.uri_fallback,request_timeout:N.request_timeout!==void 0?N.request_timeout:1e4}}u.prototype.__fetchJRD=function(N,S,A){if(typeof fetch=="function")return this.__fetchJRD_fetch(N,S,A);if(typeof XMLHttpRequest=="function")return this.__fetchJRD_XHR(N,S,A);throw new Error("add a polyfill for fetch or XMLHttpRequest")},u.prototype.__fetchJRD_fetch=function(N,S,A){var c,l=this;typeof AbortController=="function"&&(c=new AbortController);var s=fetch(N,{headers:{Accept:"application/jrd+json, application/json"},signal:c?c.signal:void 0}).then(function(y){if(y.ok)return y.text();throw y.status===404?w({message:"resource not found",url:N,status:y.status}):w({message:"error during request",url:N,status:y.status})},function(y){throw w({message:"error during request",url:N,status:void 0,err:y})}).then(function(y){if(l.__isValidJSON(y))return y;throw w({message:"invalid json",url:N,status:void 0})}),g=new Promise(function(y,O){setTimeout(function(){O(w({message:"request timed out",url:N,status:void 0})),c&&c.abort()},l.config.request_timeout)});Promise.race([s,g]).then(function(y){A(y)}).catch(function(y){S(y)})},u.prototype.__fetchJRD_XHR=function(N,S,A){var c=this,l=!1,s=new XMLHttpRequest;function g(){if(!l){if(l=!0,s.status===200)return c.__isValidJSON(s.responseText)?A(s.responseText):S(w({message:"invalid json",url:N,status:s.status}));if(s.status===404)return S(w({message:"resource not found",url:N,status:s.status}));if(s.status>=301&&s.status<=302){var O=s.getResponseHeader("Location");return function(b){return typeof b=="string"&&b.split("://")[0]==="https"}(O)?y():S(w({message:"no redirect URL found",url:N,status:s.status}))}return S(w({message:"error during request",url:N,status:s.status}))}}function y(){s.onreadystatechange=function(){s.readyState===4&&g()},s.onload=function(){g()},s.ontimeout=function(){return S(w({message:"request timed out",url:N,status:s.status}))},s.open("GET",N,!0),s.timeout=c.config.request_timeout,s.setRequestHeader("Accept","application/jrd+json, application/json"),s.send()}return y()},u.prototype.__isValidJSON=function(N){try{JSON.parse(N)}catch{return!1}return!0},u.prototype.__isLocalhost=function(N){return/^localhost(\.localdomain)?(\:[0-9]+)?$/.test(N)},u.prototype.__processJRD=function(N,S,A,c){var l=JSON.parse(S);if(typeof l!="object"||typeof l.links!="object")return l.error!==void 0?A(w({message:l.error,request:N})):A(w({message:"unknown response from server",request:N}));var s=l.links;Array.isArray(s)||(s=[]);var g={object:l,json:S,idx:{}};g.idx.properties={name:void 0},g.idx.links=JSON.parse(JSON.stringify(v)),s.map(function(b,t){if(q.hasOwnProperty(b.rel)&&g.idx.links[q[b.rel]]){var h={};Object.keys(b).map(function(d,j){h[d]=b[d]}),g.idx.links[q[b.rel]].push(h)}});var y=JSON.parse(S).properties;for(var O in y)y.hasOwnProperty(O)&&O==="http://packetizer.com/ns/name"&&(g.idx.properties.name=y[O]);return c(g)},u.prototype.lookup=function(N,S){if(typeof N!="string")throw new Error("first parameter must be a user address");if(typeof S!="function")throw new Error("second parameter must be a callback");var A=this,c="";c=N.indexOf("://")>-1?N.replace(/ /g,"").split("/")[2]:N.replace(/ /g,"").split("@")[1];var l=0,s="https";function g(){var b="";return N.split("://")[1]||(b="acct:"),s+"://"+c+"/.well-known/"+k[l]+"?resource="+b+N}function y(b){if(A.config.uri_fallback&&c!=="webfist.org"&&l!==k.length-1)return l+=1,O();if(!A.config.tls_only&&s==="https")return l=0,s="http",O();if(!A.config.webfist_fallback||c==="webfist.org")return S(b);l=0,s="http",c="webfist.org";var t=g();A.__fetchJRD(t,S,function(h){A.__processJRD(t,h,S,function(d){typeof d.idx.links.webfist=="object"&&typeof d.idx.links.webfist[0].href=="string"&&A.__fetchJRD(d.idx.links.webfist[0].href,S,function(j){A.__processJRD(t,j,S,function(F){return S(null,S)})})})})}function O(){var b=g();A.__fetchJRD(b,y,function(t){A.__processJRD(b,t,S,function(h){S(null,h)})})}return A.__isLocalhost(c)&&(s="http"),setTimeout(O,0)},u.prototype.lookupLink=function(N,S,A){if(!v.hasOwnProperty(S))return A("unsupported rel "+S);this.lookup(N,function(c,l){var s=l.idx.links[S];return c?A(c):s.length===0?A('no links found with rel="'+S+'"'):A(null,s[0])})},(p=function(){return u}.apply(I,[]))===void 0||(P.exports=p)}()},function(P,I){P.exports=XMLHttpRequest},function(P,I,T){var p=this&&this.__importDefault||function(d){return d&&d.__esModule?d:{default:d}};const x=p(T(3)),q=p(T(17)),v=p(T(1)),k=T(0),w=p(T(31)),u=p(T(12)),N=p(T(4)),S=p(T(16)),A=p(T(8)),c=p(T(14)),l=p(T(15)),s=p(T(32)),g=p(T(33)),y=p(T(13)),O=p(T(34)),b=p(T(35)),t=p(T(36)),h={features:[],featuresDone:0,readyFired:!1,loadFeatures(){this.features=[],this.featuresDone=0,this.readyFired=!1,this.featureModules={WireClient:s.default,Dropbox:l.default,GoogleDrive:c.default,Access:u.default,Discover:S.default,Authorize:N.default,BaseClient:A.default,Env:q.default},x.default.cache&&(0,k.extend)(this.featureModules,{Caching:y.default,IndexedDB:O.default,LocalStorage:b.default,InMemoryStorage:t.default,Sync:g.default}),x.default.disableFeatures.forEach(d=>{this.featureModules[d]&&delete this.featureModules[d]}),this._allLoaded=!1;for(const d in this.featureModules)this.loadFeature(d)},hasFeature(d){for(let j=this.features.length-1;j>=0;j--)if(this.features[j].name===d)return this.features[j].supported;return!1},loadFeature(d){const j=this.featureModules[d],F=!j._rs_supported||j._rs_supported();(0,v.default)(`[RemoteStorage] [FEATURE ${d}] initializing ...`),typeof F=="object"?F.then(()=>{this.featureSupported(d,!0),this.initFeature(d)},()=>{this.featureSupported(d,!1)}):typeof F=="boolean"?(this.featureSupported(d,F),F&&this.initFeature(d)):this.featureSupported(d,!1)},initFeature(d){const j=this.featureModules[d];let F;try{F=j._rs_init(this)}catch(B){return void this.featureFailed(d,B)}typeof F=="object"&&typeof F.then=="function"?F.then(()=>{this.featureInitialized(d)},B=>{this.featureFailed(d,B)}):this.featureInitialized(d)},featureFailed(d,j){(0,v.default)(`[RemoteStorage] [FEATURE ${d}] initialization failed (${j})`),this.featureDone()},featureSupported(d,j){(0,v.default)(`[RemoteStorage] [FEATURE ${d}]${j?"":"not "} supported`),j||this.featureDone()},featureInitialized(d){(0,v.default)(`[RemoteStorage] [FEATURE ${d}] initialized`),this.features.push({name:d,init:this.featureModules[d]._rs_init,supported:!0,cleanup:this.featureModules[d]._rs_cleanup}),this.featureDone()},featureDone(){this.featuresDone++,this.featuresDone===Object.keys(this.featureModules).length&&setTimeout(this.featuresLoaded.bind(this),0)},_setCachingModule(){["IndexedDB","LocalStorage","InMemoryStorage"].some(d=>{if(this.features.some(j=>j.name===d))return this.features.local=this.featureModules[d],!0})},_fireReady(){try{this.readyFired||(this._emit("ready"),this.readyFired=!0)}catch(d){console.error("'ready' failed: ",d,d.stack),this._emit("error",d)}},featuresLoaded(){(0,v.default)("[RemoteStorage] All features loaded"),this._setCachingModule(),this.local=x.default.cache&&this.features.local&&new this.features.local,this.local&&this.remote?(this._setGPD(w.default,this),this._bindChange(this.local)):this.remote&&this._setGPD(this.remote,this.remote),this.remote&&(this.remote.on("connected",()=>{this._fireReady(),this._emit("connected")}),this.remote.on("not-connected",()=>{this._fireReady(),this._emit("not-connected")}),this.remote.connected&&(this._fireReady(),this._emit("connected")),this.hasFeature("Authorize")||this.remote.stopWaitingForToken()),this._collectCleanupFunctions();try{this._allLoaded=!0,this._emit("features-loaded")}catch(d){(0,k.logError)(d),this._emit("error",d)}this._processPending()},_collectCleanupFunctions(){this._cleanups=[];for(let d=0;d<this.features.length;d++){const j=this.features[d].cleanup;typeof j=="function"&&this._cleanups.push(j)}}};P.exports=h},function(P,I,T){var p=this&&this.__awaiter||function(k,w,u,N){return new(u||(u=Promise))(function(S,A){function c(g){try{s(N.next(g))}catch(y){A(y)}}function l(g){try{s(N.throw(g))}catch(y){A(y)}}function s(g){var y;g.done?S(g.value):(y=g.value,y instanceof u?y:new u(function(O){O(y)})).then(c,l)}s((N=N.apply(k,w||[])).next())})};const x=(this&&this.__importDefault||function(k){return k&&k.__esModule?k:{default:k}})(T(1));function q(k){return this.backend==="dropbox"&&!!k.match(/^\/public\/.*[^\/]$/)}const v={get:function(k,w){if(this.local){if(w===void 0)w=typeof(u=this).remote=="object"&&u.remote.connected&&u.remote.online?2*u.getSyncInterval():((0,x.default)("Not setting default maxAge, because remote is offline or not connected"),!1);else if(typeof w!="number"&&w!==!1)return Promise.reject("Argument 'maxAge' must be 'false' or a number");return this.local.get(k,w,this.sync.queueGetRequest.bind(this.sync))}return this.remote.get(k);var u},put:function(k,w,u){return q.bind(this)(k)?v._wrapBusyDone.call(this,this.remote.put(k,w,u)):this.local?this.local.put(k,w,u):v._wrapBusyDone.call(this,this.remote.put(k,w,u))},delete:function(k){return this.local?this.local.delete(k):v._wrapBusyDone.call(this,this.remote.delete(k))},_wrapBusyDone:function(k){return p(this,void 0,void 0,function*(){return this._emit("wire-busy"),k.then(w=>(this._emit("wire-done",{success:!0}),Promise.resolve(w)),w=>(this._emit("wire-done",{success:!1}),Promise.reject(w)))})}};P.exports=v},function(P,I,T){var p=this&&this.__awaiter||function(g,y,O,b){return new(O||(O=Promise))(function(t,h){function d(B){try{F(b.next(B))}catch(z){h(z)}}function j(B){try{F(b.throw(B))}catch(z){h(z)}}function F(B){var z;B.done?t(B.value):(z=B.value,z instanceof O?z:new O(function(Y){Y(z)})).then(d,j)}F((b=b.apply(g,y||[])).next())})},x=this&&this.__importDefault||function(g){return g&&g.__esModule?g:{default:g}};const q=x(T(4)),v=x(T(2)),k=x(T(5)),w=x(T(1)),u=T(0),N=T(7),S=T(9);let A;const c="remotestorage:wireclient",l={"draft-dejong-remotestorage-00":2,"draft-dejong-remotestorage-01":3,"draft-dejong-remotestorage-02":4,"https://www.w3.org/community/rww/wiki/read-write-web-00#simple":1};class s extends S.RemoteBase{constructor(y){if(super(y),this._revisionCache={},A=(0,u.localStorageAvailable)(),this.addEvents(["connected","not-connected"]),A){const O=function(){const b=(0,u.getJSONFromLocalStorage)(c)||{},{userAddress:t,href:h,storageApi:d,token:j,properties:F}=b;return{userAddress:t,href:h,storageApi:d,token:j,properties:F}}();O&&setTimeout(()=>{this.configure(O)},0)}this.connected&&setTimeout(this._emit.bind(this),0,"connected")}get storageType(){if(this.storageApi){const y=this.storageApi.match(/draft-dejong-(remotestorage-\d\d)/);return y?y[1]:"2012.04"}}_request(y,O,b,t,h,d,j){return p(this,void 0,void 0,function*(){if(this.isForbiddenRequestMethod(y,O))return Promise.reject(`Don't use ${y} on directories!`);let F;return b!==q.default.IMPLIED_FAKE_TOKEN&&(t.Authorization="Bearer "+b),this.rs._emit("wire-busy",{method:y,isFolder:(0,u.isFolder)(O)}),(0,N.requestWithTimeout)(y,O,{body:h,headers:t,responseType:"arraybuffer"}).then(B=>{if(this.online||(this.online=!0,this.rs._emit("network-online")),this.rs._emit("wire-done",{method:y,isFolder:(0,u.isFolder)(O),success:!0}),z=B.status,[401,403,404,412].indexOf(z)>=0)return(0,w.default)("[WireClient] Error response status",B.status),F=d?this.stripQuotes(B.getResponseHeader("ETag")):void 0,B.status===401&&this.rs._emit("error",new k.default),Promise.resolve({statusCode:B.status,revision:F});if(function(Y){return[201,204,304].indexOf(Y)>=0}(B.status)||B.status===200&&y!=="GET")return F=this.stripQuotes(B.getResponseHeader("ETag")),(0,w.default)("[WireClient] Successful request",F),Promise.resolve({statusCode:B.status,revision:F});{const Y=B.getResponseHeader("Content-Type");F=d?this.stripQuotes(B.getResponseHeader("ETag")):B.status===200?j:void 0;const R=function(_){let m,r="utf-8";return _&&(m=_.match(/charset=(.+)$/),m&&(r=m[1])),r}(Y);return(0,u.shouldBeTreatedAsBinary)(B.response,Y)?((0,w.default)("[WireClient] Successful request with unknown or binary mime-type",F),Promise.resolve({statusCode:B.status,body:B.response,contentType:Y,revision:F})):(0,u.getTextFromArrayBuffer)(B.response,R).then(_=>((0,w.default)("[WireClient] Successful request",F),Promise.resolve({statusCode:B.status,body:_,contentType:Y,revision:F})))}var z},B=>(this.online&&(this.online=!1,this.rs._emit("network-offline")),this.rs._emit("wire-done",{method:y,isFolder:(0,u.isFolder)(O),success:!1}),Promise.reject(B)))})}configure(y){if(typeof y!="object")throw new Error("WireClient configure settings parameter should be an object");if(y.userAddress!==void 0&&(this.userAddress=y.userAddress),y.href!==void 0&&(this.href=y.href),y.storageApi!==void 0&&(this.storageApi=y.storageApi),y.token!==void 0&&(this.token=y.token),y.properties!==void 0&&(this.properties=y.properties),typeof this.storageApi=="string"){const O=l[this.storageApi]||5;this.supportsRevs=O>=2}this.href&&this.token?(this.connected=!0,this.online=!0,this._emit("connected")):this.connected=!1,A&&(localStorage[c]=JSON.stringify({userAddress:this.userAddress,href:this.href,storageApi:this.storageApi,token:this.token,properties:this.properties}))}get(y,O={}){if(!this.connected)return Promise.reject("not connected (path: "+y+")");const b={};return this.supportsRevs&&O.ifNoneMatch&&(b["If-None-Match"]=this.addQuotes(O.ifNoneMatch)),this._request("GET",this.href+(0,u.cleanPath)(y),this.token,b,void 0,this.supportsRevs,this._revisionCache[y]).then(t=>{if(!(0,u.isFolder)(y))return Promise.resolve(t);let h={};if(t.body!==void 0)try{t.body=JSON.parse(t.body)}catch{return Promise.reject("Folder description at "+this.href+(0,u.cleanPath)(y)+" is not JSON")}if(t.statusCode===200&&typeof t.body=="object"){if(Object.keys(t.body).length===0)t.statusCode=404;else if((d=t.body)["@context"]==="http://remotestorage.io/spec/folder-description"&&typeof d.items=="object"){for(const j in t.body.items)this._revisionCache[y+j]=t.body.items[j].ETag;h=t.body.items}else Object.keys(t.body).forEach(j=>{this._revisionCache[y+j]=t.body[j],h[j]={ETag:t.body[j]}});return t.body=h,Promise.resolve(t)}return Promise.resolve(t);var d})}put(y,O,b,t={}){if(!this.connected)return Promise.reject("not connected (path: "+y+")");!b.match(/charset=/)&&(O instanceof ArrayBuffer||(0,N.isArrayBufferView)(O))&&(b+="; charset=binary");const h={"Content-Type":b};return this.supportsRevs&&(t.ifMatch&&(h["If-Match"]=this.addQuotes(t.ifMatch)),t.ifNoneMatch&&(h["If-None-Match"]=this.addQuotes(t.ifNoneMatch))),this._request("PUT",this.href+(0,u.cleanPath)(y),this.token,h,O,this.supportsRevs)}delete(y,O={}){if(!this.connected)throw new Error("not connected (path: "+y+")");O||(O={});const b={};return this.supportsRevs&&O.ifMatch&&(b["If-Match"]=this.addQuotes(O.ifMatch)),this._request("DELETE",this.href+(0,u.cleanPath)(y),this.token,b,void 0,this.supportsRevs)}static _rs_init(y){y.remote=new s(y),y.remote.online=!0}static _rs_supported(){return typeof fetch=="function"||typeof XMLHttpRequest=="function"}static _rs_cleanup(){A&&delete localStorage[c]}}(0,u.applyMixins)(s,[v.default]),P.exports=s},function(P,I,T){var p=this&&this.__awaiter||function(b,t,h,d){return new(h||(h=Promise))(function(j,F){function B(R){try{Y(d.next(R))}catch(_){F(_)}}function z(R){try{Y(d.throw(R))}catch(_){F(_)}}function Y(R){var _;R.done?j(R.value):(_=R.value,_ instanceof h?_:new h(function(m){m(_)})).then(B,z)}Y((d=d.apply(b,t||[])).next())})},x=this&&this.__importDefault||function(b){return b&&b.__esModule?b:{default:b}};const q=x(T(3)),v=x(T(17)),k=x(T(2)),w=x(T(1)),u=x(T(4)),N=x(T(10)),S=x(T(5)),A=T(0);let c,l;function s(b,t,h){return{action:b,path:t,promise:h}}function g(b,t){return b.common.revision!==t&&(!b.remote||b.remote.revision!==t)}function y(b){return b.common&&b.common.revision}class O{constructor(t){this._finishedTasks=[],this.rs=t,this._tasks={},this._running={},this._timeStarted={},this.numThreads=10,this.rs.local.onDiff(h=>{this.addTask(h),this.doTasks()}),this.rs.caching.onActivate(h=>{this.addTask(h),this.doTasks()}),this.addEvents(["done","req-done"])}now(){return new Date().getTime()}queueGetRequest(t){return new Promise((h,d)=>{this.rs.remote.connected?this.rs.remote.online?(this.addTask(t,function(){this.rs.local.get(t).then(j=>h(j))}.bind(this)),this.doTasks()):d("cannot fulfill maxAge requirement - remote is not online"):d("cannot fulfill maxAge requirement - remote is not connected")})}corruptServerItemsMap(t,h){if(typeof t!="object"||Array.isArray(t))return!0;for(const d in t){const j=t[d];if(typeof j!="object"||typeof j.ETag!="string")return!0;if((0,A.isFolder)(d)){if(d.substring(0,d.length-1).indexOf("/")!==-1)return!0}else if(d.indexOf("/")!==-1||h&&(typeof j["Content-Type"]!="string"||typeof j["Content-Length"]!="number"))return!0}return!1}corruptItemsMap(t){if(typeof t!="object"||Array.isArray(t))return!0;for(const h in t)if(typeof t[h]!="boolean")return!0;return!1}corruptRevision(t){return typeof t!="object"||Array.isArray(t)||t.revision&&typeof t.revision!="string"||t.body&&typeof t.body!="string"&&typeof t.body!="object"||t.contentType&&typeof t.contentType!="string"||t.contentLength&&typeof t.contentLength!="number"||t.timestamp&&typeof t.timestamp!="number"||t.itemsMap&&this.corruptItemsMap(t.itemsMap)}isCorrupt(t){return typeof t!="object"||Array.isArray(t)||typeof t.path!="string"||this.corruptRevision(t.common)||t.local&&this.corruptRevision(t.local)||t.remote&&this.corruptRevision(t.remote)||t.push&&this.corruptRevision(t.push)}hasTasks(){return Object.getOwnPropertyNames(this._tasks).length>0}collectDiffTasks(){return p(this,void 0,void 0,function*(){let t=0;return this.rs.local.forAllNodes(h=>{t>100||(this.isCorrupt(h)?((0,w.default)("[Sync] WARNING: corrupt node in local cache",h),typeof h=="object"&&h.path&&(this.addTask(h.path),t++)):(this.needsFetch(h)&&this.rs.access.checkPathPermission(h.path,"r")||(0,A.isDocument)(h.path)&&this.needsPush(h)&&this.rs.access.checkPathPermission(h.path,"rw"))&&(this.addTask(h.path),t++))}).then(()=>t).catch(h=>{throw h})})}inConflict(t){return t.local&&t.remote&&(t.remote.body!==void 0||t.remote.itemsMap)}needsRefresh(t){return!!t.common&&(!t.common.timestamp||this.now()-t.common.timestamp>q.default.syncInterval)}needsFetch(t){return!!this.inConflict(t)||!(!t.common||t.common.itemsMap!==void 0||t.common.body!==void 0)||!(!t.remote||t.remote.itemsMap!==void 0||t.remote.body!==void 0)}needsPush(t){return!this.inConflict(t)&&(!(!t.local||t.push)||void 0)}needsRemotePut(t){return t.local&&t.local.body}needsRemoteDelete(t){return t.local&&t.local.body===!1}getParentPath(t){const h=t.match(/^(.*\/)([^\/]+\/?)$/);if(h)return h[1];throw new Error('Not a valid path: "'+t+'"')}deleteChildPathsFromTasks(){for(const t in this._tasks){const h=(0,A.pathsFromRoot)(t);for(let d=1;d<h.length;d++)this._tasks[h[d]]&&(Array.isArray(this._tasks[t])&&this._tasks[t].length&&Array.prototype.push.apply(this._tasks[h[d]],this._tasks[t]),delete this._tasks[t])}}collectRefreshTasks(){return p(this,void 0,void 0,function*(){return this.rs.local.forAllNodes(t=>{let h;if(this.needsRefresh(t)){try{h=this.getParentPath(t.path)}catch{}h&&this.rs.access.checkPathPermission(h,"r")?this.addTask(h):this.rs.access.checkPathPermission(t.path,"r")&&this.addTask(t.path)}}).then(()=>this.deleteChildPathsFromTasks()).catch(t=>{throw t})})}flush(t){for(const h in t)this.rs.caching.checkPath(h)==="FLUSH"&&t[h]&&!t[h].local&&((0,w.default)("[Sync] Flushing",h),t[h]=void 0);return t}doTask(t){return this.rs.local.getNodes([t]).then(h=>{const d=h[t];return d===void 0||function(j){return j.remote&&j.remote.revision&&!j.remote.itemsMap&&!j.remote.body}(d)?s("get",t,this.rs.remote.get(t)):this.needsRemotePut(d)?(d.push=(0,A.deepClone)(d.local),d.push.timestamp=this.now(),this.rs.local.setNodes(this.flush(h)).then(()=>{let j;return j=y(d)?{ifMatch:d.common.revision}:{ifNoneMatch:"*"},s("put",t,this.rs.remote.put(t,d.push.body,d.push.contentType,j))})):this.needsRemoteDelete(d)?(d.push={body:!1,timestamp:this.now()},this.rs.local.setNodes(this.flush(h)).then(()=>y(d)?s("delete",t,this.rs.remote.delete(t,{ifMatch:d.common.revision})):s("get",t,this.rs.remote.get(t)))):y(d)?s("get",t,this.rs.remote.get(t,{ifNoneMatch:d.common.revision})):s("get",t,this.rs.remote.get(t))})}autoMergeFolder(t){if(t.remote.itemsMap&&(t.common=t.remote,delete t.remote,t.common.itemsMap)){for(const h in t.common.itemsMap)t.local.itemsMap[h]||(t.local.itemsMap[h]=!1);(0,A.equal)(t.local.itemsMap,t.common.itemsMap)&&delete t.local}return t}autoMergeDocument(t){return function(h){return(!h.remote||!h.remote.revision||h.remote.revision===h.common.revision)&&(h.common.body===void 0&&h.remote.body===!1||h.remote.body===h.common.body&&h.remote.contentType===h.common.contentType)}(t)?delete(t=function(h){return h.remote&&h.remote.body===!1&&h.local&&h.local.body===!1&&delete h.local,h}(t)).remote:t.remote.body!==void 0&&((0,w.default)("[Sync] Emitting keep/revert"),this.rs.local._emitChange({origin:"conflict",path:t.path,oldValue:t.local.body,newValue:t.remote.body,lastCommonValue:t.common.body,oldContentType:t.local.contentType,newContentType:t.remote.contentType,lastCommonContentType:t.common.contentType}),t.remote.body?t.common=t.remote:t.common={},delete t.remote,delete t.local),t}autoMerge(t){if(t.remote){if(t.local)return(0,A.isFolder)(t.path)?this.autoMergeFolder(t):this.autoMergeDocument(t);if((0,A.isFolder)(t.path))t.remote.itemsMap!==void 0&&(t.common=t.remote,delete t.remote);else if(t.remote.body!==void 0){const h={origin:"remote",path:t.path,oldValue:t.common.body===!1?void 0:t.common.body,newValue:t.remote.body===!1?void 0:t.remote.body,oldContentType:t.common.contentType,newContentType:t.remote.contentType};if((h.oldValue||h.newValue)&&this.rs.local._emitChange(h),!t.remote.body)return;t.common=t.remote,delete t.remote}return t}t.common.body&&this.rs.local._emitChange({origin:"remote",path:t.path,oldValue:t.common.body,newValue:void 0,oldContentType:t.common.contentType,newContentType:void 0})}updateCommonTimestamp(t,h){return p(this,void 0,void 0,function*(){return this.rs.local.getNodes([t]).then(d=>(d[t]&&d[t].common&&d[t].common.revision===h&&(d[t].common.timestamp=this.now()),this.rs.local.setNodes(this.flush(d))))})}markChildren(t,h,d,j){return p(this,void 0,void 0,function*(){const F=[],B={},z={};for(const Y in h)F.push(t+Y),B[t+Y]=h[Y];for(const Y in j)F.push(t+Y);return this.rs.local.getNodes(F).then(Y=>{let R,_;for(const m in Y)if(_=Y[m],B[m])_&&_.common?g(_,B[m].ETag)&&(d[m]=(0,A.deepClone)(_),d[m].remote={revision:B[m].ETag,timestamp:this.now()},d[m]=this.autoMerge(d[m])):(R=this.rs.caching.checkPath(m),R==="ALL"&&(d[m]={path:m,common:{timestamp:this.now()},remote:{revision:B[m].ETag,timestamp:this.now()}})),d[m]&&B[m]["Content-Type"]&&(d[m].remote.contentType=B[m]["Content-Type"]),d[m]&&B[m]["Content-Length"]&&(d[m].remote.contentLength=B[m]["Content-Length"]);else if(j[m.substring(t.length)]&&_&&_.common){if(_.common.itemsMap)for(const r in _.common.itemsMap)z[m+r]=!0;if(_.local&&_.local.itemsMap)for(const r in _.local.itemsMap)z[m+r]=!0;if(_.remote||(0,A.isFolder)(m))d[m]=void 0;else if(d[m]=this.autoMerge(_),d[m]===void 0){const r=this.getParentPath(m),n=d[r],f=m.substring(t.length);n&&n.local&&(delete n.local.itemsMap[f],(0,A.equal)(n.local.itemsMap,n.common.itemsMap)&&delete n.local)}}return this.deleteRemoteTrees(Object.keys(z),d).then(m=>this.rs.local.setNodes(this.flush(m)))})})}deleteRemoteTrees(t,h){return p(this,void 0,void 0,function*(){return t.length===0?Promise.resolve(h):this.rs.local.getNodes(t).then(d=>p(this,void 0,void 0,function*(){const j={};function F(B,z){if(B&&B.itemsMap)for(const Y in B.itemsMap)j[z+Y]=!0}for(const B in d){const z=d[B];z&&((0,A.isFolder)(B)?(F(z.common,B),F(z.local,B)):z.common&&typeof z.common.body!==void 0&&(h[B]=(0,A.deepClone)(z),h[B].remote={body:!1,timestamp:this.now()},h[B]=this.autoMerge(h[B])))}return this.deleteRemoteTrees(Object.keys(j),h).then(B=>this.rs.local.setNodes(this.flush(B)))}))})}completeFetch(t,h,d,j){return p(this,void 0,void 0,function*(){let F,B;const z=(0,A.pathsFromRoot)(t);return(0,A.isFolder)(t)?F=[t]:(B=z[1],F=[t,B]),this.rs.local.getNodes(F).then(Y=>{let R,_,m=Y[t];const r={};function n(f){if(f&&f.itemsMap)for(R in f.itemsMap)h[R]||(r[R]=!0)}if(typeof m=="object"&&m.path===t&&typeof m.common=="object"||(m={path:t,common:{}},Y[t]=m),m.remote={revision:j,timestamp:this.now()},(0,A.isFolder)(t))for(R in n(m.common),n(m.remote),m.remote.itemsMap={},h)m.remote.itemsMap[R]=!0;else m.remote.body=h,m.remote.contentType=d,_=Y[B],_&&_.local&&_.local.itemsMap&&(R=t.substring(B.length),_.local.itemsMap[R]=!0,(0,A.equal)(_.local.itemsMap,_.common.itemsMap)&&delete _.local);return Y[t]=this.autoMerge(m),{toBeSaved:Y,missingChildren:r}})})}completePush(t,h,d,j){return p(this,void 0,void 0,function*(){return this.rs.local.getNodes([t]).then(F=>{const B=F[t];if(!B.push)throw this.stopped=!0,new Error("completePush called but no push version!");return d?((0,w.default)("[Sync] We have a conflict"),B.remote&&B.remote.revision===j||(B.remote={revision:j||"conflict",timestamp:this.now()},delete B.push),F[t]=this.autoMerge(B)):(B.common={revision:j,timestamp:this.now()},h==="put"?(B.common.body=B.push.body,B.common.contentType=B.push.contentType,(0,A.equal)(B.local.body,B.push.body)&&B.local.contentType===B.push.contentType&&delete B.local,delete B.push):h==="delete"&&(B.local.body===!1?F[t]=void 0:delete B.push)),this.rs.local.setNodes(this.flush(F))})})}dealWithFailure(t){return p(this,void 0,void 0,function*(){return this.rs.local.getNodes([t]).then(h=>{if(h[t])return delete h[t].push,this.rs.local.setNodes(this.flush(h))})})}interpretStatus(t){const h={statusCode:t,successful:void 0,conflict:void 0,unAuth:void 0,notFound:void 0,changed:void 0,networkProblems:void 0};if(typeof t=="string"&&(t==="offline"||t==="timeout"))return h.successful=!1,h.networkProblems=!0,h;if(typeof t=="number"){const d=Math.floor(t/100);return h.successful=d===2||t===304||t===412||t===404,h.conflict=t===412,h.unAuth=t===401&&this.rs.remote.token!==u.default.IMPLIED_FAKE_TOKEN||t===402||t===403,h.notFound=t===404,h.changed=t!==304,h}}handleGetResponse(t,h,d,j,F){return p(this,void 0,void 0,function*(){return h.notFound&&(d=!!(0,A.isFolder)(t)&&{}),h.changed?this.completeFetch(t,d,j,F).then(B=>(0,A.isFolder)(t)?this.corruptServerItemsMap(d)?((0,w.default)("[Sync] WARNING: Discarding corrupt folder description from server for "+t),!1):this.markChildren(t,d,B.toBeSaved,B.missingChildren).then(()=>!0):this.rs.local.setNodes(this.flush(B.toBeSaved)).then(()=>!0)):this.updateCommonTimestamp(t,F).then(()=>!0)})}handleResponse(t,h,d){const j=this.interpretStatus(d.statusCode);if(j.successful){if(h==="get")return this.handleGetResponse(t,j,d.body,d.contentType,d.revision);if(h==="put"||h==="delete")return this.completePush(t,h,j.conflict,d.revision).then(function(){return!0});throw new Error("cannot handle response for unknown action "+h)}{let F;return F=j.unAuth?new S.default:j.networkProblems?new N.default("Network request failed."):new Error("HTTP response code "+j.statusCode+" received."),this.dealWithFailure(t).then(()=>{throw this.rs._emit("error",F),F})}}finishTask(t,h=!0){if(t.action!==void 0){if(!(h&&((0,w.default)("[Sync] queue finished task:",t.path),this._finishedTasks.push(t),this._finishedTasks.length>1)))return(0,w.default)("[Sync] run task:",t.path),t.promise.then(d=>this.handleResponse(t.path,t.action,d),d=>((0,w.default)("[Sync] wireclient rejects its promise!",t.path,t.action,d),this.handleResponse(t.path,t.action,{statusCode:"offline"}))).then(d=>{if(this._finishedTasks.shift(),delete this._timeStarted[t.path],delete this._running[t.path],d&&this._tasks[t.path]){for(let j=0;j<this._tasks[t.path].length;j++)this._tasks[t.path][j]();delete this._tasks[t.path]}this.rs._emit("sync-req-done"),this._finishedTasks.length>0?this.finishTask(this._finishedTasks[0],!1):this.collectTasks(!1).then(()=>{!this.hasTasks()||this.stopped?((0,w.default)("[Sync] Sync is done! Reschedule?",Object.getOwnPropertyNames(this._tasks).length,this.stopped),this.done||(this.done=!0,this.rs._emit("sync-done"))):setTimeout(()=>{this.doTasks()},10)})},d=>{(0,w.default)("[Sync] Error",d),this._finishedTasks.shift(),delete this._timeStarted[t.path],delete this._running[t.path],this.rs._emit("sync-req-done"),this._finishedTasks.length>0?this.finishTask(this._finishedTasks[0],!1):this.done||(this.done=!0,this.rs._emit("sync-done"))});(0,w.default)("[Sync] delaying finished task:",t.path)}else delete this._running[t.path]}doTasks(){let t,h,d=0;t=this.rs.remote.connected?this.rs.remote.online?this.numThreads:1:0;const j=t-Object.getOwnPropertyNames(this._running).length;if(j<=0)return!0;for(h in this._tasks)if(!this._running[h]&&(this._timeStarted[h]=this.now(),this._running[h]=this.doTask(h),this._running[h].then(this.finishTask.bind(this)),d++,d>=j))return!0;return d>=j}collectTasks(t){return p(this,void 0,void 0,function*(){return this.hasTasks()||this.stopped?Promise.resolve():this.collectDiffTasks().then(h=>h||t===!1?Promise.resolve():this.collectRefreshTasks(),function(h){throw h})})}addTask(t,h){this._tasks[t]||(this._tasks[t]=[]),typeof h=="function"&&this._tasks[t].push(h)}sync(){return this.done=!1,this.doTasks()?Promise.resolve():this.collectTasks().then(()=>{try{this.doTasks()}catch(t){(0,w.default)("[Sync] doTasks error",t)}},function(t){throw(0,w.default)("[Sync] Sync error",t),new Error("Local cache unavailable")})}static _rs_init(t){c=function(){(0,w.default)("[Sync] syncCycleCb calling syncCycle");const h=new v.default;h.isBrowser()&&function(d,j){function F(B){const z=j.getCurrentSyncInterval();q.default.isBackground=!B;const Y=j.getCurrentSyncInterval();j._emit("sync-interval-change",{oldValue:z,newValue:Y})}d.on("background",()=>F(!1)),d.on("foreground",()=>F(!0))}(h,t),t.sync||(t.sync=new O(t),t.syncStopped&&((0,w.default)("[Sync] Instantiating sync stopped"),t.sync.stopped=!0,delete t.syncStopped)),(0,w.default)("[Sync] syncCycleCb calling syncCycle"),t.syncCycle()},l=function(){t.removeEventListener("connected",l),t.startSync()},t.on("ready",c),t.on("connected",l)}static _rs_cleanup(t){t.stopSync(),t.removeEventListener("ready",c),t.removeEventListener("connected",l),t.sync=void 0,delete t.sync}}(0,A.applyMixins)(O,[k.default]),P.exports=O},function(P,I,T){(function(p){var x=this&&this.__awaiter||function(A,c,l,s){return new(l||(l=Promise))(function(g,y){function O(h){try{t(s.next(h))}catch(d){y(d)}}function b(h){try{t(s.throw(h))}catch(d){y(d)}}function t(h){var d;h.done?g(h.value):(d=h.value,d instanceof l?d:new l(function(j){j(d)})).then(O,b)}t((s=s.apply(A,c||[])).next())})},q=this&&this.__importDefault||function(A){return A&&A.__esModule?A:{default:A}};const v=q(T(2)),k=q(T(11)),w=q(T(1)),u=T(0);let N;class S extends k.default{constructor(c){super(),this.addEvents(["change","local-events-done"]),this.db=c||N,this.db?(this.getsRunning=0,this.putsRunning=0,this.changesQueued={},this.changesRunning={},this.commitSlownessWarning=null):(0,w.default)("[IndexedDB] Failed to open DB")}getNodes(c){return x(this,void 0,void 0,function*(){const l=[],s={};for(let g=0,y=c.length;g<y;g++)this.changesQueued[c[g]]!==void 0?s[c[g]]=(0,u.deepClone)(this.changesQueued[c[g]]||void 0):this.changesRunning[c[g]]!==void 0?s[c[g]]=(0,u.deepClone)(this.changesRunning[c[g]]||void 0):l.push(c[g]);return l.length>0?this.getNodesFromDb(l).then(function(g){for(const y in s)g[y]=s[y];return g}):Promise.resolve(s)})}setNodes(c){return x(this,void 0,void 0,function*(){for(const l in c)this.changesQueued[l]=c[l]||!1;return this.maybeFlush(),Promise.resolve()})}maybeFlush(){this.putsRunning===0?this.flushChangesQueued():this.commitSlownessWarning||(this.commitSlownessWarning=p.setInterval(function(){console.warn("WARNING: waited more than 10 seconds for previous commit to finish")},1e4))}flushChangesQueued(){this.commitSlownessWarning&&(clearInterval(this.commitSlownessWarning),this.commitSlownessWarning=null),Object.keys(this.changesQueued).length>0&&(this.changesRunning=this.changesQueued,this.changesQueued={},this.setNodesInDb(this.changesRunning).then(this.flushChangesQueued.bind(this)))}getNodesFromDb(c){return new Promise((l,s)=>{const g=this.db.transaction(["nodes"],"readonly"),y=g.objectStore("nodes"),O={};this.getsRunning++,c.map(b=>{y.get(b).onsuccess=t=>{O[b]=t.target.result}}),g.oncomplete=()=>{l(O),this.getsRunning--},g.onerror=g.onabort=()=>{s("get transaction error/abort"),this.getsRunning--}})}setNodesInDb(c){return x(this,void 0,void 0,function*(){return new Promise((l,s)=>{const g=this.db.transaction(["nodes"],"readwrite"),y=g.objectStore("nodes"),O=new Date().getTime();this.putsRunning++,(0,w.default)("[IndexedDB] Starting put",c,this.putsRunning);for(const b in c){const t=c[b];if(typeof t=="object")try{y.put(t)}catch(h){throw(0,w.default)("[IndexedDB] Error while putting",t,h),h}else try{y.delete(b)}catch(h){throw(0,w.default)("[IndexedDB] Error while removing",y,t,h),h}}g.oncomplete=()=>{this.putsRunning--,(0,w.default)("[IndexedDB] Finished put",c,this.putsRunning,new Date().getTime()-O+"ms"),l()},g.onerror=()=>{this.putsRunning--,s("transaction error")},g.onabort=()=>{s("transaction abort"),this.putsRunning--}})})}reset(c){const l=this.db.name;this.db.close(),S.clean(this.db.name,()=>{S.open(l,(s,g)=>{s?(0,w.default)("[IndexedDB] Error while resetting local storage",s):this.db=g,typeof c=="function"&&c(self)})})}forAllNodes(c){return x(this,void 0,void 0,function*(){return new Promise(l=>{this.db.transaction(["nodes"],"readonly").objectStore("nodes").openCursor().onsuccess=s=>{const g=s.target.result;g?(c(this.migrate(g.value)),g.continue()):l()}})})}closeDB(){this.putsRunning===0?this.db.close():setTimeout(this.closeDB.bind(this),100)}static open(c,l){const s=setTimeout(function(){l("timeout trying to open db")},1e4);try{const g=indexedDB.open(c,2);g.onerror=function(){(0,w.default)("[IndexedDB] Opening DB failed",g),clearTimeout(s),l(g.error)},g.onupgradeneeded=function(y){const O=g.result;(0,w.default)("[IndexedDB] Upgrade: from ",y.oldVersion," to ",y.newVersion),y.oldVersion!==1&&((0,w.default)("[IndexedDB] Creating object store: nodes"),O.createObjectStore("nodes",{keyPath:"path"})),(0,w.default)("[IndexedDB] Creating object store: changes"),O.createObjectStore("changes",{keyPath:"path"})},g.onsuccess=function(){clearTimeout(s);const y=g.result;if(!y.objectStoreNames.contains("nodes")||!y.objectStoreNames.contains("changes"))return(0,w.default)("[IndexedDB] Missing object store. Resetting the database."),void S.clean(c,function(){S.open(c,l)});l(null,g.result)}}catch(g){(0,w.default)("[IndexedDB] Failed to open database: "+g),(0,w.default)("[IndexedDB] Resetting database and trying again."),clearTimeout(s),S.clean(c,function(){S.open(c,l)})}}static clean(c,l){const s=indexedDB.deleteDatabase(c);s.onsuccess=function(){(0,w.default)("[IndexedDB] Done removing DB"),l()},s.onerror=s.onabort=function(g){console.error('Failed to remove database "'+c+'"',g)}}static _rs_init(c){return new Promise((l,s)=>{S.open("remotestorage",function(g,y){g?s(g):(N=y,y.onerror=()=>{c._emit("error",g)},l())})})}static _rs_supported(){return new Promise((c,l)=>{const s=(0,u.getGlobalContext)();let g=!1;if(typeof navigator<"u"&&navigator.userAgent.match(/Android (2|3|4\.[0-3])/)&&(navigator.userAgent.match(/Chrome|Firefox/)||(g=!0)),"indexedDB"in s&&!g)try{const y=indexedDB.open("rs-check");y.onerror=function(){l()},y.onsuccess=function(){y.result.close(),indexedDB.deleteDatabase("rs-check"),c()}}catch{l()}else l()})}static _rs_cleanup(c){return new Promise(l=>{c.local&&c.local.closeDB(),S.clean("remotestorage",l)})}diffHandler(){}}(0,u.applyMixins)(S,[v.default]),P.exports=S}).call(this,T(6))},function(P,I,T){var p=this&&this.__importDefault||function(S){return S&&S.__esModule?S:{default:S}};const x=p(T(11)),q=p(T(2)),v=p(T(1)),k=T(0),w="remotestorage:cache:nodes:";function u(S){return S.substr(0,w.length)===w||S.substr(0,28)==="remotestorage:cache:changes:"}class N extends x.default{constructor(){super(),this.addEvents(["change","local-events-done"])}diffHandler(...A){}getNodes(A){const c={};for(let l=0,s=A.length;l<s;l++)try{c[A[l]]=JSON.parse(localStorage[w+A[l]])}catch{c[A[l]]=void 0}return Promise.resolve(c)}setNodes(A){for(const c in A)localStorage[w+c]=JSON.stringify(A[c]);return Promise.resolve()}forAllNodes(A){let c;for(let l=0,s=localStorage.length;l<s;l++)if(localStorage.key(l).substr(0,w.length)===w){try{c=this.migrate(JSON.parse(localStorage[localStorage.key(l)]))}catch{c=void 0}c&&A(c)}return Promise.resolve()}static _rs_init(){}static _rs_supported(){return(0,k.localStorageAvailable)()}static _rs_cleanup(){const A=[];for(let c=0,l=localStorage.length;c<l;c++){const s=localStorage.key(c);u(s)&&A.push(s)}A.forEach(c=>{(0,v.default)("[LocalStorage] Removing",c),delete localStorage[c]})}}(0,k.applyMixins)(N,[q.default]),P.exports=N},function(P,I,T){var p=this&&this.__importDefault||function(w){return w&&w.__esModule?w:{default:w}};const x=p(T(2)),q=p(T(11)),v=T(0);class k extends q.default{constructor(){super(),this._storage={},this.addEvents(["change","local-events-done"])}getNodes(u){const N={};for(let S=0,A=u.length;S<A;S++)N[u[S]]=(0,v.deepClone)(this._storage[u[S]]);return Promise.resolve(N)}setNodes(u){for(const N in u)u[N]===void 0?delete this._storage[N]:this._storage[N]=u[N];return Promise.resolve()}forAllNodes(u){for(const N in this._storage)u(this.migrate(this._storage[N]));return Promise.resolve()}diffHandler(){}static _rs_init(){}static _rs_supported(){return!0}static _rs_cleanup(){}}(0,v.applyMixins)(k,[x.default]),P.exports=k}])})})(Dt);const Lt=Ft(bt),Pt=new Lt;Pt.setApiKeys({dropbox:Nt,googledrive:Ut});const gt=Mt(!1),be=Ot(gt,D=>D);Pt.addEventListener("sync-req-done",()=>{gt.set(!0)});Pt.addEventListener("sync-done",()=>{gt.set(!1)});window.addEventListener("beforeunload",D=>{if(Ct(gt)){const i="It looks like you have been editing something. If you leave before saving, your changes will be lost.";return(D||window.event).returnValue=i,i}});function kt(D,i){return D[0]=(i&4278190080)>>24,D[1]=(i&16711680)>>16,D[2]=(i&65280)>>8,D[3]=i&255,D}const At=new Uint8Array(1),Bt=new Uint8Array(4),St=new Float32Array(1);class qt{writeByte(i){return At[0]=i,this.write(At)}writeInteger(i){return this.write(kt(Bt,i))}writeFloat(i){return St[0]=i,this.write(new Uint8Array(St.buffer))}}function Jt(D){return D>>>1&1073741824|D&3221225471}class Gt extends qt{constructor(){super(...arguments),this.hash=0}finish(){return this.hash}write(i){let P=this.hash;for(let I=0,T=i.length;I<T;I++)P=31*P+i[I];return this.hash=Jt(P),this}}function Ht(){return new Gt}const Et=new Set;function Yt(D,i=Ht){return Vt(D,i()).finish()}function Vt(D,i){return yt(D,i),Et.clear(),i}function yt(D,i){return D!=null&&(typeof D=="string"?ft(D,i):typeof D=="number"?pt(D,i):typeof D=="boolean"?zt(D,i):typeof D=="symbol"?Wt(D,i):typeof D[Symbol.iterator]=="function"?Kt(D,i):typeof D=="function"?$t(D,i):typeof D.length=="number"?Xt(D,i):Tt(D,i)),i}function ft(D,i){for(const P of D)i.writeInteger(P.charCodeAt(0))}function pt(D,i){D%1===0?i.writeInteger(D):i.writeFloat(D)}function zt(D,i){i.writeInteger(D===!0?1:0)}function Wt(D,i){ft(D.toString(),i)}function Kt(D,i){let P=0;for(const I of D)yt(I,i),P++;pt(P,i)}function $t(D,i){D.prototype!==null&&typeof D.prototype=="object"&&Tt(D.prototype,i),ft(D.name,i),pt(D.length,i),ft(D.toString(),i)}function Xt(D,i){const P=Object.getPrototypeOf(D);P!==null&&typeof P=="object"&&typeof P.constructor=="function"&&Tt(P.constructor,i);for(let I=0,T=D.length;I<T;I++)yt(D[I],i);pt(D.length,i)}function Tt(D,i){if(!Et.has(D)){Et.add(D);let P=0;for(const[I,T]of Object.entries(D))ft(I,i),yt(T,i),P++;pt(P,i)}}const ct=Math.pow(2,31)-1|0,xt={},ht={};class vt{constructor(i,P){if(i!==xt)throw new TypeError("Options can only be created with the some or none functions");this._value=P}static some(i){return st(i)}static none(){return ot()}static from(i){return i!=null?st(i):ot()}static fromJSON(i){return vt.from(i)}isNone(){return this._value===ht}isSome(){return!this.isNone()}expect(i){if(this.isSome())return this._value;throw new Error(typeof i=="function"?i():i)}unwrap(){return this.expect("Tried to unwrap value of none Option")}unwrapOr(i){return this.isSome()?this._value:i}unwrapOrElse(i){return this.isSome()?this._value:i()}map(i){return this.isSome()?st(i(this._value)):ot()}mapOr(i,P){return this.isSome()?st(i(this._value)):st(P)}mapOrElse(i,P){return this.isSome()?st(i(this._value)):st(P())}flatMap(i){return this.isSome()?i(this._value):ot()}flatMapOr(i,P){return this.isSome()?i(this._value):P}flatMapOrElse(i,P){return this.isSome()?i(this._value):P()}and(i){return this.isSome()?i:ot()}andThen(i){return this.isSome()?i(this._value):ot()}or(i){return this.isNone()?i:this}orElse(i){return this.isNone()?i():this}xor(i){const P=this.isSome(),I=i.isSome();return P&&!I?this:!P&&I?i:ot()}filter(i){return this.isSome()&&i(this._value)?this:ot()}getOrInsert(i){return this.isNone()&&(this._value=i),this}getOrInsertWith(i){return this.isNone()&&(this._value=i()),this}clear(){return this._value=ht,this}take(){if(this.isSome()){const i=this._value;return this._value=ht,st(i)}else return ot()}from(i){return i!=null?this._value=i:this.clear(),this}replace(i){return this._value=i,this}ifSome(i,P){return this.isSome()?i(this._value):P&&P(),this}ifNone(i,P){return this.isNone()?i():P&&P(this._value),this}toJSON(){return this.unwrapOr(null)}toJS(){return this.unwrapOr(null)}[Symbol.iterator](){return new Qt(this._value)}}class Qt{constructor(i){this.value=i}next(){if(this.value===ht)return{done:!0,value:void 0};{const i=this.value;return this.value=ht,{done:!1,value:i}}}}const st=D=>new vt(xt,D),ot=()=>new vt(xt,ht);class Z{constructor(i){this._index=0,this._iter=i}[Symbol.iterator](){return this}iter(){return this}next(){return this._iter.next()}nextWithIndex(){const i=this._iter.next();return i.done?i:{value:[i.value,this._index++]}}enumerate(){throw new Error("iter/Enumerate was not imported!")}peekable(){throw new Error("iter/Peekable was not imported!")}forEach(i){throw new Error("iter/ForEach was not imported!")}map(i){throw new Error("iter/Map was not imported!")}merge(i){throw new Error("iter/Merge was not imported!")}concat(i){return this.merge(i)}filter(i){throw new Error("iter/Filter was not imported!")}step(i){throw new Error("iter/Step was not imported!")}skip(i){throw new Error("iter/Skip was not imported!")}take(i){throw new Error("iter/Take was not imported!")}toMap(i,P){throw new Error("iter/ToMap was not imported!")}count(){return this.reduce(0,i=>i+1)}consume(){let i=this.next();for(;!i.done;)i=this.next();return this}toArray(){return this.reduce([],(i,P)=>(i.push(P),i))}join(i){return this.toArray().join(i)}indexOf(i){let P=this.next(),I=0;for(;!P.done;){if(P.value===i)return I;I++,P=this.next()}return-1}findIndex(i){let P=this.nextWithIndex();for(;!P.done;){const[I,T]=P.value;if(i(I,T))return T;P=this.nextWithIndex()}return-1}find(i){let P=this.nextWithIndex();for(;!P.done;){const[I,T]=P.value;if(i(I,T))return st(I);P=this.nextWithIndex()}return ot()}findAll(i){return this.filter(i)}nth(i=0){let P=this.next();for(i<0&&(i=0);!P.done;){if(i--<=0)return st(P.value);P=this.next()}return ot()}first(){return this.nth(0)}last(){let i=this.next();for(;!i.done;){const P=this.next();if(P.done)return st(i.value);i=P}return ot()}any(i){return this.findIndex(i)!==-1}some(i){return this.any(i)}none(i){return this.findIndex(i)===-1}all(i){let P=this.nextWithIndex();for(;!P.done;){const[I,T]=P.value;if(!i(I,T))return!1;P=this.nextWithIndex()}return!0}flatten(i){throw new Error("iter/Flatten was not imported!")}unflatten(i){throw new Error("iter/Unflatten was not imported!")}reduce(i,P){let I=this.next();for(;!I.done;){const T=I.value;i=P(i,T,this._index-1),I=this.next()}return i}reverse(){return dt(this.toArray().reverse())}}function dt(D){return D!=null?typeof D[Symbol.iterator]=="function"?new Z(D[Symbol.iterator]()):typeof D.next=="function"?D instanceof Z?D:new Z(D):dt(typeof D=="object"?Object.entries(D):[D]):dt([])}class Zt extends Z{constructor(i){super(i)}next(){const i=super.nextWithIndex();return i.done?i:{value:te(i.value)}}}Z.prototype.enumerate=function(){return new Zt(this)};function te(D){const i=D[0],P=D;return P[0]=D[1],P[1]=i,P}class ee extends Z{constructor(i,P){super(i),this._fn=P}next(){let i=super.nextWithIndex();for(;!i.done;){const[P,I]=i.value;if(this._fn(P,I))return{done:!1,value:P};i=super.nextWithIndex()}return{done:!0,value:void 0}}}Z.prototype.filter=function(i){return new ee(this,i)};class re extends Z{constructor(i,P){super(i),this._fn=([I,T])=>(P(I,T),I)}next(){const i=super.nextWithIndex();return i.done?i:{done:!1,value:this._fn(i.value)}}}Z.prototype.forEach=function(i){return new re(this,i)};class ne extends Z{constructor(i,P){super(i),this._fn=([I,T])=>P(I,T)}next(){const i=super.nextWithIndex();return i.done?i:{done:!1,value:this._fn(i.value)}}}Z.prototype.map=function(i){return new ne(this,i)};class oe extends Z{constructor(i,P){super(i),this._other=P}next(){const i=super.next();return i.done?this._other.next():i}}Z.prototype.merge=function(i){return new oe(this,i)};class se extends Z{constructor(){super(...arguments),this.peeked=[]}unpeekAll(){return this.peeked.length=0,this}unpeek(){return this.peeked.length>0?st(this.peeked.shift()):ot()}peek(i=0){if(i<this.peeked.length)return st(this.peeked[i]);{let P=this.peeked.length-i-1,I=super.next();for(;!I.done&&(this.peeked.push(I.value),!(--P<=0));)I=super.next();return I.done?ot():st(I.value)}}next(){const i=this.unpeek();if(i.isSome())return{done:!1,value:i.unwrap()};const P=super.next();return P.done?P:{done:!1,value:P.value}}}Z.prototype.peekable=function(){return new se(this)};class ie extends Z{constructor(i,P){super(i),this._skipped=0,this._skip=(P<=0?0:P)|0}next(){let i=super.next();for(;!i.done;)if(this._skipped<=this._skip)this._skipped+=1,i=super.next();else return i;return{done:!0,value:void 0}}}Z.prototype.skip=function(D){return new ie(this,D)};class ae extends Z{constructor(i,P){super(i),this._stepped=0,this._step=P<=0?1:P|0}next(){let i=super.next();for(;!i.done;)if(this._stepped<this._step)this._stepped+=1,i=super.next();else return this._stepped=0,i;return{done:!0,value:void 0}}}Z.prototype.step=function(D){return new ae(this,D)};class ue extends Z{constructor(i,P){super(i),this._taken=0,this._count=(P<=0?0:P)|0}next(){return this._taken<this._count?(this._taken+=1,super.next()):{done:!0,value:void 0}}}Z.prototype.take=function(i){return new ue(this,i)};const ce=D=>D,he=D=>D;class le extends Z{constructor(i,P=ce,I=he){super(i),this._map=([T,p])=>[P(T,p),I(T,p)]}toObject(){return this.reduce({},(i,P)=>(i[P[0]]=P[1],i))}next(){const i=super.nextWithIndex();return i.done?i:{done:!1,value:this._map(i.value)}}}Z.prototype.toMap=function(i,P){return new le(this,i,P)};class de extends Z{constructor(i,P){super(i),this._fn=P}next(){return this._fn(this._iter)}}Z.prototype.unflatten=function(i){return new de(this,i)};class fe extends Z{constructor(i,P=1){super(i),this._current=void 0,this._depth=P}next(){if(this._current!==void 0){const i=this._current.next();if(i.done)this._current=void 0;else return i}return this._nextRecur()}_nextRecur(){const i=super.next();if(i.done)return i;if(this._depth>0){const P=dt(i.value).flatten(this._depth-1),I=P.next();return I.done?this._nextRecur():(this._current=P,I)}else return i}}Z.prototype.flatten=function(i=1){return new fe(this,i)};class pe extends Z{constructor(i){super(i),this.rng=i}iter(){return new Z(this)}next(){return{done:!1,value:this.rng.nextFloat()}}}class me extends Z{constructor(i,P=0,I=1){super(i),this.rng=i,this.min=P,this.max=I}iter(){return new Z(this)}nextFloat(){return this.rng.nextFloatInRange(this.min,this.max)}next(){return{done:!1,value:this.nextFloat()}}}class ge extends Z{constructor(i,P=0,I=ct){super(i),this.rng=i,this.min=P|0,this.max=I|0}iter(){return new Z(this)}nextInt(){return this.rng.nextIntInRange(this.min,this.max)}next(){return{done:!1,value:this.nextInt()}}}const ye=new Uint8Array(4);class Rt{nextFloat(){return this.nextInt()/ct}nextFloatInRange(i=0,P=1){return i+this.nextFloat()*(P-i)}nextIntInRange(i=0,P=ct){return Math.round(this.nextFloatInRange(i,P))}shuffle(i){const P=i.length;for(let I=0;I<P;I++){const T=I+this.nextIntInRange(0,P-I-1),p=i[I];i[I]=i[T],i[T]=p}return i}fromArray(i){return i.length?st(i[this.nextIntInRange(0,i.length-1)]):ot()}keyFromObject(i){return this.fromArray(Object.keys(i))}valueFromObject(i){return this.fromArray(Object.values(i))}fillBytes(i){const P=ye;for(let I=0,T=i.length;I<T;I++){const p=I%4;p===0&&kt(P,this.nextInt()),i[I]=P[p]}return i}[Symbol.iterator](){return this}iter(){return new Z(this)}next(){return{done:!1,value:this.nextInt()}}float(){return new pe(this)}uniformFloat(i=0,P=1){return new me(this,i,P)}uniformInt(i=0,P=ct){return new ge(this,i,P)}}class It extends Rt{constructor(i=423257940){super(),this.seed=i}setSeed(i=423257940){return this.seed=i,this}nextInt(){return this.seed=Math.imul(48271,this.seed)|0%ct,this.seed&ct}}const ve=new It;class _t extends Rt{constructor(i,P,I,T){super(),this.x=423257940,this.y=2829571177,this.z=2541948421,this.w=289122235,this.set(i,P,I,T)}static fromSeed(i){return new _t().setSeed(i)}setSeed(i){const P=ve.setSeed(i);return this.set(P.nextInt(),P.nextInt(),P.nextInt(),P.nextInt())}set(i=423257940,P=2829571177,I=2541948421,T=289122235){return this.x=i|0,this.y=P|0,this.z=I|0,this.w=T|0,this}nextInt(){const i=this.x,P=i^i<<11;this.x=this.y,this.y=this.z,this.z=this.w;const I=this.w;return this.w=I^I>>19^(P^P>>8),this.w}}new It;new _t;function Ee(){return Math.random().toString(36).substring(2)}function Pe(D){return D.toISOString().substring(0,7)}function Te(D){return new Date(D.getFullYear(),D.getMonth()+1,0).getDate()}function xe(D,i){return i.toLocaleDateString(D,{month:"short",weekday:"short",day:"numeric"})}function Ae(D,i){return i.toLocaleDateString(D,{month:"short"})}function Se(D,i){return i.toLocaleDateString(D,{weekday:"short"})}function ke(D,i){return D.getFullYear()===i.getFullYear()&&D.getMonth()===i.getMonth()&&D.getDate()===i.getDate()}const mt=new _t;function Re(D){return mt.setSeed(Yt(D)),`rgb(${mt.nextFloatInRange(64,192)}, ${mt.nextFloatInRange(64,192)}, ${mt.nextFloatInRange(64,192)})`}function Ie(){return new Promise((D,i)=>navigator.geolocation.getCurrentPosition(P=>D(P.coords),i))}async function Oe(D){const i=await fetch(`https://nominatim.openstreetmap.org/reverse.php?lat=${D.latitude}&lon=${D.longitude}&zoom=18&format=jsonv2`);if(!i.ok)throw new Error(await i.text());return(await i.json()).display_name}function Me(D,i){return i.createdAt.getMilliseconds()-D.createdAt.getMilliseconds()}export{Z as I,xe as a,Pe as b,Ee as c,jt as d,Ie as e,Oe as f,Ae as g,Se as h,ke as i,Re as j,Te as k,be as l,Ft as m,Pt as r,Me as s};
